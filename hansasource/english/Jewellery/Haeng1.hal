external inner function string 60 UserDefined(string,string);

event DefineWindows
begin
  real h,h1,hl,h2,h3,h4,h5,h6,h7,hs,v,vm,l,vs,f,v1,v2,t;
  string 255 label;
  
  SetLangMode(LangEnglish,"ENG",2);
  
  WindowBegin("Goods Receipt",PUDClass,CGview,-);
  SetWRect(20,80,870,620);
  Sizeable(-1,-1,0,0);
  UseView(PUVc);
  ActiveFieldOnNew("TransDate");      
  FormName(PurchaseForm);
  Tile(0,69+24,false,"",TransDate);
  v = 6; vs = 20;
  EditField(h=110,v,80, "No.",Normal,SerNr,false,TSerSClass);
  EditField(h2=300,v,82,"Trans. Date",Normal,TransDate,false,PasteCurDate);
  EditField(h,v+=20,80, "Sup. No.",Normal,VECode,false,VESClass);
  EditField(h2,v,-40,"Name",Normal,VEName,false,0);
  EditField(h,v+=20,80, "Pur. Order No.",ViewOnly,PONr,false,0);
  EditField(h2,v,80,"Location",Normal,Location,false,LocationSClass);
  TileButton(1,"Comment");
  TileButton(2,"Items");
  TileButton(3,"Currency");
  TileButton(4,"Extra Costs");
  TileButton(5,"Freight");
//  CheckBox(400,-20,0,"OK",OKFlag);
  Tile(1,50,false,"1",Comment);
  EditField(h,v=6,-20,"Comment",Normal,Comment,false,0);
  EditField(h,v+=vs,100,"Tags/Objects",Normal,Objects,false,ObjSClass);
  EditField(300,v,80,"PO Contract",ViewOnly,POCOSerNr,true,POCOSClass);
  EnterSkip(Math);
  CheckBox(400,v,0,"Price Incl #VAT#",InclVAT);
  Tile(2,220,true,"2",Math);
  v = 24;
  MatrixBegin(4,v,-50,-44,-,199);
  MatTypedRow(stp);
  MatOverStrike(ovst);
  Flip(0);
  MatCol(1,28,"Item",0,ArtCode,false,INSClass);
//  MatCol(1,84,"Var",0,VARList,true,VARSClass);
//  MatCol(1,144,"Qty",0,Quant,true,0);
  MatCol(1,94,"Qty",0,Quant,true,MATVARINSClass);
  EnterSkip(Spec);
  MatText(t=3,28,"Signature",true);
  MatCol(t,100,"",0,Sign,false,0);
  MatText(t,160,"Correction Date",true);
  MatCol(t,290,"UpdDate",0,UpdDate,false,0);
  Flip(1);
  MatColTL(1,144,"Unit",0,M4Code,ViewOnly,5,UnitCode,false,UnitSCLass);
  MatCol(1,184,"Description",0,Spec,false,0);
  MatCol(1,-485,"Location",0,Location,false,LocationSClass);
  MatCol(1,-430,"Serial No.",0,SerialNr,false,SerialNrSClass);
  MatCol(1,-320,"#Stock# Type",0,StockType,false,SetSClass);
  MatCol(1,-240,"Unit Price",0,UPrice,true,0);
  MatCol(1,-160,"Cost Price",0,CostPrice,true,0);
  MatCol(1,-80,"Sum",0,Sum,true,0);
  Flip(2);
  MatCol(1,144,"Description",0,Spec,false,0);
  MatCol(1,-350,"Location",0,Location,false,LocationSClass);
  MatCol(1,-280,"Serial No.",0,SerialNr,false,SerialNrSClass);
  MatCol(1,-150,"Best Before",0,BestBefore,false,0);
  MatCol(1,-60,"Batch Status",0,BatchStatus,false,BatchStatusSClass);
  Flip(3);
  MatCol(1,144,"Description",0,Spec,false,0);
  MatColTL(1,-404,"Item Cost",0,-1,ViewOnly,-1,InPrice,false,0);
  MatColTL(1,-324,"Price Varian.",0,-1,ViewOnly,-1,VarianceAmount,false,0);
  MatCol(1,-244,"Unit Price",0,UPrice,true,0);
  MatCol(1,-174,"Extra Cost",0,Extra,true,0);
  MatCol(1,-104,"Cost Price",0,CostPrice,true,0);
  MatCol(1,-34,"#V-Cd#",0,VATCode,false,VATCodeSClass);
  Flip(4);
  MatCol(1,144,"Description",0,Spec,false,0);
  MatCol(1,-350,"Sup Item No.",0,VEItemCode,false,0);
  MatColTL(1,-270,"#S.# Unit",0,M4Code,ViewOnly,5,VEUnit,false,UnitSCLass);
  MatCol(1,-200,"Sup. Qty",0,VEQuant,true,0);
  MatCol(1,-140,"Coeff.",0,Coefficient,true,0);
  MatCol(1,-90,"Base Price",0,BasePrice,false,0);
  Flip(5);
  MatCol(1,144,"Description",0,Spec,false,0);
  MatCol(1,-350,"#Stock# Type",0,StockType,false,SetSClass);
  MatCol(1,-250,"#Stock# A/C",0,CostAcc,false,AccSClass);
  MatCol(1,-175,"Purch. A/C",0,CredAcc,false,AccSClass);
  MatCol(1,-100,"Tags/Objects",0,Objects,false,ObjSClass);
  Flip(6);
  MatCol(1,144,"Description",0,Spec,false,0);
  MatCol(1,-340,"Customs No.",0,CustomsNr,false,0);
  MatCol(1,-240,"Country of O.",0,CountryOfOrg,false,CountrySClass);
  MatCol(1,-140,"From Pos.",0,PosCode,false,PosSClass);
  MatCol(1,-70,"To Position",0,ToPosCode,false,FreePosSClass);
  Flip(7);
  MatCol(1,144,"Description",0,Spec,false,0);
  MatCol(1,-250,"Serial No.",0,SerialNr,false,SerialNrSClass);
  MatCol(1,-135,"Width",0,UnitXval,true,0);
  MatCol(1,-90,"Height",0,UnitYval,true,0);
  MatCol(1,-45,"Depth",0,UnitZval,true,0);
  Flip(8);
  MatCol(1,144,"Description",0,Spec,false,0);
  MatCol(1,-420,"Fr. Cost",0,ShipCost,true,0);
  MatCol(1,-360,"Customs",0,CustomsCost,true,0);
  label = UserDefined("AccBlock","PUCost1");
  if (blank(label)) then begin label = "Cost 1";end;
  MatCol(1,-300,label,0,RowCost1,false,0);
  label = UserDefined("AccBlock","PUCost2");
  if (blank(label)) then begin label = "Cost 2";end;
  MatCol(1,-240,label,0,RowCost2,false,0);
  label = UserDefined("AccBlock","PUCost3");
  if (blank(label)) then begin label = "Cost 3";end;
  MatCol(1,-180,label,0,RowCost3,false,0);
  label = UserDefined("AccBlock","PUCost4");
  if (blank(label)) then begin label = "Cost 4";end;
  MatCol(1,-120,label,0,RowCost4,false,0);
  label = UserDefined("AccBlock","PUCost5");
  if (blank(label)) then begin label = "Cost 5";end;
  MatCol(1,-60,label,0,RowCost5,false,0);
  Flip(9);
  MatCol(1,144,"PO No.",0,PONr,false,POSClass);
  MatCol(1,194,"PO Row",0,OrdRow,false,0);
  MatCol(1,-370,"PO Recon.",0,PORecon,false,0);
  MatCol(1,-310,"Comment",0,POReconComment,false,0);
  MatCol(1,-200,"Inv. Recon.",0,VIRecon,false,0);
  MatCol(1,-130,"Comment",0,VIReconComment,false,0);
  Flip(10);
  MatCol(t=1,144,"Description",0,Spec,false,0);
  MatCol(t,-350,"#Supp.# Serial No",0,SuppSerialNr,true,0);
  MatCol(t,-200,"Metal",0,Metal,true,0);
  MatCol(t,-150,"Weight",0,RowWeight,true,0);
  MatCol(t,-100,"Size",0,Size,true,0);
  MatCol(t,-50,"Length",0,Length,true,0);
  Flip(11);
  MatCol(t=1,144,"Description",0,Spec,false,0);
  MatCol(t,-350,"Major Stone",0,MajStoneDet,true,0);
  MatCol(t,-250,"#Colour#",0,Colour,true,0);
  MatCol(t,-200,"Clarity",0,Clarity,true,0);
  MatCol(t,-150,"Cert",0,Cert,true,0);
  MatCol(t,-100,"Minor Stone",0,MinStoneDet,true,0);
  Flip(12);
  MatCol(t=1,144,"Description",0,Spec,false,0);
  MatCol(t,-400,"Watch Brand",0,WatchBrand,true,0);
  MatCol(t,-300,"Style Name",0,StyleName,true,0);
  MatCol(t,-200,"Watch Metal",0,WatchMetal,true,0);
  MatCol(t,-100,"Movement",0,Movement,true,0);
  Flip(13);
  MatCol(t=1,144,"Description",0,Spec,false,0);
  MatCol(t,-400,"Brc/Str",0,BrcStr,true,0);
  MatCol(t,-300,"Gender",0,Gender,true,0);
  MatCol(t,-200,"Other",0,Other,true,0);
  MatCol(t,-100,"Other 2",0,Other2,true,0);
  InsertRowTest;
  DeleteRowTest;
  EndMatrix;
  vs = 20;
  v = 18; VTab(-35,v,-16,v+vs,ToolFlip,1,"A");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,2,"B");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,3,"C");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,4,"D");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,5,"E");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,6,"F");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,7,"G");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,8,"H");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,9,"I");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,10,"J");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,11,"K");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,12,"L");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,13,"M");
  CheckBox(20,-40,0,"OK",OKFlag);
  EditField(104,-40,66,"Qty",ViewOnly,SumQuant,true,0);
  EditField(104,-20,66,"Ext. Tax",ViewOnly,TAX1Sum,true,0);
  EditField(-450,-40,70,"Freight",Normal,ShipCost,true,0);
  EditField(-300,-40,70,"Customs",Normal,CustomsCost,true,0);
  EditField(-130,-40,70,"Cost Price",ViewOnly,SumCostPrice,true,0);
  EditField(-450,-20,70,"Subtotal",Normal,SubTotal,true,0);
  EditField(-300,-20,70,"#VAT#",Normal,VATVal,true,0);
  EditField(-130,-20,70,"Total",ViewOnly,PayVal,true,0);
  Tile(3,70,false,"3",FrRate);
  vs = 20;
  EditField(h=110,v=6,50,"Currency",Normal,CurncyCode,false,CurncyCodeSClass);
  EditField(h2=295,v,50,"Rate",Normal,FrRate,true,0);
  EditField(h3=360,v,50,":",Normal,ToRateB1,true,0);
  StaticText(h3+60,v+12,"Base Currency 1",false);
  EditField(h,v+=vs,50,"Base Currency 1",Normal,BaseRate1,true,0);
  EditField(h3,v,50,":",Normal,ToRateB2,true,0);
  StaticText(h3+60,v+12,"Base Currency 2",false);
  EditField(h,v+=vs,50,"Base Currency 2",Normal,BaseRate2,true,0);
  Tile(4,70,false,"4",Cost1);
  vs = 20;
  label = UserDefined("AccBlock","PUCost1");
  if (blank(label)) then begin label = "Extra Cost 1";end;
  EditField(h=110,v=6,70,label,Normal,Cost1,false,0);
  label = UserDefined("AccBlock","PUCost2");
  if (blank(label)) then begin label = "Extra Cost 2";end;
  EditField(h2=295,v,70,label,Normal,Cost2,false,0);
  label = UserDefined("AccBlock","PUCost3");
  if (blank(label)) then begin label = "Extra Cost 3";end;
  EditField(h,v+=vs,70,label,Normal,Cost3,false,0);
  label = UserDefined("AccBlock","PUCost4");
  if (blank(label)) then begin label = "Extra Cost 4";end;
  EditField(h2,v,70,label,Normal,Cost4,false,0);
  label = UserDefined("AccBlock","PUCost5");
  if (blank(label)) then begin label = "Extra Cost 5";end;
  EditField(h,v+=vs,70,label,Normal,Cost5,false,0);
  Tile(5,130,false,"5",FreightCode);
  vs = 20; h2 = 255; 
  EditField(h=110,v=6,60,"Freight Company",Normal,FreightCode,false,FreightCompanySClass);
  EditField(h2,v,-40,"Reg.No.",Normal,FreightCompanyRegNr,false,0);
  EditField(h,v+=vs,-40,"Name",Normal,FreightCompany,false,0);
  EditField(h,v+=vs,-40,"Truck Information",Normal,TruckInfo,false,0);
  EditField(h,v+=vs,-40,"Driver",Normal,Driver,false,0);
  EditField(h,v+=vs,-40,"CMR",Normal,CMRText,false,0); // International transporting number
  EditField(h,v+=vs,50,"Language",Normal,LangCode,false,LangSClass);
  SpecialMenu("Print Labels",'e',0,"PrintPULabPUDsm");
  SpecialMenu("Update Prices",' ',1,"UpdatePricesPUDsm");
  SpecialMenu("Generate Serial Nos.",' ',2,"GenSerialNosPUDsm");
  SpecialMenu("Create #Purchase Invoice#",'F',3,"VIFromPUDsm");
  SpecialMenu("Open #NL# Transaction",'t',4,"OpenTRFromPU");
  SpecialMenu("Open Batch Specification",' ',5,"OpenBatchPUDsm");
//  SpecialMenu("Update Mark",' ',6,"UpdateMarkPUDsm");
  SpecialMenu("Create Returned Goods",'B',7,"RetPUFromPUDsm");
//  SpecialMenu("Create #Stock# Movement",' ',5,"StockMovFromPUSpec");
  SpecialMenu("Split Row",' ',7,"SplitRowPUDsm");
//  SpecialMenu("Scan",' ',8,"ScanBarCodePUDsm");
  SpecialMenu("Create #Stock# Transfer",' ',8,"INTransFromPUsm");
  SpecialMenu("Accept Warehouse #Stock# Movements",' ',9,"OKStockMovPUrDsm");
  SpecialMenu("Quality Control",'u',10,"QualConFromPUDsm");
  SpecialMenu("Item Search",'f',1,"ItemSearchDsm");
  EndWindow;

  WindowBegin("Returned Goods to #Supplier#",RetPUDClass,CGview,-);
  SetWRect(20,80,620,380);
  Sizeable(-1,-1,0,0);
  UseView(RetPUVc);
  FormName(RetPurchaseForm);
  Tile(0,49+24,false,"",TransDate);
  v = 6; vs = 20;
  EditField(h=110,v,80, "No.",Normal,SerNr,false,TSerSClass);
  EditField(h2=300,v,82,"Trans. Date",Normal,TransDate,false,PasteCurDate);
  EditField(h2+300,v,80,"Reason",Normal,Reason,false,StandProblemsSClass);  
  EditField(h,v+=20,80, "#Supplier#",ViewOnly,VECode,false,0);
  EditField(h2,v,-40,"Name",ViewOnly,VEName,false,0);
  TileButton(1,"Location");
  TileButton(2,"Items");
  TileButton(3,"Currency");
  TileButton(4,"Address");
  TileButton(5,"Freight");
//  TileButton(6,"Extra Costs");
  Tile(1,70,false,"1",Location);
  EditField(h,v=6,80,"Location",Normal,Location,false,LocationSClass);
//  CheckBox(h2,v,0,"Update #Stock#",UpdStockFlag);
  EditField(h,v+=vs,80, "Pur. Order No.",ViewOnly,PONr,false,0);
  EditField(h,v+=vs,-200,"Comment",Normal,Comment,false,0);
  ButtonFrame(-180,v=16,170,2,"Reduce");
  RadioButton(-180,v,0,0,"Received Quantity",Type);
  RadioButton(-180,v+=16,1,0,"Ordered and Received Qty",Type);
/*
  CheckBox(200,-20,0,"Price Incl #VAT#",InclVAT);
*/  
  EnterSkip(Math);
  Tile(2,79,true,"2",Math);
  v = 24;
  MatrixBegin(4,v,-50,-22,-,199);
  Flip(0);
  MatCol(1,24,"Serial No.",0,SerialNr,false,SerialNrSClass);
  MatCol(1,130,"Item",0,ArtCode,false,INSClass);
  Flip(1);
  MatCol(1,250,"Qty",0,Quant,true,0);
  MatCol(1,300,"Description",0,Spec,false,0);
  MatCol(1,-200,"Location",0,Location,false,0);
  MatCol(1,-140,"#Supplier# Item No.",0,VEItemCode,false,0);
  MatCol(1,-40,"Coeff.",0,Coefficient,true,0);
  Flip(2);
  MatCol(1,174,"Description",0,Spec,false,0);
//  MatColTL(1,-310,"Location",0,M4UStr,Normal,0,Location,false,0);
  MatColTL(1,-300,"GR CostPrice",0,-1,ViewOnly,-1,PUCostPrice,false,0);
  MatColTL(1,-220,"Price Var.",0,-1,ViewOnly,-1,VarianceAmount,false,0);
  MatCol(1,-160,"FIFO",0,FIFO,true,0);
  MatCol(1,-90,"Row FIFO",0,FIFORowVal,true,0);
  Flip(3);
  MatCol(1,174,"Description",0,Spec,false,0);
  MatCol(1,-300,"Position",0,PosCode,false,PosSClass);
  MatCol(1,-235,"Serial No.",0,SerialNr,false,SerialNrSClass);
  MatCol(1,-135,"Width",0,UnitXval,true,0);
  MatCol(1,-90,"Height",0,UnitYval,true,0);
  MatCol(1,-45,"Depth",0,UnitZval,true,0);
  Flip(4);
  MatCol(1,164,"Description",0,Spec,false,0);
  MatCol(1,-260,"GR No.",0,PUNr,false,PUSClass);
  MatCol(1,-190,"GR Row",0,PURow,false,0);
  MatCol(1,-130,"PO No.",0,PONr,false,POSClass);
  MatCol(1,-60,"PO Row",0,OrdRow,false,0);
/*  
  Flip(5);
  MatCol(1,164,"Description",0,Spec,false,0);
  MatCol(1,-420,"Fr. Cost",0,ShipCost,true,0);
  MatCol(1,-360,"Customs",0,CustomsCost,true,0);
  label = UserDefined("AccBlock","PUCost1");
  if (blank(label)) then begin label = "Cost 1";end;
  MatCol(1,-300,label,0,RowCost1,false,0);
  label = UserDefined("AccBlock","PUCost2");
  if (blank(label)) then begin label = "Cost 2";end;
  MatCol(1,-240,label,0,RowCost2,false,0);
  label = UserDefined("AccBlock","PUCost3");
  if (blank(label)) then begin label = "Cost 3";end;
  MatCol(1,-180,label,0,RowCost3,false,0);
  label = UserDefined("AccBlock","PUCost4");
  if (blank(label)) then begin label = "Cost 4";end;
  MatCol(1,-120,label,0,RowCost4,false,0);
  label = UserDefined("AccBlock","PUCost5");
  if (blank(label)) then begin label = "Cost 5";end;
  MatCol(1,-60,label,0,RowCost5,false,0);
*/  
  DeleteRowTest;
  InsertRowTest;
  EndMatrix;
  vs = 20;
  v = 18; VTab(-35,v,-16,v+vs,ToolFlip,1,"A");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,2,"B");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,3,"C");
  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,4,"D");
//  v=v+ vs; VTab(-35,v,-16,v+vs,ToolFlip,4,"D");
  CheckBox(20,-20,0,"OK",OKFlag);
  EditField(120,-20,70,"Qty",ViewOnly,SumQuant,true,0);
//  EditField(-450,-20,70,"Freight",Normal,ShipCost,true,0);
//  EditField(-300,-20,70,"Customs",Normal,CustomsCost,true,0);
  EditField(-130,-20,70,"Cost Price",ViewOnly,SumCostPrice,true,0);
  Tile(3,70,false,"3",FrRate);
  vs = 20;
  EditField(h=130,v=6,50,"Currency",Normal,CurncyCode,false,CurncyCodeSClass);
  EditField(h2=295,v,50,"Rate",Normal,FrRate,true,0);
  EditField(h3=360,v,50,":",Normal,ToRateB1,true,0);
  StaticText(h3+60,v+12,"Base Currency 1",false);
  EditField(h,v+=vs,50,"Base Currency 1",Normal,BaseRate1,true,0);
  EditField(h3,v,50,":",Normal,ToRateB2,true,0);
  StaticText(h3+60,v+12,"Base Currency 2",false);
  EditField(h,v+=vs,50,"Base Currency 2",Normal,BaseRate2,true,0);
  Tile(4,130,false,"4",DelAddr0);
  vs = 20;
  EditField(h=130,v=6,-40,"Address",Normal,DelAddr0,false,0);
  EditField(h,v+=vs,-40,"",Normal,DelAddr1,false,0);
  EditField(h,v+=vs,-40,"",Normal,DelAddr2,false,0);
  EditField(h,v+=vs,-40,"",Normal,DelAddr3,false,0);
  EditField(h,v+=vs,-40,"",Normal,DelAddr4,false,0);
  EditField(h,v+=vs,80,"Address",Normal,DelAddrCode,false,DelAddrSClass);
  Tile(5,130,false,"5",FreightCode);
  vs = 20; h2 = 255; 
  EditField(h=130,v=6,60,"Freight Company",Normal,FreightCode,false,FreightCompanySClass);
  EditField(h2,v,-40,"Reg.No.",Normal,FreightCompanyRegNr,false,0);
  EditField(h,v+=vs,-40,"Name",Normal,FreightCompany,false,0);
  EditField(h,v+=vs,-40,"Truck Information",Normal,TruckInfo,false,0);
  EditField(h,v+=vs,-40,"Driver",Normal,Driver,false,0);
  EditField(h,v+=vs,-40,"CMR",Normal,CMRText,false,0);
/*  
  Tile(5,70,false,"5",Cost1);
  vs = 20;
  label = UserDefined("AccBlock","PUCost1");
  if (blank(label)) then begin label = "Extra Cost 1";end;
  EditField(h=110,v=6,70,label,Normal,Cost1,false,0);
  label = UserDefined("AccBlock","PUCost2");
  if (blank(label)) then begin label = "Extra Cost 2";end;
  EditField(h2=295,v,70,label,Normal,Cost2,false,0);
  label = UserDefined("AccBlock","PUCost3");
  if (blank(label)) then begin label = "Extra Cost 3";end;
  EditField(h,v+=vs,70,label,Normal,Cost3,false,0);
  label = UserDefined("AccBlock","PUCost4");
  if (blank(label)) then begin label = "Extra Cost 4";end;
  EditField(h2,v,70,label,Normal,Cost4,false,0);
  label = UserDefined("AccBlock","PUCost5");
  if (blank(label)) then begin label = "Extra Cost 5";end;
  EditField(h,v+=vs,70,label,Normal,Cost5,false,0);
*/  
  SpecialMenu("Create #Credit Note#",'K',0,"CredVIFromRetPUDsm");
  SpecialMenu("Open #NL# Transaction",'t',1,"OpenTRFromRetPU");
  SpecialMenu("Quality Control",'u',10,"QualConFromRetPUDsm");
  EndWindow;

  return;
end;
