external function string 200 GetWebLanguage();
external procedure ToolWebOutMailText(record MailVc,string);
external procedure ToolWebHBSShopLine(string,string,string,string,Boolean);
external function string 200 ToolWebReturnTheText(Integer);
external procedure ToolWebLineStart();
external procedure ToolWebLineEnd();
external procedure ToolWebStartTable();
external procedure ToolWebEndTable();
external procedure ToolWebGetTextLang(record MailVc,LongInt,record MailVc,string);
external procedure ToolWebOutTextLang(record MailVc,string);
external procedure GetConfInfo(string,var string,var string,var LongInt);
external procedure ToolWebHiddenField(string,string);
external procedure ToolWebGetTheText(Integer,var string);
external procedure PrintHeaderLang(string,string,string);
external procedure ToolWebHBSReadMore(string);

procedure ToolWebOutTheMail(record MailVc Mailr,LongInt maxchars,string sortorder,Boolean skipspecial,Boolean clickable,Boolean incheader)
begin
  record MailVc Mail2r;

  if (incheader) then begin
    ToolWebGetTextLang(Mailr,maxchars,Mail2r,GetWebLanguage);
    PrintHeaderLang(Right(Mailr.Header,Len(Mailr.Header)-3),Mailr.Header,Right(Mail2r.Header,Len(Mail2r.Header)-3));
  end;
  if (clickable) then begin
    WebOutString("<a href=""");
    WebOutLink("WebHBSMailFAQView.hal?sessionid=" & WebGetArg("sessionid") & "&mailnumber=" & Mailr.SerNr & "&langcode=" & WebGetArg("langcode"));
    WebOutString(""" target=""_blank"">");
  end;
  if ((maxchars>-1) and (sortorder<>"000") and ((sortorder<>"999"))) then begin
    if (incheader==false) then begin // Speedup only
      ToolWebGetTextLang(Mailr,maxchars,Mail2r,GetWebLanguage);
    end;
    ToolWebOutMailText(Mail2r,"");
  end else begin
    if ((sortorder=="000") or ((sortorder=="999"))) then begin
      if (skipspecial==false) then begin
        ToolWebOutTextLang(Mailr,Mailr.Header);
      end;
    end else begin
      ToolWebOutTextLang(Mailr,Mailr.Header);
    end;
  end;
  if (clickable) then begin
    WebOutString("</a>");
    WebOutString("<p>");
  end;
  return;
end;

procedure ToolWebOutTheMailMain(record MailVc Mailr,LongInt maxchars)
begin
  record MailVc Mail2r;

  ToolWebGetTextLang(Mailr,maxchars,Mail2r,GetWebLanguage);
  PrintHeaderLang(Right(Mailr.Header,Len(Mailr.Header)-3),Mailr.Header,Right(Mail2r.Header,Len(Mail2r.Header)-3));
  if (maxchars>-1) then begin
    ToolWebOutMailText(Mail2r,"");
  end else begin
    ToolWebOutTextLang(Mailr,Mailr.Header);
  end;
  return;
end;

procedure ToolWebOutTheMailOneLink(record MailVc Mailr,LongInt maxchars)
begin
  record MailVc Mail2r;
  string 250 tstr,tstr2;

  ToolWebGetTextLang(Mailr,maxchars,Mail2r,GetWebLanguage);
  tstr = Right(Mailr.Header,Len(Mailr.Header)-3);
  tstr2 = Right(Mail2r.Header,Len(Mail2r.Header)-3);
  if ((nonblank(tstr)) or (nonblank(tstr2))) then begin
    ToolWebLineStart;
    WebOutString("<td width=""20%"" class=""deftxt"">");
    WebOutString(Mailr.TransDate);
    WebOutString("</td>");
    WebOutString("<td width=""80%"" class=""mnu-lvl-2"">");
    WebOutNL;
    WebOutString("<a href=""");
    WebOutLink("WebHBSMailFAQView.hal?sessionid=" & WebGetArg("sessionid") & "&langcode=" & WebGetArg("langcode") & "&mailnumber=" & Mailr.SerNr);
    WebOutString(""" target=""content"">");
    if (nonblank(tstr2)) then begin
      WebOutString(tstr2);
    end else begin
      WebOutString(tstr);
    end;
    WebOutString("</a>");
    WebOutNL;
    WebOutString("</td>");
    WebOutNL;
    ToolWebLineEnd;
  end;
  return;
end;

procedure ToolWebOutTheMailLink(record MailVc Mailr,LongInt maxchars,var Integer cnt)
begin
  record MailVc Mail2r;
  string 250 tstr,tstr2;

  ToolWebGetTextLang(Mailr,maxchars,Mail2r,GetWebLanguage);
  tstr = Right(Mailr.Header,Len(Mailr.Header)-3);
  tstr2 = Right(Mail2r.Header,Len(Mail2r.Header)-3);
  if ((nonblank(tstr)) or (nonblank(tstr2))) then begin
    if (Left(Mailr.Header,3)=="000") then begin
      WebOutString("<td class=""heading3"" colspan=""3"">");
      if (nonblank(tstr2)) then begin
        WebOutString(tstr2);
      end else begin
        WebOutString(tstr);
      end;
      WebOutString("</td>");
      WebOutNL;
      ToolWebLineEnd;
      ToolWebLineStart;
    end else begin
      if (Mid(Mailr.Header,1,2)=="00") then begin
        cnt = 0;
        ToolWebLineEnd;
        ToolWebLineStart;
        WebOutString("<td class=""mnu-lvl-3"" colspan=""3"">");
        WebOutString("&nbsp;");
        WebOutString("</td>");
        WebOutNL;
        ToolWebLineEnd;
        ToolWebLineStart;
        WebOutString("<td class=""mnu-lvl-3"" colspan=""3"">");
        WebOutNL;
      end else begin
        if (cnt==4) then begin
          cnt = 0;
          ToolWebLineEnd;
          ToolWebLineStart;
        end;
        WebOutString("<td width=""160"" class=""mnu-lvl-2"">");
        cnt = cnt + 1;
      end;
      WebOutNL;
      WebOutString("<a href=""");
      WebOutLink("WebHBSMailFAQView.hal?sessionid=" & WebGetArg("sessionid") & "&langcode=" & WebGetArg("langcode") & "&mailnumber=" & Mailr.SerNr);
      WebOutString(""" target=""content"">");
      if (nonblank(tstr2)) then begin
        WebOutString(tstr2);
      end else begin
        WebOutString(tstr);
      end;
      WebOutString("</a>");
      WebOutNL;
      WebOutString("</td>");
      WebOutNL;
      if (Mid(Mailr.Header,1,2)=="00") then begin
        ToolWebLineEnd;
        ToolWebLineStart;
      end;
    end;
  end;
  return;
end;

procedure ToolWebOutTheNewsStyle(record MailVc Mailr,LongInt maxchars)
begin
  record MailVc Mail2r;

  ToolWebGetTextLang(Mailr,maxchars,Mail2r,GetWebLanguage);
  WebOutString("<tr valign=""top""><td><img src=""gfx/dot09.gif"" width=""11"" height=""13"" border=""0"" alt=""""></td>");
  WebOutString("<td class=""listing"">");
/*
  WebOutString("<a href=javascript:jsOpenReadMore(""");
  WebOutLink("WebHBSMailNewsView.hal?sessionid=" & WebGetArg("sessionid") & "&mailnumber=" & Mailr.SerNr & "&langcode=" & WebGetArg("langcode"));
  WebOutString(""")>");
*/
  WebOutString("<a href=""");
  WebOutLink("WebHBSMailNewsView.hal?sessionid=" & WebGetArg("sessionid") & "&mailnumber=" & Mailr.SerNr & "&langcode=" & WebGetArg("langcode"));
  WebOutString(""" target=""content"">");
  WebOutNL;
  ToolWebOutMailText(Mail2r,"");
  WebOutNL;
  WebOutString("</a>");
  WebOutString("<div class=""date"">" & Right(Mailr.Header,Len(Mailr.Header)-3) & "</div>");
  WebOutString("</td>");
  WebOutString("</tr>");
  WebOutString("<p>");
  return;
end;

procedure ToolWebOutTheBulletStyle(record MailVc Mailr,LongInt maxchars)
begin
  record MailVc Mail2r;

  ToolWebGetTextLang(Mailr,maxchars,Mail2r,GetWebLanguage);
  WebOutString("<tr valign=""top""><td><img src=""gfx/dot10.gif"" width=""11"" height=""13"" border=""0"" alt=""""></td>");
  WebOutString("<td class=""listing"">");
/*
  WebOutString("<a href=javascript:jsOpenReadMore(""");
  WebOutLink("WebHBSMailNewsView.hal?sessionid=" & WebGetArg("sessionid") & "&mailnumber=" & Mailr.SerNr & "&langcode=" & WebGetArg("langcode"));
  WebOutString(""")>");
*/
  WebOutString("<a href=""");
  WebOutLink("WebHBSMailFAQView.hal?sessionid=" & WebGetArg("sessionid") & "&mailnumber=" & Mailr.SerNr & "&langcode=" & WebGetArg("langcode"));
  WebOutString(""" target=""content"">");
  WebOutNL;
  ToolWebOutMailText(Mail2r,"");
  WebOutNL;
  WebOutString("</a>");
  WebOutString("</td>");
  WebOutString("</tr>");
  WebOutString("<p>");
  return;
end;

global
Function Boolean ToolWebHBSPublicMain(string thecode,LongInt norofmails,LongInt maxchars,Boolean skipspecial,Boolean clickable)
begin
  record MailVc Mailr;
  string 60 ckey;
  string 10 sortorder;
  LongInt loopcnt;
  LongInt maxmail;
  Boolean foundf;
  string 60 confcode;
  string 60 confname;
  Boolean res;

  loopcnt = 0;
  res = false;
  GetConfInfo(thecode,confname,confcode,maxmail);
  if (norofmails>-1) then begin
    if (norofmails>1) then begin
      maxmail = norofmails;
    end else begin
      maxmail = 1;
    end;
  end;
  ckey = "UserSubject:" & confcode;
  foundf = true;
  while (LoopKey(ckey,Mailr,1,foundf)) begin
    sortorder = Left(Mailr.Header,3);
    if (foundf) then begin
      if (sortorder<>"000") then begin
        loopcnt = loopcnt + 1;
      end;
      if (maxmail>-1) then begin
        if (loopcnt>maxmail) then begin
          foundf = false;
        end;
      end;
      if (foundf) then begin
        if (maxmail>1) then begin
          ToolWebOutTheMail(Mailr,maxchars,sortorder,skipspecial,clickable,true);
          ToolWebHBSReadMore("WebHBSMailFAQView.hal?sessionid=" & WebGetArg("sessionid") & "&langcode=" & WebGetArg("langcode") & "&mailnumber=" & Mailr.SerNr);
        end else begin
          ToolWebOutTheMail(Mailr,maxchars,sortorder,skipspecial,clickable,false);
          res = true;
        end;
      end;
    end;
  end;
  ToolWebHBSPublicMain = res;
  return;
end;

global
procedure ToolWebPublicMailMain(string thecode,LongInt maxchars)
begin
  record MailVc Mailr;
  string 60 ckey;
  string 10 sortorder;
  Boolean foundf;
  string 60 confcode;
  string 60 confname;
  Boolean res;
  LongInt maxmail;

  res = false;
  GetConfInfo(thecode,confname,confcode,maxmail);
  ckey = "UserSubject:" & confcode;
  foundf = true;
  while (LoopKey(ckey,Mailr,1,foundf)) begin
    sortorder = Left(Mailr.Header,3);
    if (foundf) then begin
      ToolWebOutTheMailMain(Mailr,maxchars);
      ToolWebHBSReadMore("WebHBSMailFAQView.hal?sessionid=" & WebGetArg("sessionid") & "&langcode=" & WebGetArg("langcode") & "&mailnumber=" & Mailr.SerNr);
    end;
  end;
  return;
end;

global
procedure ToolWebPublicMailLink(string thecode,LongInt maxchars)
begin
  record MailVc Mailr;
  string 60 ckey;
  string 10 sortorder;
  Boolean foundf;
  string 60 confcode;
  string 60 confname;
  Boolean res;
  LongInt maxmail;
  Integer cnt;

  cnt = 1;
  res = false;
  GetConfInfo(thecode,confname,confcode,maxmail);
  ckey = "UserSubject:" & confcode;
  foundf = true;
  WebOutString("<table width=""480""  border=""0"" cellspacing=""0"" cellpadding=""0"">");
  ToolWebLineStart;
  while (LoopKey(ckey,Mailr,1,foundf)) begin
    sortorder = Left(Mailr.Header,3);
    if (foundf) then begin
      ToolWebOutTheMailLink(Mailr,maxchars,cnt);
    end;
  end;
  ToolWebLineEnd;
  ToolWebEndTable;
  return;
end;

global
procedure ToolWebPublicMailNews(string thecode,LongInt maxchars)
begin
  record MailVc Mailr;
  string 60 ckey;
  string 10 sortorder;
  Boolean foundf;
  string 60 confcode;
  string 60 confname;
  Boolean res;
  LongInt maxmail;

  res = false;
  WebOutString("<table cellspacing=""0"" cellpadding=""5"" border=""0"">");
  GetConfInfo(thecode,confname,confcode,maxmail);
  ckey = "UserSubject:" & confcode;
  foundf = true;
  Mailr.Header = "9999999";
  while (LoopBackKey(ckey,Mailr,1,foundf)) begin
    sortorder = Left(Mailr.Header,3);
    if (foundf) then begin
      ToolWebOutTheNewsStyle(Mailr,maxchars);
    end;
  end;
  WebOutString("</table>");
  return;
end;

global
procedure ToolWebPublicMailBullet(string thecode,LongInt maxchars)
begin
  record MailVc Mailr;
  string 60 ckey;
  string 10 sortorder;
  Boolean foundf;
  string 60 confcode;
  string 60 confname;
  Boolean res;
  LongInt maxmail;

  res = false;
  WebOutString("<table cellspacing=""0"" cellpadding=""5"" border=""0"">");
  GetConfInfo(thecode,confname,confcode,maxmail);
  ckey = "UserSubject:" & confcode;
  foundf = true;
  Mailr.Header = "9999999";
  while (LoopBackKey(ckey,Mailr,1,foundf)) begin
    sortorder = Left(Mailr.Header,3);
    if (foundf) then begin
      ToolWebOutTheBulletStyle(Mailr,maxchars);
    end;
  end;
  WebOutString("</table>");
  return;
end;

global
procedure ToolWebFAQSearch(string whichone,LongInt norofmails,LongInt maxchars)
begin
  record MailVc Mailr;
  string 60 ckey;
  string 10 sortorder;
  LongInt loopcnt;
  LongInt maxmail;
  Boolean foundf;
  string 60 confcode;
  string 60 confname;

  loopcnt = 0;
  GetConfInfo(whichone,confname,confcode,maxmail);
  if (norofmails>0) then begin
    maxmail = norofmails;
  end;
  WebOutNL;
  WebOutString("<form method=""post"" action=""");
  WebOutLink("WebHBSFAQSearch.hal?sessionid=" & WebGetArg("sessionid") & "&langcode=" & WebGetArg("langcode"));
  WebOutString(""">");
  WebOutNL;
  ckey = "UserSubject:" & confcode;
  foundf = true;
  while (LoopKey(ckey,Mailr,1,foundf)) begin
    sortorder = Left(Mailr.Header,3);
    if (foundf) then begin
      loopcnt = loopcnt + 1;
      if (maxmail>-1) then begin
        if (loopcnt>maxmail) then begin
          foundf = false;
        end;
      end;
      if (foundf) then begin
        ToolWebOutTextLang(Mailr,Mailr.Header);
      end;
    end;
  end;
  WebOutString("</form>");
  WebOutNL;
  return;
end;

/*
global
procedure ToolWebFAQNewQuestion(string whichone,LongInt norofmails,LongInt maxchars)
begin
  record MailVc Mailr;
  string 60 ckey;
  string 10 sortorder;
  LongInt loopcnt;
  LongInt maxmail;
  Boolean foundf;
  string 60 confcode;
  string 60 confname;

  loopcnt = 0;
  GetConfInfo(whichone,confname,confcode,maxmail);
  if (norofmails>0) then begin
    maxmail = norofmails;
  end;
  WebOutNL;
  WebOutString("<table width=""480"" border=""0"" cellpadding=""3"">");
  WebOutString("<tr>");
  WebOutString("<td width=""100%"">");
  WebOutNL;
  WebOutString("<form name=""HansaForm"" method=""post"" action=""");
  WebOutLink("WebHBSFAQDoNewQuest.hal?sessionid=" & WebGetArg("sessionid") & "&langcode=" & WebGetArg("langcode"));
  WebOutString(""">");
  WebOutNL;
  ToolWebHiddenField("WEBPAGE",WebGetArg("WEBPAGE"));
//  ToolWebHiddenField("WEBPAGE","NEWQUEST"); // Hardcoded code, not good.
  ckey = "UserSubject:" & confcode;
  foundf = true;
  while (LoopKey(ckey,Mailr,1,foundf)) begin
    sortorder = Left(Mailr.Header,3);
    if (foundf) then begin
      loopcnt = loopcnt + 1;
      if (maxmail>-1) then begin
        if (loopcnt>maxmail) then begin
          foundf = false;
        end;
      end;
      if (foundf) then begin
        ToolWebOutTextLang(Mailr,Mailr.Header);
      end;
    end;
  end;
  WebOutString("</form>");
  WebOutString("</td>");
  WebOutString("</tr>");
  WebOutString("</table>");
  WebOutNL;
  return;
end;
*/

global
procedure ToolWebFAQNewQuestionThanks(string whichone,LongInt norofmails,LongInt maxchars)
begin
  record MailVc Mailr;
  string 60 ckey;
  string 10 sortorder;
  LongInt loopcnt;
  LongInt maxmail;
  Boolean foundf;
  string 60 confcode;
  string 60 confname;

  loopcnt = 0;
  GetConfInfo(whichone,confname,confcode,maxmail);
  if (norofmails>0) then begin
    maxmail = norofmails;
  end;
  WebOutNL;
  ckey = "UserSubject:" & confcode;
  foundf = true;
  WebOutString("<table width=""480"" border=""0"" cellpadding=""3"">");
  WebOutString("<tr>");
  WebOutString("<td width=""100%"">");
  WebOutNL;
  while (LoopKey(ckey,Mailr,1,foundf)) begin
    sortorder = Left(Mailr.Header,3);
    if (foundf) then begin
      loopcnt = loopcnt + 1;
      if (maxmail>-1) then begin
        if (loopcnt>maxmail) then begin
          foundf = false;
        end;
      end;
      if (foundf) then begin
        ToolWebOutTextLang(Mailr,Mailr.Header);
      end;
    end;
  end;
  WebOutString("</td>");
  WebOutString("</tr>");
  WebOutString("</table>");
  WebOutNL;
  return;
end;

Function
Boolean ToolWebSearchMailLang(record MailVc Mailr,string searchstr,Boolean alllangs)
begin
  record NotepadVc Noter;
  record RLinkVc RLr;
  Integer cnt;
  Boolean res,langfound;

  res = false;
  langfound = false;
  cnt = 1;
  while (ReadRecordLink(Mailr,cnt,Noter,RLr)) begin
    cnt = cnt + 1;
    if (alllangs==false) then begin
      if (WebGetArg("langcode")==Noter.LangCode) then begin // WebLanguage(1)
        langfound = true;
        AddToText(Right(RLr.Comment,Len(RLr.Comment)-3),Noter);
        if (StringInText(searchstr,Noter)) then begin
          res = true;
          goto LWebSML;
        end;
      end;
    end else begin
      AddToText(Right(RLr.Comment,Len(RLr.Comment)-3),Noter);
      if (StringInText(searchstr,Noter)) then begin
        res = true;
        goto LWebSML;
      end;
    end;
  end;
  if ((langfound==false) or (alllangs)) then begin
    AddToText(Right(Mailr.Header,Len(Mailr.Header)-3),Mailr);
    if (StringInText(searchstr,Mailr)) then begin
      res = true;
    end;
  end;
LWebSML:;
  ToolWebSearchMailLang = res;
  return;
end;

// We don't have attachements anymore, but I will leave the code, it might be useful
Function
Boolean ToolWebSearchMailLangAnswers(record MailVc Mailr,string searchstr,Boolean alllangs)
begin
  record MailVc Mail2r;
  record RLinkVc RLr;
  Integer cnt;
  Boolean res,langfound;

  res = false;
  langfound = false;
  cnt = 1;
  while (ReadRecordLink(Mailr,cnt,Mail2r,RLr)) begin
    cnt = cnt + 1;
    if (ToolWebSearchMailLang(Mail2r,searchstr,alllangs)) then begin
      res = true;
      goto LWebSMLA;
    end;
  end;
  if ((langfound==false) or (alllangs)) then begin
    AddToText(Right(Mailr.Header,Len(Mailr.Header)-3),Mailr);
    if (StringInText(searchstr,Mailr)) then begin
      res = true;
    end;
  end;
LWebSMLA:;
  ToolWebSearchMailLangAnswers = res;
  return;
end;

procedure ToolWebFAQSearchConf(string whichone,string searchstr,string langprefix,Boolean squestion,Boolean sanswer,Boolean alllangs)
begin
  record MailVc Mailr;
  record MailVc Mail2r;
  string 60 ckey;
  string 10 sortorder;
  Boolean foundf,testf;
  string 60 confcode;
  string 60 confname;
  LongInt maxmail;

  GetConfInfo(whichone,confname,confcode,maxmail);
  ckey = "UserSubject:" & confcode;
  foundf = true;
  Mailr.Header = langprefix;
  while (LoopKey(ckey,Mailr,1,foundf)) begin
    sortorder = Left(Mailr.Header,3);
    testf = true;
    if (foundf==false) then begin
      testf = false;
    end;
    if ((squestion==false) and (sanswer==false)) then begin
      testf = false;
    end;
    if (nonblank(langprefix)) then begin
      if (Left(Mailr.Header,3)!=langprefix) then begin
        testf = false;
      end;
    end;
    if (testf) then begin
      if (squestion) then begin
        if (ToolWebSearchMailLang(Mailr,searchstr,alllangs)==false) then begin
          testf = false;
        end;
      end;
    end;
    if (testf) then begin
      if (sanswer) then begin
        if (ToolWebSearchMailLangAnswers(Mailr,searchstr,alllangs)==false) then begin
          testf = false;
        end;
      end;
    end;
    if (testf) then begin
      ToolWebOutTheMailOneLink(Mailr,255);
    end;
  end;
  return;
end;

procedure GetLangPrefix(var string langprefix)
begin
  switch (CurrentCompany) begin
    case 19: langprefix = "DEN";
    case 25: langprefix = "EST";
    case 74: langprefix = "RAM";
    case 40: langprefix = "FIN";
    case 26: langprefix = "LAT";
    case 28: langprefix = "LIT";
    case 24: langprefix = "NOR";
    case 36: langprefix = "POL";
    case 29: langprefix = "RUS";
    case 39: langprefix = "SWE";
    case 63: langprefix = "ENG";
    case 37: langprefix = "ENG";
    otherwise langprefix = "";
  end;
  return;
end;

global
procedure ToolWebFAQSearchResult(var string searchstr,string frompage,string prod,string lang,string where)
begin
  record WebPagesVc WPr;
  row WebPagesVc WPrw;
  Integer rwcnt,i;
  Boolean squestion,sanswer,alllangs;
  Integer oldcomp;
  Boolean res;
  string 20 langprefix;

  GetLangPrefix(langprefix);
  if (searchstr=="*") then begin
    searchstr = " ";
  end;
  squestion = true;
  sanswer = false;
  alllangs = false;
  oldcomp = CurrentCompany;  
  res = SetCompany(1,false);
  WPr.Code = frompage;
  if (ReadFirstMain(WPr,1,true)) then begin
    rwcnt = MatRowCnt(WPr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(WPr,i,WPrw);
      ToolWebFAQSearchConf(WPrw.ConfCode,searchstr,langprefix,squestion,sanswer,alllangs);
    end;
  end;
  ResetCompany(oldcomp);
  return;
end;

global
procedure ToolWebFAQDoNewQuest(string custcode)
begin
  record CUVc CUr;
  record WebPagesVc WPr;
  record ConfVc Confr;
  row WebPagesVc WPrw;
  Integer rwcnt,i,selected;
  Boolean foundf;
  string 10 cucodpart;
  string 60 confcode;
  string 60 confname;
  LongInt maxmail;
  string 200 tstr;
  string 200 defmailaddr;
  string 20 langprefix;

  GetLangPrefix(langprefix);
  CUr.Code = custcode;
  foundf = ReadFirstMain(CUr,1,true);
  defmailaddr = CUr.eMail;
  WebOutString("<form name=""HansaForm"" method=""POST"" action=""");
  WebOutLink("/WebMailSend.hal?sessionid=" & WebGetArg("sessionid") & "&langcode=" & WebGetArg("langcode"));
  WebOutString(""">");
  WebOutString("<p>");
  WebOutString("<table width=""480"" border=""0"" cellpadding=""3"">");
  GetConfInfo("WEBQUESTIONS" & langprefix,confname,confcode,maxmail);
  if (blank(confname)) then begin
    GetConfInfo("WEBQUESTIONS",confname,confcode,maxmail);
  end;
  ToolWebHiddenField("to_field",confname);
  ToolWebHiddenField("cc_field","");
  ToolWebHiddenField("subject_field","Question from " & CUr.Name);
  ToolWebHiddenField("date_field",CurrentDate);
  ToolWebHiddenField("backpage","WebHBSNewQuestThanks.hal");
  ToolWebHBSShopLine(ToolWebReturnTheText(20060) & "(*)","from_field","text",defmailaddr,false);
  ToolWebHiddenField("dummy","dummy");

  WebOutString("<tr>");
  WebOutString("<td colspan=""2"" valign=""top"" align=""left"">");
  WebOutString("<textarea rows=""20"" name=""mail_body"" cols=""60"" class=""deftxt"">");
  WebOutString("</textarea>");
  WebOutString("</td>");
  WebOutString("</tr>");
  WebOutString("<tr>");
  ToolWebGetTheText(20074,tstr);
  WebOutString("<td colspan=""2"" align=""left"" valign=""top""><input type=""submit"" value=""" & tstr & """ name=""b1""></td>");
  WebOutString("</tr>");
  WebOutString("</table>");
  WebOutString("</form>");
  return;
end;

