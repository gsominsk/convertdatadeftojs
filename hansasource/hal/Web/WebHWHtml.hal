// WebHtml.hal (can stay)
external procedure WebCellEnd();
external procedure ToolWebLineEnd();
external procedure ToolWebListTableEnd();

global
procedure ToolWebHWStartPage()
begin
  WebOutString("<html>");
  WebOutNL;
  WebOutString("<head>");
  WebOutNL;
  return;
end;  

global
procedure ToolWebHWEndPage()
begin
  WebOutString("</body>");
  WebOutNL;
  WebOutString("</html>");
  WebOutNL;
  return;
end;

global
procedure WebHWCharset()
begin
  string 60 wcharset;
  record WebControlBlock WCr;
  string 20 lang;
  
  BlockLoad(WCr);
  wcharset = WCr.WebCharSet;
  if (blank(wcharset)) then begin
    wcharset = "iso-8859-1";
  end;
  lang = WebLanguage(1);
  switch(lang) begin
    case "lv":
      wcharset = "windows-1257";
    case "pl":
      wcharset = "iso-8859-2";
  end;
  WebOutString("<meta http-equiv=""Content-Type"" content=""text/html; charset=" & wcharset & """>");
  WebOutNL;
  return;
end;

/*
procedure WebHWFirstPart()
begin
  WebOutString("<table width=""505"" border=""0"" cellpadding=""3"">");
  WebOutNL;
  WebOutString("<tr valign=""top"">");
  WebOutNL;
  WebOutString("<td width=""320"">");
  WebOutNL;
  return;
end;

procedure WebHWSecondPart()
begin
  WebCellEnd;
  WebOutString("<td width=""168"" align=""right"">");
  WebOutNL;
  return;
end;

global
procedure WebHWThirdPart()
begin
  WebCellEnd;
  ToolWebLineEnd;
  ToolWebListTableEnd;
  return;
end;
*/

global
procedure WebHWStartBody()
begin
  WebOutString("<link rel=""stylesheet"" href=""lib/hwstyle.css"" type=""text/css"">");
  WebOutString("<script language=""JavaScript"">");
  WebOutNL;
  WebOutString("<!--");
  WebOutNL;
  WebOutString("function MM_openBrWindow(theURL,winName,features) { //v2.0");
  WebOutNL;
  WebOutString("  window.open(theURL,'',features);");
  WebOutNL;
  WebOutString("}");
  WebOutNL;
  WebOutString("//-->");
  WebOutNL;
  WebOutString("</script>");
  WebOutNL;
  WebOutString("</head>");
  WebOutNL;
  return;
end;  

global
procedure ToolWebHWStartSecureBody()
begin
  WebOutString("<link rel=""stylesheet"" href=""lib/hwstyle.css"" type=""text/css"">");

  WebOutString("<meta http-equiv=""Content-Type"" content=""text/html; charset=iso-8859-1"">");
  WebOutNL;
  WebOutString("<meta http-equiv=""Expires"" CONTENT=""0"">");
  WebOutNL;
  WebOutString("<meta http-equiv=""Cache-Control"" CONTENT=""no-cache"">");
  WebOutNL;
  WebOutString("<meta http-equiv=""Pragma"" CONTENT=""no-cache"">");
  WebOutNL;

  WebOutString("<script language=""JavaScript"">");
  WebOutNL;
  WebOutString("<!--");
  WebOutNL;
  WebOutString("javascript:window.history.forward(1);");
  WebOutNL;
  WebOutString("//-->");
  WebOutNL;
  WebOutString("</script>");
  WebOutNL;
  WebOutString("</head>");
  return;
end;  

global
procedure WebHWOutBody(string wfocusfield,string background,string bgcolor)
begin
  string 20 llink;
  string 20 lvlink;
  string 20 lalink;
  string 20 ltextcol;
  string 20 lbgcolor;
  string 255 tstr;
  
  lbgcolor = bgcolor;
  if (blank(lbgcolor)) then begin lbgcolor = "#000066"; end;
  tstr = "<body bgcolor=""" & lbgcolor & """";
  if (nonblank(background)) then begin
    tstr = tstr & " background=""" & background & """";
  end;
  if (nonblank(wfocusfield)) then begin
    tstr = tstr & " onload=""document.HansaForm." & wfocusfield & ".focus()""";
  end;
  tstr = tstr & ">";
  WebOutString(tstr);
  WebOutNL;
  return;
end;

global
procedure WebHWOutFrameSet(string rows,string cols,Boolean setmore)
begin
  string 255 tstr;

  tstr = "<frameset";
  if (nonblank(rows)) then begin
    tstr = tstr & " rows=""" & rows & """";
  end;
  if (nonblank(cols)) then begin
    tstr = tstr & " cols=""" & cols & """";
  end;
//  if (setmore) then begin
    tstr = tstr & " frameborder=""NO"" border=""0"" framespacing=""0""";
//  end;
  tstr = tstr & ">";
  WebOutString(tstr); 
  WebOutNL;
  return;
end;

global
procedure WebHWOutFrameSetEnd()
begin
  WebOutString("</frameset>");
  WebOutNL;
  return;
end;

global
procedure WebHWOutFrame(string src,string defsrc,string framename,string scrolling,Boolean failed)
begin
  string 20 lsrc;
  string 255 tstr;

  if (nonblank(src)) then begin
    lsrc = src;
  end else begin
    lsrc = defsrc;
  end;
  tstr = "<frame src=""/" & lsrc & "?sessionid=" & WebGetArg("sessionid") & "&company=" & WebGetArg("company");
  if (failed) then begin
    tstr = tstr & "&failed_log_in=yes";
  end;
  tstr = tstr & """ noresize marginwidth=""0"" marginheight=""0"" scrolling=""" & scrolling & """ name=""" & framename & """>";
  WebOutString(tstr);
  WebOutNL;
  return;
end;

procedure WebHWMenuItem(string webname,string weblink,string webarg,string webtarget,Boolean nosess,string gotourl,string linkpict,Boolean withframes)
begin
  string 255 llink;
  
  WebOutString("<TR><td width=20> </td>");
  WebOutString("<TD VALIGN=top align=""left"" class=""SideMenu"">");
  WebOutNL;
  if (nonblank(gotourl)) then begin
    if (right(gotourl,1)!="/") then begin
      WebOutString("<A HREF=""" & gotourl & "/");
    end else begin
      WebOutString("<A HREF=""" & gotourl);
    end;
  end else begin
    WebOutString("<A HREF=""");
  end;
  if (nosess) then begin
    llink = weblink;
    WebOutString(llink);
  end else begin
    llink = weblink & "?sessionid=" & WebGetArg("sessionid");
    llink = llink & "&company=" & WebGetArg("company");
    if (nonblank(webarg)) then begin
      llink = llink & "&" & webarg;
    end;
    WebOutLink(llink);
  end;
  if ((withframes) and (nonblank(webtarget))) then begin
    WebOutString(""" target=""" & webtarget & """>");  
  end else begin
    WebOutString(""">");  
  end;
  if (nonblank(linkpict)) then begin
    WebOutString("<img src=""" & linkpict & """ alt=""" & webname & """>");
  end else begin
    WebOutString(webname);
  end;
  WebOutNL;
  WebOutString("</A>");  
  WebOutString("</TD></TR>");  
  WebOutNL;
  return;
end;

global
procedure WebHWItemLink(string webname,string weblink,string webarg,string gotourl,string webtarget,var Integer rwt)
begin
  string 255 llink;

  WebOutString("<TR><TD width=""100%"" align=""left"" class=""ItemLinks"">");
  WebOutNL;
  if (nonblank(gotourl)) then begin
    if (right(gotourl,1)!="/") then begin
      WebOutString("<A HREF=""" & gotourl & "/");
    end else begin
      WebOutString("<A HREF=""" & gotourl);
    end;
  end else begin
    WebOutString("<A HREF=""");
  end;
  llink = weblink & "?sessionid=" & WebGetArg("sessionid");
  if (nonblank(webarg)) then begin
    llink = llink & "&" & webarg;
  end;
  WebOutLink(llink);
  if (nonblank(webtarget)) then begin
    WebOutString(""" target=""" & webtarget & """>");  
  end else begin
    WebOutString(""">");  
  end;
  WebOutString(webname);
  WebOutNL;
  WebOutString("</A>");  
  WebOutString("</TD></TR>");  
  WebOutNL;
  return;
end;

procedure WebHWNavLink(string webname,string weblink,string webarg,string webtarget,Boolean nosess,string gotourl,string linkpict,Boolean withframes)
begin
  string 255 llink;

  WebOutString("<td align=left");
/*
  if (nonblank(thewidth)) then begin
    WebOutString(" width=""" & thewidth & """");
  end;
*/
  WebOutString(" class=""TopMenu"">");
  WebOutString("&nbsp;");
  WebOutNL;
  if (nonblank(weblink)) then begin
    if (nonblank(gotourl)) then begin
      if (right(gotourl,1)!="/") then begin
        WebOutString("<A HREF=""" & gotourl & "/");
      end else begin
        WebOutString("<A HREF=""" & gotourl);
      end;
    end else begin
      WebOutString("<A HREF=""");
    end;
    if (nosess) then begin
      llink = weblink;
      WebOutString(llink);
    end else begin
      llink = weblink & "?sessionid=" & WebGetArg("sessionid");
      llink = llink & "&company=" & WebGetArg("company");
      if (nonblank(webarg)) then begin
        llink = llink & "&" & webarg;
      end;
      WebOutLink(llink);
    end;
    if ((withframes) and (nonblank(webtarget))) then begin
      WebOutString(""" target=""" & webtarget & """>");  
    end else begin
      WebOutString(""">");  
    end;
  end;
  WebOutNL;
  if (nonblank(linkpict)) then begin
    WebOutString("<img src=""" & linkpict & """ alt=""" & webname & """>");
  end else begin
//  WebOutString("<b>");
    WebOutString(webname);
//  WebOutString("</b>");
  end;
  WebOutNL;
  if (nonblank(weblink)) then begin
    WebOutString("</A>");
  end;
  WebOutString("&nbsp;");
  WebCellEnd;
  WebOutNL;
  return;
end;

global
procedure WebHWDisplayLink2(Boolean stacked,string webname,string weblink,string webarg,string webtarget,Boolean nosess,string gotourl,string linkpict,Boolean withframes)
begin
  if (stacked) then begin
    WebHWMenuItem(webname,weblink,webarg,webtarget,nosess,gotourl,linkpict,withframes);
  end else begin
    WebHWNavLink(webname,weblink,webarg,webtarget,nosess,gotourl,linkpict,withframes);
  end;
  return;
end;

global
procedure WebHWEditLine(string thetext,string thename,string webtype,string preval,Boolean freetext)
begin
  WebOutString("<tr valign=""top"">");
  WebOutNL;
  if (nonblank(thename)) then begin
    WebOutString("<td width=""28%"" class=""EditFieldHeader"">" & thetext & "</td>");
    WebOutNL;
    WebOutString("<td width=""72%"" class=""EditFieldHeader"">");
    WebOutNL;
    if (freetext) then begin
      WebOutString("<textarea name=""" & thename & """ maxlength=255 cols=""30"" rows=""5""></textarea>");
    end else begin
      WebOutString("<input value=""" & preval & """ type=""" & webtype & """ type=""text"" name=""" & thename & """ size=""31"">");
    end;
    WebOutNL;
    WebCellEnd;
  end else begin
    WebOutString("<td colspan=2 class=""EditFieldHeader"">" & thetext & "</td>");
  end;
  WebOutNL;
  ToolWebLineEnd;
  return;
end;

global
procedure WebHWEditFieldBrowse(string webname,string webtype,string wvalue,string wwidth,Integer wsize,Integer wlen,Integer rwt)
begin
  WebOutString("<td width=""" & wwidth & """ valign=""center"" align=""left"" class=""EditFieldHeader"">");
  WebOutString("<input type=""" & webtype & """ name=""" & webname & """  size=""" & wsize & """ MAXLENGTH=""" & wlen & """ value=""" & wvalue & """></td>");
  WebOutNL;
  return;
end;

global
procedure WebHWInfoCell(string weba,string wwidth,string thealign)
begin
  string 20 localign;

  localign = thealign;
  if (blank(localign)) then begin
    localign = "left";
  end;
  WebOutString("<td  width=""" & wwidth & """ align=""" & localign & """ class=""EditFieldHeader"">");
  WebOutNL;
  WebOutString(weba);
  WebOutNL;
  WebCellEnd;
  return;
end;

global
procedure WebHWInfoCellError(string weba,string wwidth,string thealign)
begin
  string 20 localign;

  localign = thealign;
  if (blank(localign)) then begin
    localign = "left";
  end;
  WebOutString("<td  width=""" & wwidth & """ align=""" & localign & """ class=""EditFieldHeader"">");
  WebOutString("<font size=3 color=""red"">"); // Stylesheet
  WebOutNL;
  WebOutString(weba);
  WebOutString("</font>");
  WebOutNL;
  WebCellEnd;
  return;
end;

global
procedure WebHWTableHdr(string webname,string thealign,string webwidth)
begin
  string 20 localign;

  localign = thealign;
  if (blank(localign)) then begin
    localign = "left";
  end;
  WebOutString("<td width=""" & webwidth & """ align=""" & thealign & """ class=""TableHeader"">");
  WebOutNL;
  WebOutString(webname);
  WebOutNL;
  WebCellEnd;
  return;
end;

global
procedure WebHWTableData(string webname,string weblink,string webarg,string thealign,string thesize,string target,Integer rwt)
begin
  string 255 llink,tstr;
  string 20 localign;

  localign = thealign;
  if (blank(localign)) then begin
    localign = "left";
  end;
  tstr = "<td align=""" & localign & """ ";
  if (nonblank(thesize)) then begin
    tstr = tstr & "width=""" & thesize & """ ";//
  end;
  tstr = tstr & " class=""TableData"">";
  WebOutString(tstr);
  if (nonblank(weblink)) then begin
    tstr = "<a";
    if (nonblank(target)) then begin
      tstr = tstr & " target =""" & target & """";
    end;
    tstr = tstr & " href=""";
    WebOutString(tstr);
    llink = weblink & "?sessionid=" & WebGetArg("sessionid");
    if (nonblank(webarg)) then begin
      llink = llink & "&" & webarg;
    end;
    WebOutLink(llink);
    WebOutString(""">");
  end; 
  WebOutNL;
  
  if (webname=="READ") then begin
    WebOutSTring("<img src=""read.jpg"" border=""0"">");
    goto L55;
  end;
  if (webname=="UNREAD") then begin
    WebOutSTring("<img src=""unread.jpg"" border=""0"">");
    goto L55;
  end;
  
  if (nonblank(webname)) then begin
    WebOutString(webname);
  end else begin
    WebOutString("&nbsp;");
  end;

L55:;
  if (nonblank(weblink)) then begin
    WebOutString("</a>");
  end;
  WebCellEnd;
  return;
end;

global
procedure WebHWStartTable()
begin
  WebOutString("<p><table border=0 cellspacing=0 cellpadding=1>");
  WebOutNL;
  return;
end;

global
procedure WebHWEndTable()
begin
  WebOutString("</table></p>");
  return;
end;

global
procedure WebHWListTable(Integer wcols,Integer wwidth,string bsize)
begin
  string 20 locwidth;
  string 5 thebsize;
  
  thebsize = bsize;
  if (blank(thebsize)) then begin
    thebsize = "1";
  end;
  locwidth = "100%";
  if (wwidth>0) then begin
    locwidth = wwidth;
  end;
  WebOutString("<table BORDER=""" & thebsize & """ cellpadding=""0"" cellspacing=""0""");
  WebOutSTring(" COLS=""" & wcols & """ WIDTH=""" & locwidth & """ align=left>");
  WebOutNL;
  return;
end;

global
procedure WebHWListTableEnd()
begin
  WebOutString("</table>");
  return;
end;

global
procedure WebHWPushButton(string webtext,string webtype,string webname)
begin
  WebOutString("<input type=""" & webtype & """ name=""" & webname & """ value=""" & webtext & """ class=""Buttons"">");
  WebOutNL;
  return;
end;

global
procedure WebHWOutLine(string webname)
begin
  WebOutString("<tr>");
  WebOutString("<td>" & webname & "</td>");      
  WebOutString("</tr>");
  return;
end;