external Function Boolean WebHBSDivPublicMain(string,string,LongInt,LongInt,Boolean,Boolean);
external function integer GetTXCUServiceStatus(longint,string);
external updating function boolean UpdateISStatus(string,var longint,integer);
external procedure WebISShopMyServices(string);
external procedure WebISShopServiceAmend(string,longint);
external procedure WebISShopNotLoggedIn(string);

global
updating procedure WebISShopServiceStatusChange(string langcode)
begin
  string 255 action;
  longint svcsernr;
  boolean res;
  string 60 custcode;

  if (WebLoginStatus==3) then begin
    svcsernr = StringToLongint(WebGetArg("svcsernr"));
    
    if (svcsernr!=-1) then begin
      custcode = CurrentCust;
      action = WebGetArg("action");
      
      res = false;
      switch (action) begin
        case "activate": 
          res = UpdateISStatus(custcode,svcsernr,1);
        case "disable": 
          res = UpdateISStatus(custcode,svcsernr,2);
      end;
    end;
    
    switch (WebGetArg("ret")) begin
      case "svclist":
        WebISShopMyServices(langcode);
      case "svcamend":
        WebISShopServiceAmend(langcode,svcsernr);
      otherwise
        WebISShopMyServices(langcode);
    end;
  end else begin
    WebISShopNotLoggedIn(langcode);
  end;
  return;
end;

global
procedure WebISShopServiceStatus(string langcode)
begin
  longint svcsernr;
  integer status;
  boolean res;

  if (WebLoginStatus==3) then begin
    svcsernr = StringToLongint(WebGetArg("svcsernr"));
    
    if (svcsernr!=-1) then begin
      status = GetTXCUServiceStatus(svcsernr,CurrentCust);
      switch (status) begin
        //case 1: WebOutString("The selected Service is Active");
        //case 2: WebOutString("The selected Service is Disabled");
        case 3:
          res = WebHBSDivPublicMain("IS_CONTACTFORINFO",langcode,-1,-1,false,false);
      end;
    end;
  end else begin
    WebISShopNotLoggedIn(langcode);
  end;

  return;
end;

