external updating procedure IVCreateAndAttachPdf(record IVVc);

global
updating procedure RecreateIVAttachments(record IVVc IVr,record EInvCUVc EInvCUr)
begin
  Integer filenr;
  record RLinkVc RLr;
  record Attach2Vc Attach2r;
    
  if (HasLocalization("FIN,NOR,SWE")) then begin
    filenr = 1;
    while (ReadRecordLink(IVr,filenr,Attach2r,RLr)) begin
      if (Attach2r.FileName==IVr.SerNr & ".xml") or (Attach2r.FileName==IVr.SerNr & ".pdf") then begin
        RecordDelete(Attach2r);
        RecordDelete(RLr);
      end else begin
        filenr = filenr + 1;
      end;
    end;
    CreateAndAttachFinvoice(IVr,EInvCUr);
    IVCreateAndAttachPdf(IVr);
  end;
  return;
end;

global
updating function Boolean CreateAndAttachFinvoice(record IVVc IVr,record EInvCUVc EInvCUr)
begin
  Boolean res;
  string 255 fname;
  record CYBlock CYb;
  record EInvoiceBlock EIb;
  record InternetEnablerBlock IEb;
  record RoundBlock ROb;
  record HTSIVVc HTSIVr;
  record FactoringBlock Factb;
  record FInvoiceSLBlock FInvoiceSLb;
  Integer cnt

  LogText(0,"CreateAndAttachFinvoice not supported");
/*
  BlockLoad(FInvoiceSLb);
  BlockLoad(CYb);
  BlockLoad(EIb);    
  BlockLoad(IEb);    
  BlockLoad(ROb);    
  BlockLoad(Factb);    

  fname = "tmp/" & IVr.SerNr & ".xml";

  HTSIVfromIV(CYb,ROb,IEb,EIb,EInvCUr,true,IVr,-1,HTSIVr);
  switch (FInvoiceSLb.FInvFormat) begin
    case 0: // FInvoice Format 1.3
      ExportInvoice(HTSIVr,IVr,CYb,factb,1,0,cnt,true,fname,true);
    case 1: // FInvoice Format 2.01                        
      ExportInvoice201(HTSIVr,CYb,factb,1,0,cnt,false,fname,true);
  end;
  if (FileExists(fname)) then begin
    RecordLinkFile(fname,0,IVr,CurrentCompany);
    res = true;
  end;
  Delete_File(fname);
*/  
  CreateAndAttachFinvoice = res;
  return;
end;
