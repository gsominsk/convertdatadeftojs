 /* Hal file by Sven Jansson Gnesta */
external procedure ToolWebHalLMenu(var string);
//external procedure WebHalLogin();
//external procedure WebHalLogin2();
external procedure WebHalHead(string);
external procedure WebHalPostingTop();
external procedure WebHalPostingMiddle();
external procedure WebHalPostingBottom();
external procedure ToolWebHalBody();
external procedure ToolWebHalTopSpace();
external procedure ToolWebHalorumEndPage();
external procedure ToolWebHalTop(string);
external procedure ToolWebHalGetConfName(string,var string);
external procedure ToolWebHalGetConfCode(string,var string);
external procedure ToolWebHalGetCatName(string,var string);
external procedure ToolWebHalGetCatCode(string,var string);
external procedure ToolWebHalGetDIrName(string,var string,var string,var string);
external procedure ToolWebHalTutorialConf(string,LongInt,Integer);
external procedure ToolWebHalFunc(string);
external procedure ToolWebHalFuncDetail();
external updating procedure ToolWebHalShowThreads(string);
external updating procedure ToolWebHalForumPost();
external function Boolean ToolWebHalLoggedIn();
external procedure ToolWebHalConfText(string,LongInt,Boolean);
external procedure ToolWebHalLink(Boolean,string,string);

global
procedure WebHalStart()
/*  ---------------------------------------------------------------------
    Description:
    Displays the conferance for the startpage
    --------------------------------------------------------------------- */
begin
  ToolWebHalConfText("Start",1,false);
  return;
end;

global
procedure WebHalCodeInfo()
/*  ---------------------------------------------------------------------
    Description:
    Displays the conferance for the [Code] info
    --------------------------------------------------------------------- */
begin
  ToolWebHalConfText("CodeInfo",1,true);
  return;
end;

updating procedure DoWebHalMainEx(integer mode)
/*  ---------------------------------------------------------------------
    Description:
    The procedure for the mainpage. It displays the different parts of the
    page, depending on what webarguments there are.

    input args:
    mode        - The setting for the middle page
    --------------------------------------------------------------------- */
begin
  LongInt maxmail;
  Boolean storef;
  string 100 code_,name_;
  string 50 sessionid;
  string 20 timestr,
            middle_page,
            current_menu,
            display_group;
  Integer cnt;
  Integer oldcomp;
  
  oldcomp = CurrentCompany;
  if (SetCompany(1,false)) then begin
  end;
  maxmail       = 1;
  code_         = WebGetArg("cod");
  middle_page   = WebGetArg("mip");
  current_menu  = WebGetArg("crm");
  display_group = WebGetArg("dig");
  timestr = CurrentTime;
  timestr = mid(timestr,4,1) & right(timestr,2);
  if(WebGetArg("mip") == "stor") then begin
    storef = true;
  end else begin
    storef = false;
  end;
  if (blank(WebGetArg("mip"))) then begin
    middle_page = "strt";
  end;
  if (mode == 2) then begin
    middle_page = "eror";
  end;
  if (mode == 3) then begin
    middle_page = "edit";
  end;
  switch(middle_page) begin
    // Reason for comments: The forum is bugging when I use the ToolWebHalLink...don't know why yet..So I use normal Looong links for now/Svenne
    case "stes":
      WebHalPostingTop;
      WebOutLink("WebHalMain.hal?mip=stor&dig=" & WebGetArg("dig") & "&updm=" & WebGetArg("updm"));
      WebOutLink("&mailnumber=" & WebGetArg("mailnumber") & "&crm=" & current_menu & "&cod=" & WebGetArg("cod"));
      WebOutString("&tms=" & timestr);
      WebOutString("#down");
      WebHalPostingMiddle;
      WebOutLink("WebHalMain.hal?mip=stor&dig=" & WebGetArg("dig") & "&updm=" & WebGetArg("updm"));
      WebOutLink("&mailnumber=" & WebGetArg("mailnumber") & "&crm=" & current_menu & "&cod=" & WebGetArg("cod"));
      WebOutString("&tms=" & timestr);
      WebOutString("#down");
      WebHalPostingBottom;
    case "seup":
      WebHalPostingTop;
      WebOutLink("WebHalMain.hal?mailnumber=" & WebGetArg("mailnumber") & "&mip=edit&dig=" & WebGetArg("dig"));
      WebOutLink("&crm=" & current_menu & "&cod=" & WebGetArg("cod"));
      WebOutString("&tms=" & timestr);
      WebOutString("#down");
      WebHalPostingMiddle;
      WebOutLink("WebHalMain.hal?mailnumber=" & WebGetArg("mailnumber") & "&mip=edit&dig=" & WebGetArg("dig"));
      WebOutLink("&crm=" & current_menu & "&cod=" & WebGetArg("cod"));
      WebOutString("&tms=" & timestr);
      WebOutString("#down");
      WebHalPostingBottom;
     case "noup":
      WebHalPostingTop;
      WebOutLink("WebHalMain.hal?mailnumber=" & WebGetArg("mailnumber") & "&mip=seup&dig=" & WebGetArg("dig"));
      WebOutLink("&crm=" & current_menu & "&cod=" & WebGetArg("cod"));
      WebOutString("&tms=" & timestr);
      WebOutString("#down");
      WebHalPostingMiddle;
      WebOutLink("WebHalMain.hal?mailnumber=" & WebGetArg("mailnumber") & "&mip=seup&dig=" & WebGetArg("dig"));
      WebOutLink("&crm=" & current_menu & "&cod=" & WebGetArg("cod"));
      WebOutString("&tms=" & timestr);
      WebOutString("#down");
      WebHalPostingBottom;
    case "doup": // Send it back to the page
      WebHalPostingTop;
      WebOutLink("WebHalMain.hal?mailnumber=" & WebGetArg("mailnumber") & "&mip=edit&dig=" & WebGetArg("dig"));
      WebOutLink("&crm=" & WebGetArg("crm") & "&cod=" & WebGetArg("cod") & "&updm=" & WebGetArg("updm"));
      WebOutString("&tms=" & timestr);
      WebOutString("#down");
      WebHalPostingMiddle;
      WebOutLink("WebHalMain.hal?mailnumber=" & WebGetArg("mailnumber") & "&mip=edit&dig=" & WebGetArg("dig"));
      WebOutLink("&crm=" & WebGetArg("crm") & "&cod=" & WebGetArg("cod") & "&updm=" & WebGetArg("updm"));
      WebOutString("&tms=" & timestr);
      WebOutString("#down");
      WebHalPostingBottom;
    case "yeup": // Send it to doup
      WebHalPostingTop;
      WebOutLink("WebHalMain.hal?mailnumber=" & WebGetArg("mailnumber") & "&mip=doup&dig=" & WebGetArg("dig"));
      WebOutLink("&crm=" & WebGetArg("crm") & "&cod=" & WebGetArg("cod") & "&updm=" & WebGetArg("updm"));
      WebOutString("&tms=" & timestr);
      WebOutString("#down");
      WebHalPostingMiddle;
      WebOutLink("WebHalMain.hal?mailnumber=" & WebGetArg("mailnumber") & "&mip=doup&dig=" & WebGetArg("dig"));
      WebOutLink("&crm=" & WebGetArg("crm") & "&cod=" & WebGetArg("cod") & "&updm=" & WebGetArg("updm"));
      WebOutString("&tms=" & timestr);
      WebOutString("#down");
      WebHalPostingBottom;
  otherwise
    if (!storef) then begin
      WebHalHead(display_group);
      ToolWebHalBody;
      ToolWebHalTop(current_menu);
      ToolWebHalTopSpace;
      ToolWebHalLMenu(current_menu);
      //if (ToolWebHalLoggedIn()) then begin
        switch(middle_page) begin
          case "strt": WebHalStart;                                                 // Startpage
          case "tutr": ToolWebHalGetConfName(code_,name_); ToolWebHalTutorialConf(name_,maxmail,0); // Tutorials
          case "halc": ToolWebHalGetCatName(code_,name_); ToolWebHalFunc(name_);            // HAL Functions overview
          case "deta": ToolWebHalFuncDetail;                                            // HAL Function detail
          case "disc": ToolWebHalShowThreads(code_);                                    // Discussions
          case "mail": ToolWebHalForumPost;                                             // Discussion detail
          case "newm": ToolWebHalForumPost;                                             // New message
          case "edit": ToolWebHalForumPost;                                             // Edit message
          case "klar": ToolWebHalForumPost;                                             // Store message
          case "cnfo": WebHalCodeInfo;                                                 // Login
//          case "logi": WebHalLogin;                                                 // Login
//          case "eror": WebHalLogin2;                                                // Login failed
          otherwise    WebHalStart;                                                 // Startpage
        end;
      //end else begin
        //WebHalLogin;
      //end;
      ToolWebHalorumEndPage;
    end else begin
      ToolWebHalForumPost;
    end;
  end;
  ResetCompany(oldcomp);
  return;
end;

global
updating procedure WebHalMain()
/*  ---------------------------------------------------------------------
    Description:
    The actual startpage
    --------------------------------------------------------------------- */
begin
  //WebOutString("Appearence test: I'm in WebHalMain<br>");
  DoWebHalMainEx(0);
return;
end;

global
updating procedure WebHalForum()
/*  ---------------------------------------------------------------------
    Description:
    The actual forum startpage
    --------------------------------------------------------------------- */
begin
  DoWebHalMainEx(0);
return;
end;

/*
global
updating procedure WebMailView()
begin
  DoWebHalMainEx(1);
return;
end;
*/

global
updating procedure WebHalMainErrorLogin()
begin
  DoWebHalMainEx(2);
return;
end;
 /* Hal file by Sven Jansson Gnesta */