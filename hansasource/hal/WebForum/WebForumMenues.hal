 /* Hal file by Sven Jansson Gnesta */
external procedure ToolWebHalLMTop();
external procedure ToolWebHalLMUnder();
external procedure ToolWebHalLMMouseOver();
external procedure ToolWebHalLMLine(Boolean);
external procedure ToolWebHalLMUnder();
external procedure ToolWebHalLMAir();
external procedure ToolWebHalGetConfName(string,var string);
external procedure ToolWebHalGetConfCode(string,var string);
external procedure ToolWebHalGetCatCode(string,var string);
external procedure ToolWebHalGetCatName(string,var string);
external procedure ToolWebHalLink(Boolean,string,string);
external procedure ToolWebHalLM1();
external procedure ToolWebHalLM2(record DIVc);
external procedure ToolWebHalLM3;
external procedure ToolWebHalLM4();
external procedure ToolWebHalLM5();
external procedure ToolWebHalLM6();
external procedure ToolWebHalLM7();
external procedure ToolWebHalLM8();
external procedure ToolWebHalTopBottom;
external procedure ToolWebHalTopTop;
external function Boolean ToolWebHalLoggedIn();
external procedure ToolWebHalGetDIrName(string,var string,var string,var string);

global
procedure ToolWebHalPrintTheName(string name_)
begin
  if (nonblank(name_)) then begin
    WebOutString("<span class=""TopText"">");
    WebOutString(name_);
    WebOutString("</span>");
  end else begin end;

return;
end;

global
procedure ToolWebHalTop(string current_menu)
/*  ---------------------------------------------------------------------
    Description:
    The top of the page that shows the location on the site.

    input args:
    current_menu   - Not in use at the moment

    web args:
    digr - The display group of the clicked link
    --------------------------------------------------------------------- */
begin
  string 12 code_;
  string 255 name1_,name2_,name3_;

  code_ = WebGetArg("dig");
  ToolWebHalGetDIrName(code_,name1_,name2_,name3_);
  ToolWebHalTopTop;
  if (WebGetArg("mip") == ("cnfo")) then begin
      WebOutString("<span class=""TopText"">");
      WebOutString("So you want to know how to use [Code] tags Huh?");
    WebOutString("</span>");
  end else begin
    if (blank(WebGetArg("mip"))) then begin
      WebOutString("<span class=""TopText"">Welcome to HAL programmer's reference pages!</span>");
    end else begin
     if (nonblank(name1_)) then begin
        ToolWebHalPrintTheName(name1_);
      end;
      if (nonblank(name2_)) then begin
        if (nonblank(name1_)) then begin
          WebOutString(" <span class=""Red_Arrow"">&gt;</span> ");
        end;
        ToolWebHalPrintTheName(name2_);
      end;
      if (nonblank(name3_)) then begin
        WebOutString(" <span class=""Red_Arrow"">&gt;</span> ");
        ToolWebHalPrintTheName(name3_);
      end;
      if (nonblank(WebGetArg("fnc"))) then begin
        WebOutString(" <span class=""Red_Arrow"">&gt;</span> ");
        ToolWebHalPrintTheName(WebGetArg("fnc"));
      end;
    end;
  end;
  WebOutString("&nbsp;");
  ToolWebHalTopBottom;
  return;
end;

global
procedure ToolWebHalLMenu(var string current_menu)
/*  ---------------------------------------------------------------------
    Description:
    Left menu on the page. Displays two or three levels of content.
    It also gives a warning on the webpage if the conferance or category name
    name does not match the display group name.

    Note:
    The Main code in the display group settings must be:
    REFS for the tutorial section
    HAL for the code section
    FORUM for the Discussion section

    The TOP and ALL setting are not in use but I leave it for later builds.

    input/output args:
    current_menu   - the actual menu to be displayed on the page

    web args:
    midp - The middlepage
    curm - The current menu
    updm - If the mail in the discussion section was updated, this is the mailnumber
    edtm - If the mail in the discussion section was edited, this is the mailnumber
    --------------------------------------------------------------------- */
begin
  record DIVc DIr,
              DIr2,
              DIr3;
  string 255 args,
             the_text,
             link;
  string 20 ckey,
            ckey2,
            ckey3;
  string 12 code_;
  string 100 name_,testa;
  Boolean testf,
          testf2,
          foundf,
          foundf2,
          foundf3;
  Integer cnt;

  ToolWebHalLMTop;
  args = "";
  link = "";
  ckey     = "DICode:REFS";
  foundf   = true;
  testf    = false;
  testf2   = false;
  DIr.Code = "";
  ResetLoop(DIr);
  while (LoopKey(ckey,DIr,1,foundf)) begin
    if (DIr.Code=="REFS") then begin foundf = false; end;
    if (foundf) then begin
      if (!SetInSet("TOP",DIr.DispGroups)) then begin           // start Level 1 menu
        ToolWebHalLM1;
        link = "WebHalMain.hal";
        args = "mip=" & WebGetArg("mip") & "&updm=" & WebGetArg("updm") & "&edtm=" & WebGetArg("edtm");
        if (blank(WebGetArg("mailnumber"))) then begin
           args = args & "&mailnumber=-1";
        end else begin
          args = args & "&mailnumber=" & WebGetArg("mailnumber");
        end;
        if (nonblank(current_menu)) then begin
          if (WebGetArg("crm") == DIr.Code) then begin
            args = args & "&crm=";
          end else begin
            args = args & "&crm=" & DIr.Code;
          end;
        end else begin
          args = args & "&crm=" & DIr.Code;
        end;
        ToolWebHalLink(false,link,args);
        ToolWebHalLM2(DIr);                                          // end Level 1 menu
        ToolWebHalLMLine(false);
        if (current_menu == DIr.Code) then begin
          ckey2 = "DICode:" & DIr.Code;
          foundf2 = true;
          DIr2.Code = "";
          ResetLoop(DIr2);
          while (LoopKey(ckey2,DIr2,1,foundf2)) begin
            testf2 = true;
            if (DIr2.DispGroups <> DIr.Code) then begin foundf2 = false; end;
            if (foundf2) then begin
              if (current_menu == DIr.Code) then begin
                ckey3 = "DICode:" & DIr2.Code;
                foundf2 = true;
                DIr3.Code = "";
                if (ReadFirstKey(ckey3,DIr3,1,false)) then begin  // start level 2 (without link) (menu containing undermenu 3)
                  if (testf == true) then begin
                    ToolWebHalLMAir;
                    testf = false;
                  end;
                  ToolWebHalLM3;
                  WebOutString(">" & DIr2.Name & "<");
                  ToolWebHalLM8;
                end else begin                                    // end level 2 (without link) (menu containing undermenu 3)
                  if (testf == true) then begin                   // start level 2 (with link) (menu not containing undermenu 3)
                    ToolWebHalLMAir;
                    testf = false;
                  end;
                  ToolWebHalLM4;
                  ToolWebHalGetConfCode(DIr2.Name,code_);
                  ToolWebHalGetConfName(code_,name_);
                  ToolWebHalLink(false,"WebHalMain.hal","fnc=&mip=tutr&dig=" & DIr2.Code & "&cod=" & code_ & "&pge=1");
                  WebOutString("""");
                  if (DIr2.Name <> name_) then begin
                    WebOutString("><span style=""color:red;font-size:10px;"">Undefined Dir.Name- <br>(Must match Conferance name!)</span><");
                  end else begin
                    WebOutString(">" & DIr2.Name & "<");
                  end;
                  ToolWebHalLM5;                                     // end level 2 (with link) (menu not containing undermenu 3)
                end;
                ResetLoop(DIr3);
                while (LoopKey(ckey3,DIr3,1,foundf2)) begin
                  if (DIr3.DispGroups <> DIr2.Code) then begin foundf2 = false; end;
                  if (foundf2) then begin                        // start level 3 menu
                    ToolWebHalLM6;
                    ToolWebHalGetConfCode(DIr3.Name,code_);
                    ToolWebHalGetConfName(code_,name_);
                    ToolWebHalLink(false,"WebHalMain.hal","fnc=&mip=tutr&dig=" & DIr3.Code & "&cod=" & code_ & "&pge=1");
                    WebOutString("""");
                    if (DIr3.Name <> name_) then begin
                      WebOutString("><span style=""color:red;font-size:10px;"">Undefined Dir.Name- <br>(Must match Conferance name!)</span><");
                    end else begin
                      WebOutString(">" & DIr3.Name & "<");
                    end;
                    ToolWebHalLM7;
                    testf = true;
                  end;                                            // end level 3 menu
                end;
              end;
            end;
          end;
          if (testf2 == true) then begin
            ToolWebHalLMAir;
            ToolWebHalLMLine(true);
            testf2 = false;
          end;
        end;
      end;
    end;
  end;
  args = "";
  link = "";
  ckey     = "DICode:HAL";
  foundf   = true;
  testf    = false;
  testf2   = false;
  DIr.Code = "";
  ResetLoop(DIr);
  while (LoopKey(ckey,DIr,1,foundf)) begin
    if (DIr.Code=="HAL") then begin foundf = false; end;
    if (foundf) then begin
      if (!SetInSet("TOP",DIr.DispGroups)) then begin           // start Level 1 menu
        ToolWebHalLM1;
        link = "WebHalMain.hal";
                args = "mip=" & WebGetArg("mip") & "&updm=" & WebGetArg("updm") & "&edtm=" & WebGetArg("edtm");
        if (blank(WebGetArg("mailnumber"))) then begin
           args = args & "&mailnumber=-1";
        end else begin
          args = args & "&mailnumber=" & WebGetArg("mailnumber");
        end;
        if (nonblank(current_menu)) then begin
          if (WebGetArg("crm") == DIr.Code) then begin
            args = args & "&crm=";
          end else begin
            args = args & "&crm=" & DIr.Code;
          end;
        end else begin
          args = args & "&crm=" & DIr.Code;
        end;
        ToolWebHalLink(false,link,args);
        ToolWebHalLM2(DIr);                                          // end Level 1 menu
        ToolWebHalLMLine(false);
        if (current_menu == DIr.Code) then begin
          ckey2 = "DICode:" & DIr.Code;
          foundf2 = true;
          DIr2.Code = "";
          ResetLoop(DIr2);
          while (LoopKey(ckey2,DIr2,1,foundf2)) begin
            testf2 = true;
            if (DIr2.DispGroups <> DIr.Code) then begin foundf2 = false; end;
            if (foundf2) then begin
              if (current_menu == DIr.Code) then begin
                ckey3 = "DICode:" & DIr2.Code;
                foundf2 = true;
                DIr3.Code = "";
                if (ReadFirstKey(ckey3,DIr3,1,false)) then begin  // start level 2 (without link) (menu containing undermenu 3)
                  if (testf == true) then begin
                    ToolWebHalLMAir;
                    testf = false;
                  end;
                  ToolWebHalLM3;
                  WebOutString(">" & DIr2.Name & "<");
                  ToolWebHalLM8;
                end else begin                                    // end level 2 (without link) (menu containing undermenu 3)
                  if (testf == true) then begin                   // start level 2 (with link) (menu not containing undermenu 3)
                    ToolWebHalLMAir;
                    testf = false;
                  end;
                  ToolWebHalLM4;
                  ToolWebHalGetCatCode(DIr2.Name,code_);
                  ToolWebHalGetCatName(code_,name_);
                  ToolWebHalLink(false,"WebHalMain.hal","fnc=&mip=halc&dig=" & DIr2.Code & "&cod=" & code_ & "&pge=1");
                  WebOutString("""");
                  if (DIr2.Name <> name_) then begin
                    WebOutString("><span style=""color:red;font-size:10px;"">Undefined Dir.Name- <br>(HAL Category name must<br>match displaygroup name)</span><");
                  end else begin
                    WebOutString(">" & DIr2.Name & "<");
                  end;
                  ToolWebHalLM5;
                end;                                              // end level 2 (with link) (menu not containing undermenu 3)
                ResetLoop(DIr3);
                while (LoopKey(ckey3,DIr3,1,foundf2)) begin
                  if (DIr3.DispGroups <> DIr2.Code) then begin foundf2 = false; end;
                  if (foundf2) then begin                        // start level 3 menu
                    ToolWebHalLM6;
                    ToolWebHalGetCatCode(DIr3.Name,code_);
                    ToolWebHalGetCatName(code_,name_);
                    //if ((SetInSet("ALL",DIr3.DispGroups))) then begin
                      //ToolWebHalLink(false,"WebHalMain.hal","fnc=&mip=hole&dig=" & DIr3.Code & "&cod=" & code_ & "&pge=1");
                    //end else begin
                    ToolWebHalLink(false,"WebHalMain.hal","fnc=&mip=halc&dig=" & DIr3.Code & "&cod=" & code_ & "&pge=1");
                    //end;
                    WebOutString("""");
                    if (DIr3.Name <> name_) then begin
                      WebOutString("><span style=""color:red;font-size:10px;"">Undefined Dir.Name- <br>(HAL Category name must<br>match displaygroup name)</span><");
                    end else begin
                      WebOutString(">" & DIr3.Name & "<");
                    end;
                    ToolWebHalLM7;
                    testf = true;
                  end;                                           // end level 3 menu
                end;
              end;
            end;
          end;
          if (testf2 == true) then begin
            ToolWebHalLMAir;
            ToolWebHalLMLine(true);
            testf2 = false;
          end;
        end;
      end;
    end;
  end;
  args = "";
  link = "";
  ckey     = "DICode:FORUM";
  foundf   = true;
  testf    = false;
  testf2   = false;
  DIr.Code = "";
  ResetLoop(DIr);
  while (LoopKey(ckey,DIr,1,foundf)) begin
    if (DIr.Code=="FORUM") then begin foundf = false; end;
    if (foundf) then begin
      if (!SetInSet("TOP",DIr.DispGroups)) then begin          // start Level 1 menu
        ToolWebHalLM1;
        link = "WebHalMain.hal";
        args = "mip=" & WebGetArg("mip") & "&updm=" & WebGetArg("updm") & "&edtm=" & WebGetArg("edtm");
        if (blank(WebGetArg("mailnumber"))) then begin
           args = args & "&mailnumber=-1";
        end else begin
          args = args & "&mailnumber=" & WebGetArg("mailnumber");
        end;
        if (nonblank(current_menu)) then begin
          if (WebGetArg("crm") == DIr.Code) then begin
            args = args & "&crm=";
          end else begin
            args = args & "&crm=" & DIr.Code;
          end;
        end else begin
          args = args & "&crm=" & DIr.Code;
        end;
        ToolWebHalLink(false,link,args);
        ToolWebHalLM2(DIr);                                         // end Level 1 menu
        ToolWebHalLMLine(false);
        if (current_menu == DIr.Code) then begin
          ckey2 = "DICode:" & DIr.Code;
          foundf2 = true;
          DIr2.Code = "";
          ResetLoop(DIr2);
          while (LoopKey(ckey2,DIr2,1,foundf2)) begin
            testf2 = true;
            if (DIr2.DispGroups <> DIr.Code) then begin foundf2 = false; end;
            if (foundf2) then begin
              if (current_menu == DIr.Code) then begin
                ckey3 = "DICode:" & DIr2.Code;
                foundf2 = true;
                DIr3.Code = "";
                if (ReadFirstKey(ckey3,DIr3,1,false)) then begin // start level 2 (without link) (menu containing undermenu 3)
                  if (testf == true) then begin
                    ToolWebHalLMAir;
                    testf = false;
                  end;
                  ToolWebHalLM3;
                  WebOutString(">" & DIr2.Name & "<");
                  ToolWebHalLM8;
                end else begin                                   // end level 2 (without link) (menu containing undermenu 3)
                  if (testf == true) then begin                  // start level 2 (with link) (menu not containing undermenu 3)
                    ToolWebHalLMAir;
                    testf = false;
                  end;
                  ToolWebHalLM4;
                  ToolWebHalGetConfCode(DIr2.Name,code_);
                  ToolWebHalGetConfName(code_,name_);
                  ToolWebHalLink(false,"WebHalMain.hal","fnc=&dig=" & DIr2.Code & "&crm=" & current_menu & "&mip=disc&cod=" & code_ & "&pge=1");
                  WebOutString("""");
                  if (DIr2.Name <> name_) then begin
                    WebOutString("><span style=""color:red;font-size:10px;"">Undefined Dir.Name- <br>(Must match Conferance name!)</span><");
                  end else begin
                    WebOutString(">" & DIr2.Name & "<");
                  end;
                  ToolWebHalLM5;
                end;                                             // end level 2 (with link) (menu not containing undermenu 3)
                ResetLoop(DIr3);
                while (LoopKey(ckey3,DIr3,1,foundf2)) begin
                  if (DIr3.DispGroups <> DIr2.Code) then begin foundf2 = false; end;
                  if (foundf2) then begin                        // start level 3 menu
                    ToolWebHalLM6;
                    ToolWebHalGetConfCode(DIr3.Name,code_);
                    ToolWebHalGetConfName(code_,name_);
                    ToolWebHalLink(false,"WebHalMain.hal","fnc=&dig=" & DIr3.Code & "&mip=disc&cod=" & code_ & "&pge=1");
                    WebOutString("""");
                    if (DIr3.Name <> name_) then begin
                      WebOutString("><span style=""color:red;font-size:10px;"">Undefined Dir.Name- <br>(Must match Conferance name!)</span><");
                    end else begin
                      WebOutString(">" & DIr3.Name & "<");
                    end;
                    ToolWebHalLM7;
                    testf = true;
                  end;                                           // end level 3 menu
                end;
              end;
            end;
          end;
          if (testf2 == true) then begin
            ToolWebHalLMAir;
            ToolWebHalLMLine(true);
            testf2 = false;
          end;
        end;
      end;
    end;
  end;
  ToolWebHalLMUnder;
  return;
end;
 /* Hal file by Sven Jansson Gnesta */