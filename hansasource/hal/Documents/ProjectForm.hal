external function Boolean PRTransAvail(record RcVc,string,Date,Date);

global
procedure ProjectForm(record RcVc RepSpec)
BEGIN
  record PRVc PRr;
  Boolean TrHs,testf,tmpf;
  string 255 afr,ato;
  
  StartPrintDialogGroup;
  afr = FirstInRange(RepSpec.f1,10);
  ato = LastInRange(RepSpec.f1,10);
  PRr.Code = afr;
  TrHs = true;
  while (LoopMain(PRr,1,TrHs)) begin
    if (TrHs) then begin
      if (nonblank(ato)) then begin
        if (PRr.Code>ato) then begin
          TrHs = false;
        end;
      end;     
    end;
    if (TrHs) then begin
      testf = true;
      if (nonblankdate(PRr.EndDate)) then begin
        if (RepSpec.sStartDate>PRr.EndDate) then begin testf = false; end;
      end;  
      if (PRr.Terminated==1) then begin testf = false; end;
      if (nonblank(RepSpec.f2) and (RepSpec.f2!=PRr.PRClass)) then begin testf = false; end;
      if (testf) then begin
        if (RepSpec.UsedOnly!=0) then begin
          if (PRTransAvail(RepSpec,PRr.Code,RepSpec.sStartDate,RepSpec.sEndDate)==false) then begin 
            testf = false;
          end;  
        end;
      end;
      if (testf) then begin
        tmpf = PrintDocument(PRr,"ProjectForm",false);      
      end;
    end;
  end;
LProjectForm:;
  EndPrintDialogGroup;
  RETURN;
END;