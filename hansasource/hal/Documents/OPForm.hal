
global
procedure OPForm(record RcVc RepSpec)
BEGIN
  Integer ovst;
  Boolean TrHs,VIs,VEs;
  Integer i,rwcnt;
  record OPVc OPr;
  record VIVc VIr;
  record CUVc VEr;
  row OPVc OPrw;
  LongInt afr,ato;
  record CYBlock CompYear;
  string 255 tstr,t2;

  StartPrintDialogGroup;
  BlockLoad(CompYear);
  afr = FirstInRange(RepSpec.f1,10);
  ato = LastInRange(RepSpec.f1,10);
  OPr.SerNr = 0;
  if (afr!=-1) then begin
    OPr.SerNr = afr;
  end;
  TrHs = true;
  while (LoopMain(OPr,1,TrHs)) begin
    if (TrHs) then begin
      if (ato!=-1) then begin
        if (OPr.SerNr>ato) then begin
          TrHs = false;
        end;
      end;
    end;
    if (TrHs) then begin
      if (OPr.OrderedFlag!=0) then begin
        StartReportJob(USetStr(4101));          
        if (OPr.SerNr!=-1) then begin
          tstr = USetStr(1751);
          tstr = tstr & OPr.SerNr;
          Header(1,tstr,1);
        end;
        EndHeader;
        StartFormat(15);
        OutString(100,0,USetStr(4106),true);
        OutString(120,0,USetStr(4103),false);
        OutString(210,0,USetStr(4104),false);
        OutString(1,0,USetStr(4107),true);
        EndFormat;
        Gray_Divider(0,1);
        StartFormat(15);
        OutString(100,0,USetStr(4105),true);
        OutString(120,0,OPr.BankAcc,false);
        OutString(210,0,CompYear.CompName,false);
        EndFormat;
        StartFormat(15);
        OutString(210,0,CompYear.Addr0,false);
        EndFormat;
        StartFormat(15);
        OutString(210,0,CompYear.Addr1,false);
        EndFormat;
        StartFormat(15);
        OutString(210,0,CompYear.Addr2,false);
        EndFormat;
        Gray_Divider(0,1);
        rwcnt = MatRowCnt(OPr);
        for (i=0 ; i<rwcnt; i=i+1) begin
          MatRowGet(OPr,i,OPrw);
          VIr.SerNr = OPrw.VISerNr;
          VIs = ReadFirstMain(VIr,1,true);
          if (VIs) then begin
            VEr.Code = VIr.VECode;
            VEs = ReadFirstMain(VEr,1,true);
          end;
          ovst = OPrw.ovst; 
          StartFormat(15);
          OutValOvst(100,0,OPrw.PInvVal,M4Val,true,ovst); // Maybe it should be BankVal
          OutStringOvst(120,0,OPrw.BankAcc,false,ovst);
          OutStringOvst(210,0,VIr.VEName,false,ovst);
          OutStringOvst(1,0,VIr.InvoiceNr,true,ovst);
          EndFormat;
          StartFormat(15);
          if (HasLocalization("FIN")) then begin//vatFinnish
            OutStringOvst(120,0,VIr.BankName,false,ovst);
          end;
          OutStringOvst(210,0,VEr.InvAddr0,false,ovst);
          OutStringOvst(1,0,VIr.RefStr,true,ovst);
          EndFormat;
          StartFormat(15);
          OutStringOvst(210,0,VEr.InvAddr1,false,ovst);
          EndFormat;
          StartFormat(15);
          OutStringOvst(210,0,VEr.InvAddr2,false,ovst);
          EndFormat;
          StartFormat(10);
          EndFormat;
        end;
        Gray_Divider(0,1);
        StartFormat(15);
        OutVal(100,0,OPr.CurPayVal,M4Val,true);
        OutString(106,0,OPr.PayCurCode,true);
        OutString(130,0,USetStr(4108),false);
        EndFormat;
        Gray_Divider(0,1);
        EndJob;
      end;
    end;
  end;
  EndPrintDialogGroup;
  RETURN;
END;

