external function Integer CustMainLet(record LetVc,Integer,Integer,Boolean);
external procedure GetLetterSelection(record LetVc,var Integer);

global
procedure LetForm(record RcVc RepSpec)
BEGIN
  record LetVc Letr;
  LongInt afr,ato;
  Integer keys;
  Boolean TrHs;
  Boolean testf;

  StartPrintDialogGroup;
  if (blank(RepSpec.f1)) then begin
    MessageBox(2277,"");
    goto LLetForm;
  end;
  if (RepSpec.f1!="*") then begin
    afr = FirstInRange(RepSpec.f1,20);
    ato = LastInRange(RepSpec.f1,20);
  end;
  Letr.SerNr = afr;
  TrHs = true;
  while (LoopMain(Letr,1,TrHs)) begin
    testf = true;
    if (RepSpec.f1!="*") then begin
      if (TrHs) then begin
        if (ato!=-1) then begin
          if (Letr.SerNr>ato) then begin
            TrHs = false;
          end;
        end;
      end;
    end;
    if (TrHs==false) then begin testf = false; end;
    RepSpec.Priority = 1;
// Very silly code :-) The Letr.CustCat IS the selection, why make another one that does the SAME thing....
//    if (nonblank(RepSpec.FirstAcc)) then begin
//      if (RepSpec.FirstAcc!=Letr.CustCat) then begin testf = false; end;
//    end;
    if (nonblank(RepSpec.LastAcc)) then begin
      if (RepSpec.LastAcc!=Letr.DocName) then begin testf = false; end;
    end;
    if (DateInRange(Letr.TransDate,RepSpec.sStartDate,RepSpec.sEndDate)==false) then begin testf = false; end;
    if (RepSpec.flags[1]==0) then begin
      if (Letr.Printdf!=0) then begin testf = false; end;
    end;
    if (RepSpec.flags[2]!=0) then begin
      if (nonblank(Letr.emailAddr)) then begin testf = false; end;
    end;
    if (RepSpec.flags[3]!=0) then begin
      if (nonblank(Letr.Fax)) then begin testf = false; end;
    end;
    if (testf) then begin
      GetLetterSelection(Letr,keys);
      if (CustMainLet(Letr,keys,1,RepSpec.IncDaughter==1)==0) then begin end;
      if (RepSpec.IncDaughter!=0) then begin TrHs = false; end;
    end;
  end;
LLetForm:;
  EndPrintDialogGroup;
  RETURN;
END;