external function Boolean FindHRMCOChange(LongInt,var record HRMCOChangeVc);
external procedure PrintCurrencyCode(string,string);
external procedure PrintValue(string,val,Integer,record LangNrVc,record SysFormatBlock,Boolean);
external procedure CommonDocumentFields(record RcVc);
external function Boolean Getformcode(Integer,Integer,string,string,string,LongInt,LongInt,string,string,Integer,string,var string);
external function Integer NumberofDocumentPages(string,Integer);
external procedure GetLangNr(string,var record LangNrVc);

global
procedure DoHRMCOForm(record RcVc RepSpec,record HRMCOVc HRMCOr)
begin
  record FormDefVc FDr;
  row FormDefVc FDrw;
  record SysFormatBlock SFb;
  record LangNrVc LangNrr;
  Integer i,rwcnt;
  record UserVc Userr;
  string 255 tstr;
  record HRMCOChangeVc HRMCOCr;
  
  Boolean printf;
  Integer intdocnr;
  string 30 formcode;

  BlockLoad(SFb);  
  FDr.repname = RepSpec.repname;
  FDr.shortname = RepSpec.shortname;
  if (ReadFirstMain(FDr,1,true)==false) then begin
    MessageBox(1624, " " & USetStr(1623));
    goto L99;
  end;
  rwcnt = MatRowCnt(FDr);

  GetLangNr("",LangNrr);
  intdocnr = 1;
  printf = true;
  while (printf) begin  
    formcode = "";
    for (i=rwcnt-1;i>=0;i=i-1) begin
      MatRowGet(FDr,i,FDrw);
      if (Getformcode(i,FDrw.intdocnr,FDrw.FPCode,FDrw.UserGroup,FDrw.LangCode,FDrw.SerNr,HRMCOr.SerNr,FDrw.PrintGroupCode,
                      HRMCOr.LangCode,intdocnr,"HRMCOVc",formcode)) then
      begin
        goto LBREAK;
      end;
    end;
LBREAK:;
    if (nonblank(formcode)) then begin
      if (OpenForm(formcode)) then begin
        CommonDocumentFields(RepSpec);
//        NumberofDocumentPages(formcode,MatRowCnt(HRMCOr));
        if (FindHRMCOChange(HRMCOr.SerNr,HRMCOCr)) then begin
          HRMCOr.TrialEndDate = HRMCOCr.TrialEndDate;
          HRMCOr.Class = HRMCOCr.Class;
          HRMCOr.JobTitle = HRMCOCr.JobTitle;
          HRMCOr.Comment = HRMCOCr.Comment;
          HRMCOr.SalaryType = HRMCOCr.SalaryType;
          HRMCOr.GrossSalary = HRMCOCr.GrossSalary;
          HRMCOr.CurncyCode = HRMCOCr.CurncyCode;
          HRMCOr.DepCode = HRMCOCr.DepCode;
          HRMCOr.LeaveScheme = HRMCOCr.LeaveScheme;
        end;

        OUTFORMFIELD("F_SERNR",HRMCOr.SerNr);
        OUTFORMFIELD("F_TRANSDATE",HRMCOr.TransDate);
        OUTFORMFIELD("F_STARTDATE",HRMCOr.StartDate);
        OUTFORMFIELD("F_ENDDATE",HRMCOr.EndDate);
        OUTFORMFIELD("F_TRIALENDDATE",HRMCOr.TrialEndDate);
        OUTFORMFIELD("F_EMPLOYEE",HRMCOr.Employee);
        OUTFORMFIELD("F_EMPLOYEENAME",HRMCOr.Name);
        OUTFORMFIELD("F_JOBTITLE",HRMCOr.JobTitle);
        OUTFORMFIELD("F_SALARYTYPE",StringFromSet(463,HRMCOr.SalaryType));
        OUTFORMFIELD("F_GROSSSALARY",HRMCOr.GrossSalary);
        OUTFORMFIELD("F_MANAGER2",HRMCOr.Superior);
        OUTFORMFIELD("F_COMMENT",HRMCOr.Comment);
        OUTFORMFIELD("F_DEPARTMENT",HRMCOr.DepCode);
        OUTFORMFIELD("F_CLASS",HRMCOr.Class);
        PrintCurrencyCode("F_VALUTA",HRMCOr.CurncyCode);
        OUTFORMFIELD("F_LEAVESCHEME",HRMCOr.LeaveScheme);
        OUTFORMFIELD("F_LEAVEREASON",StringFromSet(470,HRMCOr.Reason));
        OUTFORMFIELD("F_LEAVEREASONDETAILS",HRMCOr.ReasonDetails);

//        PrintRounting(Prodr.SerNr,Prodr.Routing,0);
        CloseForm;
      end else begin
        printf = false;
        MessageBox(1546,formcode);
      end;
    end else begin
      printf = false;
      if (intdocnr==1) then begin
        MessageBox(1624, " " & USetStr(1623));
      end;
    end;
    intdocnr = intdocnr + 1;
  end;
L99:;
  return;
end;
