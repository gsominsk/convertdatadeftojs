external procedure ActVcRecordDefClient(var record ActVc);
external procedure SetupCustPS2Rn(string,var record RcVc);
remote function Boolean MakeMailFromContact(record ContactVc,var record MailVc,Boolean);
remote procedure rlVEInfo_hal(string,var record RcVc);
remote updating procedure MakeActFromContactVc(var record ContactVc,var record ActVc);

global 
procedure UpdContactAddr()
BEGIN
  record ContactVc CCr;
  record CUVc CUr;
  Integer wn;
  
  wn = CurWindow;
  GetWindowRecord(wn,CCr);
  DeselectWindow(wn,false);
  CUr.Code = CCr.Company;
  if (ReadFirstMain(CUr,1,true)) then begin
    CCr.Company = CUr.Code;
    CCr.CompName = CUr.Name;
    CCr.Adress0 = CUr.InvAddr0;
    CCr.Adress1 = CUr.InvAddr1;
    CCr.Adress2 = CUr.InvAddr2;
    CCr.Adress3 = CUr.InvAddr3;
    CCr.Adress4 = CUr.InvAddr4;
    CCr.Phone = CUr.Phone;
    CCr.Fax = CUr.Fax;
    PutWindowRecord(wn,CCr);  
  end;  
  RETURN;
END;

global
procedure CustPSContactDsm()
BEGIN
  record ContactVc CCr;
  record CUVc CUr;
  record RcVc RepSpec;
  Integer wn;

  wn = CurWindow;
  GetWindowRecord(wn,CCr);
  CUr.Code = CCr.Company;
  if (ReadFirstMain(CUr,1,true)) then begin end;
  if (CUr.CUType!=0) then begin
    SetupCustPS2Rn(CCr.Company,RepSpec);
    RunReport(RepSpec,0);
  end;
  RETURN;
END;

global
procedure VendPSContactDsm()
BEGIN
  record ContactVc CCr;
  record RcVc RepSpec;
  Integer wn;
  record CUVc VEr;

  wn = CurWindow;
  GetWindowRecord(wn,CCr);
  VEr.Code = CCr.Company;
  if (ReadFirstMain(VEr,1,true)) then begin end;
  if (VEr.VEType!=0) then begin
    rlVEInfo_hal(CCr.Company,RepSpec);
    RunReport(RepSpec,0);
  end;
  RETURN;
END;

global
procedure CustPSContactLsm()
BEGIN
  record ContactVc CCr;
  record RcVc RepSpec;
  record CUVc CUr;
  Integer wn;

  wn = CurWindow;
  if (ReadMarkedRecord(wn,CCr)) then begin
    if (nonblank(CCr.Company)) then begin
      CUr.Code = CCr.Company;
      if (ReadFirstMain(CUr,1,true)) then begin end;
      if (CUr.CUType!=0) then begin
        SetupCustPS2Rn(CCr.Company,RepSpec);
        RunReport(RepSpec,0);
      end;
    end;
  end;
  RETURN;
END;

global
procedure VendPSContactLsm()
BEGIN
  record ContactVc CCr;
  record RcVc RepSpec;
  Integer wn;
  record CUVc VEr;

  wn = CurWindow;
  if (ReadMarkedRecord(wn,CCr)) then begin
    if (nonblank(CCr.Company)) then begin
      VEr.Code = CCr.Company;
      if (ReadFirstMain(VEr,1,true)) then begin end;
      if (VEr.VEType!=0) then begin
        rlVEInfo_hal(CCr.Company,RepSpec);
        RunReport(RepSpec,0);
      end;
    end;
  end;
  RETURN;
END;

global
procedure ContactListL(Integer wn,Boolean previewf)
BEGIN
  record ContactVc Contactr;
  record RcVc RepSpec;

  GetWindowRecord(wn,Contactr);
  RepSpec.repname = "ContactListRn";
  RepSpec.f3 = Contactr.Name;
  RepSpec.Media = mtScreen;
  RunReport(RepSpec,0);
  RETURN;
END;

global
procedure PrintContactD(Integer wn,Boolean previewf)
BEGIN
  record ContactVc Contactr;
  record RcVc RepSpec;
  
  GetWindowRecord(wn,Contactr);
  RepSpec.repname = "ContactListRn";
  if (previewf) then begin
    RepSpec.Media = mtScreen;
  end else begin
    RepSpec.Media = mtPrinter;
  end;
  RepSpec.JobDf = 0;
  RepSpec.ArtMode = 1;
  RepSpec.f3 = Contactr.Name;
  RunReport(RepSpec,0);
  RETURN;
END;

global
procedure NewMailContactDsm()
BEGIN
  record ContactVc Contactr;
  record MailVc Mailr;
  Integer wn,nwn;
  
  wn = CurWindow;
  GetWindowRecord(wn,Contactr);
  if (MakeMailFromContact(Contactr,Mailr,true)) then begin
    nwn = OpenWindow("MailDClass",1,0,"","",Mailr);  
  end;
  RETURN;
END;

global
updating procedure ActFromContactDsm()
begin
  Integer wn,nwn;
  record ContactVc CCr;
  record ActVc Actr;

  wn = CurWindow;
  GetWindowRecord(wn,CCr);
  RecordNew(Actr);
  ActVcRecordDefClient(Actr);
  MakeActFromContactVc(CCr,Actr);
  nwn = OpenWindow("ActDClass",1,0,"","",Actr);
  SetRLink(wn,true);
  RETURN;
END;

global
updating procedure ContactVcCreateActivity()
begin
  ActFromContactDsm;
  return;
end;

global
procedure ContactSearchLsm()
BEGIN
  Integer wn,nwn;
  record RcVc RepSpec;
  
  wn = CurWindow;
  nwn = OpenWindow("SearchContactRClass",0,0,"","",RepSpec);
  DeselectWindow(nwn,false);
  ReportDefaults(RepSpec,"SearchContactRClass");
  RepSpec.long1 = GetWindowSubset(wn);
  RepSpec.repname = "SearchContactRn";
  RepSpec.critname = "SearchContactRClass";
  RepSpec.Media = 6;
  PutWindowRecord(nwn,RepSpec);  
  WindowFieldGoto(nwn,RepSpec,-1,"f1",true);
  RETURN;
END;

global
procedure ContactSearchSsm()
BEGIN
  Integer wn,nwn;
  record RcVc RepSpec;
  
  wn = CurWindow;
  nwn = OpenWindow("SearchContactRClass",0,0,"","",RepSpec);
  DeselectWindow(nwn,false);
  ReportDefaults(RepSpec,"SearchContactRClass");
  RepSpec.long1 = GetWindowSubset(wn);
  RepSpec.repname = "SearchContactRn";
  RepSpec.critname = "SearchContactRClass";
  RepSpec.Media = 6;
  PutWindowRecord(nwn,RepSpec);  
  WindowFieldGoto(nwn,RepSpec,-1,"f1",true);
  RETURN;
END;

