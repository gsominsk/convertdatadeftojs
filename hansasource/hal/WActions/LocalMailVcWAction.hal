remote procedure LocalMailVc_PasteAddrCode(var record LocalMailVc,Integer);

global
function Boolean  LocalMailDClassHasFileAttButtonAction(Integer wn,Integer value)
begin
  Boolean res;
 
  res = false;
  LocalMailDClassHasFileAttButtonAction = res;
  return;
end;

global
function Boolean  LocalMailDClassHasRecAttButtonAction(Integer wn,Integer value)
begin
  Boolean res;
 
  res = false;
  LocalMailDClassHasRecAttButtonAction = res;
  return;
end;

global 
function Boolean LocalMailDClassInsertRowTest(Integer wn, Integer rownr)
BEGIN
  Boolean res;
  record LocalMailVc LocalMailr;

  res = true;
  if (rownr==0) then begin res = false; end;
  if (res) then begin
    GetWindowRecord(wn,LocalMailr);
    if (LocalMailr.seqnr>0) then begin res = false; end;
  end;
  LocalMailDClassInsertRowTest = res;
  RETURN;
END;

global 
function Boolean LocalMailDClassDeleteRowTest(Integer wn, Integer rownr)
BEGIN
  Boolean res;
  record LocalMailVc LocalMailr;

  res = true;
  if (rownr==0) then begin res = false; end;
  if (res) then begin
    GetPrevWindowRecord(wn,LocalMailr);
    if (LocalMailr.seqnr>0) then begin res = false; end;
  end;
  LocalMailDClassDeleteRowTest = res;
  RETURN;
END;

global
function Boolean LocalMailDClassUpdateTest(Integer wn)
BEGIN
  Boolean res;
  record LocalMailVc LocalMailr;
  
  res = true;
  GetWindowRecord(wn,LocalMailr);
  if (LocalMailr.LockedFlag!=0) then begin
    res = false;
  end;
  LocalMailDClassUpdateTest = res;
  RETURN;
END;

global
function Boolean LocalMailDClassActiveEditField(Integer wn,string fieldname,Integer fn,Integer wnst,Integer rownr,Integer changed)
BEGIN
  Boolean res;
  LongInt sz;
  record LocalMailVc LocalMail2r;
  record LocalMailVc LocalMailr;
  row LocalMailVc LocalMailrw;
  
  res = true;
  if (wnst==2) then begin//Rs_update
    switch (fieldname) begin
      case "SerNr": res = false;
    end;
    GetPrevWindowRecord(wn,LocalMail2r);
    if (LocalMail2r.LockedFlag!=0) then begin
      res = false;
    end;    
  end;
  GetWindowRecord(wn,LocalMailr);
  switch (fieldname) begin
    case "Math": 
      if (LocalMailr.LockedFlag!=0) then begin
        res = false;
      end;    
      sz = SizeTextCnt(LocalMailr);
      if (sz>30720) then begin // Not needed really, it will stop allowing characters.
        MessageBox(22063,"");
        res = false;
      end;
    case "AddrCode": 
      if (rownr>=0) then begin
        MatRowGet(LocalMailr,rownr,LocalMailrw);
        if ((LocalMailrw.RowTyp==1) and (rownr==0)) then begin
          res = false;
        end;
      end;
    case "RowTyp": 
      if (rownr>=0) then begin
        MatRowGet(LocalMailr,rownr,LocalMailrw);
        if ((LocalMailrw.RowTyp==1) and (rownr==0)) then begin
          res = false;
        end;
      end;
  end;  
  LocalMailDClassActiveEditField = res;
  RETURN;
END;

function Boolean LocalMailDClassAddrCodeEFAfter(Integer wn,Integer changed,Integer rownr)
BEGIN
  Boolean res;
  record LocalMailVc LocalMailr;
  
  if (changed!=0) then begin
    res = true;
    DeselectWindow(wn,false);
    GetWindowRecord(wn,LocalMailr);
    LocalMailVc_PasteAddrCode(LocalMailr,rownr);
    PutWindowRecord(wn,LocalMailr);        
  end;
  LocalMailDClassAddrCodeEFAfter = res;
  RETURN;
END;

global
function Boolean LocalMailDClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;

  switch (fieldname) begin
    case "AddrCode": res = LocalMailDClassAddrCodeEFAfter(wn,changed,rownr);
  end;
  LocalMailDClassAfterEditField = res;
  RETURN;
END;
