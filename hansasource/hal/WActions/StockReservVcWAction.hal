remote updating function Integer UnReserveStockRes(record StockReservVc);

global
updating procedure UnReserveDsm()
BEGIN
  Integer wn,nwn;
  record RcVc RepSpec;
  record StockReservVc StockReservr;
  record StockMovVc StockMovr;
  Integer r;

  wn = CurWindow;
  if (WindowState(wn)==0) then begin//Rs_normal
    GetWindowRecord(wn,StockReservr);
    switch (UnReserveStockRes(StockReservr)) begin
      case 0:
        Beep;
      case 1:
        CloseWindow(wn);
      case 2:
        CloseWindow(wn);
        StockMovr.SerNr = StockReservr.ToSerNr;
        if (ReadFirstMain(StockMovr,1,true)) then begin
          nwn = OpenWindow("StockMovDClass",1,0,"","",StockMovr);
        end;
    end;
  end else begin
    Beep;
  end;
  RETURN;
END;


global
function Boolean DfncyStockDClassOKFlagButtonAction(Integer wn,Integer value)
begin
  Boolean res;
  record DfncyStockVc DSr;
 
  res = false;
  if (WindowState(wn)==Rs_normal) then begin
    GetWindowRecord(wn,DSr);
    if (DSr.OKFlag!=0) then begin
      res = false;
      if (UserCanAction("UnOKAll",false)) then begin
        res = true;
      end;
    end;
  end;  
  DfncyStockDClassOKFlagButtonAction = res;
  return;
end;
