function Boolean BaggerTClassUserCodeEFAfter(Integer wn,Integer rownr,Boolean changedf)
begin
  record BaggerBlock Baggerb;
  row BaggerBlock Baggerbrw;
  record UserVc Userr;

  if (changedf) then begin
    if (rownr>=0) then begin
      GetWindowRecord(wn,Baggerb);        
      MatRowGet(Baggerb,rownr,Baggerbrw);
      Userr.Code = Baggerbrw.UserCode;
      ReadFirstMain(Userr,1,true)
      Baggerbrw.UserName = Userr.Name;
      MatRowPut(Baggerb,rownr,Baggerbrw);
      PutWindowRecord(wn,Baggerb);    
    end;
  end;
  BaggerTClassUserCodeEFAfter = true;
  return;
end;

global
function Boolean BaggerTClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
begin
  Boolean res;

  switch (fieldname) begin
    case "UserCode": res = BaggerTClassUserCodeEFAfter(wn,rownr,changed!=0);
  end;
  BaggerTClassAfterEditField = res;
  return;
end;
