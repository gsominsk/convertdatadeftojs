
global
function Boolean EmailRecipDClassMainContactCodeEFAfter(Integer wn,Integer fn,Integer rownr,Integer changedf)
begin
  Boolean res;
  record EmailRecipVc EmailRecipr;
  record CUVc CUr;
  string 255 warning;
  
  res = true;
  
  if (changedf!=0) then begin
    GetWindowRecord(wn,EmailRecipr);
    DeselectWindow(wn,false);
    CUr.Code = EmailRecipr.MainContactCode;
    if (ReadFirstMain(CUr,1,true)) then begin 
      EmailRecipr.MainContactName = CUr.Name;
      PutWindowRecord(wn,EmailRecipr);
    end;
  end;
  
  EmailRecipDClassMainContactCodeEFAfter = res;
  return;
end;


global
function Boolean EmailRecipDClassContactCodeEFAfter(Integer wn,Integer fn,Integer rownr,Integer changedf)
begin
  Boolean res;
  record EmailRecipVc EmailRecipr;
  row EmailRecipVc EmailReciprw;
  record CUVc CUr;
  string 255 warning;
  
  res = true;
  
  if (changedf!=0) then begin
    GetWindowRecord(wn,EmailRecipr);
    DeselectWindow(wn,false);
    MatRowGet(EmailRecipr,rownr,EmailReciprw);
    CUr.Code = EmailReciprw.ContactCode;
    if ReadFirstMain(CUr,1,true) then begin 
      EmailReciprw.ContactName = CUr.Name;
    end else begin 
      EmailReciprw.ContactName = "";
    end;  
    MatRowPut(EmailRecipr,rownr,EmailReciprw);
    PutWindowRecord(wn,EmailRecipr);
  end;
  
  EmailRecipDClassContactCodeEFAfter = res;
  return;
end;

/*
GetWindowRecord(wn,COr);
  MatRowGet(COr,rownr,COrw);
  if ((changedf!=0) or ((blank(COrw.Spec)) and (nonblank(COrw.ArtCode)))) then begin
    GetWindowRecord(wn,COr);
    DeselectWindow(wn,false);
    if (COVc_PasteArtCode(COr,rownr,inwarning)) then begin
      PutWindowRecord(wn,COr);
      if (nonblank(inwarning)) then begin
          MessageBox(0,inwarning);
      end;
    end else begin
      Beep;
    end;
  end;
  */


global
function Boolean EmailRecipDClassAfterEditField(Integer wn,string fieldname,Integer fn,Integer rownr,Integer changed)
BEGIN
  Boolean res;
  
  res = false;
  switch (fieldname) begin
    case "MainContactCode": res = EmailRecipDClassMainContactCodeEFAfter(wn,fn,rownr,changed);
    case "ContactCode": res = EmailRecipDClassContactCodeEFAfter(wn,fn,rownr,changed);
  end;
  EmailRecipDClassAfterEditField = res;
  RETURN;
END;