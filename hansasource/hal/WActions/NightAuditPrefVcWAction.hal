global
function Boolean NightAuditPrefDClassAfterEditField(Integer wn,string fieldname,Integer fn,Integer rownr,Integer changed)
begin
  boolean res;
  record NightAuditPrefVc NightAuditPrefr;
  record UserVc Userr;
  
  switch (fieldname) begin
    case "UserCode":
      if (changed) then begin
        GetWindowRecord(wn,NightAuditPrefr);
        Userr.Code = NightAuditPrefr.UserCode;
        if (ReadFirstMain(Userr,1,True)) then begin
          NightAuditPrefr.UserName = Userr.Name;
          PutWindowRecord(wn,NightAuditPrefr);
        end;
      end;
  end;  
  NightAuditPrefDClassAfterEditField = res;
  return;
end;
