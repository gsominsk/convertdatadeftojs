remote function Boolean ReadFirstItem(string,var record INVc,Boolean,Boolean);

function Boolean BarcodeDClassItemcodeEFAfter(Integer wn,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;
  record BarcodeVc Barcoder;
  record INVc INr;
  
  GetWindowRecord(wn,Barcoder);
  if (ReadFirstItem(Barcoder.Itemcode,INr,true,true)) then begin
    Barcoder.Comment = INr.Name;
    PutWindowRecord(wn,Barcoder);
  end else begin
    Beep;
  end;
  BarcodeDClassItemcodeEFAfter = res;
  RETURN;
END;
  
global
function Boolean BarcodeDClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;

  switch (fieldname) begin
    case "Itemcode": res = BarcodeDClassItemcodeEFAfter(wn,fn,rownr,changed);
  end;
  BarcodeDClassAfterEditField = res;
  RETURN;
END;

procedure BarcodeDClassSpecPasteNameItemcode(Integer wn,var string psname)
begin
  record BarcodeVc Barcoder;
  Integer rownr;

  GetWindowRecord(wn,Barcoder);
  rownr = WindowActiveRow(wn);
  DeselectWindow(wn,false);//to get VARINSClass working
  SelectWindow(wn);
  WindowFieldGoto(wn,Barcoder,rownr,"Itemcode",false);
  return;
end;

global
function string 40 BarcodeDClassSpecPasteName(Integer wn,string defpsname)
begin
  string 40 psname;

  psname = defpsname;
  switch (WindowActiveField(wn)) begin
    case "Itemcode": BarcodeDClassSpecPasteNameItemcode(wn,psname);
  end;
  BarcodeDClassSpecPasteName = psname;
  return;
end;
