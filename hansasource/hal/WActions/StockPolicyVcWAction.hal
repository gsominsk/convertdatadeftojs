external function Boolean ReadFirstItem(string,var record INVc,Boolean,Boolean);
external procedure GetSalesGroup(string,var string);

global
function Boolean StockPolicyDClassActiveEditField(Integer wn,string fieldname,Integer fn,Integer wnst,Integer rownr,Integer ef)
begin
  Boolean res;
  record StockPolicyVc SPr;
  
  res = true;
  if (wnst==Rs_update) then begin
    GetPrevWindowRecord(wn,SPr);
    if (SPr.OKFlag!=0) then begin
      res = false;
    end;
  end;
  StockPolicyDClassActiveEditField = res;
  return;
end;

function Boolean StockPolicyDClassArtCodeEFAfter(Integer wn,Boolean changedf)
BEGIN
  Boolean res;
  record StockPolicyVc SPr;
  record INVc INr;
  
  if (changedf) then begin
    res = true;
    DeselectWindow(wn,false);
    GetWindowRecord(wn,SPr);
    INr.Code = SPr.ArtCode;
    if (ReadFirstMain(INr,1,true)) then begin
      SPr.Name = INr.Name;
      PutWindowRecord(wn,SPr);        
    end else begin
      Beep;
    end;
  end;
  StockPolicyDClassArtCodeEFAfter = res;
  RETURN;
END;

global
function Boolean StockPolicyDClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;

  switch (fieldname) begin
    case "ArtCode": res = StockPolicyDClassArtCodeEFAfter(wn,changed!=0);
  end;
  StockPolicyDClassAfterEditField = res;
  RETURN;
END;

