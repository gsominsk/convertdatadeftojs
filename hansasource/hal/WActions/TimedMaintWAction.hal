global
procedure ScheduleMaintenanceDsm()
begin
  Integer nwn;
  record RcVc RepSpec;
  string 255 wclass;
  record TimedMaintVc TMr;
  
  GetWindowRecord(CurWindow,RepSpec);
  
  //wclass = GetWindowClass(CurWindow);
  //wclass = left(wclass,len(wclass) - 6);
  //wclass = wclass & "QClass";
  
  //RepSpec.TemplateType = kReportTemplateTypeDefault;
  //RepSpec.DefUser = CurrentUser;
  
  //nwn = OpenWindow(wclass,1,0,"","",RepSpec);
  
  RecordNew(TMr);
  PackFieldMatrix(TMr,"RepSpec",RepSpec);
  TMr.RequestedBy = CurrentUser;
  TMr.SpecWClass = GetWindowClass(CurWindow);
  TMr.RepName = RepSpec.repname;
  OpenWindow("TimedMaintDClass",1,0,"","",TMr);
  
  return;
end;

global
procedure ApproveMaintenanceDsm()
begin
  record TimedMaintVc TMr;
  
  if (UserCanAction("ApproveSchedMaint",false)==false) then begin
    Beep;
    goto LApproveMaintenanceDsm;
  end;
  
  GetWindowRecord(CurWindow,TMr);
  TMr.OKFlag = 1;
  TMr.ApprovedBy = CurrentUser;
  PutWindowRecord(CurWindow,TMr);
  
LApproveMaintenanceDsm:;
  return;
end;

global
procedure TimedMaintEditSpec()
begin
  Integer nwn,wn;
  record RcVc RepSpec;
  record TimedMaintVc TMr;
  
  wn = CurWindow;
  
  DeselectWindow(wn,false);
  GetWindowRecord(wn,TMr);
  UnpackFieldMatrix(TMr,"RepSpec",RepSpec);
  nwn = OpenWindow(TMr.SpecWClass,1,wn,"","",RepSpec);
  PutWindowRecord(nwn,RepSpec);
  
  return;
end;

global
procedure TimedMaintSaveSpecChanges(Integer wn)
begin
  Integer mwn;
  record RcVc RepSpec;
  record TimedMaintVc TMr;
  
  mwn = MotherWindow(wn);
  
  DeselectWindow(wn,false);
  DeselectWindow(mwn,false);
  
  GetWindowRecord(wn,RepSpec);
  GetWindowRecord(mwn,TMr);
  
  TMr.ApprovedBy = "";
  TMr.OKFlag = 0;
  PackFieldMatrix(TMr,"RepSpec",RepSpec);
  PutWindowRecord(mwn,TMr);
  CloseWindow(wn);
  
  return;
end;

global
function Boolean TimedMaintDClassOKFlagButtonAction(Integer wn,Integer value)
begin
  Boolean res;
  record TimedMaintVc TMr;
  
  GetWindowRecord(wn,TMr);
  
  if (TMr.DoneFlag<>0) then begin
    res = false;
    goto LTimedMaintDClassOKFlagButtonAction;
  end;
  
  if (TMr.OKFlag<>1) then begin
    res = false;
    goto LTimedMaintDClassOKFlagButtonAction;
  end;
  
  Beep;
LTimedMaintDClassOKFlagButtonAction:;
  
  TimedMaintDClassOKFlagButtonAction = res;
  return;
end;

global
function Boolean TimedMaintDClassDoneFlagButtonAction(Integer wn,Integer value)
begin
  Boolean res;
  res = false;
  TimedMaintDClassDoneFlagButtonAction = res;
  return;
end;
