
procedure InRecPutCustName(var record ECInSetBlock InRec)
begin
  record CUVc CUr;
  string 255 res;
  boolean foundf;
  integer wn;
  
  res = "";
  wn = CurWindow;
  CUr.Code = InRec.CustCode;
  foundf = true;
  while (LoopMain(CUr,1,foundf)) begin
    if (CUr.Code > InRec.CustCode) then begin
      foundf = false;
    end;
    if (CUr.Code == InRec.CustCode) then begin
      res = CUr.Name;
    end;
  end;
  InRec.CustName = res;
  return;
end;

global
function boolean ECInSetTClassCustCodeEFAfter(Integer wn,Integer fn, Integer rownr,Integer changed)
begin
  boolean res;
  record ECInSetBlock InRec;
  record CUVc CUr;

  res = true;
  if (changed!=0) then begin  
    GetWindowRecord(wn,InRec);
    DeselectWindow(wn,false);
    InRecPutCustName(InRec);
    PutWindowRecord(wn,InRec);
  end;
  ECInSetTClassCustCodeEFAfter = res;
  return;
end;

global
function Boolean ECInSetTClassAfterEditField(Integer wn,string fieldname,Integer fn,Integer rownr,Integer changed)
BEGIN
  Boolean res;
  string 30 tstr;
  record ECInSetBlock InRec;
  
  res = false;
  if (fieldname == "CustCode") then begin
    res = ECInSetTClassCustCodeEFAfter(wn,fn,rownr,changed);
  end;
  ECInSetTClassAfterEditField = res;
  RETURN;
END;
