function Boolean CUINDClassCustCodeEFAfter(Integer wn,Boolean changedf)
begin
  Boolean res;
  record CUINVc CUINr;
  record CUVc CUr;
  
  if (changedf) then begin
    GetWindowRecord(wn,CUINr);
    CUr.Code = CUINr.CustCode;
    ReadFirstMain(CUr,1,true);
    CUINr.CustName = CUr.Name;
    PutWindowRecord(wn,CUINr);
  end;
  CUINDClassCustCodeEFAfter = res;
  return;
end;

function Boolean CUINDClassArtCodeEFAfter(Integer wn,Boolean changedf)
begin
  Boolean res;
  record CUINVc CUINr;
  record INVc INr;
  
  if (changedf) then begin
    GetWindowRecord(wn,CUINr);
    INr.Code = CUINr.ArtCode;
    ReadFirstMain(INr,1,true);
    CUINr.ArtName = INr.Name;
    PutWindowRecord(wn,CUINr);
  end;
  CUINDClassArtCodeEFAfter = res;
  return;
end;

global
function Boolean CUINDClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
begin
  Boolean res;

  switch (fieldname) begin
    case "CustCode": res = CUINDClassCustCodeEFAfter(wn,changed!=0);
    case "ArtCode": res = CUINDClassArtCodeEFAfter(wn,changed!=0);
  end;
  CUINDClassAfterEditField = res;
  return;
end;

global
function Boolean CUINSClassOnOpenWindow(Integer wn)
begin
  Integer mwn;
  record ORVc ORr;
  record QTVc QTr;
  record IVVc IVr;
  record SHVc SHr;
  
  mwn = MotherWindow(wn);
  switch (GetWindowClass(mwn)) begin
    case "ORDClass":
      GetWindowRecord(mwn,ORr);
      SetWindowSubset(wn,ORr.CustCode);
    case "SHDClass":
      GetWindowRecord(mwn,SHr);
      SetWindowSubset(wn,SHr.CustCode);
    case "IVDClass":
      GetWindowRecord(mwn,IVr);
      SetWindowSubset(wn,IVr.CustCode);
    case "QTDClass":
      GetWindowRecord(mwn,QTr);
      SetWindowSubset(wn,QTr.CustCode);
  end;
  CUINSClassOnOpenWindow = false;
  return;
end;

global
function string 40 CUINSClassPasteSpecialWindowClass(string defpsname)
begin
  Integer wn;
  string 40 psname;
  record ORVc ORr;
  record QTVc QTr;
  record IVVc IVr;
  record SHVc SHr;
  string 255 custcode;
  
  wn = CurWindow;
  psname = defpsname;
  switch (GetWindowClass(wn)) begin
    case "ORDClass":
      GetWindowRecord(wn,ORr);
      custcode = ORr.CustCode;
    case "SHDClass":
      GetWindowRecord(wn,SHr);
      custcode = SHr.CustCode;
    case "IVDClass":
      GetWindowRecord(wn,IVr);
      custcode = IVr.CustCode;
    case "QTDClass":
      GetWindowRecord(wn,QTr);
      custcode = QTr.CustCode;
  end;  
  if (blank(custcode)) then begin
    psname = "CUIN2SClass";
  end;
  CUINSClassPasteSpecialWindowClass = psname;
  return;
end;
