external function Integer CheckVATNrMask(string,string,Integer,var string);
external function Boolean ProductInDemoMode();

//Should be CYBlockCheck but it is called in more places than storing blocks from the interface
global
function Boolean CYWClassOnOKWindow(Integer wn)
begin
  record CYBlock CYb;
  Boolean res;
  string 255 tstr;
  LongInt err;

  res = true;
  GetWindowRecord(wn,CYb);
  err = CheckVATNrMask(CYb.VATNr,CYb.CountryCode,0,tstr);
  if (err) then begin
    MessageBox(err,tstr);
    WindowFieldGoto(wn,CYb,-1,"VATBAcc",true);
    res = false;
    goto LCYBlockCheck;
  end;
LCYBlockCheck:;
  CYWClassOnOKWindow = res;
  return;
end;

function string 40 CYWClassSpecPasteNameAddr(Integer wn,Integer addrfield)
begin
  string 255 res;
  record CUUserLabelBlock CUUserLb;
  
  BlockLoad(CUUserLb);
  switch (CUUserLb.CountryAddrLine) begin
    case kCountryAddrLineUserAddr0:
      if (addrfield==0) then begin
        res = "CountrySClass";
      end;
    case kCountryAddrLineUserAddr1:
      if (addrfield==1) then begin
        res = "CountrySClass";
      end;
    case kCountryAddrLineUserAddr2:
      if (addrfield==2) then begin
        res = "CountrySClass";
      end;
    case kCountryAddrLineUserAddr3:
      if (addrfield==3) then begin
        res = "CountrySClass";
      end;
    case kCountryAddrLineUserAddr4:
      if (addrfield==4) then begin
        res = "CountrySClass";
      end;
  end;
  switch (CUUserLb.DistrictAddrLine) begin
    case kCountryAddrLineUserAddr0:
      if (addrfield==0) then begin
        res = "DistrictSClass";
      end;
    case kCountryAddrLineUserAddr1:
      if (addrfield==1) then begin
        res = "DistrictSClass";
      end;
    case kCountryAddrLineUserAddr2:
      if (addrfield==2) then begin
        res = "DistrictSClass";
      end;
    case kCountryAddrLineUserAddr3:
      if (addrfield==3) then begin
        res = "DistrictSClass";
      end;
    case kCountryAddrLineUserAddr4:
      if (addrfield==4) then begin
        res = "DistrictSClass";
      end;
  end;
  switch (CUUserLb.MunicipalityAddrLine) begin
    case kCountryAddrLineUserAddr0:
      if (addrfield==0) then begin
        res = "MunicipalitySClass";
      end;
    case kCountryAddrLineUserAddr1:
      if (addrfield==1) then begin
        res = "MunicipalitySClass";
      end;
    case kCountryAddrLineUserAddr2:
      if (addrfield==2) then begin
        res = "MunicipalitySClass";
      end;
    case kCountryAddrLineUserAddr3:
      if (addrfield==3) then begin
        res = "MunicipalitySClass";
      end;
    case kCountryAddrLineUserAddr4:
      if (addrfield==4) then begin
        res = "MunicipalitySClass";
      end;
  end;
  CYWClassSpecPasteNameAddr = res;
  return;
end;

global
function string 40 CYWClassSpecPasteName(Integer wn,string defpsname)
begin
  string 255 psname;
  
  psname = defpsname;
  switch (WindowActiveField(wn)) begin
    case "Addr0": psname = CYWClassSpecPasteNameAddr(wn,0);
    case "Addr1": psname = CYWClassSpecPasteNameAddr(wn,1);
    case "Addr2": psname = CYWClassSpecPasteNameAddr(wn,2);
    case "Addr3": psname = CYWClassSpecPasteNameAddr(wn,3);
    case "Addr4": psname = CYWClassSpecPasteNameAddr(wn,4);
  end;
  CYWClassSpecPasteName = psname;
  return;
end;

global
function Boolean CYWClassActiveEditField(Integer wn,string fieldname,Integer fn,Integer wnst,Integer rownr,Integer changed)
begin
  Boolean res;
  
  res = true;
  if (IsStandardProduct) then begin
    res = ProductInDemoMode==false;
  end;
  CYWClassActiveEditField = res;
end;
