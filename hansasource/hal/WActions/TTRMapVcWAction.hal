function Integer TTRFieldRowType(string code)
begin
  Integer res;
  record TTRFieldBlock TTRFb;
  row TTRFieldBlock TTRFrw;
  Integer i,rwcnt;
  
  BlockLoad(TTRFb);
  rwcnt = MatRowCnt(TTRFb);
  for (i=0;i<rwcnt;i=i+1) begin
    MatRowGet(TTRFb,i,TTRFrw);
    if (TTRFrw.Code==code) then begin
      res = TTRFrw.RowType;
      i = rwcnt;
    end;
  end;
  TTRFieldRowType = res;
  return;
end;

function Boolean TTRMapDClassCodeEFAfter(Integer wn,Boolean changedf)
begin
  Boolean res;
  record TTRMapVc TTRMapr;
  
  res = true;
  if (changedf) then begin
    DeselectWindow(wn,false);
    GetWindowRecord(wn,TTRMapr);
    TTRMapr.RowType = TTRFieldRowType(TTRMapr.Code);
    PutWindowRecord(wn,TTRMapr);
  end;
  TTRMapDClassCodeEFAfter = res;
  return;
end;

function Boolean TTRMapDClassRegisterEFAfter(Integer wn,Boolean changedf)
begin
  Boolean res;
  record TTRMapVc TTRMapr;
  
  res = true;
  if (changedf) then begin
    DeselectWindow(wn,false);
    GetWindowRecord(wn,TTRMapr);
    TTRMapr.FileName = StringSetFromString(-3,TTRMapr.Register);
    PutWindowRecord(wn,TTRMapr);
  end;
  TTRMapDClassRegisterEFAfter = res;
  return;
end;

function Boolean TTRMapDClassFromRegisterEFAfter(Integer wn,Boolean changedf)
begin
  Boolean res;
  record TTRMapVc TTRMapr;
  
  res = true;
  if (changedf) then begin
    DeselectWindow(wn,false);
    GetWindowRecord(wn,TTRMapr);
    TTRMapr.FromFileName = StringSetFromString(-3,TTRMapr.FromRegister);
    PutWindowRecord(wn,TTRMapr);
  end;
  TTRMapDClassFromRegisterEFAfter = res;
  return;
end;

global
function Boolean TTRMapDClassAfterEditField(Integer wn,string fieldname,Integer fn,Integer rownr,Integer changed)
BEGIN
  Boolean res;
  
  res = true;
  switch (fieldname) begin
    case "Code": res = TTRMapDClassCodeEFAfter(wn,changed!=0);
    case "Register": res = TTRMapDClassRegisterEFAfter(wn,changed!=0);
    case "FromRegister": res = TTRMapDClassFromRegisterEFAfter(wn,changed!=0);
  end;
  TTRMapDClassAfterEditField = res;
  RETURN;
END;