remote function Integer INAccTClassOnOKWindowRemote(record AccBlock,var string,var string);
remote function Integer AccTClassOnOKWindowRemote(record AccBlock,var string,var string);


//Should be AccBlockCheck but it is called in more places than storing blocks from the interface
global
function Boolean AccTClassOnOKWindow(Integer wn)
begin
  record AccBlock ARAccb;
  Boolean res;
  string 255 accstr,fieldgoto;
  Integer err;

  res = true;
  GetWindowRecord(wn,ARAccb);
  if (ARAccb.PostWriteOffVAT!=0) then begin
    if (ARAccb.IPBookVAT!=0) then begin
      MessageBox(24070,"");
      WindowFieldGoto(wn,ARAccb,-1,"VATBAcc",true);
      res = -1;
      goto LAccBlockCheck;
    end;
  end;

  if (ARAccb.TotalwoTAX!=0) then begin
    if (ARAccb.BasePriceInclVAT==1) then begin
      MessageBox(20939,"");
      WindowFieldGoto(wn,ARAccb,-1,"VATBAcc",true);
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  err = AccTClassOnOKWindowRemote(ARAccb,accstr,fieldgoto);
  if (err!=0) then begin
    MessageBox(err,accstr);
    WindowFieldGoto(wn,ARAccb,-1,fieldgoto,true);
    res = -1;
    goto LAccBlockCheck;
  end;

LAccBlockCheck:;
  AccTClassOnOKWindow = res;
  return;
end;

global
function Boolean INAccTClassOnOKWindow(Integer wn)
begin
  record AccBlock ARAccb;
  Boolean res;
  string 255 accstr,fieldgoto;
  Integer err;

  res = true;
  GetWindowRecord(wn,ARAccb);
  err = INAccTClassOnOKWindowRemote(ARAccb,accstr,fieldgoto);
  if (err!=0) then begin
    MessageBox(err,accstr);
    WindowFieldGoto(wn,ARAccb,-1,fieldgoto,true);
    res = -1;
    goto LINAccBlockCheck;
  end;
LINAccBlockCheck:;
  INAccTClassOnOKWindow = res;
  return;
end;

global
function Boolean AccTClassCreditIVTotNotExceedInvCheckButtonAction(Integer wn,Integer value)
begin
  Boolean res;
  record AccBlock ARAccb;
  LongInt error;

  res = true;
  error = 0;
  if (HasLocalization("PRT")) then begin 
    res = false;
    if (WindowState(wn)==Rs_normal) then begin
      GetWindowRecord(wn,ARAccb);
      if (ARAccb.CreditIVTotNotExceedInvCheck!=1) then begin 
        res = true;
        goto LAccTClass01;
      end;
    end;
    if (WindowState(wn)==Rs_update) then begin
      GetPrevWindowRecord(wn,ARAccb);
      if (ARAccb.CreditIVTotNotExceedInvCheck!=1) then begin 
        res = false;
        error = 33707;
        goto LAccTClass01;
      end;
      GetWindowRecord(wn,ARAccb);
      if (ARAccb.CreditIVTotNotExceedInvCheck!=0) then begin 
        res = false;
        error = 33707;
        goto LAccTClass01;
      end;      
    end;    
    res = HasLocalization("PRT")==false;
  end;
LAccTClass01:;
  if (error>0 and res==false) then begin 
    MessageBox(error,"");
  end;
  AccTClassCreditIVTotNotExceedInvCheckButtonAction = res;
  return;
end;

global
function Boolean AgedTClassOnOKWindow(Integer wn)
begin
  record AgedBlock Agedb;
  Boolean res;
  string 255 accstr,fieldgoto;
  Integer err;

  res = true;
  GetWindowRecord(wn,Agedb);
  if (Agedb.Per1<0) then begin
    MessageBox(1058,"");
    WindowFieldGoto(wn,Agedb,-1,"Per1",true);
    res = -1;
    goto LAgedTClassOnOKWindow;
  end;
  if (Agedb.Per2<0) then begin
    MessageBox(1058,"");
    WindowFieldGoto(wn,Agedb,-1,"Per2",true);
    res = -1;
    goto LAgedTClassOnOKWindow;
  end;
LAgedTClassOnOKWindow:;
  AgedTClassOnOKWindow = res;
  return;
end;
