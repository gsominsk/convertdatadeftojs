function Boolean CreditLimitDClassCustCodeEFAfter(Integer wn,Boolean changedf)
begin
  Boolean res;
  record CUVc CUr;
  record CreditLimitVc CLr;
  
  if (changedf) then begin
    GetWindowRecord(wn,CLr);
    CUr.Code = CLr.CustCode;
    res = ReadFirstMain(CUr,1,true);
    CLr.Name = CUr.Name;
    CLr.CreditLimit = CUr.CreditLimit;
    CLr.CreditLimitDays = CUr.CreditLimitDays;
    CLr.VECreditLimit = CUr.VECreditLimit;
    CLr.VECreditLimitDays = CUr.VECreditLimitDays;
    PutWindowRecord(wn,CLr);
  end;
  return;
end;

global
function Boolean CreditLimitDClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
begin
  Boolean res;

  switch (fieldname) begin
    case "CustCode": res = CreditLimitDClassCustCodeEFAfter(wn,changed!=0);
  end;
  CreditLimitDClassAfterEditField = res;
  return;
end;

global
function Boolean CreditLimitDClassActiveEditField(Integer wn,string fieldname,Integer fn,Integer wnst,Integer rownr,Integer changed)
begin
  Boolean res;
  record CreditLimitVc CLr;
  
  res = true;

  switch (fieldname) begin
    case "CreditLimit":
      switch (wnst) begin
        case Rs_insert:
          if (UserCanAction("AllowChangeCreditLimit",true)==false) then begin
            res = false;
          end;       
        case Rs_update:
          if (UserCanAction("AllowChangeCreditLimit",true)==false) then begin
            res = false;
          end;       
      end;
    case "VECreditLimit":
      switch (wnst) begin
        case Rs_insert:
          if (UserCanAction("AllowChangeCreditLimit",true)==false) then begin
            res = false;
          end;       
        case Rs_update:
          if (UserCanAction("AllowChangeCreditLimit",true)==false) then begin
            res = false;
          end;       
      end;
    case "CreditLimitDays":
      switch (wnst) begin
        case Rs_insert:
          if (UserCanAction("AllowChangeCreditLimitDays",true)==false) then begin
            res = false;
          end;       
        case Rs_update:
          if (UserCanAction("AllowChangeCreditLimitDays",true)==false) then begin
            res = false;
          end;       
      end;
    case "VECreditLimitDays":
      switch (wnst) begin
        case Rs_insert:
          if (UserCanAction("AllowChangeCreditLimitDays",true)==false) then begin
            res = false;
          end;       
        case Rs_update:
          if (UserCanAction("AllowChangeCreditLimitDays",true)==false) then begin
            res = false;
          end;       
      end;
  end;

  CreditLimitDClassActiveEditField = res;
  return;
end;