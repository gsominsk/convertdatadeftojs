external procedure CURegFieldVc_PasteFieldType(var record CURegFieldVc);
external function Boolean CURegFieldVc_FieldTypeIsClassification(record CURegFieldVc);

function Boolean CURegFieldDClassFieldTypeEFAfter(Integer wn,Integer changed)
begin
  Boolean res;
  record CURegFieldVc CURegFieldr;
  
  if (changed!=0) then begin
    GetWindowRecord(wn,CURegFieldr);
    CURegFieldVc_PasteFieldType(CURegFieldr);
    PutWindowRecord(wn,CURegFieldr);
  end;
  
  CURegFieldDClassFieldTypeEFAfter = res;
  return;
end;

global
function Boolean CURegFieldDClassAfterEditField(Integer wn,string fieldname,Integer fn,Integer rownr,Integer changed)
begin
  Boolean res;
  
  switch (fieldname) begin
    case "FieldType": res = CURegFieldDClassFieldTypeEFAfter(wn,changed);
  end;
  
  CURegFieldDClassAfterEditField = res;
  return;
end;

global
function string 40 CURegFieldDClassSpecPasteName(Integer wn,string defpsname)
begin
  string 255 psname;
  record CURegFieldVc CURegFieldr;
  
  psname = defpsname;
  switch (WindowActiveField(wn)) begin
    case "Param": 
      GetWindowRecord(wn,CURegFieldr);
      if (CURegFieldVc_FieldTypeIsClassification(CURegFieldr)) then begin
        psname = "CTypeSClass";
      end;
  end;
  
  CURegFieldDClassSpecPasteName = psname;
  return;
end;
