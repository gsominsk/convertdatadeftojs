remote procedure AuthCustVc_PasteCustCode(var record AuthCustVc);

global
function Boolean AuthCustDClassOKFlagButtonAction(Integer wn,Integer value)
BEGIN
  Boolean res;
  record AuthCustVc AuthCustr;
  Integer normalmode,updatemode;
 
  res = true;
  normalmode = 0;//Rs_normal
  updatemode = 2;//Rs_update
  if (WindowState(wn)==normalmode) then begin
    GetWindowRecord(wn,AuthCustr);
    if (AuthCustr.OKFlag!=0) then begin
      res = false;
    end;
    if (UserCanAction("UnOKAll",false)) then begin
      res = true;
    end;    
  end;  
  if (WindowState(wn)==updatemode) then begin
    GetPrevWindowRecord(wn,AuthCustr);
    if (AuthCustr.OKFlag!=0) then begin
      res = false;
    end;
  end;  
  AuthCustDClassOKFlagButtonAction = res;
  RETURN;
END;

global
function Boolean AuthCustDClassActiveEditField(Integer wn,string fieldname,Integer fn,Integer wnst,Integer rownr,Integer ef)
BEGIN
  Boolean res;
  record AuthCustVc AuthCust2r;
  record AuthCustVc AuthCustr;
  
  switch (fieldname) begin
    otherwise
      res = true;
      if (wnst==2) then begin//updatemode
        GetPrevWindowRecord(wn,AuthCust2r);
        if (AuthCust2r.OKFlag!=0) then begin
          switch (fieldname) begin
            case "endDate": res = true; 
            case "MaxUnits": res = true; 
            case "MaxSales": res = true; 
            case "MaxCost": res = true; 
            otherwise res = false; 
          end;
        end;
      end;    
  end;
  AuthCustDClassActiveEditField = res;
  RETURN;
END;
 
global
function Boolean AuthCustDClassCustCodeEFAfter(Integer wn,Integer rownr,Integer changedf)
begin
  record AuthCustVc AuthCustr;

  if (changedf!=0) then begin  
    GetWindowRecord(wn,AuthCustr);
    DeselectWindow(wn,false);
    AuthCustVc_PasteCustCode(AuthCustr);
    PutWindowRecord(wn,AuthCustr);
  end;
  AuthCustDClassCustCodeEFAfter = true;
  return;
end;

global
function Boolean AuthCustDClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;

  switch (fieldname) begin
    case "CustCode": res = AuthCustDClassCustCodeEFAfter(wn,rownr,changed);
  end;
  AuthCustDClassAfterEditField = res;
  RETURN;
END;

