
function Boolean ModulesTClassOperatingSystemEFAfter(Integer wn,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;
  record ModuleBlock mtr;
  
  GetWindowRecord(wn,mtr);
  if (mtr.OperatingSystem>0) then begin
    if (mtr.Hardware==0) then begin
      switch (mtr.OperatingSystem) begin
        case 1: mtr.Hardware = 1;
        case 2: mtr.Hardware = 2;
        case 3: mtr.Hardware = 3;
        case 4: mtr.Hardware = 4;
        case 5: mtr.Hardware = 5;
        case 6: mtr.Hardware = 6;
      end;
      PutWindowRecord(wn,mtr);
    end;
  end;
  ModulesTClassOperatingSystemEFAfter = res;
  RETURN;
END;
  
function Boolean ModulesTClassHardwareEFAfter(Integer wn,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;
  record ModuleBlock mtr;
  
  GetWindowRecord(wn,mtr);
  if (mtr.Hardware>0) then begin
    if (mtr.OperatingSystem==0) then begin
      switch (mtr.Hardware) begin
        case 1: mtr.OperatingSystem = 1;
        case 2: mtr.OperatingSystem = 2;
        case 3: mtr.OperatingSystem = 3;
        case 4: mtr.OperatingSystem = 4;
        case 5: mtr.OperatingSystem = 5;
        case 6: mtr.OperatingSystem = 6;
      end;
      PutWindowRecord(wn,mtr);
    end;
  end;
  ModulesTClassHardwareEFAfter = res;
  RETURN;
END;
  
global
function Boolean ModulesTClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;

  switch (fieldname) begin
    case "Hardware": res = ModulesTClassHardwareEFAfter(wn,fn,rownr,changed);
    case "OperatingSystem": res = ModulesTClassOperatingSystemEFAfter(wn,fn,rownr,changed);
  end;
  ModulesTClassAfterEditField = res;
  RETURN;
END;

// Doesn't really belong here, but this is for our internal use only
global
function Boolean SystemUsageSettingDClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;
  record INVc INr;
  record SystemUsageSettingVc SUSr;

  if (changed!=0) then begin
    switch (fieldname) begin
      case "ItemCode": 
        GetWindowRecord(wn,SUSr);
        INr.Code = SUSr.ItemCode;
        if (ReadFirstMain(INr,1,true)) then begin
          SUSr.Comment = INr.Name;
          SUSr.Objects = INr.Objects;
          PutWindowRecord(wn,SUSr);    
        end;
      case "ServiceItemCode":
        GetWindowRecord(wn,SUSr);
        INr.Code = SUSr.ServiceItemCode;
        if (ReadFirstMain(INr,1,true)) then begin
          if (blank(SUSr.Objects)) then begin
            SUSr.Objects = INr.Objects;
          end;
          PutWindowRecord(wn,SUSr);    
        end;
    end;
  end;
  SystemUsageSettingDClassAfterEditField = res;
  RETURN;
END;

