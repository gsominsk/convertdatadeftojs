external procedure GetVATRow(string,var row VATCodeBlock);

function Boolean Tax1RebDClassCodeEFAfter(Integer wn,Boolean changedf)
BEGIN
  row VATCodeBlock VATrw;
  record Tax1RebVc Tax1Rebr;

  DeselectWindow(wn,false);
  GetWindowRecord(wn,Tax1Rebr);    
  if (changedf) then begin
    GetVATRow(Tax1Rebr.Code,VATrw);
    Tax1Rebr.Comment = VATrw.Comment;
    PutWindowRecord(wn,Tax1Rebr);
  end;
  Tax1RebDClassCodeEFAfter = true;
  return;
end;

function Boolean Tax1RebDClassCustCodeEFAfter(Integer wn,Boolean changedf)
BEGIN
  record CUVc CUr;
  record Tax1RebVc Tax1Rebr;

  DeselectWindow(wn,false);
  GetWindowRecord(wn,Tax1Rebr);    
  if (changedf) then begin
    CUr.Code = Tax1Rebr.CustCode;
    if (ReadFirstMain(CUr,1,true)) then begin
      Tax1Rebr.Name = CUr.Name;
    end;
    PutWindowRecord(wn,Tax1Rebr);
  end;
  Tax1RebDClassCustCodeEFAfter = true;
  return;
end;

global
function Boolean Tax1RebDClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;

  switch (fieldname) begin
    case "Code":  res = Tax1RebDClassCodeEFAfter(wn,changed!=0);
    case "CustCode":  res = Tax1RebDClassCustCodeEFAfter(wn,changed!=0);
  end;
  Tax1RebDClassAfterEditField = res;
  RETURN;
END;
