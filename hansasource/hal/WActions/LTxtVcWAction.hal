
function Boolean ShouldUseHtmlEditor(record LTxtVc Ltxtr,Boolean newf)
begin
  Boolean res;
  res = false;
  
  if (SystemSupportsHTMLLetters()==false) then begin
    goto LShouldUseHtmlEditor;
  end;
  
/*
  if (newf) then begin
    GetMailFormattingSettings(Mailr,Confr);
    if (Confr.SerNr>0) then begin
      if (Confr.DefaultHtmlFlag!=0) then begin
        res = true;
      end;
    end;
  end;
*/
  
  if (Ltxtr.HtmlFlag!=0) then begin
    res = true;
  end;

LShouldUseHtmlEditor:;
  ShouldUseHtmlEditor = res;
end;

global
function string 255 LTxtDClassOverrideClass(record LTxtVc Ltxtr,Boolean newf)
begin
  string 255 res;
  Boolean htmlf;
  
  htmlf = ShouldUseHtmlEditor(Ltxtr,newf);
  if (htmlf==true) then begin
    res = "HtmlLTxtDClass";
  end;
  
LLTxtDClassOverrideClass:
  LTxtDClassOverrideClass = res;
  return;
end;

global
function string 255 HtmlLTxtDClassOverrideClass(record LTxtVc Ltxtr,Boolean newf)
begin
  string 255 res;
  Boolean htmlf;
  
  htmlf = ShouldUseHtmlEditor(Ltxtr,newf);
  if (htmlf==false) then begin
    res = "LTxtDClass";
  end;

LHtmlLTxtDClassOverrideClass:
  HtmlLTxtDClassOverrideClass = res;
  return;
end;

global
function Boolean LTxtDClassHtmlFlagButtonAction(Integer wn,Integer value)
begin
  Boolean res;
  record LTxtVc Ltxtr;

  res = true;
  
  GetWindowRecord(wn,Ltxtr);
  if (SystemSupportsHTMLLetters()==false) then begin
    res = false;
    goto LHtmlFlagButtonAction;
  end;
/*  
  GetMailFormattingSettings(Mailr,Confr);
  if (Confr.SerNr>0) then begin
    if (Confr.DefaultHtmlFlag==0 and Confr.ForceHtmlFlag!=0) then begin
      res = false;
      goto LHtmlFlagButtonAction;
    end;
  end;
*/  
  if (Ltxtr.HtmlFlag!=0 and WindowState(wn)!=Rs_normal) then begin
    res = false;
    MessageBox(25456,"");
    goto LHtmlFlagButtonAction;
  end;
  
LHtmlFlagButtonAction:;
  LTxtDClassHtmlFlagButtonAction = res;
  return;
end;

global
function Boolean HtmlLTxtDClassHtmlFlagButtonAction(Integer wn,Integer value)
begin
  HtmlLTxtDClassHtmlFlagButtonAction = LTxtDClassHtmlFlagButtonAction(wn,value);
  return;
end;

global
function Boolean LTxtDClassHtmlFlagButtonAfter(Integer wn,Boolean changedf)
begin
  Boolean res;
  record LTxtVc Ltxtr;
  Integer nwn,mwn;
  
  if (changedf) then begin
    DeselectWindow(wn,false);
    GetWindowRecord(wn,Ltxtr);
    if (Ltxtr.HtmlFlag!=0 and SystemSupportsHTMLLetters()) then begin
      nwn = ReOpenHtmlEditorWindow(wn,true);
    end;
  end;
  LTxtDClassHtmlFlagButtonAfter = res;
  return;
end;

global
function Boolean HtmlLTxtDClassHtmlFlagButtonAfter(Integer wn,Boolean changedf)
begin
  Boolean res;
  record LTxtVc Ltxtr;
  Integer nwn,mwn;
  
  if (changedf) then begin
    DeselectWindow(wn,false);
    GetWindowRecord(wn,Ltxtr);
    if (Ltxtr.HtmlFlag==0 and SystemSupportsHTMLLetters()) then begin
      nwn = ReOpenHtmlEditorWindow(wn,false);
    end;
  end;
  HtmlLTxtDClassHtmlFlagButtonAfter = res;
  return;
end;

global
function Boolean LTxtDClassOnOpenWindow(Integer wn)
begin
  record LTxtVc Ltxtr;
  string 255 folder;

  GetWindowRecord(wn,Ltxtr);
  if (SystemSupportsHTMLLetters()==false and Ltxtr.HtmlFlag!=0) then begin
    MessageBox(25464,""); 
  end;
  
  return;
end;

global
function Boolean HtmlLTxtDClassOnOpenWindow(Integer wn)
begin
  HtmlLTxtDClassOnOpenWindow = LTxtDClassOnOpenWindow(wn);
  return;
end;

global
procedure LTxtDClassOnWindowRecordChange(Integer wn)
begin
  record LTxtVc Ltxtr;
  Integer nwn;

  if (SystemSupportsHTMLLetters()==true) then begin
    GetWindowRecord(wn,Ltxtr);
    nwn = ReOpenHtmlEditorWindow(wn,Ltxtr.HtmlFlag);
  end;
  return;
end;


global
procedure HtmlLTxtDClassOnWindowRecordChange(Integer wn)
begin
  record LTxtVc Ltxtr;
  Integer nwn;

  GetWindowRecord(wn,Ltxtr);
  nwn = ReOpenHtmlEditorWindow(wn,Ltxtr.HtmlFlag);
  return;
end;