
function Boolean ShouldUseHtmlEditor(record ConfSignVc ConfSignr,Boolean newf)
begin
  Boolean res;
  res = false;
  
  if (SystemSupportsHTMLMail()==false) then begin
    goto LShouldUseHtmlEditor;
  end;
  
/*
  if (newf) then begin
    GetMailFormattingSettings(Mailr,Confr);
    if (Confr.SerNr>0) then begin
      if (Confr.DefaultHtmlFlag!=0) then begin
        res = true;
      end;
    end;
  end;
*/
  
  if (ConfSignr.HtmlFlag!=0) then begin
    res = true;
  end;

LShouldUseHtmlEditor:;
  ShouldUseHtmlEditor = res;
end;

global
function string 255 ConfSignDClassOverrideClass(record ConfSignVc ConfSignr,Boolean newf)
begin
  string 255 res;
  Boolean htmlf;
  
  htmlf = ShouldUseHtmlEditor(ConfSignr,newf);
  if (htmlf==true) then begin
    res = "HtmlConfSignDClass";
  end;
  
LConfSignDClassOverrideClass:
  ConfSignDClassOverrideClass = res;
  return;
end;

global
function string 255 HtmlConfSignDClassOverrideClass(record ConfSignVc ConfSignr,Boolean newf)
begin
  string 255 res;
  Boolean htmlf;
  
  htmlf = ShouldUseHtmlEditor(ConfSignr,newf);
  if (htmlf==false) then begin
    res = "ConfSignDClass";
  end;

LHtmlConfSignDClassOverrideClass:
  HtmlConfSignDClassOverrideClass = res;
  return;
end;

global
function Boolean ConfSignDClassHtmlFlagButtonAction(Integer wn,Integer value)
begin
  Boolean res;
  record ConfSignVc ConfSignr;

  res = true;
  
  GetWindowRecord(wn,ConfSignr);
  if (SystemSupportsHTMLMail()==false) then begin
    res = false;
    goto LHtmlFlagButtonAction;
  end;
/*  
  GetMailFormattingSettings(Mailr,Confr);
  if (Confr.SerNr>0) then begin
    if (Confr.DefaultHtmlFlag==0 and Confr.ForceHtmlFlag!=0) then begin
      res = false;
      goto LHtmlFlagButtonAction;
    end;
  end;
*/  
  if (ConfSignr.HtmlFlag!=0 and WindowState(wn)!=Rs_normal) then begin
    res = false;
    MessageBox(22012,"");
    goto LHtmlFlagButtonAction;
  end;
  
LHtmlFlagButtonAction:;
  ConfSignDClassHtmlFlagButtonAction = res;
  return;
end;

global
function Boolean HtmlConfSignDClassHtmlFlagButtonAction(Integer wn,Integer value)
begin
  HtmlConfSignDClassHtmlFlagButtonAction = ConfSignDClassHtmlFlagButtonAction(wn,value);
  return;
end;

global
function Boolean ConfSignDClassHtmlFlagButtonAfter(Integer wn,Boolean changedf)
begin
  Boolean res;
  record ConfSignVc ConfSignr;
  Integer nwn,mwn;
  
  if (changedf) then begin
    DeselectWindow(wn,false);
    GetWindowRecord(wn,ConfSignr);
    if (ConfSignr.HtmlFlag!=0 and SystemSupportsHTMLMail()) then begin
      nwn = ReOpenHtmlEditorWindow(wn,true);
    end;
  end;
  ConfSignDClassHtmlFlagButtonAfter = res;
  return;
end;

global
function Boolean HtmlConfSignDClassHtmlFlagButtonAfter(Integer wn,Boolean changedf)
begin
  Boolean res;
  record ConfSignVc ConfSignr;
  Integer nwn,mwn;
  
  if (changedf) then begin
    DeselectWindow(wn,false);
    GetWindowRecord(wn,ConfSignr);
    if (ConfSignr.HtmlFlag==0 and SystemSupportsHTMLMail()) then begin
      nwn = ReOpenHtmlEditorWindow(wn,false);
    end;
  end;
  HtmlConfSignDClassHtmlFlagButtonAfter = res;
  return;
end;

global
function Boolean ConfSignDClassOnOpenWindow(Integer wn)
begin
  record ConfSignVc ConfSignr;
  string 255 folder;

  GetWindowRecord(wn,ConfSignr);
  if (SystemSupportsHTMLMail()==false and ConfSignr.HtmlFlag!=0) then begin
    MessageBox(22013,""); 
  end;
  
  return;
end;

global
function Boolean HtmlConfSignDClassOnOpenWindow(Integer wn)
begin
  HtmlConfSignDClassOnOpenWindow = ConfSignDClassOnOpenWindow(wn);
  return;
end;

global
procedure ConfSignDClassOnWindowRecordChange(Integer wn)
begin
  record ConfSignVc ConfSignr;
  Integer nwn;

  if (SystemSupportsHTMLMail()==true) then begin
    GetWindowRecord(wn,ConfSignr);
    nwn = ReOpenHtmlEditorWindow(wn,ConfSignr.HtmlFlag);
  end;
  return;
end;


global
procedure HtmlConfSignDClassOnWindowRecordChange(Integer wn)
begin
  record ConfSignVc ConfSignr;
  Integer nwn;

  GetWindowRecord(wn,ConfSignr);
  nwn = ReOpenHtmlEditorWindow(wn,ConfSignr.HtmlFlag);
  return;
end;