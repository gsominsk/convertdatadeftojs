remote function Boolean GetCustAndBal(var record CUVc,var val,var val,Integer,Integer,Integer,Integer,Integer,Integer,var Boolean);

global
procedure CustMessages(string fnr,string cust)
BEGIN
  record CreditLimitBlock CreditLimitRec;
  record CUVc CUr;
  val limit,bal;
  Boolean limitdaysf;
  string 255 errstr;
  
  CUr.Code = cust;
  BlockLoad(CreditLimitRec);
  if (GetCustAndBal(CUr,limit,bal,CreditLimitRec.Base,0,0,0,0,0,limitdaysf)) then begin
    if (nonblank(CUr.WarnText1)) then begin
      MessageBox(0,CUr.WarnText1);
    end;
    if (fnr=="ORVc") then begin
      if (CreditLimitRec.ORPaste==1) then begin
        if (limitdaysf) then begin
          MessageBox(0,USetStr(22260));
        end;
        if (blank(limit)==false) then begin 
          if (bal>limit) then begin
            if (limit==0.001 and CreditLimitRec.Base==kCreditLimitBasedOnOpenInvSuspendOnOverdue) then begin
              errstr = USetStr(39600);
            end else begin
              errstr = USetStr(1164);
            end;
            MessageBox(0,errstr);
          end;
        end;
      end;
    end;
    if (fnr=="SHVc") then begin
      if (CreditLimitRec.SHPaste==1) then begin
        if (limitdaysf) then begin
          MessageBox(0,USetStr(22260));
        end;
        if (blank(limit)==false) then begin 
          if (bal>limit) then begin
            if (limit==0.001 and CreditLimitRec.Base==kCreditLimitBasedOnOpenInvSuspendOnOverdue) then begin
              errstr = USetStr(39600);
            end else begin
              errstr = USetStr(1164);
            end;
            MessageBox(0,errstr);
          end;
        end;
      end;
    end;
    if (fnr=="IVVc") then begin
      if (CreditLimitRec.IVPaste==1) then begin
        if (limitdaysf) then begin
          MessageBox(0,USetStr(22260));
        end;
        if (blank(limit)==false) then begin 
          if (bal>limit) then begin
            if (limit==0.001 and CreditLimitRec.Base==kCreditLimitBasedOnOpenInvSuspendOnOverdue) then begin
              errstr = USetStr(39600);
            end else begin
              errstr = USetStr(1164);
            end;
            MessageBox(0,errstr);
          end;
        end;
      end;
    end;
  end;
  RETURN;
END;

