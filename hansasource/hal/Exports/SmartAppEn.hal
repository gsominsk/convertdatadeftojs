procedure DoSmartAppEn(record SmartAppVc SAr,record RcVc RepSpec)
begin
  record RepGenVc RGr;
  record WindowDefinitionVc WDr;
  record RegisterDefinitionVc RDr;
  string 255 vcname;
  
  ExportString("SmartAppVc");
  NewLine;
  ExportRecord(SAr);
  NewLine;
  NewLine;
  NewLine;
  
  ExportString("repgen2");
  NewLine;
  while (LoopKey("Code:" & SAr.UUID,RGr,0,true)) begin
    ExportRecord(RGr);
    NewLine;
  end;
  NewLine;
  NewLine;
  
  ExportString("WindowDefinitionVc");
  NewLine;
  while (LoopKey("MainKey:" & SAr.UUID,WDr,0,true)) begin
    ExportRecord(WDr);
    NewLine;
    vcname = WDr.Register;
  end;
  NewLine;
  NewLine;
  
  ExportString("RegisterDefinitionVc");
  NewLine;
  while (LoopKey("MainKey:" & SAr.UUID,RDr,0,true)) begin
    ExportRecord(RDr);
    NewLine;
  end;
  NewLine;
  NewLine;
  
  if (RepSpec.flags[0]==1) then begin
    RecordNew(RDr);
    ResetLoop(RDr);
    
    while (LoopKey("MainKey:" & SAr.UUID,RDr,0,true)) begin
      vcname = RegDefVcName(RDr);
      RegisterExport(vcname);
    end;
    
  end;
end;

global
procedure SmartAppEn(record RcVc RepSpec)
begin
  record SmartAppVc SAr;
  
  SAr.UUID = RepSpec.RecordUUID;
  
  if (ReadFirstKey("UUID",SAr,1,true)) then begin
    DoSmartAppEn(SAr,RepSpec);
  end;
end;
