external procedure NewLineExport();

global
procedure DnBAppHeader(string crncy,var LongInt appsernr,var LongInt betcount,Integer flags2)
BEGIN
  string 255 tstr;
  
  betcount = betcount + 1;
  /*
  if (nonblank(crncy) and (crncy<>"NOK")) then begin
    tstr = "AH100TBIU";
  end else begin
    tstr = "AH100TBII";
  end;
  */
  if (flags2==1) then begin
    tstr = "AH200TBIU";
  end else begin
    tstr = "AH200TBII";
  end;
  
  ExportPadString(tstr,9," ",false);
  ExportPadString(DateToString(CurrentDate,"MMDD"),4," ",false);
  tstr = appsernr;
  ExportPadString(tstr,6,"0",true);
  ExportPadString(" ",8," ",true);
  ExportPadString(" ",11," ",true);
  ExportPadString("04",2," ",true);
  appsernr = appsernr + 1;
  RETURN;
END;

global
procedure ConvertBankVal(val vp,var string res)
BEGIN
  val nv;
  
  nv = vp * 100;
  res = ValToString(nv,M40Val,"","",0);//  tstr = nv; in 6.1 this puts thousand separator
  RETURN;
END;

global
procedure DnBBegin(string crncy,string user,record CYBlock CompYear,var LongInt betcount,var LongInt appsernr,var LongInt rowsernr,Integer flags2,string divcode,Boolean newversf)
BEGIN
  string 255 tstr;
  
  DnBAppHeader(crncy,appsernr,betcount,flags2);
  ExportPadString("BETFOR00",8," ",false);
  ExportPadString(StripNonDigits(CompYear.BankCode),11,"0",true);
  ExportPadString(divcode,11," ",false);
  tstr = rowsernr;
  ExportPadString(tstr,4,"0",true);
  rowsernr = rowsernr + 1;
  if (rowsernr>9999) then begin
    rowsernr = 0;
  end;  
  ExportPadString(" ",6," ",true);
  NewLineExport;
  ExportPadString(DateToString(CurrentDate,"MMDD"),4," ",false);
  ExportPadString(" ",10," ",false);
  ExportPadString("VERSJON002",10," ",false);
  ExportPadString(" ",10," ",true);
  ExportPadString(UpperCase(user),11," ",true);
  ExportPadString(" ",1," ",true);
  ExportPadString("0",6,"0",true);
  ExportPadString("0",20,"0",true);  
  ExportPadString(" ",1," ",false);
  ExportPadString(" ",7," ",false);
  NewLineExport;
  ExportPadString(" ",80," ",true);
  NewLineExport;
  ExportPadString(" ",80," ",true);
  NewLineExport;
  RETURN;
END;

global
procedure BankExpNorwayEnd(record CYBlock CompYear,var LongInt rowsernr,var LongInt appsernr,var LongInt betcount,Integer betfor21cnt,Integer flags2,Boolean newversf)
BEGIN
  string 255 tstr;
  Integer i;
  
  DnBAppHeader("",appsernr,betcount,flags2);
  ExportPadString("BETFOR99",8," ",false);
  ExportPadString(StripNonDigits(CompYear.BankCode),11,"0",true);
  ExportPadString(" ",11," ",true);
  tstr = rowsernr;
  ExportPadString(tstr,4,"0",true);
  //rowsernr = rowsernr + 1; HA
  if (rowsernr>9999) then begin
    rowsernr = 0;
  end;  
  ExportPadString(" ",6," ",true);
  
  NewLineExport;
  ExportPadString(DateToString(CurrentDate,"MMDD"),4," ",false);
  if (flags2==0) then begin
    ExportPadString("0",4,"0",false);
    ExportPadString("0",15,"0",false);
  end else begin
    ExportPadString(" ",19," ",false);
  end;
  tstr = betcount+1;
  ExportPadString(tstr,5,"0",true);
  ExportPadString(" ",52," ",false);
  NewLineExport;
  ExportPadString(" ",80," ",false);
  NewLineExport;
  ExportPadString(" ",31," ",false);
  ExportPadString(" ",4," ",false);
  ExportPadString(" ",1," ",false);
  ExportPadString(" ",1," ",false);
  ExportPadString(" ",1," ",false);
  ExportPadString(" ",18," ",false);
  if (newversf) then begin
    ExportPadString("HOTFIXTP2",9," ",false);
    ExportPadString(" ",7," ",false);
  end else begin
    ExportPadString(Mid(ProgramVersion,0,3),8," ",false);
    ExportPadString("Hansa",8," ",false);
  end;
  ExportPadString(" ",8," ",false);
  NewLineExport;
  RETURN;
END;
