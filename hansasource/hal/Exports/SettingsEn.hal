external function Integer GetLocalCompanyNr(string,Boolean);

procedure ExportTheBlock(string blockname,Integer compnr,Integer curcomp)
BEGIN
  
  if (SetCompany(compnr,false)) then begin
    BlockExport(blockname);  
    ResetCompany(curcomp);
  end else begin
    ResetCompany(curcomp);
  end;
  RETURN;
END;

global
procedure SettingsEn(record RcVc RepSpec)
BEGIN
  record CompaniesBlock CompaniesRec;
  row CompaniesBlock comprw;
  Integer i,rwcnt;
  Integer compnr,curcomp;
  Boolean TrHs;

  if (blank(RepSpec.f1)) then begin
    goto LSettingsEn;
  end;
  curcomp = CurrentCompany;  
  BlockLoad(CompaniesRec);
  rwcnt = MatRowCnt(CompaniesRec);
  for (i=0;i<rwcnt;i=i+1) begin
    MatRowGet(CompaniesRec,i,comprw);
    if (comprw.CompCode==RepSpec.f1) then begin
      compnr = GetLocalCompanyNr(comprw.CompCode,false);
      TrHs = true;
      goto LExport;
    end;
  end;
LExport:;  
  if (TrHs) then begin
    ExportFormat;
    ExportTheBlock("BaseCurBlock",compnr,curcomp);
    ExportTheBlock("SysFormatBlock",compnr,curcomp);
    ExportTheBlock("LangBlock",compnr,curcomp);
    ExportTheBlock("DBLockBlock",compnr,curcomp);
    ExportTheBlock("PeriodBlock",compnr,curcomp);
    ExportTheBlock("RoundBlock",compnr,curcomp);
    ExportTheBlock("SLAccBlock",compnr,curcomp);
    ExportTheBlock("PMBlock",compnr,curcomp);
    ExportTheBlock("CreditLimitBlock",compnr,curcomp);
    ExportTheBlock("FreightBlock",compnr,curcomp);
    ExportTheBlock("FreightWeightBlock",compnr,curcomp);
    ExportTheBlock("AccBlock",compnr,curcomp);
    ExportTheBlock("InvDefBlock",compnr,curcomp);
    ExportTheBlock("CredDefBlock",compnr,curcomp);
    ExportTheBlock("VATCodeBlock",compnr,curcomp);
  end;
/*  
  RegisterExport("DNMVc");
  RegisterExport("SpecDayVc");
  RegisterExport("StyleVc");
  RegisterExport("DocVc");
  RegisterExport("LangNrVc");
  RegisterExport("WeekVc");
  RegisterExport("PDVc");
*/  
LSettingsEn:;  
  RETURN;
END;

