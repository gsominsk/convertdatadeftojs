external function Boolean SetInSet2(string,string);

global
procedure Contact1En(record RcVc RepSpec)
begin
  record ContactRelVc ContactRelr;
  record CUVc CUr;
  String 60 fr,to;
  Boolean found,testf,cufound;
  record MailSettingsBlock MBr;

  BlockLoad(MBr);
  // Export header to file
  ExportString("Company");
  ExportString("CompName");
  ExportString("Name");
  ExportString("Adress0");
  ExportString("Adress1");
  ExportString("Adress2");
  ExportString("Phone");
  ExportString("Fax");
  ExportString("Email");
  ExportString("Comment0");
  ExportString("Comment1");
  ExportString("Comment2");
  ExportString("Title");
  ExportString("Department");
  ExportString("JobDesc");
  ExportString("Classification");
  ExportString("Mobile");
  ExportString("AltPhone");
  ExportString("BirthDate");
  ExportString("Closed");
  ExportString("Adress3");
  ExportString("Adress4");
  ExportString("");
  ExportString("");
  ExportString("");
  ExportString("");
  ExportString("Salutation1");
  ExportString("Salutation2");
  ExportString("Salutation3");
  NewLine;
  NewLine;
  
  
  fr = FirstInRange(RepSpec.f1,20);
  to = LastInRange(RepSpec.f1,20);
  ContactRelr.CustCode = fr;
  found = true;
  
  while (LoopKey("CompKey",ContactRelr,1,found)) begin
  
    testf = true;
    
    if(nonblank(to)) then begin
      if (ContactRelr.CustCode>to) then begin
        found = false;
      end;
    end;
    
    
    // Check contact person
    if (nonblank(RepSpec.f2)) then begin
      if (ContactRelr.ContactName<>RepSpec.f2) then begin
        testf = false;
      end;
    end;
    
    CUr.Code = ContactRelr.ContactCode;
    if (ReadFirstMain(CUr,1,true)==false) then begin
      testf = false;
    end;

    // Check customer category
    if (nonblank(RepSpec.f3)) then begin
       if (CUr.CustCat<>RepSpec.f3) then begin
         testf = false;
       end;
     end;
    
    
    // Check classification
    if (nonblank(RepSpec.f4)) then begin
     testf = (SetinSet2(RepSpec.f4,CUr.Classification));
    end;
    
    if (CUr.blockedFlag<>0) then begin testf = false; end;
    
    if (found==false) then begin
      testf = false;
    end;

    if (testf) then begin
      ExportString(ContactRelr.CustCode);
      ExportString(ContactRelr.CustName);
      ExportString(CUr.Name);
      ExportString(CUr.InvAddr0);
      ExportString(CUr.InvAddr1);
      ExportString(CUr.InvAddr2);
      ExportString(CUr.Phone);
      ExportString(CUr.Fax);
      if (MBr.ExclEmail==0) then begin
        ExportString(CUr.eMail);
      end else begin
        ExportString("");
      end;
      ExportString(CUr.Comment0);
      ExportString(CUr.Comment1);
      ExportString(CUr.Comment2);
      ExportString(CUr.Title);
      ExportString(CUr.Department);
      ExportString(CUr.JobDesc);
      ExportString(CUr.Classification);
      ExportString(CUr.Mobile);
      ExportString(CUr.AltPhone);
      ExportString(CUr.BirthDate);
      ExportString(CUr.blockedFlag);
      ExportString(CUr.InvAddr3);
      ExportString(CUr.InvAddr4);
      ExportString("");
      ExportString("");
      ExportString("");
      ExportString("");
      ExportString(CUr.Salutation1);
      ExportString(CUr.Salutation2);
      ExportString(CUr.Salutation3);
      NewLine;
    end;  /* if(testf) */
  end; /* LoopKey */
  return;
end;

