global
procedure ExportInvBunaaarbankinn(var record RcVc RepSpec,var record FactoringBlock factp)
BEGIN
  record ARVc ARr;
  record IVVc IVr;
  Boolean TrHs,testf;
  string 255 tstr;
  LongInt appsernr;
  Boolean exported;
  record CYBlock CYRec;
  record OPTblock OPTr;
  LongInt friv,toiv;
  
  friv = FirstInRange(RepSpec.f1,10);
  toiv = LastInRange(RepSpec.f1,10);  
  BlockLoad(CYRec);
  BlockLoad(OPTr);
//  CreateFile(OPTr.ExpPath & "\\" & "BI080");
  appsernr = 0;
  if (factp.Bank==1) then begin 
    appsernr = RepSpec.FirstVer;
  end;  
  TrHs = true;
  IVr.InvDate = RepSpec.sStartDate;
  while (LoopKey("InvDate",IVr,1,TrHs)) begin
    if (IVr.InvDate>RepSpec.sEndDate) then begin
      TrHs = false;
    end;
    if (TrHs) then begin
      testf = true;
      if (IVr.InvType==kInvoiceTypeCredit or IVr.InvType==kInvoiceTypeCreditSpecialSales) then begin testf = false; end;
      if (nonblank(RepSpec.f1)) then begin
        if (IVr.SerNr<friv) then begin testf = false; end;
        if (IVr.SerNr>toiv) then begin testf = false; end;
      end;
      if (testf) then begin
        ARr.InvoiceNr = IVr.SerNr;
        if (ReadFirstMain(ARr,1,true)) then begin
          ExportPadString(factp.User,4," ",false);
          ExportPadString(Mid(factp.User,4,2),2," ",false);
          ExportPadString(factp.LastSerNr,6," ",false);//maybe cuurent export number 
          ExportPadString("",3," ",false);
          tstr = StripNonDigits(CYRec.OrgNr);
          ExportPadString(tstr,10," ",false);
          ExportPadString(CYRec.BankCode,3," ",false);
          ExportPadString(IVr.CustCode,10," ",false);
          ExportPadString("001",3," ",false);
          ExportPadString(DateToString(IVr.PayDate,"DDMMYY"),6," ",false);
          ExportPadString(DateToString(AddDay(IVr.PayDate,15),"DDMMYY"),6," ",false);//??
          ExportPadString("",1," ",false);
          ExportPadString("0",11,"0",true);
          ExportPadString(IVr.SerNr,7," ",false);
          ExportPadString("",1," ",false);
          ExportPadString("",3," ",false);
          ExportPadString("",3," ",false);
          ExportPadString("",6," ",false);
          ExportPadString("",11," ",false);
          ExportPadString("",3," ",false);
          ExportPadString("",2," ",false);
          ExportPadString("",1," ",false);
          ExportPadString("",3," ",false);
          ExportPadString("",50," ",false);
          ExportPadString("",3," ",false);
          ExportPadString(ValToString(IVr.Sum4,M4Val,"","",0),11,"0",true);
          ExportPadString("01",2," ",false);          
          NewLine;
          exported = true;
        end;
      end;  
    end;
  end;
  if (exported) then begin
    factp.LastSerNr = factp.LastSerNr + 1;
    factp.LastDate = CurrentDate;
  end;  
//  CloseFile;
  RETURN;
END;
