/* Bank Export For England Albacs */
/* Programmed by Bj¿rn Schwab for 3.6 */ 
/* to be connected to 30 in  SetBegin(16); */

global
procedure BankExpEngEn0(record OPVc OPr)
begin
 Row OPVc OPrw;
 Record VIVc VIr;
 record CYBlock CompYear;
 Integer i,rwcnt;
 string 255 tstr;
 integer strl; 
 integer strl1;
 
  BlockLoad(CompYear);
  rwcnt = MatRowCnt(OPr);
  for (i = 0; i<rwcnt; i = i + 1) begin
      MatRowGet(OPr,i,OPrw);
      ExportPadString(OPrw.SortCode,8," ",false);  //Sort Code
      ExportPadString("  ",2," ",false);
      ExportPadString(OPrw.BankAcc,8," ",false);  //Bank Account
      ExportPadString("  ",2," ",false);
      ExportPadString("0",1," ",false);  //Type 0
      ExportPadString("  ",2," ",false);
      VIr.SerNr = OPrw.VISerNr;
      if (ReadFirstMain(VIr,1,true)) then begin  //Supplier Name
        ExportPadString(Vir.VEName,18," ", false); 
      end;  
      ExportPadString("  ",2," ",false);
      strl = len(OPrw.RecVal);
      strl1 = strl - 3;
      ExportPadString(left(OPrw.RecVal,strl1),6," ",true);    //Sent Amount
      tstr = right(OPrw.RecVal,2);
      ExportPadString(tstr,2," ", false); //decimals
      ExportPadString("  ",2," ",false);
      VIr.SerNr = OPrw.VISerNr;
      if (ReadFirstMain(VIr,1,true)) then begin
        ExportPadString(VIr.InvoiceNr,18," ", false); // Reference Supplier Invoice Number
      end;  
      ExportPadString("  ",2," ",false);
      ExportPadString("  ",2," ",false); //Transaction Code
      ExportPadString("  ",2," ",false);
      ExportPadString(OPr.SortCode,8," ",false);  // Sort Code own bank
      ExportPadString("  ",2," ",false);
      ExportPadString(OPr.BankAcc,8," ",false); //Bank Account own bank        
      ExportPadString("  ",2," ",false);
      ExportPadString("0",1," ",false);  //Type 0
      ExportPadString("  ",2," ",false);
      ExportPadString(CompYear.CompName,18," ",false);
      NewLine; 
  end;
  return;
end;
