global
procedure BankExpEngEn2(record OPVc OPr)
begin
 Row OPVc OPrw;
 record CYBlock CompYear;
 record PMBlock PMr;
 row PMBlock PMrw;
 record VIVc VIr;

 Boolean TrHs;
 Integer i,rwcnt;
 string 255 tstr;
 integer j,PMrrwcnt;
   
 BlockLoad(CompYear);
  
 tstr = "$FN:1";
 ExportPadString(tstr,len(tstr)," ",false);  
 NewLine;
 
 tstr = "$FT:";
 tstr = tstr & OPr.CurPayVal;
 ExportPadString(tstr,len(tstr)," ",false);  
 NewLine;
 
 tstr = "$DS";
 ExportPadString(tstr,len(tstr)," ",false);  
 NewLine;
 
 
 BlockLoad(PMr);
 PMrrwcnt = MatRowCnt(PMr);
 for (j = 0; j<PMrrwcnt; j=j+1) begin
      MatRowGet(PMr,j,PMrw);
      if (PMrw.Code==OPr.PayMode) then begin
        tstr = "F01:" & PMrw.BankNr; 
        ExportPadString(tstr,len(tstr)," ",false);  
 		NewLine;
        tstr = "F02:" & PMrw.SortCode; 
        ExportPadString(tstr,len(tstr)," ",false);  
 		NewLine;
      end;
 end;  
 tstr = "F03:" & "HansaFinancials PL"; 
 ExportPadString(tstr,len(tstr)," ",false);  
 NewLine;
 
 rwcnt = MatRowCnt(OPr);
 tstr = "F04:" & rwcnt; 
 ExportPadString(tstr,len(tstr)," ",false);  
 NewLine;
 tstr = "F05:" & OPr.CurPayVal;
 ExportPadString(tstr,len(tstr)," ",false);  
 NewLine;
 tstr = "$LS";
 ExportPadString(tstr,len(tstr)," ",false);  
 NewLine;
 for (i = 0; i<rwcnt; i = i + 1) begin
    MatRowGet(OPr,i,OPrw);
    
    VIr.SerNr = OPrw.VISerNr;
    if ReadFirstMain(VIr,1,true) then begin
    end;
    
    tstr = "S01:";
    tstr = tstr & OPrw.BankAcc;
    ExportPadString(tstr,len(tstr)," ",false);  
 	NewLine;
 	
    tstr = "S02:";
    tstr = tstr & OPrw.SortCode;
    ExportPadString(tstr,len(tstr)," ",false);  
 	NewLine;
    tstr = "S03:";
    tstr = tstr & Left(VIr.VEName,18);
    ExportPadString(tstr,len(tstr)," ",false);  
 	NewLine;
 		
    tstr = "S04:";
    tstr = tstr & OPrw.RecVal;
    ExportPadString(tstr,len(tstr)," ",false);  
 	NewLine;
 	
    tstr = "S05:";
    tstr = tstr & VIr.InvoiceNr;
    ExportPadString(tstr,len(tstr)," ",false);  
 	NewLine;
    
    tstr = "$LE";
    ExportPadString(tstr,len(tstr)," ",false);  
    NewLine;
    if (i == rwcnt - 1) then begin
        tstr = "$DE";
        ExportPadString(tstr,len(tstr)," ",false);
    end else begin    
        ExportPadString("$LS",3," ",false);  
    end;	 
    NewLine;
  end;
  return;
end;
