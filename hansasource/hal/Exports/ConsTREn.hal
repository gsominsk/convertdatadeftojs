external procedure ExpBackupString(string);
external procedure OutRegisterTag(string);

procedure OutCompNr(Integer compnr)
BEGIN
  ExportString("compnr");
  ExportString(compnr);
  NewLine;
  RETURN;
END;

global
procedure ConsTREn(record RcVc RepSpec)
BEGIN
  Boolean TrHs,first;
  record TRVc TRr;
  LongInt frtr,totr;
  Integer yc1,yc2;
  
  frtr = FirstTransInRange(RepSpec.f1);
  totr = LastTransInRange(RepSpec.f1);
  yc1 = FirstTransTypeInRange(RepSpec.f1);
  yc2 = LastTransTypeInRange(RepSpec.f1);
  TRr.Number = frtr;
  TRr.IntYc = yc1;
  first = true;
  TrHs = true;
  while (LoopMain(TRr,2,TrHs)) begin
    if (nonblank(RepSpec.f1)) then begin
      if (TRr.IntYc>yc2) then begin TrHs = false; end;
    end;  
    if (TRr.IntYc==yc2) then begin
      if (TRr.Number>totr) then begin TrHs = false; end;
    end; 
    if (TrHs) then begin
      if (first==true) then begin
        OutCompNr(RepSpec.ArtMode);
        ExportFormat;
        ExpBackupString(RepSpec.f3);
        OutRegisterTag("TRVc");
        first = false;
        NewLine;
      end;
      if (nonblankdate(RepSpec.d1)) then begin
        TRr.TransDate = RepSpec.d1;
      end;
      ExportRecord(TRr);
      NewLine;
      UserTrace(TRr.Number,M4Long);
    end;
  end; 
  RETURN;
END;