global
procedure ExportInvSparisjodir(var record RcVc RepSpec,var record FactoringBlock factp)
BEGIN
  record ARVc ARr;
  record IVVc IVr;
  Boolean TrHs,testf;
  string 255 tstr;
  LongInt appsernr;
  Boolean exported;
  record CYBlock CYRec;
  LongInt friv,toiv;
  record CUVc CUr;
  
  friv = FirstInRange(RepSpec.f1,10);
  toiv = LastInRange(RepSpec.f1,10);  
  BlockLoad(CYRec);
  appsernr = 0;
  if (factp.Bank==1) then begin 
    appsernr = RepSpec.FirstVer;
  end;  
/*
  ExportPadString(CYRec.CompName,10," ",false);  
  ExportPadString(";",1," ",false);
  tstr = StripNonDigits(CYRec.BankCode);
  ExportPadString(Left(tstr,4),4,"0",true);  
  ExportPadString(Mid(tstr,4,2),2,"0",false);  
  ExportPadString(Mid(tstr,6,6),6,"0",false);  
  ExportPadString(";",1," ",false);
  ExportPadString("",10,"",false);  
  ExportPadString(";",1," ",false);  
  tstr = Left(CYRec.CompName,50);
  ExportPadString(tstr,len(tstr)," ",false);  
  tstr = Left(CYRec.CompName,50);
//  ExportPadString("",50," ",false);
  ExportPadString(";",1," ",false);
//  ExportPadString("",50," ",false);
  ExportPadString(";",1," ",false);
//  ExportPadString("",50," ",false);
  ExportPadString(";",1," ",false);
  ExportPadString("N",1," ",false);
  ExportPadString(";",1," ",false);
  ExportPadString("N",1," ",false);
  ExportPadString(";",1," ",false);
//  ExportPadString("",80," ",false);
  ExportPadString(";",1," ",false);
//  ExportPadString("",80," ",false);
  ExportPadString(";",1," ",false);
  ExportPadString("00",2," ",false);
  ExportPadString(";",1," ",false);
  NewLine;
*/  
  TrHs = true;
  IVr.InvDate = RepSpec.sStartDate;
  while (LoopKey("InvDate",IVr,1,TrHs)) begin
    if (IVr.InvDate>RepSpec.sEndDate) then begin
      TrHs = false;
    end;
    if (TrHs) then begin
      testf = true;
      if (IVr.InvType==kInvoiceTypeCredit or IVr.InvType==kInvoiceTypeCreditSpecialSales) then begin testf = false; end;
      if (nonblank(RepSpec.f1)) then begin
        if (IVr.SerNr<friv) then begin testf = false; end;
        if (IVr.SerNr>toiv) then begin testf = false; end;
      end;
      if (testf) then begin
        ARr.InvoiceNr = IVr.SerNr;
        if (ReadFirstMain(ARr,1,true)) then begin
          CUr.Code = IVr.CustCode;
          if (ReadFirstMain(CUr,1,true)) then begin
          end;
          ExportPadString("S",1," ",false);
          ExportPadString(";",1," ",false);
          tstr = StripNonDigits(IVr.CustCode);
          ExportPadString("0",10," ",false);
          ExportPadString(";",1," ",false);
          ExportPadString(factp.User,6," ",false);
          ExportPadString(";",1," ",false);
          tstr = StripNonDigits(CUr.BankAccount);          
          ExportPadString(tstr,10," ",false);
          ExportPadString(";",1," ",false);
          tstr = Left(IVr.Addr0,50);
          ExportPadString(tstr,len(tstr)," ",false);
          ExportPadString(";",1," ",false);
          tstr = Left(ValToString(IVr.Sum4,M4Val,"",",",0),9);
          ExportPadString(tstr,len(tstr)," ",false);
          ExportPadString(";",1," ",false);
          tstr = DateToString(IVr.PayDate,"DDMMYYYY");
          ExportPadString(tstr,8," ",false);
          ExportPadString(";",1," ",false);
          tstr = DateToString(AddDay(IVr.PayDate,15),"DDMMYYYY");
          ExportPadString(tstr,8," ",false);
          ExportPadString(";",1," ",false);
          ExportPadString(";",1," ",false);
          ExportPadString(";",1," ",false);
          NewLine;
          exported = true;
        end;
      end;  
    end;
  end;
  if (exported) then begin
    factp.LastSerNr = factp.LastSerNr + 1;
    factp.LastDate = CurrentDate;
  end;  
  RETURN;
END;
