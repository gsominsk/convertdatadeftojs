external procedure NewLineExport();

global
procedure ItemHistEn(record RcVc RepSpec)
begin
  record ItemHistVc IHr;
  Boolean found,testf;
  string 255 frin,toin,index;
  Integer segs;
  
  frin = FirstInRange(RepSpec.f1,20);
  toin = LastInRange(RepSpec.f1,20);
  index = "ArtCode";
  segs = 2;
  if (blank(RepSpec.f1)) then begin
    index = "TransDate";
    segs = 1;
  end;
  found = true;
  IHr.ArtCode = frin;
  IHr.TransDate = RepSpec.sStartDate;
  while (LoopKey(index,IHr,segs,found)) begin
    if (DateInRange(IHr.TransDate,RepSpec.sStartDate,RepSpec.sEndDate)==false) then begin
      found = true;
    end;
    if (nonblank(RepSpec.f1)) then begin
      if (IHr.ArtCode>toin) then begin found = false; end;
    end;
    if (found) then begin
      testf = true;
      if (nonblank(RepSpec.f2)) then begin
        if (IHr.Location!=RepSpec.f2) then begin testf = false; end;
      end;
      if (RepSpec.flags[0]==0) then begin
        if (IHr.StockAffectf==0) then begin testf = false; end;
      end;
      if (testf) then begin
        ExportRecord(IHr);
        NewLineExport;
      end;
    end;
  end;
  return;
end;