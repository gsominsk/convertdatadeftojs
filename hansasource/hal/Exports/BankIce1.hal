/*bunaåarbankinn*/
global
procedure BankExpIceland1(record OPVc OPr,record RcVc RepSpec)
BEGIN
  record VIVc VIr;
  record CUVc VEr;
  Integer i,rwcnt;
  row OPVc OPrw;
  Boolean testf;
  string 255 tstr,vebankacc;
  record OPTblock OPTr;

  BlockLoad(OPTr);
  CreateFile(OPTr.ExpPath & "\\" & "SI080");
  rwcnt = MatRowCnt(OPr);
  for (i = 0 ; i<rwcnt ;i=i+1) begin
    MatRowGet(OPr,i,OPrw);
    if (OPrw.ovst<>0) then begin goto LBankExpIceland1; end;
    if (blank(OPrw.BankAcc)) then begin goto LBankExpIceland1; end;    
    VIr.SerNr = OPrw.VISerNr;
    if (ReadFirstMain(VIr,1,true)==false) then begin goto LBankExpIceland1; end;
    testf = true;
    if (VIr.Invalid<>0) then begin goto LBankExpIceland1; end;
    testf = true;           
    if (testf) then begin
      VEr.Code = OPrw.VECode;
      if (ReadFirstMain(VEr,1,true)) then begin end;
      vebankacc = StripNonDigits(OPrw.BankAcc);
      ExportPadString(Left(vebankacc,4),4,"0",true);
      ExportPadString(Mid(vebankacc,4,2),2,"0",true);      
      ExportPadString(Mid(vebankacc,6,6),6," ",false);
      ExportPadString("",2," ",false);
      ExportPadString(OPrw.VECode,10," ",false);
      ExportPadString(DateToString(VIr.DueDate,"DD"),2," ",false);
      ExportPadString("",2," ",false);
      if (OPrw.ChequeNr==-1) then begin
        tstr = "";
      end else begin
        tstr = OPrw.ChequeNr;
      end;
      ExportPadString(tstr,7," ",false);//?
      tstr = ValToString(OPrw.BankVal,M4Val,"","",0);
      ExportPadString(tstr,11,"0",true);
      ExportPadString(VIr.RefStr,16," ",false);
      ExportPadString("",18," ",false);
      ExportPadString("",50," ",false);
      ExportPadString("",50," ",false);
      ExportPadString("",1," ",false);//must be J or P or N
      ExportPadString("",1," ",false);//must be J or N
      ExportPadString("",8," ",false);
      NewLine;
    end;    
  end;
LBankExpIceland1:;
  CloseFile;
  RETURN;
END;
