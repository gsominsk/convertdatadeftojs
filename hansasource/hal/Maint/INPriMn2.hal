external function roundmode SetRoundModeD(Integer);
external function roundmode DefaultRoundMode();
external procedure CheckFlush(var Integer,Integer);

/*

Made by Tony Marshal

This is designed for Office/2 to allow bulk update of Item prices

*/

global
updating procedure ItemPricesO2Mn(record RcVc RepSpec)
begin
  record INVc INr;
  string 20 fromart, toart, sort;
  string 40 vtemp;
  val tempval;
  boolean TrHs, testf, stored;
  Integer flushcnt;
  
  if nonblank(RepSpec.f1) then begin
    sort = "Group";
    INr.Group=RepSpec.f1;
  end else begin
    sort="Code";
  end;
  if nonblank(RepSpec.f2) then begin
    fromart = FirstInRange(RepSpec.f2,20);
    toart = LastInRange(RepSpec.f2,20);
    INr.Code = fromart;
  end else begin
    INr.Code = "";
  end;
  
  TrHs = true;
  while (LoopKey(sort,INr,1,TrHs)) begin
    testf = true;
    if (sort=="Code") then begin
      if (INr.Code>toart) then begin
        TrHs = false;
      end;
    end;
    if (sort=="Group") then begin
      if (INr.Group>RepSpec.f1) then begin
        TrHs = false;
      end;
    end;
    if blank(RepSpec.f1) AND blank(RepSpec.f2) then begin
      TrHs = false;
    end;
    if (INr.Terminated<>0) then begin
      testf = false;
    end;
    if (TrHs) then begin
      if (testf) then begin
        if nonblank(RepSpec.vals0) then begin
          tempval =RepSpec.vals0/100;
          if (RepSpec.ArtMode==0) then begin
            INr.UPrice1 = Round(INr.UPrice1*tempval,DefaultRoundMode);
          end else begin
            INr.UPrice1 = Round(INr.UPrice1*tempval,SetRoundModeD(3));
          end;
        end;
        stored = RecordStore(INr,true);
        CheckFlush(flushcnt,10);
      end;
    end;
  end;
  RETURN;
END;

