external procedure CheckFlush(var Integer,Integer);

global
updating procedure ICToBcMn(record RcVc RepSpec)
begin
  record INVc oldINr;
  record INVc INr;
  Boolean TrHs,testf;
  string 100 fromart,toart;
  string 100 frcc,tocc;
  LongInt LLoop1;
  string 200 tstr;
  Integer res;
  Integer flushcnt;

  fromart = FirstInRange(RepSpec.f1,20);
  toart = LastInRange(RepSpec.f1,20);
  frcc = FirstInRange(RepSpec.f3,20);
  tocc = LastInRange(RepSpec.f3,20);
  INr.Code = fromart;
  TrHs = true;
  while (LoopMain(INr,1,TrHs)) begin
    testf = true; //testf = false;
    RecordCopy(oldINr,INr);
    if (TrHs) then begin
      if (nonblank(toart)) then begin
        if (INr.Code>toart) then begin
          TrHs = false;
        end;
      end;
    end;
    if (TrHs==false) then begin
      testf = false;
    end;
    if (RepSpec.flags[2]==1) then begin
      if (nonblank(INr.BarCode)) then begin
        testf = false;
      end;
    end;
    if (testf) then begin
      if (nonblank(RepSpec.f3)) then begin
        if (INr.Group<>RepSpec.f3) then begin
          testf = false;
        end;
      end;
    end;
    if (testf) then begin
      switch (RepSpec.flags[3]) begin
        case 0: 
          INr.BarCode = INr.Code;
        case 1:
          tstr = INr.EUCodex;
          INr.EUCodex = INr.BarCode;
          INr.BarCode = tstr;
      end;
    end;
    if (testf) then begin
      res = RecordUpdate(oldINr,INr,false);
      CheckFlush(flushcnt,10);
    end;
    MaintTrace(INr.Code);    
  end;
  return;
end;
