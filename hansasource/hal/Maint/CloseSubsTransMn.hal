event startup
begin
  Real h,v,l,vs;

  SetLangMode(LangEnglish,"ENG",0);

  Maintenance("Close Subscription Transactions",CloseSubsTransVClass,CloseSubsTransMn,modAppBilling);

  return;
end;

event DefineWindows
begin
  real h,v;

  SetLangMode(LangEnglish,"ENG",0);

  WindowBegin("Specify Close Subscription Transactions",CloseSubsTransVClass,CGMnt,RcType);
  SetWRect(20,80,350,150);
  EndWindow;
end;

global
updating procedure CloseSubsTransMn(record RcVc RepSpec)
BEGIN
  Boolean found,testf;
  record SubscriptionTransVc STr;
  record SubscriptionTransVc oldSTr;
   
  found = true;
  while (LoopMain(STr,1,found)) begin 
    if (found) then begin
      testf = true;
      if (STr.Paid!=0) then begin testf = false; end;
      if (testf) then begin
        RecordCopy(oldSTr,STr);
        STr.Paid = 1;
        if (RecordUpdate(oldSTr,STr,false)) then begin
        end; 
        MaintTrace(STr.SerNr); 
      end;
    end;
  end;
LCloseSubsTransMn:;  
  RETURN;
END;