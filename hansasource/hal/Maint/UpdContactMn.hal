external procedure CheckFlush(var Integer,Integer);

procedure UpdateFieldWith(record CUVc CUr,Integer UsedOnly,var string res)
BEGIN
  res = "";
  switch (UsedOnly) begin
    case 1: res = CUr.Department;
    case 2: res = CUr.Name;
    case 3: res = CUr.Comment0;
    case 4: res = CUr.Comment1;
    case 5: res = CUr.Comment2;
    case 6: res = CUr.Title;
    case 7: res = CUr.JobDesc;
  end;  
  RETURN;
END;

global
updating procedure UpdContactMn(record RcVc RepSpec)
begin
  record CUVc CUr;
  Boolean TrHs,testf,updatef;
  string 255 tstr;
  Integer flushcnt;
  
  switch (RepSpec.ArtMode) begin
    case 7:
      if (blank(RepSpec.LastAcc)) then begin
        goto LUpdContactMn;
      end;
  end;
  TrHs = true;
  while (LoopMain(CUr,1,TrHs)) begin
    if (TrHs) then begin
      testf = true;
      if (SetInSet(RepSpec.f1,CUr.Classification)==false) then begin testf = false; end;
      if (nonblank(RepSpec.FirstAcc)) then begin
        if (CUr.PayDeal!=RepSpec.FirstAcc) then begin testf = false; end;
      end;
      if (testf) then begin
        updatef = true;      
        switch (RepSpec.ArtMode) begin
          case 1: UpdateFieldWith(CUr,RepSpec.UsedOnly,tstr); CUr.Salutation1 = tstr;
          case 2: UpdateFieldWith(CUr,RepSpec.UsedOnly,tstr); CUr.Salutation2 = tstr;
          case 3: UpdateFieldWith(CUr,RepSpec.UsedOnly,tstr); CUr.Salutation3 = tstr;
          case 4: UpdateFieldWith(CUr,RepSpec.UsedOnly,tstr); CUr.Title = tstr;
          case 5: UpdateFieldWith(CUr,RepSpec.UsedOnly,tstr); CUr.JobDesc = tstr;
          case 6: UpdateFieldWith(CUr,RepSpec.UsedOnly,tstr); CUr.Department = tstr;
          case 7: CUr.PayDeal = RepSpec.LastAcc;
          otherwise updatef = false;
        end;
        if (updatef) then begin
          if (RecordStore(CUr,true)) then begin
          end;
        end;
      end;
    end;
  end;
LUpdContactMn:;  
  return;
end;