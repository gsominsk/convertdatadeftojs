external procedure CleanUpTelNr(string,var string);

global
updating
procedure UpdRegNumbersMn(record RcVc RepSpec)
begin
  Record CUVc CUr;
  Record CUVc VEr;
  Record CallRegTypeVc CallRegTyper;
  String 255 tmp;
  Boolean testf;
    
  if (RepSpec.flags[4]==1) then begin
    while (LoopMain(CallRegTyper,1,true)) begin
      recorddelete(CallRegTyper);
      stepback(CallRegTyper);
    end;
    DBFlush;
    DBHold;
  end;  
  if (RepSpec.flags[1]==1) then begin
    while (LoopMain(CUr,1,true)) begin
      testf = true;
      if (CUr.CUType==0) then begin testf = false; end;
      if (testf) then begin
        Usertrace(CUr.Code,0);
        CallRegTyper.Code = CUr.Code;
        CleanUpTelNr(CUr.Phone,tmp);
        CallRegTyper.Number = tmp;
        CallRegTyper.RegType = 0;
        CallRegTyper.Name = CUr.Name;
        if RecordStore(CallRegTyper,true) then begin end;
      end;
    end;
    DBFlush;
    DBHold;
  end;
  if (RepSpec.flags[2]==1) then begin
    while (LoopMain(VEr,1,true)) begin
      testf = true;
      if (VEr.VEType==0) then begin testf = false; end;    
      if (testf) then begin
        Usertrace(VEr.Code,0);
        CleanUpTelNr(VEr.Phone,tmp);
        CallRegTyper.Code = VEr.Code;
        CallRegTyper.Number = tmp;
        CallRegTyper.RegType = 1;
        CallRegTyper.Name = VEr.Name;
        if RecordStore(CallRegTyper,true) then begin end;
      end;
    end;
    DBFlush;
    DBHold;
  end;
  Return;
end;
