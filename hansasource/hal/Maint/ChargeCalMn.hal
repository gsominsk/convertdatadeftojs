//external updating procedure TelCallToShopBask(string,string,time,val,LongInt,string,string);
// external updating procedure CalcTelCost(record PhoneBlock,var record TelCallsVc,Boolean);

// This is probably old code that isn't used anymore.
updating
procedure TelCallsInShopBasket(record PhoneBlock PhoneRec,record JobVc Jobr)
BEGIN
/*
  record TelCallsVc TelCallsr;
  Boolean TrHs;

  TrHs = true;
  TelCallsr.ResCode = Jobr.ResCode;
  while (LoopKey("ResCode",TelCallsr,1,TrHs)) begin
    if (Jobr.ResCode<>TelCallsr.ResCode) then begin
      TrHs = false;
    end;
    if (TrHs) then begin
//      if (PhoneRec.EnableCharging!=0) then begin
//        CalcTelCost(PhoneRec,TelCallsr,true);
//      end;
      if (PhoneRec.EnableCharging!=2) then begin   
//        TelCallToShopBask(PhoneRec.ArtCode,TelCallsr.Type,TelCallsr.Duration,TelCallsr.Cost,Jobr.SerNr,Jobr.CUCode,""); // Last one is Phone
      end;  
    end;
  end;  
*/  
  RETURN;
END;

global
updating procedure TelCallsJobLoop(LongInt frres,LongInt tores)
BEGIN
  record JobVc Jobr;
  record PhoneBlock PhoneRec;
  Boolean TrHs;

  BlockLoad(PhoneRec);
  if (PhoneRec.ChargeMethod==0) then begin
    TrHs = true;
    while (LoopMain(Jobr,1,TrHs)) begin
      if (tores>0) then begin
        if (Jobr.SerNr>tores) then begin
          TrHs = false;
        end;
      end;
      if (TrHs) then begin
        if (PhoneRec.EnableCharging!=0) then begin
          TelCallsInShopBasket(PhoneRec,Jobr);
        end;
      end;
    end;
  end;
  RETURN;
END;
  
global
updating procedure ChargeCalMn(record RcVc RepSpec)
BEGIN
  LongInt frres,tores;
  
  if (blank(RepSpec.f1)) then begin
    goto LChargeCalMn;
  end;
  frres = FirstInRange(RepSpec.f1,10);
  tores = LastInRange(RepSpec.f1,10);
  TelCallsJobLoop(frres,tores);
LChargeCalMn:;
  RETURN;
END;
