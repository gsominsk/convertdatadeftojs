external procedure SetupIVFromShopBask(var record IVVc,string,string,string,string,val,val,val,val,val);
external updating procedure StoreIVFromJobShopBask(var record RcVc,var record IVVc,record JobVc,string,Boolean,Integer);
//external procedure BuildIVFromJobShopBask(var record IVVc,record JobVc,string,Boolean,Boolean,Boolean,Integer,record RcVc);
external procedure BuildIVFromShopBask3(var record IVVc,record JobVc,string,Boolean,Boolean,Boolean,Integer,record RcVc);
external updating procedure UpdateJobShopBask(record JobVc,LongInt,string,Boolean,Boolean,Boolean,Boolean,var Integer);

global
updating procedure IVFromGroupJobMn(record RcVc RepSpec)
begin
  record JobVc GJobr;
  record IVVc IVr;
  Integer flushcnt;
  
  GJobr.SerNr = RepSpec.long1;
  if (ReadFirstMain(GJobr,1,true)) then begin
    SetupIVFromShopBask(IVr,GJobr.PriceList,GJobr.ResUsage,GJobr.CUCode,GJobr.CurncyCode,GJobr.FrRate,GJobr.ToRateB1,GJobr.ToRateB2,GJobr.BaseRate1,GJobr.BaseRate2);
    BuildIVFromShopBask3(IVr,GJobr,GJobr.CUCode,false,false,true,RepSpec.ArtMode,RepSpec);
    StoreIVFromJobShopBask(RepSpec,IVr,GJobr,GJobr.CUCode,false,-1);
    UpdateJobShopBask(GJobr,IVr.SerNr,GJobr.CUCode,false,false,true,false,flushcnt);    
  end;
  return;
end;
