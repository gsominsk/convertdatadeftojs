//  *********************************************// DESC   : Last NL Transaction of the Year// DATE   : 01/2000// Description by: GMexternal procedure SMSumup(var record SMVc);updating procedure CreateSim3_ARG_POR(record SMVc Sim1)begin   record SMVc SMr;  row SMVc SMrw;  Integer i,rwcnt;  val d,c;    RecordCopy(SMr,Sim1);  SMr.Comment = USetStr(8343);  SMr.TransDate = AddDay(SMr.TransDate,1);  rwcnt = MatRowCnt(SMr);  for (i=0;i<rwcnt;i=i+1) begin    MatRowGet(SMr,i,SMrw);    d = SMrw.DebVal;     c = SMrw.CredVal;    SMrw.DebVal = c;     SMrw.CredVal = d;    SMrw.RowSimStat = 4;    MatRowPut(SMr,i,SMrw);  end;      SMSumup(SMr);  SMr.SerNr = NextSerNr("SMVc",SMr.TransDate,-1,false,"");    if RecordStore(SMr,true) then begin   end;  return;end;  globalupdating procedure CloseYMn(record RcVc RepSpec)begin  record SMVc Sim1;  row SMVc Srw1;  record SMVc Sim2;  row SMVc Srw2;  record ObjBalVc Param;  record AccVc Acnt;  Boolean Res,Bool;  val balc,bald;  val CBal,TBal;  Date CloseDate;  Integer rownr1,rownr2;  Bool = true;  TBal = 0;  if blank(RepSpec.f1) then begin     goto L99;  end;  if blank(RepSpec.d1) then begin     CloseDate = currentdate;  end else begin     CloseDate = RepSpec.d1;  end;            rownr1 = 0;     RecordNew(Sim1);  Sim1.TransDate = CloseDate;  Sim1.Comment = USetStr(8340);  Sim1.SerNr = NextSerNr("SMVc",Sim1.TransDate,-1,false,"");           rownr2 = 0;  RecordNew(Sim2);  Sim2.TransDate = CloseDate;  Sim2.Comment = USetStr(8341);  Acnt.AccNumber = "";  while (LoopMain(Acnt,1,Bool)) begin    Param.AccNumber = Acnt.AccNumber;    Param.Object    = "";    bald =  GetBalance(Param,"transdebit",CloseDate);    balc =  GetBalance(Param,"transcredit",CloseDate);    CBal = (-1 * balc) + bald;    if (CBal<>0) then begin      if ((Acnt.AccType ==3) or (Acnt.AccType ==4)) then begin  // Result accounts        Srw1.AccNumber = Acnt.AccNumber;        Srw1.Comment =  Acnt.Comment;        if (CBal<0) then begin          Srw1.DebVal =  -1 * CBal;          Srw1.CredVal = 0; // should be blank        end else begin          Srw1.CredVal = CBal;          Srw1.DebVal = 0; // should be blank        end;        if (RepSpec.flags[1]==1) then begin           Srw1.RowSimStat = 3;        end;          MatRowPut(Sim1,rownr1,Srw1);        rownr1 = rownr1 + 1;        TBal = TBal + CBal;      end;      if ((Acnt.AccType ==0) or (Acnt.AccType ==1) or (Acnt.AccType ==2)) then begin   // Equity        Srw2.AccNumber = Acnt.AccNumber;        Srw2.Comment =  Acnt.Comment;        if (CBal<>0) then begin          if (CBal<0) then begin            Srw2.DebVal = -1 * CBal;            Srw2.CredVal = 0; // should be blank          end else begin            Srw2.CredVal = CBal;            Srw2.DebVal = 0; // should be blank          end;        end;         if (RepSpec.flags[1]==1) then begin           Srw2.RowSimStat = 3;        end;        MatRowPut(Sim2,rownr2,Srw2);        rownr2 = rownr2 + 1;      end;    end;  end; // while      // Equal against Years profit account  Srw1.AccNumber = RepSpec.f1;  Srw2.AccNumber = RepSpec.f1;  Srw1.Comment = USetStr(8342) & " " & GetYear(CloseDate);  Srw2.Comment = USetStr(8342) & " " & GetYear(CloseDate);  if (TBal<0) then begin     Srw1.CredVal = -TBal;     Srw1.DebVal  =  Blankval;     Srw2.DebVal  = -TBal;     Srw2.CredVal =  Blankval;  end else begin     Srw1.DebVal  = TBal;     Srw1.CredVal = Blankval;     Srw2.CredVal = TBal;     Srw2.DebVal  = Blankval;     if (RepSpec.flags[1]==1) then begin        Srw1.RowSimStat = 3;     end;    end;  MatRowPut(Sim1,rownr1,Srw1);  if (RepSpec.flags[1]==1) then begin     Srw2.RowSimStat = 3;  end;  MatRowPut(Sim2,rownr2,Srw2);  if (Sim1.SerNr>0) then begin    SMSumup(Sim1);    Res = RecordStore(Sim1,true);    Sim2.SerNr = Sim1.SerNr + 1 ;    SMSumup(Sim2);    Res = RecordStore(Sim2,true);    if (RepSpec.flags[1]==1) and Res then begin       CreateSim3_ARG_POR(Sim2);    end;  end;L99:;  return;end;