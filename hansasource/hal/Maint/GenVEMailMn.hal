external procedure PasteJobInExcur(record JobVc,var record ExcursionVc,var Integer);
external function Boolean SetupMail(var record MailVc,String,Integer);


global
updating procedure GenVEMailMn(record RcVc RepSpec)
begin
  record ExcursionVc Excursion;
  Boolean Skip,TrHs;
  record MailVc Mailr;
  Integer Pasajeros;
  String 255 tstr;

  if not SetupMail(Mailr,RepSpec.f1,1) then begin
    goto LGenMailPlanProvMn;
  end;   
  AddToText("Excursiones Planificados: ",Mailr);
  AddToText(Chr(13) & Chr(10),Mailr);

  TrHs = true;
  Excursion.VECode = RepSpec.f1;
  Excursion.TransDate   = RepSpec.sStartDate;  
  while(LoopKey("VECode",Excursion,2,TrHs)) begin
    if  ((Excursion.VECode == RepSpec.f1) and (Excursion.TransDate <= RepSpec.sEndDate)) then begin

      Pasajeros = MatRowCnt(Excursion);
      tstr = Excursion.TransDate & " " & Excursion.StartTime & " : " & Excursion.EndTime;
      tstr = tstr & " " & Excursion.Comment;
      tstr = tstr & " con " & Pasajeros & ".";
      AddToText(tstr,Mailr);
      AddToText(Chr(13) & Chr(10),Mailr);
    end;
  end;
  if (RecordStore(Mailr,false)) then begin end;

LGenMailPlanProvMn:;  
  return;
end;
