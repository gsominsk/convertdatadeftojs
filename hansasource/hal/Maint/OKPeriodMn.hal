external procedure CheckFlush(var Integer,Integer);

// f1 code of person
// d1 start date
// d2 end date

global
updating procedure OkPeriodMn(Record RcVc RepSpec)
begin
  record ActVc actr;
  record ActVc actr2;
  string 60 ukey;
  Boolean foundf;
  Integer xres,flushcnt;
  
  foundf = true;
  
  actr.TransDate = RepSpec.d1;
  actr.TodoFlag = 0; // Calendar
  ukey = "UserMain:" & RepSpec.f1;

  while (LoopKey(ukey,actr,1,foundf)) begin
    //StopAlert("tdf " & actr.TodoFlag & " td " & actr.TransDate);

    if ((actr.TodoFlag<>0) or DateInRange(actr.TransDate,RepSpec.d1,RepSpec.d2)==false) then begin
      goto L99;
    end;

    RecordCopy(actr2,actr);
    
    if (actr2.OKFlag==0) then begin
      actr2.OKFlag = 1;
      xres = RecordUpdate(actr,actr2,true);
      CheckFlush(flushcnt,10);
    end;
L99:;
  end;
end;