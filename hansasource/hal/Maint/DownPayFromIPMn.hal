external updating procedure MakeDownPayFromOKedIPD(record IPVc,Integer,var array record IVVc,var string);

global
updating procedure DownPayFromIPMn(record RcVc RepSpec)
begin
  record IPVc IPr;
  Boolean found,TESTF;
  string 255 index;
  LongInt frip,toip;
  array record IVVc aIVr;
  string 255 errstr;
  
  frip = FirstInRange(RepSpec.f1,20);
  toip = LastInRange(RepSpec.f1,20);
  IPr.TransDate = RepSpec.sStartDate;
  index = "TransDate";
  if (nonblank(RepSpec.f1)) then begin
    index = "SerNr";
    IPr.SerNr = frip;
  end;
  found = true;
  while (LoopKey(index,IPr,1,found)) begin
    if (nonblank(RepSpec.f1)) then begin
      if (IPr.SerNr>toip) then begin found = false; end;
    end else begin
      if (DateInRange(IPr.TransDate,RepSpec.sStartDate,RepSpec.sEndDate)==false) then begin
        found = false;
      end;
    end;
    if (found) then begin
      testf = true;
      if (DateInRange(IPr.TransDate,RepSpec.sStartDate,RepSpec.sEndDate)==false) then begin
        testf = false;
      end;
      if (testf) then begin
        MakeDownPayFromOKedIPD(IPr,-1,aIVr,errstr);
      end;
    end;
  end;
  return;
end;