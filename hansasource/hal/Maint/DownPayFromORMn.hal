external updating function Integer RecordAction_raOrdDownPay(LongInt,val,val,var record IVVc,var string,integer);

global
updating procedure DownPayFromORMn(record RcVc RepSpec)
begin
  record ORVc ORr;
  Boolean found,testf;
  LongInt fror,toor;
  string 255 index,errstr;
  LongInt err;
  record IVVc IVr;
  
  fror = FirstInRange(RepSpec.f1,20);
  toor = LastInRange(RepSpec.f1,20);
  index = "OrdDate";
  if (nonblank(RepSpec.f1)) then begin
    index = "SerNr";
  end;
  found = true;
  while (LoopKey(index,ORr,1,found)) begin
    if (nonblank(RepSpec.f1)) then begin
      if (ORr.SerNr<fror or ORr.SerNr>toor) then begin
        found = false;
      end else begin
        if (DateInRange(ORr.OrdDate,RepSpec.sStartDate,RepSpec.sEndDate)==false) then begin
          found = false;
        end;
      end;
    end;
    if (found) then begin
      testf = true;
      if (ORr.Closed!=0) then begin
        testf = false;
      end;
      if (ORr.InvMark!=0) then begin
        testf = false;
      end;
      if (testf) then begin
        err = RecordAction_raOrdDownPay(ORr.SerNr,blankval,blankval,IVr,errstr,0);
      end;
    end;
  end;
  return;
end;