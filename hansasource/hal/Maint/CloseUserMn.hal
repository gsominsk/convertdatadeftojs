global
updating procedure DoCloseUserMn(record UserVc Userr,string compcode)
begin
  Boolean res;
  record UserVc oUserr;
  Integer curcomp;
  
  curcomp = CurrentCompany;
  if (SetCompanyCode(compcode,false)) then begin
    RecordCopy(oUserr,Userr);
    Userr.Closed = 1;
    RecordUpdate(oUserr,Userr,true);
  end;
  ResetCompany(curcomp);
  return;
end;

global
procedure CloseUserMn(record RcVc RepSpec)
begin
  Integer i,rwcnt;
  record CompaniesBlock Compb;
  row CompaniesBlock comprw;
  record GlobalUserVc GUserr;
  record UserVc Userr;
  Boolean found;

  BlockLoad(Compb);
  rwcnt = MatRowCnt(Compb);  
  found = true;
  while (LoopMain(GUserr,1,found)) begin
    if (found) then begin
      if (GUserr.Closed!=0) then begin
        for (i=0;i<rwcnt;i=i+1) begin
          MatRowGet(Compb,i,comprw);
          Userr.Code = GUserr.Code;
          if (ReadFirstMain(Userr,1,true)) then begin
            if (Userr.Closed==0) then begin
              qupdating.DoCloseUserMn(Userr,i);
            end;
          end;
        end;
      end;
    end;
  end;
  return;
end;