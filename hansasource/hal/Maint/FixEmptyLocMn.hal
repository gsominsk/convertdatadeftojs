global
updating procedure FixEmptyLocMn(record RcVc RepSpec)
begin
  record MainStockBlock MSb;
  record ItemHistVc IHr;
  record ItemHistVc oldIHr;
  record ItemStatusVc ISr;
  record ItemStatusVc oldISr;
  Boolean found;
  record PUVc PUr;
  record PUVc oldPUr;
  record SHVc SHr;
  record SHVc oldSHr;
  record SDVc SDr;
  record SDVc oldSDr;
  record SRVc SRr;
  record SRVc oldSRr;
  record WSVc WSr;
  record WSVc oldWSr;
  record IVVc IVr;
  record IVVc oldIVr;
  record INTransferVc INTransferr;
  record INTransferVc oldINTransferr;
  record ProdVc Prodr;
  record ProdVc oldProdr;
  record ProdOperationVc ProdOperationr;
  record ProdOperationVc oldProdOperationr;
  record RetPUVc RetPUr;
  record RetPUVc oldRetPUr;
  record RetVc Retr;
  record RetVc oldRetr;
  record StockMovVc StockMovr;
  record StockMovVc oldStockMovr;
  
  BlockLoad(MSb);
  if (blank(MSb.MainStock)) then begin
    MessageBox(1767,"");
    goto LFixEmptyLocMn;
  end;
  found = true;
  IHr.Location = "";
  while (LoopKey("SerNrPerLoc",IHr,1,found)) begin
    if (nonblank(IHr.Location)) then begin
      found = false;
    end;
    if (found) then begin
      RecordCopy(oldIHr,IHr);
      IHr.Location = MSb.MainStock;
      RecordUpdate(oldIHr,IHr,false);
      switch (IHr.FileName) begin
        case "PUVc":
          PUr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(PUr,1,true)) then begin
            RecordCopy(oldPUr,PUr);
            PUr.Location = MSb.MainStock;
            RecordUpdate(oldPUr,PUr,false);            
          end;
        case "SHVc":
          SHr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(SHr,1,true)) then begin
            RecordCopy(oldSHr,SHr);
            SHr.Location = MSb.MainStock;
            RecordUpdate(oldSHr,SHr,false);            
          end;
        case "SDVc":
          SDr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(SDr,1,true)) then begin
            RecordCopy(oldSDr,SDr);
            SDr.Location = MSb.MainStock;
            RecordUpdate(oldSDr,SDr,false);            
          end;
        case "SRVc":
          SRr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(SRr,1,true)) then begin
            RecordCopy(oldSRr,SRr);
            SRr.Location = MSb.MainStock;
            RecordUpdate(oldSRr,SRr,false);            
          end;
        case "IVVc":
          IVr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(IVr,1,true)) then begin
            RecordCopy(oldIVr,IVr);
            IVr.Location = MSb.MainStock;
            RecordUpdate(oldIVr,IVr,false);            
          end;
        case "INTransferVc":
          INTransferr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(INTransferr,1,true)) then begin
            RecordCopy(oldINTransferr,INTransferr);
            INTransferr.Location = MSb.MainStock;
            RecordUpdate(oldINTransferr,INTransferr,false);            
          end;
        case "ProdVc":
          Prodr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(Prodr,1,true)) then begin
            RecordCopy(oldProdr,Prodr);
            Prodr.Location = MSb.MainStock;
            RecordUpdate(oldProdr,Prodr,false);            
          end;
        case "ProdOperationVc":
          ProdOperationr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(ProdOperationr,1,true)) then begin
            RecordCopy(oldProdOperationr,ProdOperationr);
            ProdOperationr.Location = MSb.MainStock;
            RecordUpdate(oldProdOperationr,ProdOperationr,false);            
          end;
        case "RetPUVc":
          RetPUr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(RetPUr,1,true)) then begin
            RecordCopy(oldRetPUr,RetPUr);
            RetPUr.Location = MSb.MainStock;
            RecordUpdate(oldRetPUr,RetPUr,false);            
          end;
        case "RetVc":
          Retr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(Retr,1,true)) then begin
            RecordCopy(oldRetr,Retr);
            Retr.Location = MSb.MainStock;
            RecordUpdate(oldRetr,Retr,false);            
          end;
        case "WSVc":
          WSr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(WSr,1,true)) then begin
            RecordCopy(oldWSr,WSr);
            WSr.Location = MSb.MainStock;
            RecordUpdate(oldWSr,WSr,false);            
          end;
/*          
        case "StockMovVc":
          StockMovr.SerNr = IHr.TransNr;
          if (ReadFIrstMain(StockMovr,1,true)) then begin
            RecordCopy(oldStockMovr,StockMovr);
            StockMovr.Location = MSb.MainStock;
            RecordUpdate(oldStockMovr,StockMovr,false);            
          end;
*/          
      end;
      StepBack(IHr);
    end;
  end;
  found = true;
  ISr.Location = "";
  while (LoopKey("Location",ISr,1,found)) begin
    if (nonblank(ISr.Location)) then begin
      found = false;
    end;
    if (found) then begin
      RecordCopy(oldISr,ISr);
      ISr.Location = MSb.MainStock;
      RecordUpdate(oldISr,ISr,false);
    end;
  end;
LFixEmptyLocMn:;  
  return;
end;