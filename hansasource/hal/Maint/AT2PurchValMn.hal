external procedure CheckFlush(var Integer,Integer);

global
updating procedure AT2PurchValMn(record RcVc RepSpec)
BEGIN
  record AT2UnitVc AT2Unit;
  record AT2UnitVc oldAT2Unit;
  Boolean TrHs;
  string 30 frat,toat;
  Integer cnt;
  
  frat = FirstInRange(RepSpec.f1,30);
  toat = LastInRange(RepSpec.f1,30);
  TrHs = true;
  AT2Unit.InventoryNr = frat;
  while (LoopMain(AT2Unit,1,TrHs)) begin
    if (nonblank(RepSpec.f1)) then begin
      if (AT2Unit.InventoryNr>toat) then begin TrHs = false; end;
    end;
    if (TrHs) then begin
      if (AT2Unit.Quantity!=0) then begin
        RecordCopy(oldAT2Unit,AT2Unit);
        AT2Unit.PurchVal = AT2Unit.PurchVal/AT2Unit.Quantity;
        if (RecordUpdate(oldAT2Unit,AT2Unit,false)==0) then begin end;
        CheckFlush(cnt,10);
      end;
    end;
  end;
  RETURN;
END;