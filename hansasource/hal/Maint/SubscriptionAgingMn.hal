
global
updating procedure SubscriptionAgingMn(record RcVc RepSpec)
begin
  record SubscriptionVc Subr;
  record SubscriptionVc oldSubr;
  Boolean found,testf;

  found = true;
  while (LoopKey("ActCUCode",Subr,1,found)) begin
    if (found) then begin
      testf = true;
      if (nonblankdate(Subr.PaidUntilDate)) then begin 
        if (Subr.PaidUntilDate<CurrentDate) then begin testf = false; end;
      end;
      if (nonblankdate(Subr.EndDate)) then begin 
        if (Subr.EndDate<=CurrentDate) then begin testf = false; end;
      end;
      if (Subr.Closed!=0) then begin testf = false; end;
      if (testf) then begin
        RecordCopy(oldSubr,Subr);
        Subr.PaidUntilDate = AddDay(CurrentDate,-1);
        RecordUpdate(oldSubr,Subr,false);
      end;
    end;
  end;
  return;
end;