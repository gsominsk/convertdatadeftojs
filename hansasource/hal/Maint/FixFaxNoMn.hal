// Done for 4.0, 2002-07-01, Bjšrn Schwab
// Very wierd code, no from to, all customers are updated, even if not needed etc.

external procedure RemoveCharactersFromString(var string,string);
external procedure CheckFlush(var Integer,Integer);


procedure RemoveFaxNo(var string faxno,string remove,var string faxnonew)
begin
  
  Integer pos,oldpos;
  string 200 ostr,oldostr,res;
  string 20 tstr;
  if (left(faxno,len(remove)) == remove) then begin
    faxno = mid(faxno,len(remove),len(faxno));
  end;
  faxnonew = faxno;
  RemoveCharactersFromString(faxnonew," "); 
  RemoveCharactersFromString(faxnonew,"-");
  RETURN;
END;

updating procedure ChangeOnCustomers(record RcVc RepSpec)
begin
  record CUVc CUr;
  boolean TrHs,res,testf;
  string 255 remove;
  string 20 faxnonew,faxnoold;
  integer cnt,max;
  
  TrHs = true;
  max = 25;
  while (LoopMain(CUr,1,TrHs)) begin
    if (TrHs) then begin
      if (nonblank(CUr.Fax)) then begin
        remove = RepSpec.f1;
        faxnoold = CUr.Fax;
        RemoveFaxNo(faxnoold,remove,faxnonew);
        CUr.Fax = faxnonew;
        MaintTrace(CUr.Code); 
        res = RecordStore(CUr,true);
        CheckFlush(cnt,max)  
      end;
    end;
  end;
  return;
end;

global
updating procedure FixFaxNoMn(record RcVc RepSpec)
begin
  
  ChangeOnCustomers(RepSpec);
  return;
 end;
