external function Time TimeDiff(Time,Time);

global
procedure HouseStatRn(record RcVc RepSpec)
begin
  Integer nro;
  Record ActVc ActReg;
  Row ActVc ActRow;
  Date Pend,Pstart;
  Integer p1,p2,p3,p4,p5,p6,p6a,p7,p8,p9,p0;
  Val Total; 
  Val tiempo;
  Boolean Skip;
  String 20 res;

// Positions
  p1= 0;
  p2= 65;
  p4= 150;
  p5= 230;
  p7= 230;
  p8= 380;
  p9= 420;
  p0= 480;

Pend = RepSpec.sStartDate;
Pstart = RepSpec.sEndDate;

// Header
  nro = 0;
  StartReportJob(USetStr(10290));
  EndHeader;

  StartFormat(15);
  OutString(p1,0,USetStr(10291),false);
  OutString(p2,0,USetStr(10292),false);
  OutString(p4,0,USetStr(10293),false);
  OutString(p5,0,USetStr(10294),false);
  EndFormat;
  Gray_Divider(0,1);
 
  while (LoopMain(ActReg,1,true)) begin 
          
      if (blank(ActReg.StartTime) or blank(ActReg.EndTime)) then begin 
		  Skip = true; 
	  end;  
        // if ((RepSpec.f1<> and RepSpec.f2<>ActReg.MainPersons) then begin
      Skip = false;
      If ((ActReg.TransDate > RepSpec.sEndDate) or (ActReg.TransDate < RepSpec.sStartDate)) then begin
          Skip = true;
      end;
      if ((RepSpec.f1 <> ActReg.ActType) and (not Blank(RepSpec.f1))) then begin
        Skip = true;
      end;
      if ((RepSpec.f2 <> ActReg.MainPersons) and (not Blank(RepSpec.f2))) then begin
        Skip = true;
      end;
      if (not Skip) then begin
          StartFormat(15);
          OutString(p1,0,ActReg.MainPersons,false);
          OutDate(p2,0,ActReg.TransDate,false);
          OutString(p4,0,tiempo,false);
          OutString(p5,0,ActReg.Resources,false);
          nro = nro + 1;
          tiempo = TimeToVal(TimeDiff(ActReg.StartTime,ActReg.EndTime));
          Total  = Total + tiempo; 
          EndFormat;
      end; 
  end;

// Footer

  Gray_Divider(0,1);
  StartFormat(15);
  OutString(p1,0,USetStr(10295),false);
  res = (Total/nro);
  OutVal(p4,0,Total,M4Val,false);  
  StartFormat(15);
  EndFormat;
  EndFormat;
  OutString(p1,0,USetStr(10296) & " " & nro & " " & USetStr(10297) & ": " & res,false);
  EndFormat;

  EndJob;
  return;
end;
