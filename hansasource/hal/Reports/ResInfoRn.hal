external function Boolean FindStringInString(string,string);
external procedure HTRess(string,string,var string);

procedure PrintDetailedResInfo(record ResVc Resr)
BEGIN
  record CUVc ContactCUr;
  record MailSettingsBlock MBr;

  BlockLoad(MBr);
  StartFormat(15);
  OutString(0,0,Resr.Code,false);
  OutString(70,0,Resr.Name,false);
  OutString(250,0,Resr.Number,false);
  OutString(330,0,Resr.Spec,false);
//  OutDate(370,0,Resr.DateCreation,false);
//  OutDate(440,0,Resr.DateChanged,false);
  EndFormat;     
  ContactCUr.Name = Resr.Contact;
  if (ReadFirstKey("Name",ContactCUr,1,true)) then begin
    StartFormat(15);
    OutString(0,0,ContactCUr.Name,false);
    OutString(100,0,ContactCUr.Phone,false);
    OutString(180,0,ContactCUr.Fax,false);
    OutString(260,0,ContactCUr.Mobile,false);
    if (blank(ContactCUr.eMail)) then begin
      OutString(340,0,USetStr(2289),false);
    end else begin
      if (MBr.ExclEmail==0) then begin
        OutString(340,0,ContactCUr.eMail,false);
      end;
    end;
    OutString(440,0,ContactCUr.JobDesc,false);
    EndFormat;     
    StartFormat(15);
    OutString(0,0,ContactCUr.InvAddr0,false);
    OutString(300,0,ContactCUr.Title,false);
    EndFormat;     
    StartFormat(15);
    OutString(0,0,ContactCUr.InvAddr1,false);
    OutString(300,0,ContactCUr.Classification,false);
    EndFormat;
    if (nonblank(ContactCUr.InvAddr2)) then begin   
      StartFormat(15);
      OutString(0,0,ContactCUr.InvAddr2,false);
      EndFormat;     
    end;  
  end;  
  RETURN;
END;

global
procedure ResInfoRn(record RcVc RepSpec)
BEGIN
  record ResVc Resr;
  Boolean found,testf;
  LongInt rescnt;
  Integer rw;
  string 255 frres,tores,tstr;

  rescnt = 0;
  rw = 1;
  frres = FirstInRange(RepSpec.f1,5);
  tores = LastInRange(RepSpec.f1,5);
  StartReportJob(USetStr(8215));
   HTRess(frres,tores,tstr);
   Header(rw,tstr,1);
  EndHeader;
  if (RepSpec.ArtMode==0) then begin
    StartFormat(15);
/*
     OutString(0,0,USetStr(8216),false);
     OutString(100,0,USetStr(8217),false);
     OutString(250,0,USetStr(8218),false);
     OutString(330,0,USetStr(8219),false);
*/
    OutString(0,0,USetStr(8246),false);  
    OutString(50,0,USetStr(8247),false);    
    OutString(170,0,USetStr(8248),false);    
    OutString(280,0,USetStr(8249),false); 
    OutString(350,0,USetStr(8250),false); 
    OutString(430,0,USetStr(8251),false); 
    EndFormat;
  end;
  if (RepSpec.ArtMode==1) then begin
    StartFormat(15);
     OutString(0,0,USetStr(8216),false);
     OutString(70,0,USetStr(8217),false);
     OutString(250,0,USetStr(8218),false);
     OutString(330,0,USetStr(8219),false);
     OutString(370,0,USetStr(8220),false);
     OutString(440,0,USetStr(8221),false);
    EndFormat;
  end;  
  Gray_Divider(0,1);
  Resr.Code = frres;
  found = true;
  while (LoopMain(Resr,1,found)) begin
    testf = true;
    if (nonblank(tores)) then begin
      if (Resr.Code>tores) then begin found = false; end;
    end;  
    if (nonblank(RepSpec.f2)) then begin
      if (FindStringInString(Resr.Name,RepSpec.f2)==false) then begin testf = false; end;
    end;  
    if (nonblank(RepSpec.ObjStr)) then begin
      if (SetInSet(RepSpec.ObjStr,Resr.Class)==false) then begin 
        testf = false;
     end;
    end;
    if (Resr.Terminated<>0) then begin testf = false; end;
    if (found==false) then begin testf = false; end;
    if (testf) then begin
      if (RepSpec.ArtMode==0) then begin
         StartFormat(15);
         OutString(0,0,Resr.Code,false);
         OutString(50,0,Resr.Name,false);
         OutString(170,0,Resr.Contact,false);     
         OutString(280,0,Resr.Number,false);  
//         OutString(330,0,Resr.Spec,false);
         OutString(350,0,Resr.Class,false);  
         OutString(430,0,Resr.AreaCode,false);  
         EndFormat;               
      end;
      if (RepSpec.ArtMode==1) then begin
        PrintDetailedResInfo(Resr);
        Gray_Divider(0,200);
      end;
    end;
  end;    
  EndJob;
  RETURN;
END;
