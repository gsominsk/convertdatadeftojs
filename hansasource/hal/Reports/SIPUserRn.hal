external function Boolean IsEnterprise();
external procedure HTPersons(string,string,var string);

global
procedure SIPUserRn(record RcVc RepSpec)
begin
  record UserVc Userr;
  record GlobalUserVc GlobalUserr;
  record CUVc CUr;
  string 10 fruser,touser;
  Boolean TrHs,testf;
  Integer usercnt,leftrw,rightrw,globalusercnt;
  string 255 tstr;
  array integer a_col;
  string 255 custcode,sipext,DblCUVcstr;

  fruser = FirstInRange(RepSpec.f1,10);
  touser = LastInRange(RepSpec.f1,10);
  a_col[0] = 0;
  a_col[1] = 40;
  a_col[2] = 150;
  a_col[3] = 305;
  a_col[4] = 350;
  rightrw = 1;
  leftrw = 2;

  StartReportJob(USetStr(38350));
  if (RepSpec.flags[1]==0) then begin tstr = USetStr(14575); end;
  if (RepSpec.flags[1]==1) then begin tstr = USetStr(16183); end;
  if (RepSpec.flags[1]==2) then begin tstr = USetStr(16181); end;
  HTPersons(fruser,touser,tstr);
  Header(rightrw,tstr,1);
  if (RepSpec.flags[2]==0) then begin
    Header(leftrw,USetStr(38353),0);
    leftrw = leftrw + 1;
  end;
  switch (RepSpec.flags[3]) begin
    case 0: tstr = USetStr(38355);
    case 1: tstr = USetStr(38356);
    case 2: tstr = "";
  end;
  if (nonblank(tstr)) then begin
    Header(rightrw,tstr,1);
  end;
  EndHeader;

  StartFormat(15);
  OutString(a_col[0],0,USetStr(8901),false);
  OutString(a_col[1],0,USetStr(8902),false);
  OutString(a_col[2],0,USetStr(34591),false);
  OutString(a_col[3],0,USetStr(38351),false);
  EndFormat;
  Gray_Divider(0,1);

  TrHs = true;
  Userr.Code = fruser;
  while (LoopMain(Userr,1,TrHs)) begin
    testf = true;
    custcode = "";
    sipext = "";
    if (nonblank(touser)) then begin
      if (Userr.Code>touser) then begin
        TrHs = false;
        testf = false;
      end;
    end;
    if (testf) then begin
      if (nonblank(Userr.CustCode)) then begin
        CUr.Code = Userr.CustCode;
        if (ReadFirstMain(CUr,1,true)) then begin
          custcode = CUr.Code;
          sipext = CUr.SIPCode;
          DblCUVcstr = "DblCUVc";
        end else begin
          custcode = USetStr(38352) & ": " & Userr.CustCode;
          DblCUVcstr = "";
        end;
      end;
    end;
    if (testf) then begin
      switch (RepSpec.flags[3]) begin
        case 0: testf = nonblank(sipext);
        case 1: testf = blank(sipext);
      end;
    end;
    if (testf) then begin
      if (RepSpec.flags[1]==1) then begin
        if (Userr.TypeOfUser!=kTypeOfUserConcurrent) then begin
          testf = false;
        end;
      end;
    end;
    if (testf) then begin
      if (RepSpec.flags[1]==2) then begin
        if (Userr.TypeOfUser!=kTypeOfUserNamed) then begin
          testf = false;
        end;
      end;
    end;
    if (testf) then begin
       if (RepSpec.flags[2]==0) then begin
        if (Userr.Closed!=0) then begin
          testf = false;
        end;
      end;
    end;
    if (testf) then begin
      usercnt = usercnt + 1;
      StartFormat(15);
      OutString(a_col[0],0,Userr.Code,false);
      OutString(a_col[1],0,Userr.Name,false);
      OutString(a_col[2],DblCUVcstr,custcode,false);
      OutString(a_col[3],0,sipext,false);
      EndFormat;
    end;
  end;
  Gray_Divider(0,1);
  StartFormat(15);
  EndFormat; 
  
  //Global Users
  StartFormat(15);
  OutString(a_col[0],0,USetStr(38357),false);
  EndFormat;  
  Gray_Divider(0,1);

  TrHs = true;
  GlobalUserr.Code = fruser;
  while (LoopMain(GlobalUserr,1,TrHs)) begin
    testf = true;
    custcode = "";
    sipext = "";
    if (nonblank(touser)) then begin
      if (GlobalUserr.Code>touser) then begin
        TrHs = false;
        testf = false;
      end;
    end;
    if (testf) then begin
      if (nonblank(GlobalUserr.CustCode)) then begin
        CUr.Code = GlobalUserr.CustCode;
        if (ReadFirstMain(CUr,1,true)) then begin
          custcode = CUr.Code;
          sipext = CUr.SIPCode;
          DblCUVcstr = "DblCUVc";
        end else begin
          custcode = USetStr(38352) & ": " & GlobalUserr.CustCode;
          DblCUVcstr = "";
        end;
      end;
    end;
    if (testf) then begin
      switch (RepSpec.flags[3]) begin
        case 0: testf = nonblank(sipext);
        case 1: testf = blank(sipext);
      end;
    end;
    if (testf) then begin
      if (RepSpec.flags[1]==1) then begin
        if (GlobalUserr.TypeOfUser!=kTypeOfUserConcurrent) then begin
          testf = false;
        end;
      end;
    end;
    if (testf) then begin
      if (RepSpec.flags[1]==2) then begin
        if (GlobalUserr.TypeOfUser!=kTypeOfUserNamed) then begin
          testf = false;
        end;
      end;
    end;
    if (testf) then begin
       if (RepSpec.flags[2]==0) then begin
        if (GlobalUserr.Closed!=0) then begin
          testf = false;
        end;
      end;
    end;
    if (testf) then begin
      globalusercnt = globalusercnt + 1;
      StartFormat(15);
      OutString(a_col[0],0,GlobalUserr.Code,false);
      OutString(a_col[1],0,GlobalUserr.Name,false);
      OutString(a_col[2],DblCUVcstr,custcode,false);
      OutString(a_col[3],0,sipext,false);
      EndFormat;
    end;
  end;

  Gray_Divider(0,1);
  StartFormat(15);
  EndFormat;
  Black_Divider(a_col[4],1);
  StartFormat(15);
  OutString(a_col[4],0,USetStr(38354) & " " ,false);
  OutString(1,0,usercnt,true);
  EndFormat;
  StartFormat(15);
  OutString(a_col[4],0,USetStr(38358) & " " ,false);
  OutString(1,0,globalusercnt,true);
  EndFormat;

  EndJob;
  return;
end;
