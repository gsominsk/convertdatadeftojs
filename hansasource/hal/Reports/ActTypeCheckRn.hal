procedure CombineArrays(array string acttypes,Integer cnt,var array string usersort,var Integer sortcnt)
begin
  Integer i,j;
  Boolean usrfndf;

  for (i=0;i<cnt;i=i+1) begin
    usrfndf = false;
    for (j=0;j<sortcnt;j=j+1) begin
      if (acttypes[i]==usersort[j]) then begin
        usrfndf = true;
      end;
    end;
    if (usrfndf==false) then begin
      usersort[sortcnt] = acttypes[i];
      sortcnt = sortcnt + 1;
    end;
  end;
  return;
end;

procedure PrintAllActTypes(record CompaniesBlock CompaniesRec,array string acttypes,array string actclasses,array Boolean usedf,array string company,Integer cnt)
begin
  row CompaniesBlock comprw;
  Integer i,j,k,rwcnt,sortcnt;
  array string 5 usersort;
  Boolean firstf;

  StartFormat(15);
  OutString(0,0,USetStr(13238),false);
  EndFormat;
  Black_Divider(0,1);
  StartFormat(15);
  OutString(0,0,USetStr(13201),false);
  OutString(2,0,USetStr(13202),false);
  OutString(3,0,USetStr(30251),false);
  OutString(1,0,USetStr(30252),true);
  EndFormat;
  Gray_Divider(0,1);
  rwcnt = MatRowCnt(CompaniesRec);
  CombineArrays(acttypes,cnt,usersort,sortcnt);
  for (i=0;i<sortcnt;i=i+1) begin
    firstf = true;
    for (j=0;j<cnt;j=j+1) begin
      if (usersort[i]==acttypes[j]) then begin
//        if (firstf) then begin
          StartFormat(15)
          OutString(0,0,acttypes[j],false);
          OutString(2,0,actclasses[j],false);
          OutString(3,0,company[j],false);
          for (k=0;k<rwcnt;k=k+1) begin
            MatRowGet(CompaniesRec,k,comprw);
            if (comprw.CompCode==company[j]) then begin
//              OutString(3,0,comprw.CompCode,false);
              OutString(4,0,comprw.CompName,false);
              OutString(5,0,comprw.ShortName,false);
            end;
          end;
          if (usedf[j]==false) then begin
            OutString(1,0,USetStr(30253),true);
          end else begin
            OutString(1,0,USetStr(30254),true);
          end;
          EndFormat;
          firstf = false;
//        end;
      end;
    end;
  end;
  return;
end;

global
procedure ActTypeCheckRn(record RcVc RepSpec)
begin
  record ActTypeVc ActTyper;
  record ActVc Actr;
  Boolean foundf,testf;
  Integer i,rwcnt;
  Integer compnr,oldcomp;
  Array string 5 acttypecode;
  Array string 5 acttypeclass;
  Array Boolean usedf;
  Array string 5  company;
  Integer cnt;
  record CompaniesBlock CompaniesRec;
  row CompaniesBlock comprw;
  LongInt comps;

  StartReportJob(USetStr(30250));
  EndHeader;
  SetRepCol(2,80);
  SetRepCol(3,220);
  SetRepCol(4,260);
  SetRepCol(5,360);
// To create the Array of information
  cnt = 0;
  oldcomp = CurrentCompany;
  BlockLoad(CompaniesRec);
  rwcnt = MatRowCnt(CompaniesRec);
  for (i=0;i<rwcnt;i=i+1) begin
    MatRowGet(CompaniesRec,i,comprw);
    if (SetCompany(i+1,false)) then begin
      ResetLoop(ActTyper);
      ActTyper.Code = "";
      foundf = true;
      while (LoopMain(ActTyper,1,foundf)) begin
        testf = true;
        if (testf) then begin
          acttypecode[cnt] = ActTyper.Code;
          acttypeclass[cnt] = ActTyper.ActTypeGr;
          company[cnt] = comprw.CompCode;
          Actr.ActType = ActTyper.Code;
          usedf[cnt] = ReadFirstKey("ActType",Actr,1,true);
          cnt = cnt + 1;
        end;
      end;
    end;
  end;
  ResetCompany(oldcomp);
  PrintAllActTypes(CompaniesRec,acttypecode,acttypeclass,usedf,company,cnt);
  EndJob;
  return;
end;
