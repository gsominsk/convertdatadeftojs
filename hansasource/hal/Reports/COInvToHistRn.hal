
procedure InvToPrintContractOverview(record COVc COr)
BEGIN 
  StartFormat(15);
   OutStringID(60,"DblCOVc",COr.SerNr,false,COr.ChildSerNr);
   OutLongInt(90,0,COr.ChildSerNr,false);
   OutString(140,"DblCUVc",COr.CustCode,false);
   OutString(220,"DblCUVc",COr.Addr0,false);
   OutDate(480,0,COr.CancelDate,true);
  EndFormat;
  RETURN;
END;

procedure CUInvToLabel(Integer pos,string tstr)
BEGIN 
  StartFormat(15);
   OutString(pos,0,tstr,false);
  EndFormat;   
  RETURN;
END;

procedure InvToPrintContractDetail(record COVc COr)
BEGIN 
  Boolean printdeladdlab;

  printdeladdlab = true;
  StartFormat(15);
   OutStringID(60,"DblCOVc",COr.SerNr,false,COr.ChildSerNr);
   OutLongInt(90,0,COr.ChildSerNr,false);
   OutString(140,"DblCUVc",COr.CustCode,false);
   OutString(220,0,COr.Addr0,false);
   OutDate(480,0,COr.CancelDate,true);
  EndFormat;
  if (nonblank(COr.ShipAddr0)) then begin 
    if (printdeladdlab)  then begin
      CUInvToLabel(90,USetStr(9627));
      printdeladdlab = false;
    end;
    StartFormat(15);
     OutString(110,0,COr.ShipAddr0,false);
    EndFormat;
  end;  
  if (nonblank(COr.ShipAddr1)) then begin 
    if (printdeladdlab)  then begin
      CUInvToLabel(90,USetStr(9627));
      printdeladdlab = false;
    end;
    StartFormat(15);
     OutString(110,0,COr.ShipAddr1,false);
    EndFormat;
  end;  
  if (nonblank(COr.ShipAddr2)) then begin 
    if (printdeladdlab)  then begin
      CUInvToLabel(90,USetStr(9627));
      printdeladdlab = false;
    end;
    StartFormat(15);
     OutString(110,0,COr.ShipAddr2,false);
    EndFormat;
  end;  
  if (nonblank(COr.ShipAddr3)) then begin 
    if (printdeladdlab)  then begin
      CUInvToLabel(90,USetStr(9627));
      printdeladdlab = false;
    end;
    StartFormat(15);
     OutString(110,0,COr.ShipAddr3,false);
    EndFormat;
  end;  
  if (printdeladdlab==false) then begin Gray_Divider(60,1); end;
  RETURN;
END;

procedure COInvToPrintInvoiceToCustomer(record RcVc RepSpec,string CustCode)
BEGIN
  record CUVc CUr;

  CUr.Code = CustCode;
  if (ReadFirstMain(CUr,1,true)) then begin
    StartFormat(15);
     OutString(0,"DblCUVc",CUr.Code,false);
     OutString(60,0,CUr.Name,false);
    EndFormat;    
    if (RepSpec.ArtMode==1) then begin
      if (nonblank(CUr.InvAddr0)) then begin
        StartFormat(15);
         OutString(60,0,CUr.InvAddr0,false);
        EndFormat;
      end;  
      if (nonblank(CUr.InvAddr1)) then begin
        StartFormat(15);
         OutString(60,0,CUr.InvAddr1,false);
        EndFormat;
      end;  
      if (nonblank(CUr.InvAddr2)) then begin  
        StartFormat(15);
         OutString(60,0,CUr.InvAddr2,false);
        EndFormat;
      end;   
    end;         
  end;
  RETURN;
END;

    
global
procedure COInvToHistRn(record RcVc RepSpec)
BEGIN
  record COVc COr;
  Boolean TrHs,printcustf,printivf,testf;
  val paid;
  LongInt frco,toco,lastconr;
  string 20 frinto,tointo,lastinvto;
  
  StartReportJob(USetStr(9625));
  EndHeader;
  frco = FirstInRange(RepSpec.f1,10);
  toco = LastInRange(RepSpec.f1,10);
  frinto = FirstInRange(RepSpec.f2,20);
  tointo = LastInRange(RepSpec.f2,20);
  if (RepSpec.ArtMode==0) then begin
    StartFormat(15);
     OutString(0,0,USetStr(9606),false);
     OutString(60,0,USetStr(9602),false);
     OutString(90,0,USetStr(9626),false);
     OutString(140,0,USetStr(9601),false);
     OutString(220,0,USetStr(9608),false);
     OutString(480,0,USetStr(9609),true);
    EndFormat;     
  end;
  if (RepSpec.ArtMode==1) then begin
    StartFormat(15);
     OutString(0,0,USetStr(9606),false);
     OutString(60,0,USetStr(9602),false);
     OutString(90,0,USetStr(9626),false);
     OutString(140,0,USetStr(9608),false);
     OutString(480,0,USetStr(9609),true);
    EndFormat;     
  end;
  Gray_Divider(0,1);    

  COr.InvoiceToCode = frinto;
  TrHs = true;
  while (LoopKey("InvoiceToCode",COr,1,TrHs)) begin
    testf = true;
    if (nonblank(tointo)) then begin
      if (COr.InvoiceToCode>tointo) then begin TrHs = false; end;
    end; 
    if (blank(COr.InvoiceToCode)) then begin testf = false; end; 
    if (DateInRange(COr.startDate,RepSpec.sStartDate,RepSpec.sEndDate)==false) then begin testf = false; end;    
    if (TrHs and testf) then begin 
      if (lastinvto!=COr.InvoiceToCode) then begin   
        if (nonblank(lastinvto)) then begin
          Gray_Divider(0,1);
        end;
        COInvToPrintInvoiceToCustomer(RepSpec,COr.InvoiceToCode);
      end;  
      lastinvto = COr.InvoiceToCode;
      if (RepSpec.ArtMode==0) then begin
        InvToPrintContractOverview(COr);
      end;  
      if (RepSpec.ArtMode==1) then begin
        InvToPrintContractDetail(COr);
      end;        
    end;
  end;
  EndJob;
  RETURN;
END;
