procedure SimFormat(record SMVc SMr)
BEGIN
  record AccVc Accr;
  record CYBlock CompYear;
  row SMVc SMrw;
  Boolean Accs;
  string 255 temp;
  Integer i,rwcnt,pbc;
  
  BlockLoad(CompYear);
  rwcnt = MatRowCnt(SMr);
  StartFormat(15);
  EndFormat;
  StartFormat(15);
  OutString(0,0,CompYear.CompName,false);
  OutString(350,0,USetStr(3083),true);
  OutLongInt(1,0,SMr.SerNr,true);
  EndFormat;
  StartFormat(15);
  OutString(0,0,USetStr(3042),false);
  OutString(60,0,SMr.Comment,false);
  OutString(350,0,USetStr(3045),true);
  OutDate(1,0,SMr.TransDate,true);
  EndFormat;
  StartFormat(15);
  OutString(0,0,USetStr(3044),false);
  OutString(60,0,SMr.Sign,false);
  OutString(350,0,USetStr(3057),true);
  OutString(1,0,SMr.RefStr,true);
  EndFormat;
  StartFormat(15);
  EndFormat;
  StartFormat(15);
  OutString(20,0,USetStr(3046),false);
  OutString(60,0,USetStr(3047),false);
  OutString(160,0,USetStr(3048),false);
  OutString(380,0,USetStr(3049),true);
  OutString(1,0,USetStr(3050),true);
  EndFormat;
  StartFormat(2);
  EndFormat;
  for (i=0;i<rwcnt;i=i+1) begin
    MatRowGet(SMr,i,SMrw);
    pbc = pbc + 1;
    if (pbc>30) then begin
      pbc = 0;
      NewPage(false);
      StartFormat(60);
      EndFormat;
    end;
    Accr.AccNumber = SMrw.AccNumber;
    Accs = ReadFirstMain(Accr,1,true);
    StartFormat(15);
    temp = "";
    if (nonblank(SMrw.Comment)) then begin
      temp = SMrw.Comment;
    end else begin
      if (Accs) then begin
        temp = Accr.Comment;
      end;  
    end;    
    OutString(20,0,SMrw.AccNumber,false);
    OutString(60,0,SMrw.Objects,false);
    OutString(160,0,temp,false);
    OutVal(380,0,SMrw.DebVal,M4Val,true);
    OutVal(1,0,SMrw.CredVal,M4Val,true);
    EndFormat;
  end; 
  Black_Divider(300,480);
  StartFormat(15);
  OutVal(380,0,SMr.DSum,M4DVal,true);
  OutVal(465,0,SMr.CSum,M4CVal,true);
  EndFormat;
  RETURN;
END;

global
procedure Sim2Rn(record RcVc RepSpec)
BEGIN
  Boolean TrHs,testf;
  record SMVc SMr;
  LongInt afr,ato;

  StartReportJob(""); 
  EndHeader;
/*  
  if ((RepSpec.Media!=1)) then begin
    StartFormat(0);
     OutString(0,0,USetStr(1048),false);
    EndFormat;
    goto L99;
  end;
*/
  afr = FirstInRange(RepSpec.f1,10);
  ato = LastInRange(RepSpec.f1,10);
//  if (RepSpec.Media==1) then begin
    TrHs = true;
    SMr.SerNr = afr;
    while (LoopMain(SMr,1,TrHs)) begin
      if (TrHs) then begin
        if (ato!=-1) then begin
          if (SMr.SerNr>ato) then begin TrHs = false; end;
        end;
      end;
      if (TrHs) then begin
        testf = true;
        if (testf) then begin
          SimFormat(SMr);
          NewPage(false);
        end;
      end;
    end;
//  end;
L99:;
  EndJob;
  RETURN;
END;
