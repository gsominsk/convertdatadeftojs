external procedure HTPositions(string, string, var string);
external procedure PrintItemsAtPosition(string,string,string,string,var val,Boolean,Integer,string);


global
procedure PositionErrRn(record RcVc RepSpec)
BEGIN
  Boolean TrHs,testf;
  record PosVc Posr;
  string 20 frpos,topos,ckey;
  Integer keys;
  Integer rw;
  string 255 tstr;
  val qty;
  
  frpos = FirstInRange(RepSpec.f1,20);
  topos = LastInRange(RepSpec.f1,20);
  StartReportJob(USetStr(14130));  
    HTPositions(frpos,topos,tstr);
    Header(rw,tstr,1);
    rw = rw + 1;
  EndHeader;
  StartFormat(15);
   OutString(0,0,USetStr(14131),false);
   OutString(90,0,USetStr(14132),false);
   OutString(180,0,USetStr(14133),false);
   OutString(400,0,USetStr(14134),false);
  EndFormat;
  ckey = "Status";
  keys = 1;
  Posr.Status = 3;
  if (nonblank(RepSpec.f2)) and (nonblank(RepSpec.f3)) then begin
    ckey = "LocAreaStatus";
    Posr.Location = RepSpec.f3;
    Posr.LocArea = RepSpec.f2;
    keys = 3;
  end;
  Gray_Divider(0,1);
  TrHs = true;
  while (LoopKey(ckey,Posr,keys,TrHs)) begin
    if (Posr.Status!=3) then begin TrHs = false; end;
    if (nonblank(RepSpec.f2)) and (nonblank(RepSpec.f3)) then begin
      if (Posr.Location!=RepSpec.f3) then begin TrHs = false; end;
      if (Posr.LocArea!=RepSpec.f2) then begin TrHs = false; end;
    end;
    if (TrHs) then begin
      testf = true;
      if (nonblank(RepSpec.f1)) then begin
        if (Posr.Code<frpos) then begin testf = false; end;
        if (Posr.Code>topos) then begin testf = false; end;
      end;
      if (nonblank(RepSpec.f2)) then begin
        if (Posr.LocArea!=RepSpec.f2) then begin testf = false; end;
      end;
      if (nonblank(RepSpec.f3)) then begin
        if (Posr.Location!=RepSpec.f3) then begin testf = false; end;
      end;
      if (testf) then begin
        StartFormat(15);
         OutString(0,"DblPosHist",Posr.Code,false);
         OutString(90,0,Posr.LocArea,false);
         OutString(180,0,Posr.Comment,false);
         OutVal(400,0,Posr.Height,M4Qty,false);
        EndFormat;
        PrintItemsAtPosition("",Posr.Code,"","",qty,false,4,"");
      end;
    end;
  end;
  EndJob;
  RETURN;
END;