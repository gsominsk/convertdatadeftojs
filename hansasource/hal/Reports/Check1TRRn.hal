external procedure HT2Per(Date, Date , var string);

global
procedure Check1TRRn(record RcVc RepSpec)
BEGIN
  record TRVc TRr;
  Boolean TrHs,firstivf,firstipf,firstipbf,firstipof,firstvif,firstopf,firstopbf,firstopof;
  Boolean firstexpf,firstprodf,firstppf,firstsmf,firstshf,firstdropshf,firstpuf,firstsdf,firstclif,firstclof,firstforextrf;
  Boolean printf;
  string 255 tstr;
  Integer rw;
  record AT2WrofVc AT2Wrofr;
  record RestAccVc RestAccr;
  record ChqDepVc ChkDepr;
  record IVCashVc IVCashr;
  record ActVc Actr;
  record IPVc IPr;
  record IVVc IVr;
  record OPVc OPr;
  record TSVc TSr;
  record VIVc VIr;
  record PUVc PUr;
  record SHVc SHr;
  record DropSHVc DropSHr;
  record SDVc SDr;
  record SRVc SRr;
  record PPVc PPr;
  record StockMovVc SMr;
  record RetVc Retr;
  record RetPUVc RetPUr;
  record ProdVc Prodr;
  record INTransferVc Offhr;
  record ExpVc Expr;
  record CLInVc CLIr;
  record CLOutVc CLOr;
  record IntIVVc IntIVr;
  record ProdOperationVc ProdOperationr;
  record CredManVc CredManr;
  string 30 keystr;
  record ForexTRVc FTRr;
  
  firstivf = true;
  firstipf = true;
  firstipbf = true;
  firstipof = true;
  firstvif = true;
  firstopf = true;
  firstopbf = true;
  firstopof = true;  
  firstexpf = true;
  firstprodf = true;
  firstppf = true;
  firstsmf = true;
  firstshf = true;
  firstpuf = true;
  firstsdf = true;
  firstclif = true;
  firstclof = true;
  firstforextrf = true;
  StartReportJob(USetStr(7797));
   rw = 1;    
   HT2Per(RepSpec.sStartDate,RepSpec.sEndDate,tstr);
   Header(rw,tstr,1);
   rw = rw + 1;
  EndHeader;
  StartFormat(15);
  OutString(0,0,USetStr(7817),false);
  OutString(60,0,USetStr(2503),false);
//  OutString(130,0,USetStr(7796),false);
  EndFormat;
  Gray_Divider(0,1);
  if (nonblankdate(RepSpec.sStartDate)) then begin
    keystr = "TransDate";
    TRr.TransDate = RepSpec.sStartDate;
  end else begin
    keystr = "Number";
  end;
  TrHs = true;
  TRr.Number = -1;
  TRr.IntYc = 201;
  while (LoopKey(keystr,TRr,2,TrHs)) begin
    if (nonblankdate(RepSpec.sStartDate)) then begin
      if (DateInRange(TRr.TransDate,RepSpec.sStartDate,RepSpec.sEndDate)==false) then begin TrHs = false; end;
    end;
    if (TrHs==false) then begin goto LLoop; end;
    switch (TRr.IntYc) begin
      case AT2WrofYc://AT2WrofYc
        printf = false;
        AT2Wrofr.SerNr = TRr.Number;
        if (ReadFirstMain(AT2Wrofr,1,true)==false) then begin
          printf = true;
        end else begin
          if (AT2Wrofr.OKFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstivf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1430),false);
             Gray_Divider(0,1);
            EndFormat;
            firstivf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case IVYc://IVYc
        printf = false;
        IVr.SerNr = TRr.Number;
        if (ReadFirstMain(IVr,1,true)==false) then begin
          printf = true;
        end else begin
          if (IVr.OKFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstivf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1150),false);
             Gray_Divider(0,1);
            EndFormat;
            firstivf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case IVCashYc://IVCashYc
        printf = false;
        IVCashr.SerNr = TRr.Number;
        if (ReadFirstMain(IVCashr,1,true)==false) then begin
          printf = true;
        end else begin
          if (IVCashr.OKFlag==0) and (IVCashr.Invalid==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstivf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1431),false);
             Gray_Divider(0,1);
            EndFormat;
            firstivf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
/*        
      case 229://RestAccYc
        printf = false;
        RestAccr.SerNr = TRr.Number;
        if (ReadFirstMain(RestAccr,1,true)==false) then begin
          printf = true;
        end else begin
          if (RestAccr.Closed==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstivf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1436),false);
             Gray_Divider(0,1);
            EndFormat;
            firstivf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
*/        
      case ChqDepYc://ChqDepYc
        printf = false;
        ChkDepr.SerNr = TRr.Number;
        if (ReadFirstMain(ChkDepr,1,true)==false) then begin
          printf = true;
        end else begin
          if (ChkDepr.OKFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstivf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1437),false);
             Gray_Divider(0,1);
            EndFormat;
            firstivf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 231://TSYc
        printf = false;
        TSr.SerNr = TRr.Number;
        if (ReadFirstMain(TSr,1,true)==false) then begin
          printf = true;
        end else begin
          if (TSr.OKFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstivf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1438),false);
             Gray_Divider(0,1);
            EndFormat;
            firstivf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 232://ActYc
        printf = false;
        Actr.SerNr = TRr.Number;
        if (ReadFirstMain(Actr,1,true)==false) then begin
          printf = true;
        end else begin
          if (Actr.OKFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstivf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1439),false);
             Gray_Divider(0,1);
            EndFormat;
            firstivf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 202://IPYc
        printf = false;
        IPr.SerNr = TRr.Number;
        if (ReadFirstMain(IPr,1,true)==false) then begin
          printf = true;
        end else begin
          if (IPr.OKFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstipf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1151),false);
             Gray_Divider(0,1);
            EndFormat;
            firstipf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 203://VIYc
        printf = false;
        VIr.SerNr = TRr.Number;
        if (ReadFirstMain(VIr,1,true)==false) then begin
          printf = true;
        end else begin
          if (VIr.OKFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstvif) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1152),false);
             Gray_Divider(0,1);
            EndFormat;
            firstvif = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 204://OPYc
        printf = false;
        OPr.SerNr = TRr.Number;
        if (ReadFirstMain(OPr,1,true)==false) then begin
          printf = true;
        end else begin
          if (OPr.DoneFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstopf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1153),false);
             Gray_Divider(0,1);
            EndFormat;
            firstopf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 205://PUYc
        printf = false;
        PUr.SerNr = TRr.Number;
        if (ReadFirstMain(PUr,1,true)==false) then begin
          printf = true;
        end else begin
          if (PUr.OKFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstpuf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1157),false);
             Gray_Divider(0,1);
            EndFormat;
            firstpuf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case RetYc://RetYc
        printf = false;
        Retr.SerNr = TRr.Number;
        if (ReadFirstMain(Retr,1,true)==false) then begin
          printf = true;
        end else begin
          if (Retr.OKFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstsmf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1421),false);
             Gray_Divider(0,1);
            EndFormat;
            firstsmf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case RetPUYc://RetPUYc
        printf = false;
        RetPUr.SerNr = TRr.Number;
        if (ReadFirstMain(RetPUr,1,true)==false) then begin
          printf = true;
        end else begin
          if (RetPUr.OKFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstsmf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1446),false);
             Gray_Divider(0,1);
            EndFormat;
            firstsmf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 241://VariancePUYc
        printf = false;
        SMr.SerNr = TRr.Number;
        if (ReadFirstMain(SMr,1,true)==false) then begin
          printf = true;
        end else begin
          if (SMr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstsmf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1449),false);
             Gray_Divider(0,1);
            EndFormat;
            firstsmf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 206://SHYc
        printf = false;
        SHr.SerNr = TRr.Number;
        if (ReadFirstMain(SHr,1,true)==false) then begin
          printf = true;
        end else begin
          if (SHr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstshf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1158),false);
             Gray_Divider(0,1);
            EndFormat;
            firstshf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case DropSHYc:
        printf = false;
        DropSHr.SerNr = TRr.Number;
        if (ReadFirstMain(DropSHr,1,true)==false) then begin
          printf = true;
        end else begin
          if (DropSHr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstdropshf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1158),false);
             Gray_Divider(0,1);
            EndFormat;
            firstdropshf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 207://ExpYc
        printf = false;
        Expr.SerNr = TRr.Number;
        if (ReadFirstMain(Expr,1,true)==false) then begin
          printf = true;
        end else begin
          if (Expr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstexpf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1170),false);
             Gray_Divider(0,1);
            EndFormat;
            firstexpf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case ForexTRYc:
        printf = false;
        FTRr.SerNr = TRr.Number;
        if (ReadFirstMain(FTRr,1,true)==false) then begin
          printf = true;
        end else begin
          if (FTRr.OKFlag==0) then begin
            printf = true;
          end;
        end;
        if (printf) then begin
          if (firstforextrf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1640),false);
             Gray_Divider(0,1);
            EndFormat;
            firstforextrf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 208://PPYc
        printf = false;
        PPr.SerNr = TRr.Number;
        if (ReadFirstMain(PPr,1,true)==false) then begin
          printf = true;
        end else begin
          if (PPr.DoneFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstppf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1171),false);
             Gray_Divider(0,1);
            EndFormat;
            firstppf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 209://STMovYc
        printf = false;
        SMr.SerNr = TRr.Number;
        if (ReadFirstMain(SMr,1,true)==false) then begin
          printf = true;
        end else begin
          if (SMr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstsmf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1172),false);
             Gray_Divider(0,1);
            EndFormat;
            firstsmf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 240://SentSTMovYc
        printf = false;
        SMr.SerNr = TRr.Number;
        if (ReadFirstMain(SMr,1,true)==false) then begin
          printf = true;
        end else begin
          if (SMr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstsmf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1172),false);
             Gray_Divider(0,1);
            EndFormat;
            firstsmf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 211://CLInYc
        printf = false;
        CLIr.SerNr = TRr.Number;
        if (ReadFirstMain(CLIr,1,true)==false) then begin
          printf = true;
        end else begin
          if (CLIr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstclif) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1193),false);
             Gray_Divider(0,1);
            EndFormat;
            firstclif = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 212://CLOutYc
        printf = false;
        CLOr.SerNr = TRr.Number;
        if (ReadFirstMain(CLOr,1,true)==false) then begin
          printf = true;
        end else begin
          if (CLOr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstclof) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1194),false);
             Gray_Divider(0,1);
            EndFormat;
            firstclof = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 213://SDYc
        printf = false;
        SDr.SerNr = TRr.Number;
        if (ReadFirstMain(SDr,1,true)==false) then begin
          printf = true;
        end else begin
          if (SDr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstsdf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1195),false);
             Gray_Divider(0,1);
            EndFormat;
            firstsdf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 214: begin//STRYc
        end;
      case 215://OPOYc
        printf = false;
        OPr.SerNr = TRr.Number;
        if (ReadFirstMain(OPr,1,true)==false) then begin
          printf = true;
        end else begin
          if (OPr.DoneFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstopof) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1416),false);
             Gray_Divider(0,1);
            EndFormat;
            firstopof = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 216://OPBYc
        printf = false;
        OPr.SerNr = TRr.Number;
        if (ReadFirstMain(OPr,1,true)==false) then begin
          printf = true;
        end else begin
          if (OPr.DoneFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstopbf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1417),false);
             Gray_Divider(0,1);
            EndFormat;
            firstopbf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 217://IPOYc
        printf = false;
        IPr.SerNr = TRr.Number;
        if (ReadFirstMain(IPr,1,true)==false) then begin
          printf = true;
        end else begin
          if (IPr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstipof) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1418),false);
             Gray_Divider(0,1);
            EndFormat;
            firstipof = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 218://IPBYc
        printf = false;
        IPr.SerNr = TRr.Number;
        if (ReadFirstMain(IPr,1,true)==false) then begin
          printf = true;
        end else begin
          if (IPr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstipbf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1419),false);
             Gray_Divider(0,1);
            EndFormat;
            firstipbf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 219://ProdYc
        printf = false;
        Prodr.SerNr = TRr.Number;
        if (ReadFirstMain(Prodr,1,true)==false) then begin
          printf = true;
        end else begin
          if (Prodr.PRStatusFlag==0) or (Prodr.PRStatusFlag==4) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstprodf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1420),false);
             Gray_Divider(0,1);
            EndFormat;
            firstprodf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 235://INTransferYc
        printf = false;
        Offhr.SerNr = TRr.Number;
        if (ReadFirstMain(Offhr,1,true)==false) then begin
          printf = true;
        end else begin
          if (Offhr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstprodf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1443),false);
             Gray_Divider(0,1);
            EndFormat;
            firstprodf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 239://IntIVYc
        printf = false;
        IntIVr.SerNr = TRr.Number;
        if (ReadFirstMain(IntIVr,1,true)==false) then begin
          printf = true;
        end else begin
          if (IntIVr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstpuf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1157),false);
             Gray_Divider(0,1);
            EndFormat;
            firstpuf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 245://ProdOperationYc
        printf = false;
        ProdOperationr.SerNr = TRr.Number;
        if (ReadFirstMain(ProdOperationr,1,true)==false) then begin
          printf = true;
        end else begin
          if (ProdOperationr.PRStatusFlag==0) or (ProdOperationr.PRStatusFlag==4) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstpuf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1633),false);
             Gray_Divider(0,1);
            EndFormat;
            firstpuf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 246://CredManYc
        printf = false;
        CredManr.SerNr = TRr.Number;
        if (ReadFirstMain(CredManr,1,true)==false) then begin
          printf = true;
        end else begin
          if (CredManr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstpuf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1635),false);
             Gray_Divider(0,1);
            EndFormat;
            firstpuf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
      case 247://SRYc
        printf = false;
        SRr.SerNr = TRr.Number;
        if (ReadFirstMain(SRr,1,true)==false) then begin
          printf = true;
        end else begin
          if (SRr.OKFlag==0) then begin
            printf = true;
          end;
        end;        
        if (printf) then begin
          if (firstsdf) then begin
            StartFormat(15);
             OutString(0,0,USetStr(1636),false);
             Gray_Divider(0,1);
            EndFormat;
            firstsdf = false;
          end;
          StartFormat(15);
           OutStringID(60,"DblTRVc",TRr.Number,false,TRr.IntYc);
          EndFormat;
        end;
    end;
LLoop:;    
  end;
  EndJob;
  RETURN;
END;
