global
procedure ServMonHistRn(record RcVc RepSpec)
begin
  record ServerMonitorVc SMr;
  record ServMonHistVc ServMonHistr;
  Boolean foundf;
  string 60 prevsm;

  StartReportJob("Server Monitor History");
  SetRepCol(2,80);
  SetRepCol(3,300);
  SetRepCol(4,420);
  SetRepCol(5,15);
  SetRepCol(6,80);
  SetRepCol(7,110);
  EndHeader;
  
  StartFormat(15);
  OutString(0,0,"Code",false);
  OutString(2,0,"Comment",false); 
  OutString(3,0,"IP Address",false);
  OutString(4,0,"Port",false);
  EndFormat;
  Gray_Divider(0,1);
  ServMonHistr.Code = RepSpec.f1;
  foundf = true;
  while (LoopMain(ServMonHistr,2,foundf)) begin
    if (nonblank(RepSpec.f1)) then begin
      if (ServMonHistr.Code!=RepSpec.f1) Then begin
        foundf = false;
      end;
    end;
    if (foundf) then begin
      if (prevsm!=ServMonHistr.Code) then begin
        SMr.Code = ServMonHistr.Code;
        if (ReadFirstMain(SMr,1,true)==false) then begin
          RecordNew(SMr);
        end;
        StartFormat(15);
        OutString(0,0,ServMonHistr.Code,false);
        OutString(2,0,SMr.Comment,false);
        OutString(3,0,SMr.IP,false);
        OutString(4,0,SMr.WebPort,false);
        EndFormat;
        Gray_Divider(0,1);
        StartFormat(15);
        EndFormat;
        StartFormat(15);
        OutString(5,0,"Date",false);
        OutString(6,0,"Time",false);
        OutString(7,0,"Status",false);
        OutString(240,0,"Hours up",true);
        OutString(320,0,"Users Online",true);
        OutString(400,0,"DB Size (MB)",true);
        OutString(1,0,"Free HD (MB)",true);
        EndFormat;
        Gray_Divider(0,1);
        prevsm = ServMonHistr.Code;
      end;
      StartFormat(15);
      OutString(5,0,ServMonHistr.TransDate,false);
      OutString(6,0,Left(ServMonHistr.TransTime,5),false);
      OutString(7,0,StringFromSet(333,ServMonHistr.IStatus),false);
      OutLongInt(240,0,ServMonHistr.Running,true);
      OutLongInt(320,0,ServMonHistr.Online,true);
      OutLongInt(400,0,ServMonHistr.DBSize,true);
      OutLongInt(1,0,ServMonHistr.HDFree,true);
      EndFormat;
    end;
  end;
  EndJob;
  return;
end;
