external procedure GetCountryName(string,string,var string);
external procedure MakeArrivalCode(string,var string);

procedure PrintCustomsRows(record CustomsVc Customsr)
BEGIN
  row CustomsVc Customsrw;
  Integer i,rwcnt;
  record ItemStatusVc ISr;
  
  StartFormat(15);
  EndFormat;
  StartFormat(15);
   OutString(0,0,USetStr(10764),false);
   OutString(40,0,USetStr(10740),false);
   OutString(100,0,USetStr(10741),false);
   OutString(240,0,USetStr(10765),true);
   OutString(320,0,USetStr(10766),true);
   OutString(400,0,USetStr(10767),true);
   OutString(480,0,USetStr(10768),true);
  EndFormat;
  Gray_Divider(0,1);
  rwcnt = MatRowCnt(Customsr);
  for (i=0;i<rwcnt;i=i+1) begin
    MatRowGet(Customsr,i,Customsrw);
    ISr.Code = Customsrw.ArtCode;
    if (ReadFirstMain(ISr,1,true)) then begin
    end;
    StartFormat(15);
    OutLongInt(0,0,Customsrw.PONr,false);
    OutString(40,0,Customsrw.CommodityCode,false);
    OutString(100,0,Customsrw.CommodityDesc,false);    
    OutVal(240,0,ISr.Instock,M4Qty,true);
    EndFormat;
    Black_Divider(260,320);
    Black_Divider(340,400);
    Black_Divider(420,480);
  end;
  Gray_Divider(0,1);
  RETURN;
END;

global
procedure CUSPARRn(record RcVc RepSpec)
BEGIN
  record CustomsVc Customsr;
  record NotepadVc Noter;
  record RLinkVc RLinkr;
  Boolean notefound; 
  Integer notenr;
  Integer i,rwcnt;
  string 255 tstr;

  Customsr.SerNr = RepSpec.long1;
  if (ReadFirstMain(Customsr,1,true)) then begin
    notenr = 1;
    while (ReadRecordLink(Customsr,notenr,Noter,RLinkr)) begin
      notenr = notenr + 1;
      if (RLinkr.Comment==RepSpec.f1) then begin
        notefound = true;
        goto LFOUND;
      end;
    end;    
LFOUND:;
    StartReportJob(USetStr(10755));
    EndHeader;  
     if (!notefound) then begin
       StartFormat(15);
        OutString(0,0,USetStr(10756),false);
       EndFormat;
       Black_Divider(0,1);
     end;
     StartFormat(15);
      OutString(0,0,USetStr(10757) & ": ",false);
      OutLongInt(120,0,Customsr.VECode,false);
      OutString(190,0,Customsr.Addr0,false);
     EndFormat;
     StartFormat(10);
     EndFormat;
     StartFormat(15);
      OutString(0,0,USetStr(10758) & ": ",false);
      OutString(120,0,Customsr.CountryCode,false);
      GetCountryName(Customsr.CountryCode,"",tstr);
      OutString(190,0,tstr,false);
      OutString(350,0,USetStr(10759) & ": ",false);
     EndFormat;
     Black_Divider(400,1);
     StartFormat(10);
     EndFormat;
     StartFormat(15);
      OutString(0,0,USetStr(10721) & ": ",false);
      OutLongInt(120,"DblCustomsVc",Customsr.SerNr,false);
      OutString(350,0,USetStr(10760) & ": ",false);
     EndFormat;
     Black_Divider(400,1);
     StartFormat(15);
      OutString(0,0,USetStr(10725) & ": ",false);
      OutString(120,0,Customsr.ShipMode,false);
     EndFormat;     
     StartFormat(15);
      OutString(0,0,USetStr(10723) & ": ",false);
      MakeArrivalCode(Customsr.ArrivalCode,tstr);
      OutString(120,0,tstr,false);
      OutString(350,0,USetStr(10761) & ": ",false);
     EndFormat;
     Black_Divider(400,1);
     StartFormat(15);
      OutString(0,0,USetStr(10762) & ": ",false);
      OutVal(150,0,Customsr.Weight,M4UVal,true);
      OutString(190,0,USetStr(10763) & ": ",false);
      OutVal(300,0,Customsr.NrOffPackages,M4UVal,true);
     EndFormat; 
     PrintCustomsRows(Customsr);    
     StartFormat(15);
      OutString(0,0,USetStr(10769) & ": ",false);
     EndFormat; 
     Gray_Divider(150,1);
    EndJob;
  end;
  RETURN;
END;  
