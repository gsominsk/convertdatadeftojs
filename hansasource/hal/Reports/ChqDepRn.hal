global
procedure CompDepRn(record RcVc RepSpec)
begin
  val tt;
  record ChqDepVc Dep;
  row ChqDepVc Deprw;
  Record CheckVc Chq;
  Boolean TsHr,OK;
  Integer p1,p2,p3,p4,p5,j,rows,i,k;
  String 20 AmntOfCheques;
  String 100 HdrStr;
  Integer HdrLn;
  Record PMBlock PayModes;
  Row PMBlock PayModesrw;
  String 80 CtaName,CtaBank;

// Positions
  p1= 0;
  p2= 160;
  p3= 215;
  p4= 360;
  p5= 480;


// Get parameters & Init
  tt = 0;   i = 0;
  TsHr = true;


  Dep.SerNr = RepSpec.long1;
  if ReadFirstMain(Dep,1,true) then begin

    StartReportJob(USetStr(8455));
    HdrLn = 1;
    HdrStr = USetStr(8461) & Dep.TransDate;
    Header(HdrLn,HdrStr,1);
    HdrStr = USetStr(14621) & ": " & RepSpec.long1;
    Header(HdrLn,HdrStr,2);
    
    EndHeader;
    
    Blockload(PayModes);
    rows = MatRowCnt(PayModes);
    for (k=0;k<rows;k=k+1) begin
      MatRowGet(PayModes,k,PayModesrw);
      if (PayModesrw.Code == Dep.PayMode)then begin
        CtaName  = PayModesrw.Comment;
        CtaBank  = PayModesrw.BankNr;
       end;
    end;

    StartFormat(15);
    OutString(p1,0,"Desposit to Banco: " & CtaName,false);  
    OutString(p4,0,"Desposit to A/C: " & Dep.TransDate,false);   // EVTB
    EndFormat;
    
    
    StartFormat(15);
    OutString(2,0,Dep.Comment,false);  // EVTB
// EVTB    OutString(p1,0,"Deposito en cta. Banco : " & CtaBank,false);
    EndFormat;
    StartFormat(15);
    OutString(p1,0,USetStr(8456),false);
    OutString(p2,0,USetStr(8457),false);
    OutString(p3+5,0,USetStr(8515),false);    // EVTB
    OutString(p4,0,USetStr(8495),false);      // EVTB
    OutString(p5,0,USetStr(8458),true);
    EndFormat;
    Gray_Divider(0,1);

    rows = MatRowCnt(Dep);
    for (j=0;j<rows;j=j+1) begin
       MatRowGet(Dep,j,Deprw);

       Chq.SerNr = Deprw.ChqNr;
       if ReadFirstMain(Chq,1,true) then begin
         StartFormat(15);
         OutString(p1,0,left(Chq.BankName,30),false);
         OutString(p2,0,left(Chq.CheckNr,8),false);
         OutString(p3,0,Chq.CUName,false);
         OutString(p4,0,Chq.EffectDate,false);
         OutVal(p5,0,Chq.Amount,M4Val,true);
         EndFormat;       
         tt = tt + Chq.Amount;
         i  = i + 1;
       end;
    end; 
  end;

  // Footer
  Gray_Divider(0,1);
  StartFormat(15);
  AmntOfCheques = i;
  AmntOfCheques = AmntOfCheques & USetStr(8459);
  OutString(p1,0,USetStr(8460),false);
  OutString(p2,0,AmntOfCheques,false);
  OutVal(p3,0,tt,M4Val,true);
  EndFormat;

  StartFormat(15);
  EndFormat;

  Gray_Divider(0,1);
  StartFormat(15);
  OutString(p1,0,USetStr(8443),false);   
  OutVal(p3,0,Dep.Cash,M4Val,true);
  EndFormat;
  Gray_Divider(0,1);

  StartFormat(15);
  EndFormat;
   
  StartFormat(15);
  OutString(p1,0,USetStr(8444),false);
  OutVal(p3,0,(tt+Dep.Cash),M4Val,true);
  EndFormat;
   
  EndJob;
  return;
end;
