external procedure HT2Per(Date, Date , var string);


global
procedure EmailQueListRn(record RCVc RepSpec)
begin
  record EMailQueVc EQr;
  row EMailQueVc EQrw;
  Boolean TrHs,testf,firstf;
  Integer i,rwcnt,rw;
  string 255 tstr;
  
  StartReportJob(USetStr(38510));
  rw = 1;
  HT2Per(RepSpec.sStartDate,RepSpec.sEndDate,tstr);
  Header(rw,tstr,1);
  rw = rw + 1;
  if (nonblank(RepSpec.f1)) then begin
    Header(rw,USetStr(10018) & RepSpec.f1,1);
    rw = rw + 1;
  end;

  EndHeader;
  if (blank(RepSpec.f1)) then begin
    StartFormat(15);
    OutString(0,0,USetStr(38515),false);
    EndFormat;
  end else begin
    TrHs = true;
    firstf = true;
    while (LoopMain(EQr,3,TrHs)) begin
      testf = true;;
      if (EQr.EMailSent!=1) then begin
        testf = false;
      end;
      if (DateInRange(EQr.QueDate,RepSpec.sStartDate,RepSpec.sEndDate)==false) then begin
        testf = true;
      end;
      if (testf) then begin
        testf = false;
        rwcnt = MatRowCnt(EQr);
        for (i=0;i<rwcnt;i=i+1) begin
          MatRowGet(EQr,i,EQrw);
          if (EQrw.AddrCode==RepSpec.f1) then begin
            testf = true;
            i = rwcnt;
          end;
        end;
      end;
      if (testf) then begin
        if (firstf) then begin
          StartFormat(15);
          OutString(0,0,USetStr(38511),false);
          OutString(60,0,USetStr(38512),false);
          OutString(100,0,USetStr(38513),false);
          OutString(140,0,USetStr(38514),false);
          EndFormat;
          StartFormat(1);
          Gray_Divider(0,1);
          EndFormat;
          firstf = false;
        end;
        StartFormat(15);
        OutString(0,"DblEmailQueVc",EQr.SerNr,false);
        OutString(60,0,EQr.QueDate,false);
        OutString(100,0,EQr.QueTime,false);
        OutString(140,0,EQr.Header,false);
        EndFormat;
      end;
    end;
  end;
  EndJob;
  
  return;
end;