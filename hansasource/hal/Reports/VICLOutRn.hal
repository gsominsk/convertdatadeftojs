external procedure HT2Per(Date, Date , var string);
external procedure PrintCLOutVI(LongInt);

procedure PrintHeader()
BEGIN
  string 255 tstr;

  SetRepCol(0,15);
  SetRepCol(2,50);
  SetRepCol(3,200);
  SetRepCol(4,260);
  SetRepCol(5,380);
  SetRepCol(6,440);
  SetRepCol(7,445);
  SetRepCol(8,475);
  StartFormat(15);
  OutString(0,0,USetStr(10491),false);
  OutString(2,0,USetStr(10492),false);
  OutString(3,0,USetStr(10493),false);
  OutString(4,0,USetStr(7670),false);
  OutString(5,0,USetStr(10495),true);
  OutString(6,0,USetStr(10496),true);
  OutString(7,0,USetStr(10497),false);
  EndFormat;
  Gray_Divider(0,1);
  RETURN;
END;

procedure PrintCLOutOP(LongInt opsernr)
BEGIN
  record OPVc OPr;
 
  OPr.SerNr = opsernr;
  if (ReadFirstMain(OPr,1,true)) then begin
    StartFormat(15);
    OutLongInt(0,"DblVePerOP",OPr.SerNr,false);
    OutString(2,0,USetStr(1153),false);
    OutDate(3,0,OPr.TransDate,false);
    EndFormat;
  end;
  RETURN;
END;

global
procedure VICLOutRn(record RcVc RepSpec)
BEGIN
  record CLOutVIVc CLOutVIr;
  Boolean TrHs,testf;
  LongInt lastclout;
  LongInt frinv,toinv;
  boolean test;
  record CLOutVc CLOutr;
  integer rw;
  string 255 tstr;
  
  StartReportJob(USetStr(10460));
  rw = 1;
  HT2Per(RepSpec.sStartDate,RepSpec.sEndDate,tstr);
  Header(rw,tstr,1);
  rw = rw +1;
  if nonblank(RepSpec.f1) then begin
 	 tstr = RepSpec.f1;
 	 Header(rw,tstr,1);
  	 rw = rw +1;
  end;	
  EndHeader;
  PrintHeader;
  TrHs = true;
  
  frinv = FirstInRange(RepSpec.f1,20);
  toinv = LastInRange(RepSpec.f1,20);
  CLOutVIr.CLOutNr = frinv;
  while (LoopMain(CLOutVIr,1,TrHs)) begin
    testf = true;
    if nonblank(RepSpec.f1) then begin
      if (CLOutVIr.CLOutNr> toinv) then begin
      	testf = false;
      	TrHs = false;
      end;	
    end;
    if testf then begin
    	CLOutr.SerNr = CLOutVIr.CLOutNr;
    	if ReadFirstMain(CLOutr,1,true) then begin
    		if (DateInRange(CLOutr.TransDate,RepSpec.sStartDate,Repspec.sEndDate)==false) then begin
      			testf = false;
      		end;	
    	end;
    end;
    if testf then begin
		if (CLOutVIr.CLOutNr!=lastclout) then begin
		  Gray_Divider(0,1);
		  StartFormat(15);
		   OutString(0,0,USetStr(1834),false);
		   OutLongInt(70,"DblCLOutVc",CLOutVIr.CLOutNr,false);
		  EndFormat;
		  Gray_Divider(0,200);
		end;      
		testf = true;
		if (CLOutVIr.FileName=="OPVc") then begin
		  if (RepSpec.flags[0]==0) then begin
			testf = false;
		  end;
		end;
		if (testf) then begin
		  switch (CLOutVIr.FileName) begin
			case "VIVc": PrintCLOutVI(CLOutVIr.SerNr);
			case "OPVc": PrintCLOutOP(CLOutVIr.SerNr);
		  end;
		end;  
		lastclout = CLOutVIr.CLOutNr;
	  end;
	end;  
  EndJob;
  RETURN;
END;