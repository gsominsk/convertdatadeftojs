
#ifdef HAL
external procedure HTLocations(string, string, var string);

global
procedure PrintHeaderIQ()
BEGIN
  StartFormat(15);
   OutString(0,0,USetStr(2463),false);
//   OutString(50,0,USetStr(2504),false);
  OutString(120,0,USetStr(2339),true);
   OutString(180,0,USetStr(2569),true);
   OutString(240,0,USetStr(2570),true);
   OutString(300,0,USetStr(2571),true);
 
   OutString(360,0,USetStr(2991),true);  
   OutString(420,0,USetStr(3011),true);  
   OutString(1,0,USetStr(2722),true);  
  EndFormat;
  Gray_Divider(0,1);
  RETURN;
END;  

global
function Boolean CheckDeliveryLocation(string artcode,string location,LongInt ordernr,val quant,var val qtydel)
BEGIN
  Boolean res;
  record SHVc SHr;
  row SHVc SHrw;
  Integer i,rwcnt;
  Boolean TrHs,testf;
  record MainStockBlock MainRec;

  BlockLoad(MainRec);
  qtydel = 0;
  res = true;
  SHr.OrderNr = ordernr;
  TrHs = true;
  while (LoopKey("OrderKey",SHr,1,TrHs)) begin
    if (SHr.OrderNr<>ordernr) then begin TrHs = false; end;
    if (TrHs) then begin
      rwcnt = MatRowCnt(SHr);
      for (i=0;i<rwcnt;i=i+1) begin
        MatRowGet(SHr,i,SHrw);
        testf = true;
        if (SHrw.ArtCode==artcode) then begin
          if (nonblank(SHrw.Location)) then begin
            if (SHrw.Location<>location) then begin
              testf = false;
            end;                  
          end else begin
            if (nonblank(SHr.Location)) then begin
              if (SHr.Location<>location) then begin
                testf = false;
              end;                  
            end else begin
              if (MainRec.MainStock<>location) then begin
                testf = false;
              end;                  
            end;  
          end;  
          if (testf) then begin
            qtydel = qtydel + SHrw.Ship;
            if (qtydel>quant) then begin
              qtydel = qtydel - SHrw.Ship;            
            end;
          end;
        end;
      end;
    end;  
  end;       
  CheckDeliveryLocation = res;
  RETURN;
END;
#endif
