external procedure HTWOrdStatus(Integer, Integer, Integer, var string);
external procedure HTPers(string,var string);
external procedure HTDetailLevel(integer, var string);
external procedure HTCusts(string, string, var string);//37
external procedure HTWOrder(LongInt , LongInt , var string);
external procedure HTProject(string ,var string);
external procedure HT2Per(Date, Date , var string);

procedure RepWOrder(record WOVc WOp)
begin
  Integer i,rwcnt;
  row WOVc WOrw;

  StartFormat(15);
  OutString(0,"DblWOVc",WOp.SerNr,false);
  OutDate(60,0,WOp.TransDate,false);
  OutLongInt(120,0,WOp.SVOSerNr,false);
  OutDate(220,0,WOp.PlanDate,false);
  OutString(300,0,WOp.PlanWork,false);
  OutString(480,0,WOp.OurContact,true);
  EndFormat;
  StartFormat(15);
  OutString(30,0,WOp.CustCode,false);
  OutString(120,0,WOp.Addr0,false);
  OutString(300,0,WOp.CustContact,false);
  OutString(480,0,WOp.CustOrdNr,true);
  EndFormat;
  if nonblank(WOp.Comment1) then begin
    StartFormat(15);
    OutString(220,0,WOp.Comment1,false);
    EndFormat;
  end;
  if nonblank(WOp.Comment2) then begin
    StartFormat(15);
    OutString(220,0,WOp.Comment2,false);
    EndFormat;
  end;
  if nonblank(WOp.Comment3) then begin
    StartFormat(15);
    OutString(220,0,WOp.Comment3,false);
    EndFormat;
  end;
  if nonblank(WOp.Comment4) then begin
    StartFormat(15);
    OutString(220,0,WOp.Comment4,false);
    EndFormat;
  end;  
  StartFormat(5);
  EndFormat;
  rwcnt = MatRowCnt(WOp);
  if (rwcnt>0) then begin
    StartFormat(15);
    OutString(20,0,USetStr(8279),false);
    OutString(104,0,USetStr(8283),true);
    OutString(112,0,USetStr(8302),false);
    OutString(280,0,USetStr(8303),false);
    OutString(380,0,USetStr(8304),false);
    OutString(430,0,USetStr(8305),false);
    EndFormat;
    Gray_Divider(20,1);
  end;    
  for (i = 0; i<rwcnt; i = i + 1) begin
    MatRowGet(WOp,i,WOrw);
    if (WOrw.stp==1) then begin
      StartFormat(15);
      OutString(12,0,WOrw.ArtCode,false);
      OutString(104,0,WOrw.Quant,true);
      OutString(112,0,WOrw.Spec,false);
      OutString(280,0,WOrw.SerialNr,false);
      OutString(380,"DblStandProblemVc",WOrw.StandProblem,false);
      OutVal(440,0,WOrw.PlanWork,M4UVAL,true);
      EndFormat;
    end;
  end;
  StartFormat(15);
  OutString(100,0,WOp.Objects,false);
  EndFormat;
return;
end;


global
procedure WOListRn(record RcVc RepSpec)
begin
  record WOVc WOr;
  Boolean TrHs;
  Boolean testf;
  LongInt afr;
  LongInt ato;
  string 255 tstr;
  Integer rw;
  LongInt frso;
  LongInt toso;
  Integer wocnt;

  frso = FirstInRange(RepSpec.f3,30);
  toso =  LastInRange(RepSpec.f3,30);
  afr = FirstInRange(RepSpec.f1,30);
  ato = LastInRange(RepSpec.f1,30);
  rw = 1;
  StartReportJob(USetStr(8300));
  HT2Per(RepSpec.sStartDate,RepSpec.sEndDate,tstr);
  Header(rw,tstr,1);
  rw = rw + 1;
  HTWOrdStatus(RepSpec.flags[2],RepSpec.flags[3],RepSpec.flags[1],tstr);
  Header(rw,tstr,0);
  HTWOrder(afr,ato,tstr);
  Header(rw,tstr,1);
  rw = rw + 1;
  if (nonblank(RepSpec.f2)) then begin
    string 20 frc,toc;
    frc = FirstInRange(RepSpec.f2,20);
    toc = LastInRange(RepSpec.f2,20);
    HTCusts(frc,toc,tstr);
    Header(rw,tstr,1);
    rw = rw + 1;
  end;
  if (RepSpec.ArtMode==2) then begin
    tstr = USetStr(5127);
  end else begin
    HTDetailLevel(RepSpec.ArtMode,tstr);
  end;
  Header(rw,tstr,0);
  if (nonblank(RepSpec.AccStr)) then begin
    HTProject(RepSpec.AccStr,tstr);
    Header(rw,tstr,1);
    rw = rw + 1;
  end;
  if (nonblank(RepSpec.TransStr)) then begin
    HTPers(RepSpec.TransStr,tstr);
    Header(rw,tstr,1);
    rw = rw + 1;
  end;

  EndHeader;
  if (RepSpec.ArtMode==0) then begin
    StartFormat(15);
    OutString(0,0,USetStr(2562),false);
    OutString(60,0,USetStr(2563),false);
    OutString(140,0,USetStr(2564),false);
    OutString(405,0,USetStr(8268),false);
    EndFormat;
  end;
  if (RepSpec.ArtMode==1) then begin
    StartFormat(15);
    OutString(0,0,USetStr(2562),false);
    OutString(60,0,USetStr(2563),false);
    OutString(120,0,USetStr(8266),false);
    OutString(220,0,USetStr(8268),false);
    OutString(300,0,USetStr(8269),false);
    EndFormat;
    StartFormat(15);
    OutString(20,0,USetStr(8279),false);
    OutString(104,0,USetStr(8283),true);
    OutString(430,0,USetStr(8301),false);
    EndFormat;
  end;
  WOr.SerNr = afr;
  if (RepSpec.ArtMode==0) then begin
    Gray_Divider(0,1);
  end;
  TrHs = true;
  while (LoopMain(WOr,1,TrHs)) begin
    if (ato <> -1) then begin
      if (WOr.SerNr > ato) then begin
        TrHs = false;
      end;
    end;
    if (TrHs) then begin
      testf = false;
      if (RepSpec.flags[3]==1) then begin
        if (/*nonblank(WOr.Done) and */(WOr.Closed==3)) then begin
          testf = true;
        end;
      end;
      if (RepSpec.flags[4]==1) then begin
         if (WOr.Closed==0) then begin
            testf = true;
         end;
      end;
      if (RepSpec.flags[2]==1) then begin
        if (WOr.Closed==1) then begin
          testf = true;
        end;
      end;
      if (RepSpec.flags[1]==1) then begin
        if (/*blank(WOr.Done) and */(WOr.Closed==2)) then begin
          testf = true;
        end;
      end;
      if (nonblank(RepSpec.f2) and (RepSpec.f2<>WOr.CustCode)) then begin
        testf = false;
      end;
      if (nonblank(RepSpec.f2) and (RepSpec.f2==WOr.CustCode)) then begin
        testf = false;
      end;
      if (nonblank(RepSpec.TransStr)) then begin
        if (RepSpec.TransStr <>  WOr.EMCode) then begin
          testf = false;
        end;
      end;
      if ((WOr.TransDate < RepSpec.sStartDate) or (WOr.TransDate > RepSpec.sEndDate)) then begin
        testf = false;
      end;
      if (nonblank(RepSpec.f3)) then begin
        if (toso<>-1) then begin
          if (WOr.SVOSerNr > toso) then begin
            testf = false;
          end;
        end;
        if (WOr.SVOSerNr<frso) then begin
          testf = false;
        end;
      end;
      if ((RepSpec.flags[1]==0) and
          (RepSpec.flags[2]==0) and
          (RepSpec.flags[3]==0) and
          (RepSpec.flags[4]==0)) then begin testf = true; 
      end;
      if (testf) then begin
        if (RepSpec.ArtMode==1) then begin
          Gray_Divider(0,1);
          RepWOrder(WOr);
        end;
        if ((RepSpec.ArtMode==2) or (RepSpec.ArtMode==0)) then begin
          StartFormat(15);
          OutString(0,"DblWOVc",WOr.SerNr,false);
          OutDate(60,0,WOr.TransDate,false);
          OutString(140,0,WOr.Addr0,false);
          OutDate(440,0,WOr.PlanDate,true);
          EndFormat;          
        end;
        wocnt = wocnt + 1;
      end;
    end;
  end;
  Gray_Divider(0,1);
  if (wocnt>0) then begin		//newrb
    StartFormat(15);
    OutString(0,0,USetStr(8160) & " " & wocnt,false);
    EndFormat;
  end;  
  EndJob;
return;
end;
