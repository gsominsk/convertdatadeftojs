external procedure HT2Per(Date, Date , var string);
external procedure PrintCLInIV(LongInt);

procedure PrintHeader()
BEGIN
  string 255 tstr;
  
  SetRepCol(0,15);
  SetRepCol(2,50);
  SetRepCol(3,200);
  SetRepCol(4,260);
  SetRepCol(5,380);
  SetRepCol(6,440);
  SetRepCol(7,445);
  SetRepCol(8,475);
  StartFormat(15);
  OutString(0,0,USetStr(10501),false);
  OutString(2,0,USetStr(10502),false);
  OutString(3,0,USetStr(10503),false);
  OutString(4,0,USetStr(7670),false);
  OutString(5,0,USetStr(10505),true);
  OutString(6,0,USetStr(10506),true);
  OutString(7,0,USetStr(10507),false);
  OutString(8,0,USetStr(1532),false);
  EndFormat;
  Gray_Divider(0,1);
  RETURN;
END;

procedure PrintCLInIP(LongInt ipsernr)
BEGIN
  record IPVc IPr;
 
  IPr.SerNr = ipsernr;
  if (ReadFirstMain(IPr,1,true)) then begin
    StartFormat(15);
    OutLongInt(0,"DblCuPerIP",IPr.SerNr,false);
    OutString(2,0,USetStr(1151),false);
    OutDate(3,0,IPr.TransDate,false);
    EndFormat;
  end;
  RETURN;
END;

global
procedure IVCLInRn(record RcVc RepSpec)
BEGIN
  record CLInIVVc CLInIVr;
  Boolean TrHs,testf;
  LongInt lastclin;
  LongInt frinv,toinv;
  boolean test;
  record CLInVc CLInr;
  integer rw;
  string 255 tstr;
  
  frinv = FirstInRange(RepSpec.f1,20);
  toinv = LastInRange(RepSpec.f1,20);
  
  StartReportJob(USetStr(10465));
  rw = 1;
  HT2Per(RepSpec.sStartDate,RepSpec.sEndDate,tstr);
  Header(rw,tstr,1);
  rw = rw +1;
  if nonblank(RepSpec.f1) then begin
 	 tstr = RepSpec.f1;
 	 Header(rw,tstr,1);
  	 rw = rw +1;
  end;	 
  EndHeader;
  PrintHeader;
  TrHs = true;
  CLInIVr.CLInNr = frinv;
  while (LoopMain(CLInIVr,1,TrHs)) begin
    testf = true;
    if nonblank(RepSpec.f1) then begin
      if (CLInIVr.CLInNr> toinv) then begin
      	testf = false;
      	TrHs = false;
      end;	
    end;
    if testf then begin
    	CLInr.SerNr = CLInIVr.CLInNr;
    	if ReadFirstMain(CLInr,1,true) then begin
    		if (DateInRange(CLInr.TransDate,RepSpec.sStartDate,Repspec.sEndDate)==false) then begin
      			testf = false;
      		end;	
    	end;
    end;
    if testf then begin
		if (CLInIVr.CLInNr!=lastclin) then begin
		  Gray_Divider(0,1);
		  StartFormat(15);
		   OutString(0,0,USetStr(1833),false);
		   OutLongInt(70,"DblCLInVc",CLInIVr.CLInNr,false);
		  EndFormat;
		  Gray_Divider(0,200);
		end;      
		if (CLInIVr.FileName=="IPVc") then begin
		  if (RepSpec.flags[0]==0) then begin
			testf = false;
		  end;
		end;
		if (testf) then begin
		  switch (CLInIVr.FileName) begin
			case "IVVc": PrintCLInIV(CLInIVr.SerNr);
			case "IPVc": PrintCLInIP(CLInIVr.SerNr);
		  end;
		end;  
		lastclin = CLInIVr.CLInNr;
	end;	
  end;
  EndJob;
  RETURN;
END;