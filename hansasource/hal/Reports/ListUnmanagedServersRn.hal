external function string 255 NodeURL(record CloudNodeVc);external function Boolean TreatServiceError(LongInt,string,string);globalprocedure GetServersFolder(var array string afolders)begin  LongInt i,n;    n = CountFoldersInDir("/Servers");    for (i = 0; i<n; i = i + 1) begin    afolders[i] = GetFolderNameInDir("/Servers",i);  end;end;function Boolean BeginStrEq(string longstring,string prefix)begin  Boolean res;    if (left(longstring,len(prefix))==prefix) then begin    res = true;  end;    BeginStrEq = res;end;function Boolean FolderIsExpected(string folder)begin  Boolean res;  switch (folder) begin    case "Versions": res = true;    case "VersionsCNTest": res = true;    case "VersionsCCTest": res = true;    case "scripts": res = true;    case "ToBeArchivedOrDeleted": res = true;    case "lost+found": res = true;  end;    if (BeginStrEq(folder,"HTS_CloudController")) then begin res = true; end;  if (BeginStrEq(folder,"HTS_CloudNode")) then begin res = true; end;    FolderIsExpected = res;end;function Boolean RCSMissingForFolder(string folder,string node)begin  Boolean res,loopf;  record RemoteCloudServerVc RCSr;    RCSr.Controller = node;  loopf = true;  res = true;    while (LoopKey("Controller",RCSr,1,loopf)) begin    if (RCSr.Controller<>node) then begin loopf = false; end;    if (loopf) then begin      if (RCSr.DataFolder==("/Servers/" & folder)) then begin        res = false;        goto LRCSMissingForFolder;      end;    end;  end;  LRCSMissingForFolder:;      RCSMissingForFolder = res;end;procedure ListUnmanagedServersOnNode(record CloudNodeVc CNr)begin  array string 255 afolders;  string 255 url;  LongInt stat;  boolean failf;  Integer i;    url = NodeURL(CNr);    if (CNr.Closed!=0) then begin    goto LListUnmanagedServersOnNode;  end;    stat = CallService(url).GetServersFolder(afolders);  failf = TreatServiceError(stat,url,"GetServersFolder");    if (failf) then begin    goto LListUnmanagedServersOnNode;  end;    for (i = 0; i<afolders.length; i = i + 1) begin    if (FolderIsExpected(afolders[i])==false) then begin      if (RCSMissingForFolder(afolders[i],CNr.Code)) then begin        StartFormat(15);        OutString(0,0,CNr.Code,false);        OutString(200,0,afolders[i],false);        EndFormat;      end;    end;  end;  LListUnmanagedServersOnNode:;end;globalprocedure ListUnmanagedServersRn(record RcVc RepSpec)begin  record CloudNodeVc CNr;    StartReportJob("List Unmanaged Servers");  EndHeader;    while (LoopMain(CNr,0,true)) begin    ListUnmanagedServersOnNode(CNr);  end;    EndJob;  return;end;