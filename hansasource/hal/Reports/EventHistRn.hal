
global
procedure EventHistRn(record RcVc RepSpec)
begin
  record ExcursionrsVc Eventhisr;
  record ExcursionVc Excur;
  record JobVc Jobr; 
  Longint LastEventNr;
  Boolean skip,TrHs;
  
  StartReportJob(USetStr(12766));
  EndHeader;
  
  SetRepCol(2,60);
  SetRepCol(3,150);  
  SetRepCol(4,230); 
  SetRepCol(5,285); 
  SetRepCol(6,340);
  SetRepCol(7,410); 
  SetRepCol(8,480); 
  
  StartFormat(15);
  OutString(2,0,USetStr(11246),false);
  OutString(3,0,USetStr(11247),false);
  OutString(4,0,USetStr(11248),false);
  OutString(5,0,USetStr(12768),false);
  OutString(6,0,USetStr(12767),false);
  EndFormat;
  Gray_Divider(0,1);
  
  TrHs = true;  LastEventNr = -1;
  Eventhisr.TransDate = RepSpec.sStartDate;
  while (LoopKey("TransDate",Eventhisr,1,TrHs)) begin
    skip = false;
    if (Eventhisr.TransDate > RepSpec.sEndDate) then begin
      TrHs = false;
      skip = true;
    end;
    if (LastEventNr==Eventhisr.EventNr) then begin
      skip = true;
    end;

    if (not skip) then begin
      StartFormat(15);
      OutString(2,"DblExcursionVc",Eventhisr.EventNr,false);
      OutDate(3,0,Eventhisr.TransDate,false);
      OutString(4,0,Eventhisr.StartTime,false);
      Excur.SerNr = Eventhisr.EventNr;
      if (ReadFirstMain(Excur,1,true)) then begin
        OutString(5,0,Excur.EndTime,false);
        OutString(6,0,Eventhisr.Comment,false);
      end;
      EndFormat;
    end;
    LastEventNr = Eventhisr.EventNr;
  end;
  EndJob;
  return;
end;
