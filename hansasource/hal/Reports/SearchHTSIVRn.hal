external procedure GetCurUser(var record UserVc);

global
procedure SearchHTSIVRn(record RcVc RepSpec)
begin
  record HTSIVVc HTSIVr;
  record LetVc Letr;
  boolean TrHs,testf;
  string 255 tstr;
  integer cnt, rw;
  record UserVc Userr;
    
  cnt = 0;
  rw = 1;
  StartReportJob("USetStr(16660)");
  if (nonblank(RepSpec.f1)) then begin
    switch (RepSpec.ArtMode) begin
      case 0:tstr = USetStr(16663) & RepSpec.f1;
      case 1:tstr = USetStr(16664)  & RepSpec.f1;
      case 2:tstr = USetStr(16665)  & RepSpec.f1;
      case 3:tstr = USetStr(16666)  & RepSpec.f1;
      case 4:tstr = USetStr(16667)  & RepSpec.f1;
      case 5:tstr = USetStr(16668)  & RepSpec.f1;
      case 6:tstr = USetStr(16669)  & RepSpec.f1;
      case 7:tstr = USetStr(16670)  & RepSpec.f1;
      otherwise tstr = "Not defined";
    end;
    Header(rw,tstr,1);
    rw = rw + 1;  
  end;
  EndHeader;
  if (blank(RepSpec.f1)) then begin
    goto LSearchHTSIVRn;
  end;
  GetCurUser(Userr);
  SetRepCol(2,120);
  SetRepCol(3,380);
  StartFormat(15);
  OutString(0,0,USetStr(16671),false);
  OutString(2,0,USetStr(16672),false);
  EndFormat;
  Gray_Divider(0,1);
  TrHs = true;
  while (LoopMain(HTSIVr,1,TrHs)) begin
    if (TrHs) then begin
      testf = false;
      RecordNew(Letr);
      if (RepSpec.ArtMode == 0) or (RepSpec.ArtMode == 1) then begin
        AddToText(HTSIVr.CustCode,Letr);
        AddToText(" ",Letr);
      end;
      if (RepSpec.ArtMode == 0) or (RepSpec.ArtMode == 2) then begin
        AddToText(HTSIVr.Addr0,Letr);
        AddToText(" ",Letr);
      end;
      if (RepSpec.ArtMode == 0) or (RepSpec.ArtMode == 3) then begin
        AddToText(HTSIVr.VATNr,Letr);
        AddToText(" ",Letr);
      end;
      if (RepSpec.ArtMode == 0) or (RepSpec.ArtMode == 4) then begin
        AddToText(HTSIVr.RegNr1,Letr);
        AddToText(" ",Letr);
      end;     
      if (RepSpec.ArtMode == 0) or (RepSpec.ArtMode == 5) then begin
        AddToText(HTSIVr.SerNr,Letr);
        AddToText(" ",Letr);
      end;
      if (RepSpec.ArtMode == 0) or (RepSpec.ArtMode == 6) then begin
        AddToText(HTSIVr.TransDate,Letr);
        AddToText(" ",Letr);
      end;
      if (RepSpec.ArtMode == 0) or (RepSpec.ArtMode == 7) then begin
        AddToText(HTSIVr.TransTime,Letr);
        AddToText(" ",Letr);
      end;     
      if (StringInText(RepSpec.f1,Letr)) then begin
        testf = true;
      end;
      if (testf) then begin
        StartFormat(15);
        OutString(0,"DblHTSIVVc",HTSIVr.SerNr,false);
        OutString(2,0,HTSIVr.Addr0,false);
        EndFormat;
        cnt = cnt + 1;
      end;  
    end;
  end;  
  Gray_Divider(0,1);
  StartFormat(15);
  OutString(0,0,USetStr(16674),false);
  OutVal(100,0,cnt,M40Val,true);
  EndFormat;
LSearchHTSIVRn:;
  EndJob;
  return;
end;

