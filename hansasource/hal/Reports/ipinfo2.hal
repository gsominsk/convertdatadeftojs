//IPInfo2.HAL
// Is this file used??

external function val MulWithRateToBase1(var string,Date,val,roundmode);


global
procedure FindPaidAmount(LongInt ivrsernr,LongInt sernr,var val paidamount)
begin
  record IPrsVc IPrsr;
  record IPVc IPr;
  row IPVc IPrw;
  Boolean TrHs;
  Integer rwcnt,i;
  LongInt curpayment;
  val paidinbase;

  paidamount = 0;
  curpayment = -1;
  IPrsr.IVNr = ivrsernr;
  IPrsr.TransType = kIPrsTransTypeReceipt;
  TrHs = true;
  while (LoopKey("IVKey",IPrsr,2,TrHs)) begin
   TrHs = true;
   if (IPrsr.IVNr!=ivrsernr) then begin
    TrHs = false;
   end;
   if (IPrsr.TransType!=kIPrsTransTypeReceipt) then begin
    TrHs = false;
   end;
/*
   if (IPrsr.TransType!=kIPrsTransTypeNLTransaction) then begin
     TrHs = false;
   end;
   if (IPrsr.TransType!=kIPrsTransTypeCashIn) then begin
     TrHs = false;
   end;
*/
   if (TrHs) then begin
    if (curpayment!=IPrsr.TransNr) then begin
      curpayment = IPrsr.TransNr;
      if (IPrsr.TransNr!=sernr) then begin
       IPr.SerNr = IPrsr.TransNr;
       if (ReadFirstMain(IPr,1,true)) then begin
        if (IPr.OKFlag==1) then begin
          rwcnt = MatRowCnt(IPr);
          for (i=0;i<rwcnt;i=i+1) begin
           MatRowGet(IPr,i,IPrw);
           if (IPrw.InvoiceNr==IPrsr.IVNr) then begin
                        paidinbase = MulWithRateToBase1(IPrw.InvCurncy,IPr.TransDate,IPrw.InvVal,DefaultCurRoundOff);
            paidamount = paidamount + paidinbase;
           end;
          end;
        end;
       end;
      end;
    end;
   end;
  end;
return;
end;

global
procedure FindOpenAmount(LongInt ivrsernr,var val paidamount)
begin
  record ARVc ARr;

  ARr.InvoiceNr = ivrsernr;
  if (ReadFirstMain(ARr,1,true)) then begin
    paidamount = ARr.RVal;
  end;
return;
end;
