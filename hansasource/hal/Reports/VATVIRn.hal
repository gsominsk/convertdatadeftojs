#ifdef HAL

procedure VATVIFormat(record VATVIVc VATVIr)
BEGIN  
  record AccVc Accr;
  row VATVIVc VATVIrw;
  Boolean Accs;
  string 255 temp;
  Integer i,rwcnt;

  rwcnt = MatRowCnt(VATVIr);
    StartFormat(15);
    EndFormat;
    StartFormat(15);
    OutString(400,0,USetStr(3041),true);
    OutLongInt(1,"DblVATVIVc",VATVIr.SerNr,true);
    EndFormat;
    StartFormat(15);
    OutString(0,0,VATVIr.VECode,false);
    OutString(80,0,VATVIr.VEName,false);
    OutString(400,0,USetStr(3043),true);
    OutDate(1,0,VATVIr.VIInvDate,true);
    EndFormat;
    StartFormat(15);
    OutString(0,0,USetStr(3044),false);
    OutString(80,0,VATVIr.OKPersons,false);
    OutString(400,0,USetStr(3045),true);
    OutDate(1,0,VATVIr.TransDate,true);
    EndFormat;
    StartFormat(15);
    OutString(0,0,USetStr(3057),false)
    OutString(80,0,VATVIr.RefStr,false);
    OutString(400,0,USetStr(3060),true);
    EndFormat;
    StartFormat(15);
    OutString(0,0,USetStr(3059),false);
    OutString(80,0,VATVIr.InvoiceNr,false);
    EndFormat;
    StartFormat(60);
    EndFormat;
    StartFormat(15);
    OutString(20,0,USetStr(3046),false);
    OutString(60,0,USetStr(3047),false);
    OutString(160,0,USetStr(3048),false);
    OutString(380,0,USetStr(3049),true);
    OutString(460,0,USetStr(3050),true);
    EndFormat;
    StartFormat(2);
    EndFormat;
    for (i = 0 ; i<rwcnt ;i=i+1) begin
      MatRowGet(VATVIr,i,VATVIrw);
      if (VATVIrw.stp==1) then begin
        Accr.AccNumber = VATVIrw.AccNumber;
        Accs = ReadFirstKey("AccNumber",Accr,1,true);
        StartFormat(15);
        temp = "";
        if (nonblank(VATVIrw.Comment)) then begin
            temp = VATVIrw.Comment;
        end else begin
          if (Accs) then begin
            temp = Accr.Comment;
          end;    
        end; 
        if (VATVIrw.ovst<>0) then begin
          OutString(0,0,"O",false);
        end;
        OutString(20,0,VATVIrw.AccNumber,false);//VATVIrw.ovst
        OutString(60,0,VATVIrw.Objects,false);//VATVIrw.ovst
        OutString(160,0,temp,false);//VATVIrw.ovst
        if (VATVIr.InvType!=kInvoiceTypeCredit and VATVIr.InvType!=kInvoiceTypeCreditSpecialSales) then begin
          if (VATVIrw.Sum < 0) then begin  
            VATVIrw.Sum = -VATVIrw.Sum;
            OutVal(460,0,VATVIrw.Sum,M4Val,true);//VATVIrw.ovst
          end else begin
            OutVal(380,0,VATVIrw.Sum,M4Val,true);//VATVIrw.ovst
          end;    
        end;
        if (VATVIr.InvType==kInvoiceTypeCredit or VATVIr.InvType==kInvoiceTypeCreditSpecialSales) then begin
          if (VATVIrw.Sum > 0) then begin  
             OutVal(460,0,VATVIrw.Sum,M4Val,true);//VATVIrw.ovst
          end else begin
            VATVIrw.Sum = -VATVIrw.Sum;
           OutVal(380,0,VATVIrw.Sum,M4Val,true);//VATVIrw.ovst
          end;    
        end;
        OutString(1,0,VATVIrw.VATCode,true);
        EndFormat;
      end;
    end; 
    StartFormat(30);
    EndFormat;
    StartFormat(15);
    OutString(160,0,USetStr(3058),false);
    if (VATVIr.InvType==kInvoiceTypeCredit or VATVIr.InvType==kInvoiceTypeCreditSpecialSales) then begin
      OutVal(380,0,VATVIr.PayVal,M4Val,true);
    end else begin
      OutVal(460,0,VATVIr.PayVal,M4Val,true);
    end;
    EndFormat;
  RETURN;
END;

global
procedure VATVIRn(record RcVc RepSpec)
BEGIN
  record VATVIVc VATVIr;
  Boolean TrHs;
  LongInt afr,ato;
  Boolean testf;
//  Integer MediaPrinter;

/*
  MediaPrinter = 1;
  if ((RepSpec.Media<>MediaPrinter)) then begin
//    Error0(1048);
    goto L99;
  end;
  if (RepSpec.Media==MediaPrinter) then begin
*/
    afr = FirstInRange(RepSpec.f1,20);
    ato = LastInRange(RepSpec.f1,20);
    StartReportJob(USetStr(4161));     
    EndHeader;
    VATVIr.SerNr = afr;
    TrHs = true;
    while (LoopMain(VATVIr,1,TrHs)) begin
      if ((VATVIr.SerNr<=ato) or (ato==-1)) then begin
        testf = true;
        if (RepSpec.OnlyUnprntd==0) then begin
          if (VATVIr.OKFlag<>0) then begin testf = false; end;
        end;  
        if (testf) then begin
          VATVIFormat(VATVIr);
          NewPage(false);
        end;
      end else begin
        TrHs = false;
      end;
    end;
    EndJob;
//  end;
L99:;
  RETURN;
END;
#endif
