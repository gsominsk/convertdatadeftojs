external procedure HT2Per(Date,Date,var string);
external procedure HTNr(Integer,Integer,LongInt,LongInt,var string);

global
procedure AT2MovJRn(record RcVc RepSpec)
begin
  record AT2MovVc AT2Mov;
  Boolean TrHs;
  Boolean testf;
  LongInt frmov,tomov;
  Integer rwcnt; 
  Integer i;
  row AT2MovVc AT2Movrw;   
  string 255 tstr;
  Integer rw;

  frmov = FirstInRange(RepSpec.f1,20);
  tomov =  LastInRange(RepSpec.f1,20);
  StartReportJob(USetStr(8800));
  rw = 1;
  HT2Per(RepSpec.sStartDate,RepSpec.sEndDate,tstr);
  Header(rw,tstr,1);
  rw = rw +1;
  if (nonblank(RepSpec.f1)) then begin
    tstr = USetStr(8810);
    tstr = tstr & " ";
    tstr = tstr & RepSpec.f1;
    Header(rw,tstr,1);
    rw = rw + 1;
  end; 
   if (nonblank(RepSpec.FirstAcc)) then begin
    tstr = USetStr(8801);
    tstr = tstr & " ";
    tstr = tstr & RepSpec.FirstAcc;
    Header(rw,tstr,1);
    rw = rw + 1;
  end;  
  if (RepSpec.ArtMode==1) then begin
     tstr = USetStr(6667);
     Header(rw,tstr,1);
     rw = rw + 1;
  end;
  if (RepSpec.ArtMode==0) then begin
     tstr = USetStr(6671);
     Header(rw,tstr,1);
     rw = rw + 1;
  end;
  EndHeader;
  StartFormat(15);
   OutString(0,0,USetStr(8802),false);
   OutString(60,0,USetStr(8806),false);
   OutString(130,0,USetStr(8803),false);
   OutString(190,0,USetStr(8804),false);
   OutString(240,0,USetStr(8805),false);
  EndFormat;  
  Black_Divider(0,1);   
  TrHs = true;
  AT2Mov.SerNr = frmov;
  while (LoopKey("SerNr",AT2Mov,1,TrHs)) begin
    testf=true;
    if (frmov<>-1) then begin
      if (AT2Mov.SerNr>tomov) then begin
        TrHs = false;
      end;
    end; 
    if (TrHs) then begin
      if (nonblankdate(RepSpec.sStartDate)) then begin
        if (RepSpec.sStartDate>AT2Mov.TransDate) then begin
          testf = false;
        end;
        if (RepSpec.sEndDate<AT2Mov.TransDate) then begin
         testf = false;
        end;
      end;
      if (nonblank(RepSpec.FirstAcc)) then begin
        if (AT2Mov.DepFrom<>RepSpec.FirstAcc) then begin
           testf = false; 
        end;  
      end; 
      if (nonblank(RepSpec.LastAcc)) then begin
        if (AT2Mov.DepTo>RepSpec.LastAcc) then begin
           testf = false; 
        end;
      end;     
      if (nonblank(RepSpec.f1)) then begin
        if (AT2Mov.SerNr>tomov) then begin
          testf = false;
        end;
      end;
         
      if (testf) then begin
       StartFormat(15);
         OutString(0,0,AT2Mov.SerNr,false);
         OutDate(60,0,AT2Mov.TransDate,false);
         OutString(130,0,AT2Mov.DepFrom,false);
         OutString(190,0,AT2Mov.DepTo,false);
         OutString(240,0,AT2Mov.Comment,false);
       EndFormat;
       if (RepSpec.ArtMode==1) then begin
         StartFormat(5);
         EndFormat;
         rwcnt = MatRowCnt(AT2Mov);
         if (rwcnt<1) then begin
           Black_Divider(0,1);
         end; 
         if (rwcnt>0) then begin 
           Gray_Divider(30,1)
           StartFormat(20);
             OutString(30,0,USetStr(8807),false);
             OutString(110,0,USetStr(8808),false);
             OutString(180,0,USetStr(8809),false);
           EndFormat;
           for (i = 0; i < rwcnt; i = i + 1) begin
             MatRowGet(AT2Mov,i,AT2Movrw);
             StartFormat(15);
               OutString(30,0,AT2Movrw.AT2Code,false);
               OutString(110,0,AT2Movrw.InventoryNr,false);
               OutString(180,0,AT2Movrw.Description,false);
             EndFormat;
           end; 
          Black_Divider(0,1); 
          end;
        end;
      end;      
    end;      
  end;   
  EndJob;
  return;
end;
