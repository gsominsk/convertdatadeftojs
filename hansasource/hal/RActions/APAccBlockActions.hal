external function Boolean IsControlAccount(string,Boolean,Boolean);
external function Boolean VATCodeExists(string);

global
function LongInt APAccBlockCheck(var record APAccBlock APAccr,record APAccBlock APAcc2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;
  record AccVc Accr;

  res = 0;     
  if (nonblank(APAccr.APAcc)) then begin
    Accr.AccNumber = APAccr.APAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.APAcc,-1,"APAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (IsControlAccount(APAccr.APAcc,false,true)==false) then begin
    RecordCheckError(1082,"",-1,"APAcc");      
    res = -1; 
    goto LAPAccBlockCheck;
  end;
  if (nonblank(APAccr.PCredAcc)) then begin
    Accr.AccNumber = APAccr.PCredAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.PCredAcc,-1,"PCredAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.PERebAcc)) then begin
    Accr.AccNumber = APAccr.PERebAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.PERebAcc,-1,"PERebAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.EUPERebAcc)) then begin
    Accr.AccNumber = APAccr.EUPERebAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.EUPERebAcc,-1,"EUPERebAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.ExpPERebAcc)) then begin
    Accr.AccNumber = APAccr.ExpPERebAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.ExpPERebAcc,-1,"ExpPERebAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.PVATBAcc)) then begin
    Accr.AccNumber = APAccr.PVATBAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.PVATBAcc,-1,"PVATBAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.CashAcc)) then begin
    Accr.AccNumber = APAccr.CashAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.CashAcc,-1,"CashAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.VATAcc)) then begin
    Accr.AccNumber = APAccr.VATAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.VATAcc,-1,"VATAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.ExtraCostAcc)) then begin
    Accr.AccNumber = APAccr.ExtraCostAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.ExtraCostAcc,-1,"ExtraCostAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.RateGainAcc)) then begin
    Accr.AccNumber = APAccr.RateGainAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.RateGainAcc,-1,"RateGainAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.RateLossAcc)) then begin
    Accr.AccNumber = APAccr.RateLossAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.RateLossAcc,-1,"RateLossAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.RateRndOffAcc)) then begin
    Accr.AccNumber = APAccr.RateRndOffAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.RateRndOffAcc,-1,"RateRndOffAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;  
  if (nonblank(APAccr.EUVATBAcc)) then begin
    Accr.AccNumber = APAccr.EUVATBAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.EUVATBAcc,-1,"EUVATBAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.OnAccAcc)) then begin
    Accr.AccNumber = APAccr.OnAccAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.OnAccAcc,-1,"OnAccAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.VATCodeDom)) then begin
    if (VATCodeExists(APAccr.VATCodeDom)==false) then begin
      RecordCheckError(1120,APAccr.VATCodeDom,-1,"VATCodeDom");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.VATCodeEU)) then begin
    if (VATCodeExists(APAccr.VATCodeEU)==false) then begin
      RecordCheckError(1120,APAccr.VATCodeEU,-1,"VATCodeEU");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.VATCodeExp)) then begin
    if (VATCodeExists(APAccr.VATCodeExp)==false) then begin
      RecordCheckError(1120,APAccr.VATCodeExp,-1,"VATCodeExp");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.PrelAPAcc)) then begin
    Accr.AccNumber = APAccr.PrelAPAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.PrelAPAcc,-1,"PrelAPAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.EMURndOffAcc)) then begin
    Accr.AccNumber = APAccr.EMURndOffAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.EMURndOffAcc,-1,"EMURndOffAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.EMUWriteOffAcc)) then begin
    Accr.AccNumber = APAccr.EMUWriteOffAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.EMUWriteOffAcc,-1,"EMUWriteOffAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.CredAcc)) then begin
    Accr.AccNumber = APAccr.CredAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.CredAcc,-1,"CredAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.WriteOffLossAcc)) then begin
    Accr.AccNumber = APAccr.WriteOffLossAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.WriteOffLossAcc,-1,"WriteOffLossAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.OnAccVAT)) then begin
    Accr.AccNumber = APAccr.OnAccVAT;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.OnAccVAT,-1,"OnAccVAT");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
/*  not on the APAccTCLass Window
  if (nonblank(APAccr.PreOPBookVAT)) then begin
    Accr.AccNumber = APAccr.PreOPBookVAT;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.PreOPBookVAT,-1,"PreOPBookVAT");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
*/
  if (nonblank(APAccr.RetainAcc)) then begin
    Accr.AccNumber = APAccr.RetainAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.RetainAcc,-1,"RetainAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.BankRateGainAcc)) then begin
    Accr.AccNumber = APAccr.BankRateGainAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.BankRateGainAcc,-1,"BankRateGainAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
  if (nonblank(APAccr.BankRateLossAcc)) then begin
    Accr.AccNumber = APAccr.BankRateLossAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,APAccr.BankRateLossAcc,-1,"BankRateLossAcc");      
      res = -1;
      goto LAPAccBlockCheck;
    end;
  end;
LAPAccBlockCheck:;
  APAccBlockCheck = res;
  RETURN;
END;
