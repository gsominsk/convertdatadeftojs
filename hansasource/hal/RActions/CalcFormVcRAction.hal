external procedure GetFullCurncyRate (var string,Date,var val,var val,var val,var val,var val);
external procedure B1ToB2Val(val,val,val,var val);


global
function LongInt CalcFormVcRecordImport(var record CalcFormVc CalcFormr,record CalcFormVc CalcForm2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;
  val t,fr,to1,to2,br1,br2;
  string 10 curncy;
  Boolean gBase1ToBase2;
  record ConvMasterBlock cvm;
  row CalcFormVc CalcFormrw;
  Integer i,rwcnt;
      
  BlockLoad(cvm);
  if (cvm.Base1ToBase2Flag!=0) then begin gBase1ToBase2 = true; end;
  if (gBase1ToBase2) then begin
    GetFullCurncyRate(curncy,CurrentDate,fr,to1,to2,br1,br2);
    rwcnt = MatRowCnt(CalcFormr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(CalcFormr,i,CalcFormrw);
      B1ToB2Val(CalcFormrw.From,br1,br2,t);
      CalcFormrw.From = t;
      B1ToB2Val(CalcFormrw.To,br1,br2,t);
      CalcFormrw.To = t;
      B1ToB2Val(CalcFormrw.Amount,br1,br2,t);
      CalcFormrw.Amount = t;
      MatRowPut(CalcFormr,i,CalcFormrw);
    end;
  end;
  CalcFormVcRecordImport = res;
  RETURN;
END;

global
function LongInt WHCalcFormVcRecordDefaults(var record WHCalcFormVc WHCalcFormr,record WHCalcFormVc WHCalcForm2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;

  WHCalcFormr.BaseCalcVAT = 1;
  WHCalcFormr.BaseCalcNet = 1;
  WHCalcFormr.BaseCalcExTax = 1;
  WHCalcFormVcRecordDefaults = res; 
  RETURN;
END;

global
function LongInt WHCalcFormVcRecordImport(var record WHCalcFormVc WHCalcFormr,record WHCalcFormVc WHCalcForm2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;
  val t,fr,to1,to2,br1,br2;
  string 10 curncy;
  Boolean gBase1ToBase2;
  record ConvMasterBlock cvm;
  row WHCalcFormVc WHCalcFormrw;
  Integer i,rwcnt;
      
  BlockLoad(cvm);
  if (cvm.Base1ToBase2Flag!=0) then begin gBase1ToBase2 = true; end;
  if (gBase1ToBase2) then begin
    GetFullCurncyRate(curncy,CurrentDate,fr,to1,to2,br1,br2);
    B1ToB2Val(WHCalcFormr.MinAmount,br1,br2,t);
    WHCalcFormr.MinAmount = t;
    B1ToB2Val(WHCalcFormr.NoTaxAmount,br1,br2,t);
    WHCalcFormr.NoTaxAmount = t;
    rwcnt = MatRowCnt(WHCalcFormr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(WHCalcFormr,i,WHCalcFormrw);
      B1ToB2Val(WHCalcFormrw.From,br1,br2,t);
      WHCalcFormrw.From = t;
      B1ToB2Val(WHCalcFormrw.To,br1,br2,t);
      WHCalcFormrw.To = t;
      B1ToB2Val(WHCalcFormrw.FixAmount,br1,br2,t);
      WHCalcFormrw.FixAmount = t;
      B1ToB2Val(WHCalcFormrw.MinAmount,br1,br2,t);
      WHCalcFormrw.MinAmount = t;
      B1ToB2Val(WHCalcFormrw.BaseAmount,br1,br2,t);
      WHCalcFormrw.BaseAmount = t;
      MatRowPut(WHCalcFormr,i,WHCalcFormrw);
    end;
  end;
  WHCalcFormVcRecordImport = res;
  RETURN;
END;
