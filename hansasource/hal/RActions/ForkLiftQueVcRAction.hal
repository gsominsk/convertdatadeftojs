global
updating procedure UpdateNT7000NumbBlock(string location,Integer QueType,Boolean negf,string ForkLiftSystemID,LongInt flqnr)
BEGIN
  record LocationVc Locr;
  record NT7000NumbersVc NTNr;
  record NT7000NumbersVc oldNTNr;
  record ForkLiftQueVc oldForkLiftQuer;

  Locr.Code = location;
  ReadFirstMain(Locr,1,true);
  if (Locr.WHMForkLiftSystem==2) then begin
    if (QueType==0) then begin
      goto LUpdateNT7000NumbBlock;
    end;
  end;
  oldForkLiftQuer.ForkLiftSystemID = ForkLiftSystemID;
  if (ReadLastKey("ForkLiftSystemID",oldForkLiftQuer,1,true)) then begin 
    if (flqnr!=oldForkLiftQuer.SerNr) then begin 
      goto LUpdateNT7000NumbBlock;
    end;
  end;  
  NTNr.Location = location;
  ReadFirstMain(NTNr,1,true);
  RecordCopy(oldNTNr,NTNr);
  if (negf==false) then begin
    NTNr.OrdSentToNT7000 = NTNr.OrdSentToNT7000 + 1;
    if (NTNr.OrdSentToNT7000<0) then begin NTNr.OrdSentToNT7000 = 0; end;
    RecordUpdate(oldNTNr,NTNr,true);
  end else begin
    NTNr.OrdSentToNT7000 = NTNr.OrdSentToNT7000 - 1;
    if (NTNr.OrdSentToNT7000>=0) then begin 
      RecordUpdate(oldNTNr,NTNr,true);
    end;
  end;
LUpdateNT7000NumbBlock:;  
  RETURN;
END;

global
updating function LongInt  ForkLiftQueVcRecordUpdateAfter(var record ForkLiftQueVc ForkLiftQuer,record ForkLiftQueVc ForkLiftQue2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;

  if ((ForkLiftQuer.Status==1) or (ForkLiftQuer.Status==2)) and (ForkLiftQue2r.Status==0) then begin
    UpdateNT7000NumbBlock(ForkLiftQuer.FrLocation,ForkLiftQuer.QueType,false,ForkLiftQuer.ForkLiftSystemID,ForkLiftQuer.SerNr);
  end;
  if (ForkLiftQuer.Status==3) and (ForkLiftQue2r.Status==2) then begin
    UpdateNT7000NumbBlock(ForkLiftQuer.FrLocation,ForkLiftQuer.QueType,true,ForkLiftQuer.ForkLiftSystemID,ForkLiftQuer.SerNr);
  end;
  if (ForkLiftQuer.Status==0) and (ForkLiftQue2r.Status==1) then begin
    UpdateNT7000NumbBlock(ForkLiftQuer.FrLocation,ForkLiftQuer.QueType,true,ForkLiftQuer.ForkLiftSystemID,ForkLiftQuer.SerNr);
  end;
  ForkLiftQueVcRecordUpdateAfter = res; 
  RETURN;
END;

global
updating function LongInt  ForkLiftQueVcRecordRemoveAfter(var record ForkLiftQueVc ForkLiftQuer,record ForkLiftQueVc ForkLiftQue2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;

  UpdateNT7000NumbBlock(ForkLiftQuer.FrLocation,ForkLiftQuer.QueType,true,ForkLiftQuer.ForkLiftSystemID,ForkLiftQuer.SerNr);
  ForkLiftQueVcRecordRemoveAfter = res; 
  RETURN;
END;
