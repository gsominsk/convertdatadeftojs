external function Boolean IsControlAccount(string,Boolean,Boolean);
external function Boolean VATCodeExists(string);

global
updating function LongInt AccBlockCheck(var record AccBlock AccRec,record AccBlock AccRec2,LongInt stat,LongInt long4)
BEGIN
  LongInt res;
  record AccVc Accr;  

  res = 0; 
/*
it is in another place   now
  if (AccRec.TotalwoTAX!=0) then begin
    if (AccRec.BasePriceInclVAT==1) then begin
      RecordCheckError(20939,"",-1,"VATBAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.ARAcc)) then begin
    Accr.AccNumber = AccRec.ARAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.ARAcc,-1,"ARAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
    if (IsControlAccount(AccRec.ARAcc,true,true)==false) then begin
      RecordCheckError(1082,"",-1,"ARAcc");      
      res = -1; 
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.RndAcc)) then begin
    Accr.AccNumber = AccRec.RndAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.RndAcc,-1,"RndAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.RndLossAcc)) then begin
    Accr.AccNumber = AccRec.RndLossAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.RndLossAcc,-1,"RndLossAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.CredAcc)) then begin
    Accr.AccNumber = AccRec.CredAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.CredAcc,-1,"CredAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.WriteOffLossAcc)) then begin
    Accr.AccNumber = AccRec.WriteOffLossAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.WriteOffLossAcc,-1,"WriteOffLossAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.ERebAcc)) then begin
    Accr.AccNumber = AccRec.ERebAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.ERebAcc,-1,"ERebAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.EUERebAcc)) then begin
    Accr.AccNumber = AccRec.EUERebAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.EUERebAcc,-1,"EUERebAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.ExpERebAcc)) then begin
    Accr.AccNumber = AccRec.ExpERebAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.ExpERebAcc,-1,"ExpERebAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.VATBAcc)) then begin
    Accr.AccNumber = AccRec.VATBAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.VATBAcc,-1,"VATBAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.CashAcc)) then begin
    Accr.AccNumber = AccRec.CashAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.CashAcc,-1,"CashAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.VATERAcc)) then begin
    Accr.AccNumber = AccRec.VATERAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.VATERAcc,-1,"VATERAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;  
  if (nonblank(AccRec.ExtraCostAcc)) then begin
    Accr.AccNumber = AccRec.ExtraCostAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.ExtraCostAcc,-1,"ExtraCostAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.RateGainAcc)) then begin
    Accr.AccNumber = AccRec.RateGainAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.RateGainAcc,-1,"RateGainAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.RateLossAcc)) then begin
    Accr.AccNumber = AccRec.RateLossAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.RateLossAcc,-1,"RateLossAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.RateRndOffAcc)) then begin
    Accr.AccNumber = AccRec.RateRndOffAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.RateRndOffAcc,-1,"RateRndOffAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.StockAcc)) then begin
    Accr.AccNumber = AccRec.StockAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.StockAcc,-1,"StockAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.PurchAcc)) then begin
    Accr.AccNumber = AccRec.PurchAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.PurchAcc,-1,"PurchAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.StockCostAcc)) then begin
    Accr.AccNumber = AccRec.StockCostAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.StockCostAcc,-1,"StockCostAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.DomSalesAcc)) then begin
    Accr.AccNumber = AccRec.DomSalesAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.DomSalesAcc,-1,"DomSalesAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.EUSalesAcc)) then begin
    Accr.AccNumber = AccRec.EUSalesAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.EUSalesAcc,-1,"EUSalesAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.ExpSalesAcc)) then begin
    Accr.AccNumber = AccRec.ExpSalesAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.ExpSalesAcc,-1,"ExpSalesAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.OnAccAcc)) then begin
    Accr.AccNumber = AccRec.OnAccAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.OnAccAcc,-1,"OnAccAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.VATCodeDom)) then begin
    if (VATCodeExists(AccRec.VATCodeDom)==false) then begin
      RecordCheckError(1120,AccRec.VATCodeDom,-1,"VATCodeDom");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.VATCodeEU)) then begin
    if (VATCodeExists(AccRec.VATCodeEU)==false) then begin
      RecordCheckError(1120,AccRec.VATCodeEU,-1,"VATCodeEU");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.VATCodeExp)) then begin
    if (VATCodeExists(AccRec.VATCodeExp)==false) then begin
      RecordCheckError(1120,AccRec.VATCodeExp,-1,"VATCodeExp");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;  
  if (nonblank(AccRec.StockGainAcc)) then begin
    Accr.AccNumber = AccRec.StockGainAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.StockGainAcc,-1,"StockGainAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.PUExtraAcc)) then begin
    Accr.AccNumber = AccRec.PUExtraAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.PUExtraAcc,-1,"PUExtraAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.PUFreightAcc)) then begin
    Accr.AccNumber = AccRec.PUFreightAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.PUFreightAcc,-1,"PUFreightAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.PUCustomsAcc)) then begin
    Accr.AccNumber = AccRec.PUCustomsAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.PUCustomsAcc,-1,"PUCustomsAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.OnAccVATAcc)) then begin
    Accr.AccNumber = AccRec.OnAccVATAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.OnAccVATAcc,-1,"OnAccVATAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.ReturnedAcc)) then begin
    Accr.AccNumber = AccRec.ReturnedAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.ReturnedAcc,-1,"ReturnedAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.EMURndOffAcc)) then begin
    Accr.AccNumber = AccRec.EMURndOffAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.EMURndOffAcc,-1,"EMURndOffAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.EMUWriteOffAcc)) then begin
    Accr.AccNumber = AccRec.EMUWriteOffAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.EMUWriteOffAcc,-1,"EMUWriteOffAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.BaseRoundOffAcc)) then begin
    Accr.AccNumber = AccRec.BaseRoundOffAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.BaseRoundOffAcc,-1,"BaseRoundOffAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end else begin
//CheckTrans uses this account if diffrence in 2nd base currency
//if this is blank we have nonbalanced transaction
    RecordCheckError(20027,"",-1,"BaseRoundOffAcc");      
    res = -1;
    goto LAccBlockCheck;
  end;
  if (nonblank(AccRec.ProdICostAcc)) then begin
    Accr.AccNumber = AccRec.ProdICostAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.ProdICostAcc,-1,"ProdICostAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.ProdWCostAcc)) then begin
    Accr.AccNumber = AccRec.ProdWCostAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.ProdWCostAcc,-1,"ProdWCostAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.CashBackAcc)) then begin
    Accr.AccNumber = AccRec.CashBackAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.CashBackAcc,-1,"CashBackAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.CommisionAcc)) then begin
    Accr.AccNumber = AccRec.CommisionAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.CommisionAcc,-1,"CommisionAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.PUCost1)) then begin
    Accr.AccNumber = AccRec.PUCost1;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.PUCost1,-1,"PUCost1");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.PUCost2)) then begin
    Accr.AccNumber = AccRec.PUCost2;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.PUCost2,-1,"PUCost2");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.PUCost3)) then begin
    Accr.AccNumber = AccRec.PUCost3;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.PUCost3,-1,"PUCost3");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.PUCost4)) then begin
    Accr.AccNumber = AccRec.PUCost4;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.PUCost4,-1,"PUCost4");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.PUCost5)) then begin
    Accr.AccNumber = AccRec.PUCost5;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.PUCost5,-1,"PUCost5");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.SalesVAT)) then begin
    Accr.AccNumber = AccRec.SalesVAT;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.SalesVAT,-1,"SalesVAT");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.SalesTAX)) then begin
    Accr.AccNumber = AccRec.SalesTAX;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.SalesTAX,-1,"SalesTAX");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.BadARAcc)) then begin
    Accr.AccNumber = AccRec.BadARAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.BadARAcc,-1,"BadARAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;  
  if (nonblank(AccRec.CredDomSalesAcc)) then begin
    Accr.AccNumber = AccRec.CredDomSalesAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.CredDomSalesAcc,-1,"CredDomSalesAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.CredEUSalesAcc)) then begin
    Accr.AccNumber = AccRec.CredEUSalesAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.CredEUSalesAcc,-1,"CredEUSalesAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.CredExpSalesAcc)) then begin
    Accr.AccNumber = AccRec.CredExpSalesAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.CredExpSalesAcc,-1,"CredExpSalesAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.CredVATCodeDom)) then begin
    if (VATCodeExists(AccRec.CredVATCodeDom)==false) then begin
      RecordCheckError(1120,AccRec.CredVATCodeDom,-1,"CredVATCodeDom");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;  
  if (nonblank(AccRec.CredVATCodeEU)) then begin
    if (VATCodeExists(AccRec.CredVATCodeEU)==false) then begin
      RecordCheckError(1120,AccRec.CredVATCodeEU,-1,"CredVATCodeEU");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;  
  if (nonblank(AccRec.CredVATCodeExp)) then begin
    if (VATCodeExists(AccRec.CredVATCodeExp)==false) then begin
      RecordCheckError(1120,AccRec.CredVATCodeExp,-1,"CredVATCodeExp");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;  
  if (nonblank(AccRec.INTransferAcc)) then begin
    Accr.AccNumber = AccRec.INTransferAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.INTransferAcc,-1,"INTransferAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.BankRateGainAcc)) then begin
    Accr.AccNumber = AccRec.BankRateGainAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.BankRateGainAcc,-1,"BankRateGainAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.BankRateLossAcc)) then begin
    Accr.AccNumber = AccRec.BankRateLossAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.BankRateLossAcc,-1,"BankRateLossAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
  if (nonblank(AccRec.PreIPVATAcc)) then begin
    Accr.AccNumber = AccRec.PreIPVATAcc;
    if (ReadFirstMain(Accr,1,true)==false) then begin
      RecordCheckError(1007,AccRec.PreIPVATAcc,-1,"PreIPVATAcc");      
      res = -1;
      goto LAccBlockCheck;
    end;
  end;
*/  
LAccBlockCheck:;
  AccBlockCheck = res;
  RETURN;
END;
