external procedure ExtractObjWithSeparator(string,string,Boolean,var Integer,var string);

global
function LongInt VARVcRecordCheck(var record VARVc VARr,record VARVcVc VAR2r,LongInt stat,LongInt long4)
begin
  LongInt res;
  string 255 tstr;
  
  res = 0;
  if blank(VARr.Code) then begin
    RecordCheckError(1959,"",-1,"Code");
    res = -1;
    goto LVARVcRecordCheck;
  end;  
LVARVcRecordCheck:;
  VARVcRecordCheck = res;
  return;
end;

function Boolean ItemHistVcExists(string variety)
begin
  Boolean res,found,testf,loopf;
  record ItemHistVc IHr;
  Integer pos;
  string 255 tstr;

  if (res==false) then begin
    found = true;
    ResetLoop(IHr);
    IHr.FileName = "PUVc";
    while (LoopKey("FNTransNr",IHr,1,found)) begin
      if (IHr.FileName!="PUVc") then begin found = false; end;
      if (found) then begin
        testf = true;
        if (blank(IHr.Variety)) then begin testf = false; end;
        if (testf) then begin
          testf = false;
          loopf = true;
          pos = 0;
          ExtractObjWithSeparator(".",IHr.Variety,true,pos,tstr);
          while (loopf) begin
            if (tstr==variety) then begin
              testf = true;
            end;
            ExtractObjWithSeparator(".",IHr.Variety,true,pos,tstr);
            if (blank(tstr)) then begin loopf = false; end;
            if (testf) then begin loopf = false; end;
          end;
        end;       
        if (testf) then begin
          res = true;
          goto LItemHistVcExists;
        end;
      end;
    end;
  end;
  if (res==false) then begin
    found = true;
    ResetLoop(IHr);
    IHr.FileName = "ProdVc";
    while (LoopKey("FNTransNr",IHr,1,found)) begin
      if (IHr.FileName!="ProdVc") then begin found = false; end;
      if (found) then begin
        testf = true;
        if (blank(IHr.Variety)) then begin testf = false; end;
        if (testf) then begin
          testf = false;
          loopf = true;
          pos = 0;
          ExtractObjWithSeparator(".",IHr.Variety,true,pos,tstr);
          while (loopf) begin
            if (tstr==variety) then begin
              testf = true;
            end;
            ExtractObjWithSeparator(".",IHr.Variety,true,pos,tstr);
            if (blank(tstr)) then begin loopf = false; end;
            if (testf) then begin loopf = false; end;
          end;
        end;       
        if (testf) then begin
          res = true;
          goto LItemHistVcExists;
        end;
      end;
    end;
  end;
LItemHistVcExists:;  
  ItemHistVcExists = res; 
  return;
end;

global
function LongInt VARVcRecordRemoveTest(var record VARVc VARr,record VARVc VAR2r,LongInt long3,LongInt long4)
begin
  LongInt res;
  Boolean testf;

  res = 1;
  testf = ItemHistVcExists(VARr.Code);
  if (testf) then begin
    if (long3>0) then begin MessageBox(1122,""); end;
    res = 0;
  end;
LVARVcRecordRemoveTest:;
  VARVcRecordRemoveTest = res; 
  return;
end;
