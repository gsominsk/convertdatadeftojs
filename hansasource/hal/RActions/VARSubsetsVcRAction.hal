external procedure NextM4Number(string,var string);
external function LongInt CheckVarieties(string,var string);

global
function LongInt VARSubsetsVcRecordCheck(var record VARSubsetsVc VARSubsetsr,record VARSubsetsVc VARSubsets2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;
  string 255 tstr;
  
  res = 0;
  if blank(VARSubsetsr.Code) then begin
    RecordCheckError(1959,"",-1,"Code");
    res = -1;
    goto LIVARSubsetsVcRecordCheck;
  end;  
  if blank(VARSubsetsr.Subset) then begin
    RecordCheckError(1959,"",-1,"Subset");
    res = -1;
    goto LIVARSubsetsVcRecordCheck;
  end;  
  if (nonblank(VARSubsetsr.Subset)) then begin
    res = CheckVarieties(VARSubsetsr.Subset,tstr);
    if (res!=0) then begin
      RecordCheckError(res," " & tstr,-1,"Subset");      
      res = -1; 
      goto LIVARSubsetsVcRecordCheck;
    end;
  end;
LIVARSubsetsVcRecordCheck:;
  VARSubsetsVcRecordCheck = res;
  RETURN;
END;

global
updating function LongInt VARSubsetsVcRecordImport(var record VARSubsetsVc VARSubsetsr,record VARSubsetsVc VARSubsets2r,LongInt long3,LongInt long4)
begin
  LongInt res;
  transaction string 255 gVARSubsetCodeonImport;
  
  if (blank(VARSubsetsr.Code)) then begin
    if (blank(gVARSubsetCodeonImport)) then begin
      VARSubsetsr.Code = "1";
    end else begin
      NextM4Number(gVARSubsetCodeonImport,VARSubsetsr.Code);
    end;
    gVARSubsetCodeonImport = VARSubsetsr.Code;
//    FixRLinks(); !!!
  end;
  VARSubsetsVcRecordImport = res;
  return;
end;
