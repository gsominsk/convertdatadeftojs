global
function LongInt HCUAVcRecordInIndex(record HCUAVc HCUAr,string indexname)
begin
  LongInt res;
  
  res = 1;
  if (HCUAr.Closed!=0) then begin 
    if (indexname=="ActCUCode") then begin res = 0; end;
  end;
  HCUAVcRecordInIndex = res;
  return;
end;  

global
function LongInt HCUAVcRecordCheck(record HCUAVc HCUAr,record HCUAVc oHCUAr,LongInt stat,LongInt long4)
begin
  LongInt res;
  record ResLocVc ResLocr;
  record ResTypeVc ResTyper;
  record ScheduleRuleVc Scheduler;
  record CUVc CUr;
  record HCUAVc lHCUAr;
  row HCUAVc HCUArw;
  Integer i,rwcnt;
  Boolean found,testf;
      
  res = 0;
  if (blank(HCUAr.CUCode)) then begin
    RecordCheckError(1120,"",-1,"CUCode");      
    res = -1; 
    goto LHCUAVcRecordCheck;
  end;  
  if (blankdate(HCUAr.StartDate)) then begin
    RecordCheckError(1120,"",-1,"StartDate");      
    res = -1; 
    goto LHCUAVcRecordCheck;
  end;  
  if (nonblankdate(HCUAr.EndDate)) then begin
    if (HCUAr.StartDate>HCUAr.EndDate) then begin
      RecordCheckError(2246,"",-1,"EndDate");      
      res = -1; 
      goto LHCUAVcRecordCheck;     
    end;
  end;
  found = true;
  lHCUAr.CUCode = HCUAr.CUCode;
  while (LoopKey("ActCUCode",lHCUAr,1,found)) begin
    if (lHCUAr.CUCode!=HCUAr.CUCode) then begin found = false; end;
    if (found) then begin
      testf = true;
      switch (stat) begin
        case Rs_update:
          if ((lHCUAr.StartDate==oHCUAr.StartDate) and (lHCUAr.EndDate==oHCUAr.EndDate)) then begin 
            if ((HCUAr.StartDate==oHCUAr.StartDate) and (HCUAr.EndDate==oHCUAr.EndDate)) then begin 
              testf = false; 
            end;
          end;
      end;
      if (testf) then begin
        if (DateInRange(HCUAr.StartDate,lHCUAr.StartDate,lHCUAr.EndDate)) then begin
          RecordCheckError(20159,"",-1,"StartDate");      
          res = -1; 
          goto LHCUAVcRecordCheck;     
        end;  
        if (DateInRange(HCUAr.EndDate,lHCUAr.StartDate,lHCUAr.EndDate)) then begin
          RecordCheckError(20159,"",-1,"StartDate");      
          res = -1; 
          goto LHCUAVcRecordCheck;     
        end;  
        if (HCUAr.StartDate<lHCUAr.StartDate) and (HCUAr.EndDate>lHCUAr.EndDate) then begin
          RecordCheckError(20159,"",-1,"StartDate");      
          res = -1; 
          goto LHCUAVcRecordCheck;     
        end;
        if (lHCUAr.StartDate<HCUAr.StartDate) and (lHCUAr.EndDate>HCUAr.EndDate) then begin
          RecordCheckError(20159,"",-1,"StartDate");      
          res = -1; 
          goto LHCUAVcRecordCheck;     
        end;
      end;
    end;
  end;    
  CUr.Code = HCUAr.CUCode;
  if (ReadFIrstMain(CUr,1,true)==false) then begin
    RecordCheckError(20859,"",-1,"CUCode");
    res = -1;
    goto LHCUAVcRecordCheck;
  end;
  rwcnt = MatRowCnt(HCUAr);
  for (i=0;i<rwcnt;i=i+1) begin
    MatRowGet(HCUAr,i,HCUArw);
    ResTyper.Code = HCUArw.ResType;
    if (ReadFIrstMain(ResTyper,1,true)==false) then begin
      RecordCheckError(1290,"",i,"ResType");
      res = -1;
      goto LHCUAVcRecordCheck;
    end;
    Scheduler.Code = HCUArw.ScheduleRule;
    if (ReadFIrstMain(Scheduler,1,true)==false) then begin
      RecordCheckError(1290,"",i,"ScheduleRule");
      res = -1;
      goto LHCUAVcRecordCheck;
    end;
    if (nonblank(HCUArw.ResLoc)) then begin
      ResLocr.Code = HCUArw.ResLoc;
      if (ReadFIrstMain(ResLocr,1,true)==false) then begin
        RecordCheckError(1290,"",i,"ResLoc");
        res = -1;
        goto LHCUAVcRecordCheck;
      end;
    end;
  end;
LHCUAVcRecordCheck:;  
  HCUAVcRecordCheck = res;
  return;
end;  
