function LongInt CorrectSettingInCompany(string compcode)
begin
  LongInt res;
  Integer i,rwcnt;
  record DaughterCompBlock DCb;
  row DaughterCompBlock DCbrw;
  Integer oldcomp;
  
  res = 0;
  oldcomp = CurrentCompany;
  if (SetCompanyCode(compcode,false)) then begin
    BlockLoad(DCb);
    rwcnt = MatRowCnt(DCb);
    for (i=0; i<rwcnt;i=i+1) begin
      MatRowGet(DCb,i,DCbrw);
      if (StringToInt(DCbrw.CompCode)==oldcomp) then begin
        res = 2246;
        goto LCorrectSettingInCompany;        
      end;
    end;
  end else begin
    res = 2246;
  end;
LCorrectSettingInCompany:;  
  ResetCompany(oldcomp);
  CorrectSettingInCompany = res;
  return;
end;

global
function LongInt DaughterCompBlockCheck(var record DaughterCompBlock DCb,record DaughterCompBlock DC2b,LongInt stat,LongInt long4)
begin
  LongInt res;
  Integer i,rwcnt,err;
  row DaughterCompBlock DCbrw;
  
  res = 0;
  rwcnt = MatRowCnt(DCb);
  for (i=0; i<rwcnt;i=i+1) begin
    MatRowGet(DCb,i,DCbrw);
    if (StringToInt(DCbrw.CompCode)==CurrentCompany) then begin
      RecordCheckError(2246,"",i,"CompCode");   
      res = -1;
      goto LDaughterCompBlockCheck;        
    end;
    err = CorrectSettingInCompany(DCbrw.CompCode);
    if (err!=0) then begin
      RecordCheckError(err,"",i,"CompCode");   
      res = -1;
      goto LDaughterCompBlockCheck;        
    end;
  end;  
LDaughterCompBlockCheck:;  
  DaughterCompBlockCheck = res;
  return;
end;
