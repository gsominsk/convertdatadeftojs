external procedure FindCurMailboxName(var string);
external function Boolean FindUserInMailbox(string,var string,var LongInt);

global
function LongInt LocalMailVcRecordInIndex(record LocalMailVc LocalMailr,string indexname)
BEGIN
  LongInt res;
  
  res = 1;
  if (LocalMailr.copyf==0) then begin 
    if (indexname=="Copy")  then begin res = 0; end;
  end;
  if (LocalMailr.copyf!=0) then begin 
    if (indexname=="UserSerNr")  then begin res = 0; end;
    if (indexname=="UserSubject")  then begin res = 0; end;
    if (indexname=="UserTime")  then begin res = 0; end;
  end;
  LocalMailVcRecordInIndex = res;
  RETURN;
END;

global
function LongInt LocalMailVcRecordDefaults(var record LocalMailVc LocalMailr,record LocalMailVc LocalMail2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;
  row LocalMailVc marw;
  string 255 tstr;
  
  LocalMailr.SerNr = -1;
  LocalMailr.seqnr = -1;

  ClearRow(LocalMailr,marw,1);
  marw.RowTyp = 1;
  FindCurMailboxName(tstr);
  marw.AddrCode = tstr;
  MatRowPut(LocalMailr,0,marw);
  LocalMailVcRecordDefaults = res; 
  RETURN;
END;

global
function LongInt LocalMailVcRecordDuplicate(var record LocalMailVc LocalMailr,record LocalMailVc LocalMail2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;
  
  LocalMailr.SerNr = -1;
  LocalMailr.seqnr = -1;
  
  LocalMailVcRecordDuplicate = res; 
  RETURN;
END;

updating procedure SaveCopyMail(record LocalMailVc mailp)
BEGIN
  record LocalMailVc copymailp;
  
  RecordCopy(copymailp,mailp);
  copymailp.copyf = 1;
  if (RecordStore(copymailp,false)) then begin end;
  RETURN;
END;

global
updating function LongInt LocalMailVcRecordUpdate(var record LocalMailVc LocalMailr,record LocalMailVc LocalMail2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;

  if (LocalMailr.seqnr>0) then begin
    SaveCopyMail(LocalMail2r);
  end;
  LocalMailr.TransDate = CurrentDate;
  LocalMailr.TransTime = CurrentTime;
  LocalMailVcRecordUpdate = res;
  RETURN;
END;

global
function LongInt LocalMailVcRecordSave(var record LocalMailVc LocalMailr,record LocalMailVc LocalMail2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;

  if (LocalMailr.SerNr==-1) then begin
    LocalMailr.SerNr = NextSerNr("LocalMailVc",CurrentDate,-1,false,"");      
  end;
  LocalMailVcRecordSave = res;
  RETURN;
END;

