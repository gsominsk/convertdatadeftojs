global
function LongInt CredManEventVcRecordRemoveTest(var record CredManEventVc CredManEventr,record CredManEventVc CredManEvent2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;

  res = 1;
  if (CredManEventr.RecordNr>0) then begin
    res = 0;
  end;
  CredManEventVcRecordRemoveTest = res;
  return;
END;

global
updating function LongInt CredManEventVcRecordRemove(var record CredManEventVc CredManEventr,record CredManEventVc CredManEvent2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;
  record CredManVc CredManr;
  record CredManVc oldCredManr;
  row CredManVc CredManrw;
  row CredManEventVc CredManEventrw;
  Boolean savef;
  Integer ei,erwcnt;
  Integer i,rwcnt;
  val blv;
  
  CredManr.SerNr = CredManEventr.CredManNr;
  if (ReadFirstMain(CredManr,1,true)) then begin
    savef = false;
    RecordCopy(oldCredManr,CredManr);
    erwcnt = MatRowCnt(CredManEventr);
    rwcnt = MatRowCnt(CredManr);
    for (ei=0;ei<erwcnt;ei=ei+1) begin
      MatRowGet(CredManEventr,ei,CredManEventrw);
      for (i=0;i<rwcnt;i=i+1) begin
        MatRowGet(CredManr,i,CredManrw);
        if (CredManrw.ArtCode==CredManEventrw.ArtCode and CredManrw.ChargeType==CredManEventrw.ChargeType) then begin
          if (CredManrw.InvoicedOn==-1 and CredManrw.InvoicedSum>=CredManEventrw.Sum) then begin
            CredManrw.InvoicedSum = CredManrw.InvoicedSum - CredManEventrw.Sum;
            if (CredManrw.InvoicedSum==0) then begin
              CredManrw.InvoicedSum = blv;
            end;
            MatRowPut(CredManr,i,CredManrw);
            savef = true;
          end;
        end;
      end;
    end;
  end;
  if (savef) then begin
    if (RecordUpdate(oldCredManr,CredManr,false)==0) then begin
    end;
  end;
  CredManEventVcRecordRemove = res;
  RETURN;
END;

global
function Boolean HasCredManTypeBeenUsed(record CredManTypeVc CredManTyper)
begin
  Boolean res;
  
  res = true;
  HasCredManTypeBeenUsed = res;
  return;
end;

global
function LongInt CredManTypeVcRecordRemoveTest(var record CredManTypeVc CredManTyper,record CredManTypeVc CredManType2r,LongInt stat,LongInt long4)
BEGIN
  LongInt res;

  res = 1;
  if (HasCredManTypeBeenUsed(CredManTyper)) then begin
    res = 0;
  end;
  CredManTypeVcRecordRemoveTest = res;
  return;
END;

