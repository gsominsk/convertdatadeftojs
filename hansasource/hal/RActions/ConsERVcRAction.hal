external procedure GetMaxMinRate(string,var val,var val,var val,var val,var val,var val);
external function Boolean UseOldRate(record BaseCurBlock);
external procedure SwapM4Val(var val,var val);

global
function LongInt ConsERVcRecordDefaults(var record ConsERVc ConsERr,record ConsERVc ConsER2r,LongInt stat,LongInt long4)
begin
  LongInt res;

  ConsERr.Date = CurrentDate;
  ConsERr.PLFrRate = blankval;
  ConsERr.PLToRate1 = blankval;
  ConsERr.PLToRate2 = blankval;
  ConsERr.BalFrRate = blankval;
  ConsERr.BalToRate1 = blankval;
  ConsERr.BalToRate2 = blankval;
  ConsERVcRecordDefaults = res; 
  return;
end;

global
function LongInt ConsERVcRecordDuplicate(var record ConsERVc ConsERr,record ConsERVc ConsER2r,LongInt stat,LongInt long4)
begin
  LongInt res;

  ConsERr.Date = CurrentDate;
  ConsERVcRecordDuplicate = res; 
  return;
end;

global
function LongInt ConsERVcRecordRemoveTest(var record ConsERVc ConsERr,record ConsERVc ConsER2r,LongInt stat,LongInt long4)
begin
  LongInt res;

  res = 1;
  if (ConsERr.Date!=CurrentDate) then begin
    res = 0;
  end;
  ConsERVcRecordRemoveTest = res; 
  return;
end;

global
function LongInt ConsERVcRecordImport(var record ConsERVc ConsERr,record ConsERVc ConsER2r,LongInt stat,LongInt long4)
begin
  LongInt res;
  Boolean gBase1ToBase2;
  record ConvMasterBlock cvm;
  val to1,to2;
      
  BlockLoad(cvm);
  if (cvm.Base1ToBase2Flag!=0) then begin gBase1ToBase2 = true; end;
  if (gBase1ToBase2) then begin
    to1 = ConsERr.PLToRate1;
    to2 = ConsERr.PLToRate2;
    SwapM4Val(to1,to2);
    ConsERr.PLToRate1 = to1;
    ConsERr.PLToRate2 = to2;
    to1 = ConsERr.BalToRate1;
    to2 = ConsERr.BalToRate2;
    SwapM4Val(to1,to2);
    ConsERr.BalToRate1 = to1;
    ConsERr.BalToRate2 = to2;
  end;
  ConsERVcRecordImport = res;
  return;
end;

global
function LongInt ConsERVcRecordCheck(var record ConsERVc ConsERr,record ConsERVc ConsER2r,LongInt stat,LongInt long4)
begin
  LongInt res;
  record CurncyCodeVc ccr;
  val maxfr,maxto1,maxto2;
  val minfr,minto1,minto2;
  record BaseCurBlock bascur;
  Boolean oldrate;
       
  res = 0;     
  BlockLoad(bascur);  
  oldrate = UseOldRate(bascur);
  ccr.CurncyCode = ConsERr.CurncyCode;
  if (ReadFirstMain(ccr,1,true)==false) then begin
    RecordCheckError(1260,"",-1,"CurncyCode");      
    res = -1; 
    goto LConsERVcRecordCheck;
  end;
  if (blankdate(ConsERr.Date)) then begin
    RecordCheckError(1058,"",-1,"Date");      
    res = -1; 
    goto LConsERVcRecordCheck;
  end;
  if (oldrate==false) then begin
    if (ConsERr.PLFrRate==0) then begin
      RecordCheckError(1058,"",-1,"PLFrRate");      
      res = -1; 
      goto LConsERVcRecordCheck;
    end;
    if (ConsERr.BalFrRate==0) then begin
      RecordCheckError(1058,"",-1,"BalFrRate");      
      res = -1; 
      goto LConsERVcRecordCheck;
    end;
  end;
  if ((ConsERr.PLToRate1!=0) and (ConsERr.PLToRate2!=0)) then begin
    RecordCheckError(1259,"",-1,"PLToRate1");      
    res = -1; 
    goto LConsERVcRecordCheck;
  end;
  if ((ConsERr.BalToRate1!=0) and (ConsERr.BalToRate2!=0)) then begin
    RecordCheckError(1259,"",-1,"BalToRate1");      
    res = -1; 
    goto LConsERVcRecordCheck;
  end;
  if ((ConsERr.PLToRate1==0) and (ConsERr.PLToRate2==0)) then begin
    RecordCheckError(1264,"",-1,"PLToRate1");      
    res = -1; 
    goto LConsERVcRecordCheck;
  end;
  if ((ConsERr.BalToRate1==0) and (ConsERr.BalToRate2==0)) then begin
    RecordCheckError(1264,"",-1,"BalToRate1");      
    res = -1; 
    goto LConsERVcRecordCheck;
  end;
  GetMaxMinRate(ccr.CurncyCode,maxfr,maxto1,maxto2,minfr,minto1,minto2);
//  if (oldrate==false) then begin//Why ? 
    if (maxfr!=0) then begin
      if (ConsERr.PLFrRate>maxfr) then begin
        RecordCheckError(1261,"",-1,"PLFrRate");      
        res = -1; 
        goto LConsERVcRecordCheck;
      end;
      if (ConsERr.BalFrRate>maxfr) then begin
        RecordCheckError(1261,"",-1,"BalFrRate");      
        res = -1; 
        goto LConsERVcRecordCheck;
      end;
    end;
    if (minfr!=0) then begin
      if (ConsERr.PLFrRate<minfr) then begin
        RecordCheckError(1262,"",-1,"PLFrRate");      
        res = -1; 
        goto LConsERVcRecordCheck;
      end;
      if (ConsERr.BalFrRate<minfr) then begin
        RecordCheckError(1262,"",-1,"BalFrRate");      
        res = -1; 
        goto LConsERVcRecordCheck;
      end;
    end;
//  end;
  if (ConsERr.PLToRate1!=0) then begin
    if (bascur.NotBase1!=0) then begin
      RecordCheckError(1263,"",-1,"PLToRate1");      
      res = -1; 
      goto LConsERVcRecordCheck;
    end;
    if (maxto1!=0) then begin
      if (ConsERr.PLToRate1>maxto1) then begin
        RecordCheckError(1261,"",-1,"PLToRate1");      
        res = -1; 
        goto LConsERVcRecordCheck;
      end;
    end;
    if (minto1!=0) then begin
      if (ConsERr.PLToRate1<minto1) then begin
        RecordCheckError(1262,"",-1,"PLToRate1");      
        res = -1; 
        goto LConsERVcRecordCheck;
      end;
    end;
  end;
  if (ConsERr.BalToRate1!=0) then begin
    if (bascur.NotBase1!=0) then begin
      RecordCheckError(1263,"",-1,"BalToRate1");      
      res = -1; 
      goto LConsERVcRecordCheck;
    end;
    if (maxto1!=0) then begin
      if (ConsERr.BalToRate1>maxto1) then begin
        RecordCheckError(1261,"",-1,"BalToRate1");      
        res = -1; 
        goto LConsERVcRecordCheck;
      end;
    end;
    if (minto1!=0) then begin
      if (ConsERr.BalToRate1<minto1) then begin
        RecordCheckError(1262,"",-1,"BalToRate1");      
        res = -1; 
        goto LConsERVcRecordCheck;
      end;
    end;
  end;
  if (ConsERr.PLToRate2!=0) then begin
    if (oldrate) then begin
      RecordCheckError(1263,"",-1,"PLToRate2");      
      res = -1; 
      goto LConsERVcRecordCheck;
    end else begin
      if (bascur.NotBase2!=0) then begin
        RecordCheckError(1263,"",-1,"PLToRate2");      
        res = -1; 
        goto LConsERVcRecordCheck;
      end;
      if (maxto2!=0) then begin
        if (ConsERr.PLToRate2>maxto2) then begin
          RecordCheckError(1261,"",-1,"PLToRate2");      
          res = -1; 
          goto LConsERVcRecordCheck;
        end;
      end;
      if (minto2!=0) then begin
        if (ConsERr.PLToRate2<minto2) then begin
          RecordCheckError(1262,"",-1,"PLToRate2");      
          res = -1; 
          goto LConsERVcRecordCheck;
        end;
      end;
    end;
  end;
  if (ConsERr.BalToRate2!=0) then begin
    if (oldrate) then begin
      RecordCheckError(1263,"",-1,"BalToRate2");      
      res = -1; 
      goto LConsERVcRecordCheck;
    end else begin
      if (bascur.NotBase2!=0) then begin
        RecordCheckError(1263,"",-1,"BalToRate2");      
        res = -1; 
        goto LConsERVcRecordCheck;
      end;
      if (maxto2!=0) then begin
        if (ConsERr.BalToRate2>maxto2) then begin
          RecordCheckError(1261,"",-1,"BalToRate2");      
          res = -1; 
          goto LConsERVcRecordCheck;
        end;
      end;
      if (minto2!=0) then begin
        if (ConsERr.BalToRate2<minto2) then begin
          RecordCheckError(1262,"",-1,"BalToRate2");      
          res = -1; 
          goto LConsERVcRecordCheck;
        end;
      end;
    end;
  end;
LConsERVcRecordCheck:;
  ConsERVcRecordCheck = res;
  return;
end;

