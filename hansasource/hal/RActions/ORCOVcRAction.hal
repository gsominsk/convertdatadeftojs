external function Integer PayTermType(string);

global
function LongInt ORCOVcRecordDefaults(var record ORCOVc ORCOr,record ORCOVc ORCO2r,LongInt long3,LongInt long4)
begin
  LongInt res;

  if (SingleUserMode) then begin
    ORCOr.SerNr = NextSerNr("ORCOVc",ORCOr.CODate,-1,false,"");
  end;
  ORCOr.OKFlag = 0;
  ORCOr.Closed = 0;
  ORCOVcRecordDefaults = res;
  return;
end;

global
function LongInt ORCOVcRecordDuplicate(var record ORCOVc ORCOr,record ORCOVc ORCO2r,LongInt long3,LongInt long4)
begin
  LongInt res;

  if (SingleUserMode) then begin
    ORCOr.SerNr = NextSerNr("ORCOVc",ORCOr.CODate,-1,false,"");
  end;
  ORCOr.OKFlag = 0;
  ORCOr.Closed = 0;
  ORCOVcRecordDuplicate = res;
  return;
end;

global
function LongInt ORCOVcRecordCheck(record ORCOVc ORCOr,record ORCOVc ORCO2r,LongInt stat,LongInt long4)
begin
  LongInt res;
  record ORCOVc locORCOr;
  record CUVc CUr;
  LongInt oldnr;
  record PDVc PDr;

  res = 0;
  if (stat==Rs_update) then begin
    if (ORCOr.SerNr<=0) then begin
      ORCOr.SerNr = ORCO2r.SerNr;
    end;
  end;  
  oldnr = ORCOr.SerNr;
  if (ORCOr.SerNr<=0) then begin
    ORCOr.SerNr = NextSerNr("ORCOVc",ORCOr.CODate,-1,false,"");
  end;
  if ((stat==Rs_insert) or (ORCOr.SerNr!=ORCO2r.SerNr)) then begin
    locORCOr.SerNr = ORCOr.SerNr;
    if (ReadFirstMain(locORCOr,1,true)) then begin
      RecordCheckError(1547,"",-1,"SerNr");      
      res = -1; 
      goto LORCOVcRecordCheck;
    end;
  end;
/*  
  if (SerNrTestQTVc(ORCOr.SerNr,ORCOr.CODate,gentrans)==false) then begin
    RecordCheckError(1557,"",-1,"SerNr");      
    res = -1; 
    goto LORCOVcRecordCheck;
  end;
*/  
  CUr.Code = ORCOr.CustCode;
  if (ReadFirstMain(CUr,1,true)==false) then begin
    RecordCheckError(1120,ORCOr.CustCode,-1,"CustCode");      
    res = -1; 
    goto LORCOVcRecordCheck;
  end;
  if (CUr.blockedFlag!=0) then begin
    RecordCheckError(1265,ORCOr.CustCode,-1,"CustCode");      
    res = -1; 
    goto LORCOVcRecordCheck;
  end;
  if (nonblank(ORCOr.PayDeal)) then begin
    PDr.Code = ORCOr.PayDeal;
    if (ReadFirstMain(PDr,1,true)==false) then begin
      RecordCheckError(1256,"",-1,"PayDeal");      
      res = -1; 
      goto LORCOVcRecordCheck;
    end;
    switch (PayTermType(ORCOr.PayDeal)) begin
      case kInvoiceTypeCredit:
        RecordCheckError(1227,ORCOr.PayDeal,-1,"PayDeal");      
        res = -1;
        goto LORCOVcRecordCheck;
      case kInvoiceTypeEmployee:
        RecordCheckError(1958,"",-1,"PayDeal");      
        res = -1;
        goto LORCOVcRecordCheck;
    end;
  end;
  if (ORCOr.Closed!=0) then begin
    RecordCheckError(24230,ORCOr.SerNr,-1,"SerNr");      
    res = -1; 
    goto LORCOVcRecordCheck;
  end;
LORCOVcRecordCheck:;
  if (res!=0) then begin ORCOr.SerNr = oldnr; end;
  ORCOVcRecordCheck = res;
  return;
end;

global
updating function LongInt ORCOVcRecordRemoveTest(var record ORCOVc ORCOr,record ORCOVc ORCO2r,LongInt long3,LongInt long4)
begin
  LongInt res;
  record ORVc ORr;
  record VATIVVc VATIVr;

  res = 1;
  ORr.ORCONr = ORCOr.SerNr;
  if (ReadFirstKey("ORCONr",ORr,1,true)) then begin
    res = 0;
    goto LORCOVcRecordRemoveTest;
  end;
  VATIVr.ORCONr = ORCOr.SerNr;
  if (ReadFirstKey("ORCONr",VATIVr,1,true)) then begin
    res = 0;
    goto LORCOVcRecordRemoveTest;
  end;
LORCOVcRecordRemoveTest:;  
  ORCOVcRecordRemoveTest = res; 
  return;
end;

global
function LongInt ORCOVcRecordInIndex(record ORCOVc ORCOr,string indexname)
begin
  LongInt res;
  
  res = 1;
  if (ORCOr.Closed!=0) then begin 
    if (indexname=="ActSerNr")  then begin res = 0; end;
    if (indexname=="ActCustCode")  then begin res = 0; end;
    if (indexname=="ActCustName")  then begin res = 0; end;
    if (indexname=="ActCODate")  then begin res = 0; end;
    if (indexname=="ActOKFlag")  then begin res = 0; end;
  end;
  ORCOVcRecordInIndex = res;
  return;
end;
