global
function Boolean ChangeAttachmentFilenameToUUID(var record Attach2Vc Attr)
begin
  Boolean res;
  string 255 oldname;
  string 255 newname;
  
  res = false;
  
  if (Attr.Storage!=kAttachStorageSerNr) then begin
    goto out;
  end;
  
  if (BlankUUID(Attr.UUID)) then begin
    goto out;
  end;
  
  oldname = "Attach/" & Attr.SerNr;
  newname = "Attach/" & Attr.UUID;
  
  if (FileExists(oldname)==false) then begin
    goto out;
  end;
  
  if (RenameFile(oldname,newname)==0) then begin
    res = true;
    Attr.Storage = kAttachStorageUUID;
  end;
  
out:;
  ChangeAttachmentFilenameToUUID = res;
  return;
end;

global
function LongInt Attach2VcRecordImport(var record Attach2Vc Attr,record Attach2Vc Att2r,LongInt stat,LongInt long4)
begin
  LongInt res;
  
  if (ChangeAttachmentFilenameToUUID(Attr)==false) then begin
    // ...
  end;
  
out:;
  Attach2VcRecordImport = res;
  return;
end;