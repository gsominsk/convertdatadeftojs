//tools
external function string 255 removenextnode(var string);
external function string 255 CleanPath(string);
external function string 10 ToolWebNGGetCountry();
external procedure UpdateWebCountry(string);
external function boolean LoginState();
external function string 255 GetLinkToStruct(LongInt,boolean);
external function string 255 FormatLink(string,string,boolean,boolean);
external function string 255 FormatSimpleLink(string,boolean);
external function string 255 FormatSimpleLinkWithArg(string,string,boolean);
external function string 10 CurrentWebLang();
//pages
external procedure ShowErrorPage(string);
external procedure ShowWebAppPageStart(record WebNGPageVc,string);
external procedure ShowWebAppPageEnd(record WebNGPageVc);
//shop
external function string 255 GetLinkToShop();
external procedure RedirectToShopPageWithArg(string,string);
external procedure RedirectToShoppingBasket();
external procedure RedirectToShopPage(string);
//translation
external function string 255 ToolWebNGTranslateText(integer);
//webng
external procedure RedirectToStructLink(string);
external procedure RedirectToStartPage();
external procedure RedirectToURL(string);
//std
external function string 255 ConvertXml(string);

global
procedure ShopConfigureProductApp(record WebNGStructVc WSr,string path)
begin
  record WebNGPageVc WPr;
  string 255 link;
  string 255 node,mpath;
  
  //handles
  // /configureproduct/1234/
  
  mpath = path;
  node = removenextnode(mpath);
  
  if (nonblank(node)) then begin
    WPr.Code = WSr.WebPage;
    if (nonblank(WPr.Code)) then begin
      if (ReadFirstMain(WPr,1,true)) then begin end;
    end;

    ShowWebAppPageStart(WPr,"");

    WebOutTagOpen("<h1>");
    WebOutStringFormat("Configure this product");
    WebOutTagClose("</h1>");

    WebOutStringFormat("<p>This function is not yet implemented.</p>");

    WebOutStringFormat("<p>You can however add the selected product to the basket in unconfigured state.</p>");

    link = FormatLink("/WebUpdatingAction.hal","?action=addtobasket&product=" & ConvertXml(node) & "&config=1",true,true);
    WebOutStringFormat("<p><a href=""" & link & """>" & ToolWebNGTranslateText(25510) & "</a></p>"); //Add to basket
    
    ShowWebAppPageEnd(WPr);
  end else begin
    RedirectToShoppingBasket;
  end;
  return;
end;