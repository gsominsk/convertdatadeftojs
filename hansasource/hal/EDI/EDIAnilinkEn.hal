global
procedure EDIAnilinkEn(record RcVc RepSpec)
BEGIN
  record IVVc IVr;
  record EDIIVVc EDIIVr;
  record CUVc CUr;  
  string 20 frcu,tocu;
  LongInt frediiv,toediiv;
  Boolean TrHs,testf;
  LongInt ivcnt;
  
  ivcnt = 0;
  frediiv = FirstInRange(RepSpec.f1,10);
  toediiv = LastInRange(RepSpec.f1,10);
  frcu = FirstInRange(RepSpec.f2,20);
  tocu = LastInRange(RepSpec.f2,20);
  TrHs = true;
  EDIIVr.SerNr = frediiv;
  while (LoopMain(EDIIVr,1,TrHs)) begin
    if (nonblank(RepSpec.f1)) then begin
      if (EDIIVr.SerNr>toediiv) then begin TrHs = false; end;
    end;  
    if (TrHs) then begin
      testf = true;
      if (nonblank(RepSpec.f2)) then begin
        if (EDIIVr.CustCode<frcu) then begin testf = false; end;
        if (EDIIVr.CustCode>tocu) then begin testf = false; end;
      end;
      if (RepSpec.flags[1]==0) then begin
        if (EDIIVr.ExportedFlag!=0) then begin testf = false; end;
      end;
      if (RepSpec.FirstVer!=-1) then begin
        if (EDIIVr.BatchNr!=RepSpec.FirstVer) then begin testf = false; end;
      end;
      if (testf) then begin
        CUr.Code = EDIIVr.CustCode;
        if (ReadFirstMain(CUr,1,true)==false) then begin 
          testf = false;
        end else begin
          if (CUr.EDIFlag==0) then begin testf = false; end;
        end;
        if (CUr.CUType==0) then begin testf = false; end;
      end;
      if (testf) then begin
        IVr.SerNr = EDIIVr.SerNr;
        if (ReadFirstMain(IVr,1,true)) then begin
          ExportRecord(IVr);
        end;
      end;  
    end;  
  end;
  RETURN;
END;
