external procedure RestAccVcGetCalcItemPrice(record INVc,record RestAccVc,Integer,var val);
external function Boolean GetItemPriceDiscount3(string,val,var record INVc,string,val,val,val,val,val,string,string,string,string,
                                                var val,var string,var val,var string,var val,var string,Integer,var Boolean,Date,Time,
                                                string,Boolean,var Boolean,string,var string,var val,string,string,var string);

global
procedure RestAccPriceLookup_PasteArtCode(var record SoftFVc RestAccPLr,Integer rownr,record LocalMachineBlock LMb)
begin
  record INVc INr;  
  row SoftFVc RestAccPLrw;
  Integer res;
  Boolean chsum,calcpricef,bool;
  val price,vreb,baseprice,tax2prc;
  string 255 curitemname,vatcode,salesacc,tax2code,taxtemplatecode;
  Boolean dummyf;
  Time blankt;

  MatRowGet(RestAccPLr,rownr,RestAccPLrw);
  if (RestAccPLrw.Quant==blankval) then begin
    RestAccPLrw.Quant = 1;
  end;

  if (GetItemPriceDiscount3(RestAccPLrw.ArtCode,RestAccPLrw.Quant,INr,"",
                          blankval,blankval,blankval,blankval,blankval,
                          "","",RestAccPLr.PriceList,"",
                          price,curitemname,vreb,vatcode,baseprice,salesacc,
                          0,calcpricef,RestAccPLr.TransDate,blankt,RestAccPLr.CustCode,false,dummyf,"",tax2code,tax2prc,"","",taxtemplatecode)) then 
  begin
    if (calcpricef) then begin
      RestAccPLrw.Quant = blankval;
      RestAccVcGetCalcItemPrice(INr,RestAccPLr,rownr,price);
    end;
    RestAccPLrw.Spec = curitemname;
    RestAccPLrw.Price = price;
    RestAccPLrw.VATCode = vatcode;
    MatRowPut(RestAccPLr,rownr,RestAccPLrw);
    chsum = true;
  end;  
  return;
end;
