external procedure GetFullCurncyRate (var string,Date,var val,var val,var val,var val,var val);

global
procedure PasteEDIOrdInOrd(var record EDIORVc EDIORp,var record ORVc ORp)
BEGIN
  row EDIORVc EDIORrw;
  row ORVc ORrw;
  Integer i,rwcnt,orcnt;
  record CUVc CUr;
  Boolean cufoundf;
  val fr,to1,to2,br1,br2;
  record AccBlock ARb;

  BlockLoad(ARb);
  begin
    CUr.Code = EDIORp.CustCode;
    cufoundf = ReadFirstMain(CUr,1,true);
    if (cufoundf) then begin 
      if (CUr.EDIFlag==0) then begin goto LPasteEDIOrdInOrd; end;
    end;
    if (EDIORp.ORSerNr>0) then begin goto LPasteEDIOrdInOrd; end; 
    if (EDIORp.VersionNr!=1) then begin goto LPasteEDIOrdInOrd; end;
    rwcnt = MatRowCnt(EDIORp);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(EDIORp,i,EDIORrw);
      ClearRow(ORp,ORrw,1);
      ORrw.stp = 1;    
      ORrw.ArtCode = EDIORrw.ArtCode;
      ORrw.Quant = EDIORrw.Quant;
      ORrw.Price = EDIORrw.Price;
      ORrw.Sum = EDIORrw.Sum;
      ORrw.vRebate = EDIORrw.vRebate;
      ORrw.SalesAcc = EDIORrw.SalesAcc;
      ORrw.Shipd1 = EDIORrw.Shipd1;
      ORrw.Shipd2 = EDIORrw.Shipd2;
      ORrw.Invd = EDIORrw.Invd;
      ORrw.Objects = EDIORrw.Objects;
      ORrw.BasePrice = EDIORrw.BasePrice;
      ORrw.rowGP = EDIORrw.rowGP;
      ORrw.Spec = EDIORrw.Spec;
      ORrw.VATCode = EDIORrw.VATCode;
      ORrw.Recepy = EDIORrw.Recepy;
      ORrw.SerialNr = EDIORrw.SerialNr;
      ORrw.PriceFactor = EDIORrw.PriceFactor;
      ORrw.VARList = EDIORrw.VARList;
      ORrw.ShipNote = EDIORrw.ShipNote;
      ORrw.UnitCode = EDIORrw.UnitCode;
      ORrw.UnitFactQuant = EDIORrw.UnitFactQuant;
      ORrw.UnitFactPrice = EDIORrw.UnitFactPrice;
      MatRowPut(ORp,orcnt,ORrw);      
      orcnt = orcnt + 1;
    end;
    ORp.OrdDate = CurrentDate;
    ORp.CustCode = EDIORp.CustCode;
    ORp.Addr0 = EDIORp.Addr0;
    ORp.Addr1 = EDIORp.Addr1;
    ORp.Addr2 = EDIORp.Addr2;
    ORp.Addr3 = EDIORp.Addr3;
    ORp.InvAddr3 = EDIORp.InvAddr3;
    ORp.InvAddr4 = EDIORp.InvAddr4;
    ORp.OurContact = EDIORp.OurContact;
    ORp.CustContact = EDIORp.CustContact;
    ORp.ExportFlag = EDIORp.ExportFlag;
    ORp.InvFlag = EDIORp.InvFlag;
    ORp.ShipFlag = EDIORp.ShipFlag;
    ORp.Prntdf = EDIORp.Prntdf;
    ORp.PayDeal = EDIORp.PayDeal;
    if (blank(ORp.PayDeal)) then begin
      if (cufoundf) then begin
        ORp.PayDeal = CUr.PayDeal;
      end;
    end;
    ORp.CustCat = EDIORp.CustCat;
    ORp.InvMark = EDIORp.InvMark;
    ORp.ShipMark = EDIORp.ShipMark;
    ORp.Objects = EDIORp.Objects;
    ORp.OrderStatus = EDIORp.OrderStatus;
    ORp.PlanShip = EDIORp.PlanShip;
    ORp.SalesMan = EDIORp.SalesMan;
    if (blank(ORp.SalesMan)) then begin
      ORp.SalesMan = CUr.SalesMan;
    end;
    ORp.Sign = EDIORp.Sign;
    ORp.ShipDeal = EDIORp.ShipDeal;
    ORp.ShipAddr0 = EDIORp.ShipAddr0;
    ORp.ShipAddr1 = EDIORp.ShipAddr1;
    ORp.ShipAddr2 = EDIORp.ShipAddr2;
    ORp.ShipAddr3 = EDIORp.ShipAddr3;
    ORp.DelAddr3 = EDIORp.DelAddr3;
    ORp.DelAddr4 = EDIORp.DelAddr4;
    ORp.CurncyCode = EDIORp.CurncyCode;
    ORp.LangCode = EDIORp.LangCode;
    ORp.InvoiceToCode = EDIORp.InvoiceToCode;
    ORp.Closed = EDIORp.Closed;
    ORp.ToRateB1 = EDIORp.ToRateB1;
    ORp.BuildOn = EDIORp.BuildOn;
    ORp.PRCode = EDIORp.PRCode;
    ORp.Comment = EDIORp.Comment;
    ORp.InvOnlyOnFull = EDIORp.InvOnlyOnFull;
    ORp.DownPaySent = EDIORp.DownPaySent;
    ORp.InvoiceToCode = EDIORp.InvoiceToCode;
    ORp.OrderClass = EDIORp.OrderClass;
    ORp.CustOrdNr = EDIORp.CustOrdNr;
    ORp.PriceList = EDIORp.PriceList;
    ORp.InclVAT = EDIORp.InclVAT;
    ORp.NoTAXonVAT = EDIORp.NoTAXonVAT;
    if (ORp.NoTAXonVAT<0) then begin
      ORp.NoTAXonVAT = ARb.NoTAXonVAT;
    end;    
    ORp.TotalwoTAX = EDIORp.TotalwoTAX;
    ORp.Sum0 = EDIORp.Sum0;
    ORp.Sum1 = EDIORp.Sum1;
    ORp.Sum2 = EDIORp.Sum2;
    ORp.Sum3 = EDIORp.Sum3;
    ORp.Reserved = EDIORp.Reserved;
    ORp.OSFlag = EDIORp.OSFlag;
    ORp.Location = EDIORp.Location;
    ORp.CustVATCode = EDIORp.CustVATCode;
    ORp.RebCode = EDIORp.RebCode;
    ORp.VATNr = EDIORp.VATNr;
    ORp.Phone = EDIORp.Phone;
    ORp.Fax = EDIORp.Fax;
    ORp.ExportedFlag = EDIORp.ExportedFlag;
    ORp.BaseSum4 = EDIORp.BaseSum4;
    ORp.FrRate = EDIORp.FrRate;
    ORp.ToRateB2 = EDIORp.ToRateB2;
    ORp.BaseRate1 = EDIORp.BaseRate1;
    ORp.BaseRate2 = EDIORp.BaseRate2;
    if ((ORp.BaseRate1==0) or (ORp.BaseRate2==0)) then begin
      GetFullCurncyRate(ORp.CurncyCode,ORp.OrdDate,fr,to1,to2,br1,br2);
      ORp.FrRate = fr;
      ORp.ToRateB1 = to1;
      ORp.ToRateB2 = to2;
      ORp.BaseRate1 = br1;
      ORp.BaseRate2 = br2;
    end;
    ORp.DiscPerc = EDIORp.DiscPerc;
    ORp.DiscSum = EDIORp.DiscSum;
    ORp.TotGP = EDIORp.TotGP;
    ORp.Probability = EDIORp.Probability;
    ORp.CreditCard = EDIORp.CreditCard;
    ORp.AuthorizationCode = EDIORp.AuthorizationCode;
    ORp.GPProc = EDIORp.GPProc;
    ORp.ExportedFlag = EDIORp.ExportedFlag;
  end;
LPasteEDIOrdInOrd:;
  RETURN;
END;