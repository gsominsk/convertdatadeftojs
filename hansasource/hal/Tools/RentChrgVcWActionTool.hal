external function string 255 FindINObjects(string,string);
external procedure CalcSum(val,val,val,val,var val,Integer);
external function Boolean GetItemPriceDiscount3(string,val,var record INVc,string,val,val,val,val,val,string,string,string,string,
                                                var val,var string,var val,var string,var val,var string,Integer,var Boolean,Date,Time,
                                                string,Boolean,var Boolean,string,var string,var val,string,string,var string);

global
function Boolean PasteRentChrgItem(var record RentChrgVc RentChrgr,var string inwarning)
begin
  Boolean res;
  record AgreementVc Agreer;
  record INVc INr;
  val s,price,vreb,baseprice,tax2prc;
  string 255 curitemname,salesacc,vatcode,tax2code,taxtemplatecode;
  Boolean calcprice,dummyf;
  record GeneralOptionBlock GenOptRec;
  val tomultiply;
  Time blankt;

  if (RentChrgr.ItemQuant==0) then begin
    tomultiply = 1;
  end else begin
    tomultiply = RentChrgr.ItemQuant;
  end;
  BlockLoad(GenOptRec);
  RentChrgr.Price = BlankVal;
  RentChrgr.vRebate = BlankVal;
  RentChrgr.Sum = BlankVal;
  Agreer.SerNr = RentChrgr.AgreementNr;
  if (ReadFirstMain(Agreer,1,true)) then begin
    if (GetItemPriceDiscount3(RentChrgr.Item,RentChrgr.Quant,INr,Agreer.CurncyCode,
                              Agreer.FrRate,Agreer.ToRateB1,Agreer.ToRateB2,Agreer.BaseRate1,Agreer.BaseRate2,
                              Agreer.LangCode,Agreer.CustCat,Agreer.PriceList,Agreer.RebCode,
                              price,curitemname,vreb,vatcode,baseprice,salesacc,
                              Agreer.ExportFlag,calcprice,RentChrgr.TransDate,blankt,Agreer.CustCode,true,dummyf,"",tax2code,tax2prc,"","",taxtemplatecode)) then begin
      if (vreb==0) then begin
        vreb = blankval;
      end;
      if (nonblank(INr.WarnText1)) then begin
        inwarning = INr.WarnText1;
      end;
      RentChrgr.Objects = FindINObjects(INr.Objects,INr.Group);
      RentChrgr.CustOrdNr = "";
      RentChrgr.Price = price;
      RentChrgr.Spec = curitemname;
      RentChrgr.vRebate = vreb;
      CalcSum(RentChrgr.Quant*tomultiply,RentChrgr.Price,INr.PriceFactor,RentChrgr.vRebate,s,GenOptRec.UseDiscount);
      RentChrgr.Sum = s;
      res = true;
    end;
  end;
  PasteRentChrgItem = res;
  return;
end;

global
function Boolean RentChrgVc_PasteItem(var record RentChrgVc RentChrgr,var string inwarning)
BEGIN
  Boolean res;
  
  res = PasteRentChrgItem(RentChrgr,inwarning);
  RentChrgVc_PasteItem = res;
  return;
end;

