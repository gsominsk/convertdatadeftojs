global
procedure CampaignPasteLeadCode(var record CampaignVc Campaignr,Integer rownr)
begin
  row CampaignVc Campaignrw;
  record CUVc Leadr;
  record CUVc CUr;
  
  if (rownr>=0) then begin
    MatRowGet(Campaignr,rownr,Campaignrw);
    switch (Campaignrw.CodeType) begin
      case kCampaignRowCodeTypeLead:
        Leadr.Code = Campaignrw.Code;
        ReadFirstMain(Leadr,1,true);
        Campaignrw.Name = Leadr.Name;
        Campaignrw.Person = Leadr.Person;
      case kCampaignRowCodeTypeCU:
        CUr.Code = Campaignrw.Code;
        ReadFirstMain(CUr,1,true);
        Campaignrw.Name = CUr.Name;
        Campaignrw.Person = CUr.Person;
    end;
    MatRowPut(Campaignr,rownr,Campaignrw);
  end;
  return;
end;

global
updating function Integer CreateLetFromCampaign(record CampaignVc Campaignr,var record LetVc Letr,var string warning)
begin
  Integer res;
  record RcVc RepSpec;
  record PersColVc PersColr;
  record PersColListVc PersColListr;
  record CUVc CUr;
  row CampaignVc Campaignrw;
  integer i,rwcnt;
  boolean TrHs,firstf;
  string 255 tstr;
  
  res = 1;
  RecordNew(Letr);
  Letr.CustCode = "";
  Letr.CampaignCode = Campaignr.Code;
  Letr.FileName = "CampaignVc";
  Letr.TransNr = Campaignr.Code;
  if (RecordStore(Letr,false)) then begin
    res = 0;
    CreateRecordLink(Letr,CurrentCompany,Campaignr,CurrentCompany);  
    CreateRecordLink(Campaignr,CurrentCompany,Letr,CurrentCompany);  
  end;
  CreateLetFromCampaign = res;
  return;
end;