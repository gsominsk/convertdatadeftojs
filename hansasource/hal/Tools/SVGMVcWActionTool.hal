external function Boolean GetSVOSerialItem(string,string,record SVOSerVc);
external function Boolean GetCustAndBal(var record CUVc,var val,var val,Integer,Integer,Integer,Integer,Integer,Integer,var Boolean);
external function Boolean GetItemNameStr(Integer,var string,string,string,string);
external function Boolean GetFirstItem(var string,var record INVc);

global
function Boolean PasteItemInSVGM(var record SVGMVc SVGMp,Integer rownr)
BEGIN
  row SVGMVc SVGMrw;
  record INVc INr;
  Boolean res;
  string 255 tstr;

  MatRowGet(SVGMp,rownr,SVGMrw);
  if (GetFirstItem(SVGMrw.ArtCode,INr)) then begin
    if (GetItemNameStr(1,tstr,"",INr.Name,INr.Code)) begin      
      SVGMrw.Spec = tstr;
    end;  
    MatRowPut(SVGMp,rownr,SVGMrw);
    res = true;
  end else begin
    res = false;
  end;
  PasteItemInSVGM = res;
  RETURN;
END;

global
function Boolean PasteCUInSVGM(var record SVGMVc SVGMp,var string warntext)
BEGIN
  record CUVc CUr;
  val bal;
  val limit;
  Boolean res,limitdaysf;
  
  CUr.Code = SVGMp.CustCode;
  if (GetCustAndBal(CUr,limit,bal,0,0,0,0,0,0,limitdaysf))   then begin
    SVGMp.Addr0 = CUr.Name;
    SVGMp.CustContact = CUr.Person;
    warntext = CUr.WarnText1;
    res = true;
  end;
  PasteCUInSVGM = res;
  RETURN;
END;

global
function Boolean PasteSVOIn2SVGM(var record SVGMVc SVGMp)
BEGIN
  record SVOVc SVOr;
  row SVOVc SVOrw;
  row SVGMVc SVGMrw;
  Boolean res;
  Integer i,rwcnt;
  string 255 tstr;
  
  SVOr.SerNr = SVGMp.SVONr;
  if (ReadFirstMain(SVOr,1,true)) then begin
    SVGMp.CustCode = SVOr.CustCode;
    if (PasteCUInSVGM(SVGMp,tstr)) then begin end;
    if (blank(SVGMp.Comment1)) then begin SVGMp.Comment1 = SVOr.Comment1; end;
    if (blank(SVGMp.Comment2)) then begin SVGMp.Comment2 = SVOr.Comment2; end;
    if (blank(SVGMp.Comment3)) then begin SVGMp.Comment3 = SVOr.Comment3; end;
    if (blank(SVGMp.Comment4)) then begin SVGMp.Comment4 = SVOr.Comment4; end;
    rwcnt = MatRowCnt(SVOr);
    for (i=0;i<rwcnt;i=i+1) begin
       MatRowGet(SVOr,i,SVOrw);
       ClearRow(SVGMp,SVGMrw,1);
       SVGMrw.ArtCode = SVOrw.ArtCode;
       SVGMrw.Spec = SVOrw.Spec;
       SVGMrw.SerialNr = SVOrw.SerialNr;
       SVGMrw.PlanShiprw = SVOrw.PlanShiprw;
       SVGMrw.Location = "";
       SVGMrw.MotherNr = "";
       SVGMrw.InQuant = SVOrw.Quant;
       SVGMrw.OutQuant = blankval;
       SVGMrw.CostPrice = blankval;
       SVGMrw.SalesPrice = blankval;
       MatRowPut(SVGMp,i,SVGMrw);
    end;   
    res = true;
  end;
  PasteSVOIn2SVGM = res;
  RETURN;
END;

global
function Boolean SVGM_PasterSerialNr(var record SVGMVc SVGMp,Integer rownr)
BEGIN
  record SVOSerVc SVOSerr;
  row SVGMVc SVGMrw;
  string 255 tstr;
  Boolean res;
  
  if (GetSVOSerialItem(SVGMrw.ArtCode,SVGMrw.SerialNr,SVOSerr)) then begin
    if (blank(SVGMp.CustCode)) then begin
      SVGMp.CustCode = SVOSerr.CustCode;
      if (PasteCUInSVGM(SVGMp,tstr)) then begin end;
    end;
    if (blank(SVGMrw.ArtCode)) then begin
      ClearRow(SVGMp,SVGMrw,1);
      SVGMrw.ArtCode = SVOSerr.ItemCode;
      SVGMrw.Spec = SVOSerr.ItemName;
      SVGMrw.SalesPrice = SVOSerr.SalesPrice;
      SVGMrw.CostPrice = SVOSerr.CostPrice;
      SVGMrw.SoldDate = SVOSerr.SoldDate;
      SVGMrw.WarrantyUntil = SVOSerr.WarrantyUntil;
/*
      if (SVOSerr.InStock>0) then begin
        SVGMrw.OutQuant = 1;
        SVGMrw.InQuant = blankval;
      end else begin
        SVGMrw.InQuant = 1;
        SVGMrw.OutQuant = blankval;
      end;
*/
      MatRowPut(SVGMp,rownr,SVGMrw);
    end;
  end;
  SVGM_PasterSerialNr = res;
  RETURN;
END;

