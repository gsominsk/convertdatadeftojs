external function Boolean AreasAreEqual(area,area);

global
updating function Boolean DeviceTokenNeedsUpdate(area devicetoken)
begin
  Boolean res;
  record NotifLocalBlock NLb;
  area devtok;
  
  res = GetAreaLength(devicetoken)>0;
  
  if (res==false) then begin goto LDeviceTokenNeedsUpdate; end;
  
  BlockLoad(NLb);
  GetRecordBlob(NLb,"Blob",devtok);
  
  res = AreasAreEqual(devicetoken,devtok)==false;
  
  if (res) then begin
    SetRecordBlob(NLb,"Blob",devicetoken);
    BlockStore(NLb);
  end;
  
LDeviceTokenNeedsUpdate:;
  DeviceTokenNeedsUpdate = res;
end;
