external updating procedure StoreTTR(var record TTRVc);
external procedure CreateNewTTR(record TRVc,row TRVc,Integer,string,var record TTRVc);

function string 255 GetFieldValueByName_SDVc(record SDVc SDr,Integer sd,string FileName,string field)
BEGIN
  string 255 res;
  row SDVc SDrw;
  
  if (sd>=0) then begin
    MatRowGet(SDr,sd,SDrw);
  end;
  switch (FileName) begin
  end;
  GetFieldValueByName_SDVc = res;
  RETURN;
END;

updating procedure AddExtraInforToTTR_SDVc(record TRVc TRr,row TRVc TRrw,Integer rownr,string Group,record SDVc SDr)
BEGIN
  record TAccGroupVc TAccGroupr;
  record TTRVc TTRr,tempTTRr;
  record TTRMapVc TTRMapr;
  row TAccGroupVc TAccGrouprw;
  Integer i,rwcnt;
  row TTRVc TTRrw;
  Integer sd,vrwcnt;
  Integer stp;
  Boolean storerowttrf,storettrf;  

  TAccGroupr.Code = Group;
  if (ReadFirstMain(TAccGroupr,1,true)) then begin    
    CreateNewTTR(TRr,TRrw,rownr,TAccGroupr.Code,tempTTRr);
    storettrf = true;
    rwcnt = MatRowCnt(TAccGroupr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TAccGroupr,i,TAccGrouprw);
      TTRMapr.Code = TAccGrouprw.Field;
      TTRMapr.FileName = "SDVc";
      TTRMapr.Type = 0;
      if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
        stp = TTRMapr.RowType;
        ClearRow(tempTTRr,TTRrw,stp);
        TTRrw.stp = stp;
        TTRrw.Value = GetFieldValueByName(SDr,TTRMapr.Field,-1);
        if (nonblank(TTRrw.Value)) then begin
          MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
        end;
      end else begin
        TTRMapr.FromFileName = "SDVc";
        TTRMapr.Type = 0;
        TTRMapr.Code = TAccGrouprw.Field;
        if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(tempTTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName_SDVc(SDr,-1,TTRMapr.FileName,TTRMapr.Field);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
          end;
        end;
      end;
    end;
    RecordCopy(TTRr,tempTTRr);
    
    vrwcnt = MatRowCnt(SDr);
    for (sd=0;sd<vrwcnt;sd=sd+1) begin   
      storerowttrf = false;   
      for (i=0;i<rwcnt;i=i+1) begin
        MatRowGet(TAccGroupr,i,TAccGrouprw);
        TTRMapr.Code = TAccGrouprw.Field;
        TTRMapr.FileName = "SDVc";
        TTRMapr.Type = 1;
        if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(TTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName(SDr,TTRMapr.Field,sd);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
            storerowttrf = true;
          end;
        end else begin
          TTRMapr.FromFileName = "SDVc";
          TTRMapr.Type = 1;
          TTRMapr.Code = TAccGrouprw.Field;
          if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
            stp = TTRMapr.RowType;
            ClearRow(tempTTRr,TTRrw,stp);
            TTRrw.stp = stp;
            TTRrw.Value = GetFieldValueByName_SDVc(SDr,sd,TTRMapr.FileName,TTRMapr.Field);
            if (nonblank(TTRrw.Value)) then begin
              MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
              storerowttrf = true;
            end;
          end;
        end;
      end;
      if (storerowttrf) then begin
        StoreTTR(TTRr);
        RecordCopy(TTRr,tempTTRr);
        storettrf = false;
      end;
    end;
    if (storettrf) then begin
      StoreTTR(TTRr);
    end;
  end;
  RETURN;
END;

global
updating procedure AddTTrans_SDVc(record TRVc TRr,record SDVc SDr)
BEGIN
  row TRVc TRrw;
  Integer i,rwcnt;
  record TAccVc TAccr;
  record TTRBlock TTRb;

  BlockLoad(TTRb);
  if (TTRb.FromSD!=0) then begin
    rwcnt = MatRowCnt(TRr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TRr,i,TRrw);
      if (TRrw.stp==1) and (TRrw.ovst==0) then begin
        if (nonblank(TRrw.TAccNumber)) then begin      
          TAccr.TAccNumber = TRrw.TAccNumber;
          if (ReadFirstMain(TAccr,1,true)) then begin
            AddExtraInforToTTR_SDVc(TRr,TRrw,i,TAccr.Group,SDr);
          end;
        end;
      end;
    end;
  end;
  RETURN;
END;

function string 255 GetFieldValueByName_SRVc(record SRVc SRr,Integer sd,string FileName,string field)
begin
  string 255 res;
  row SRVc SRrw;
  
  if (sd>=0) then begin
    MatRowGet(SRr,sd,SRrw);
  end;
  switch (FileName) begin
  end;
  GetFieldValueByName_SRVc = res;
  return;
end;

updating procedure AddExtraInforToTTR_SRVc(record TRVc TRr,row TRVc TRrw,Integer rownr,string Group,record SRVc SRr)
begin
  record TAccGroupVc TAccGroupr;
  record TTRVc TTRr,tempTTRr;
  record TTRMapVc TTRMapr;
  row TAccGroupVc TAccGrouprw;
  Integer i,rwcnt;
  row TTRVc TTRrw;
  Integer sd,vrwcnt;
  Integer stp;
  Boolean storerowttrf,storettrf;  

  TAccGroupr.Code = Group;
  if (ReadFirstMain(TAccGroupr,1,true)) then begin    
    CreateNewTTR(TRr,TRrw,rownr,TAccGroupr.Code,tempTTRr);
    storettrf = true;
    rwcnt = MatRowCnt(TAccGroupr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TAccGroupr,i,TAccGrouprw);
      TTRMapr.Code = TAccGrouprw.Field;
      TTRMapr.FileName = "SRVc";
      TTRMapr.Type = 0;
      if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
        stp = TTRMapr.RowType;
        ClearRow(tempTTRr,TTRrw,stp);
        TTRrw.stp = stp;
        TTRrw.Value = GetFieldValueByName(SRr,TTRMapr.Field,-1);
        if (nonblank(TTRrw.Value)) then begin
          MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
        end;
      end else begin
        TTRMapr.FromFileName = "SRVc";
        TTRMapr.Type = 0;
        TTRMapr.Code = TAccGrouprw.Field;
        if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(tempTTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName_SRVc(SRr,-1,TTRMapr.FileName,TTRMapr.Field);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
          end;
        end;
      end;
    end;
    RecordCopy(TTRr,tempTTRr);
    
    vrwcnt = MatRowCnt(SRr);
    for (sd=0;sd<vrwcnt;sd=sd+1) begin   
      storerowttrf = false;   
      for (i=0;i<rwcnt;i=i+1) begin
        MatRowGet(TAccGroupr,i,TAccGrouprw);
        TTRMapr.Code = TAccGrouprw.Field;
        TTRMapr.FileName = "SRVc";
        TTRMapr.Type = 1;
        if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(TTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName(SRr,TTRMapr.Field,sd);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
            storerowttrf = true;
          end;
        end else begin
          TTRMapr.FromFileName = "SRVc";
          TTRMapr.Type = 1;
          TTRMapr.Code = TAccGrouprw.Field;
          if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
            stp = TTRMapr.RowType;
            ClearRow(tempTTRr,TTRrw,stp);
            TTRrw.stp = stp;
            TTRrw.Value = GetFieldValueByName_SRVc(SRr,sd,TTRMapr.FileName,TTRMapr.Field);
            if (nonblank(TTRrw.Value)) then begin
              MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
              storerowttrf = true;
            end;
          end;
        end;
      end;
      if (storerowttrf) then begin
        StoreTTR(TTRr);
        RecordCopy(TTRr,tempTTRr);
        storettrf = false;
      end;
    end;
    if (storettrf) then begin
      StoreTTR(TTRr);
    end;
  end;
  return;
end;

global
updating procedure AddTTrans_SRVc(record TRVc TRr,record SRVc SRr)
begin
  row TRVc TRrw;
  Integer i,rwcnt;
  record TAccVc TAccr;
  record TTRBlock TTRb;

  BlockLoad(TTRb);
  if (TTRb.FromSR!=0) then begin
    rwcnt = MatRowCnt(TRr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TRr,i,TRrw);
      if (TRrw.stp==1) and (TRrw.ovst==0) then begin
        if (nonblank(TRrw.TAccNumber)) then begin      
          TAccr.TAccNumber = TRrw.TAccNumber;
          if (ReadFirstMain(TAccr,1,true)) then begin
            AddExtraInforToTTR_SRVc(TRr,TRrw,i,TAccr.Group,SRr);
          end;
        end;
      end;
    end;
  end;
  return;
end;

function string 255 GetFieldValueByName_RetVc(record RetVc Retr,Integer ret,string FileName,string field)
BEGIN
  string 255 res;
  row RetVc Retrw;
  
  if (ret>=0) then begin
    MatRowGet(Retr,ret,Retrw);
  end;
  switch (FileName) begin
  end;
  GetFieldValueByName_RetVc = res;
  RETURN;
END;

updating procedure AddExtraInforToTTR_RetVc(record TRVc TRr,row TRVc TRrw,Integer rownr,string Group,record RetVc Retr)
BEGIN
  record TAccGroupVc TAccGroupr;
  record TTRVc TTRr,tempTTRr;
  record TTRMapVc TTRMapr;
  row TAccGroupVc TAccGrouprw;
  Integer i,rwcnt;
  row TTRVc TTRrw;
  Integer ret,vrwcnt;
  Integer stp;
  Boolean storerowttrf,storettrf;  

  TAccGroupr.Code = Group;
  if (ReadFirstMain(TAccGroupr,1,true)) then begin    
    CreateNewTTR(TRr,TRrw,rownr,TAccGroupr.Code,tempTTRr);
    storettrf = true;
    rwcnt = MatRowCnt(TAccGroupr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TAccGroupr,i,TAccGrouprw);
      TTRMapr.Code = TAccGrouprw.Field;
      TTRMapr.FileName = "RetVc";
      TTRMapr.Type = 0;
      if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
        stp = TTRMapr.RowType;
        ClearRow(tempTTRr,TTRrw,stp);
        TTRrw.stp = stp;
        TTRrw.Value = GetFieldValueByName(Retr,TTRMapr.Field,-1);
        if (nonblank(TTRrw.Value)) then begin
          MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
        end;
      end else begin
        TTRMapr.FromFileName = "RetVc";
        TTRMapr.Type = 0;
        TTRMapr.Code = TAccGrouprw.Field;
        if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(tempTTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName_RetVc(Retr,-1,TTRMapr.FileName,TTRMapr.Field);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
          end;
        end;
      end;
    end;
    RecordCopy(TTRr,tempTTRr);
    
    vrwcnt = MatRowCnt(Retr);
    for (ret=0;ret<vrwcnt;ret=ret+1) begin   
      storerowttrf = false;   
      for (i=0;i<rwcnt;i=i+1) begin
        MatRowGet(TAccGroupr,i,TAccGrouprw);
        TTRMapr.Code = TAccGrouprw.Field;
        TTRMapr.FileName = "RetVc";
        TTRMapr.Type = 1;
        if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(TTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName(Retr,TTRMapr.Field,ret);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
            storerowttrf = true;
          end;
        end else begin
          TTRMapr.FromFileName = "RetVc";
          TTRMapr.Type = 1;
          TTRMapr.Code = TAccGrouprw.Field;
          if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
            stp = TTRMapr.RowType;
            ClearRow(tempTTRr,TTRrw,stp);
            TTRrw.stp = stp;
            TTRrw.Value = GetFieldValueByName_RetVc(Retr,ret,TTRMapr.FileName,TTRMapr.Field);
            if (nonblank(TTRrw.Value)) then begin
              MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
              storerowttrf = true;
            end;
          end;
        end;
      end;
      if (storerowttrf) then begin
        StoreTTR(TTRr);
        RecordCopy(TTRr,tempTTRr);
        storettrf = false;
      end;
    end;
    if (storettrf) then begin
      StoreTTR(TTRr);
    end;
  end;
  RETURN;
END;

global
updating procedure AddTTrans_RetVc(record TRVc TRr,record RetVc Retr)
BEGIN
  row TRVc TRrw;
  Integer i,rwcnt;
  record TAccVc TAccr;
  record TTRBlock TTRb;

  BlockLoad(TTRb);
  if (TTRb.FromRet!=0) then begin
    rwcnt = MatRowCnt(TRr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TRr,i,TRrw);
      if (TRrw.stp==1) and (TRrw.ovst==0) then begin
        if (nonblank(TRrw.TAccNumber)) then begin      
          TAccr.TAccNumber = TRrw.TAccNumber;
          if (ReadFirstMain(TAccr,1,true)) then begin
            AddExtraInforToTTR_RetVc(TRr,TRrw,i,TAccr.Group,Retr);
          end;
        end;
      end;
    end;
  end;
  RETURN;
END;

function string 255 GetFieldValueByName_RetPUVc(record RetPUVc RetPUr,Integer retpu,string FileName,string field)
BEGIN
  string 255 res;
  row RetPUVc RetPUrw;
  
  if (retpu>=0) then begin
    MatRowGet(RetPUr,retpu,RetPUrw);
  end;
  switch (FileName) begin
  end;
  GetFieldValueByName_RetPUVc = res;
  RETURN;
END;

updating procedure AddExtraInforToTTR_RetPUVc(record TRVc TRr,row TRVc TRrw,Integer rownr,string Group,record RetPUVc RetPUr)
BEGIN
  record TAccGroupVc TAccGroupr;
  record TTRVc TTRr,tempTTRr;
  record TTRMapVc TTRMapr;
  row TAccGroupVc TAccGrouprw;
  Integer i,rwcnt;
  row TTRVc TTRrw;
  Integer retpu,vrwcnt;
  Integer stp;
  Boolean storerowttrf,storettrf;  

  TAccGroupr.Code = Group;
  if (ReadFirstMain(TAccGroupr,1,true)) then begin    
    CreateNewTTR(TRr,TRrw,rownr,TAccGroupr.Code,tempTTRr);
    storettrf = true;
    rwcnt = MatRowCnt(TAccGroupr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TAccGroupr,i,TAccGrouprw);
      TTRMapr.Code = TAccGrouprw.Field;
      TTRMapr.FileName = "RetPUVc";
      TTRMapr.Type = 0;
      if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
        stp = TTRMapr.RowType;
        ClearRow(tempTTRr,TTRrw,stp);
        TTRrw.stp = stp;
        TTRrw.Value = GetFieldValueByName(RetPUr,TTRMapr.Field,-1);
        if (nonblank(TTRrw.Value)) then begin
          MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
        end;
      end else begin
        TTRMapr.FromFileName = "RetPUVc";
        TTRMapr.Type = 0;
        TTRMapr.Code = TAccGrouprw.Field;
        if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(tempTTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName_RetPUVc(RetPUr,-1,TTRMapr.FileName,TTRMapr.Field);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
          end;
        end;
      end;
    end;
    RecordCopy(TTRr,tempTTRr);
    
    vrwcnt = MatRowCnt(RetPUr);
    for (retpu=0;retpu<vrwcnt;retpu=retpu+1) begin   
      storerowttrf = false;   
      for (i=0;i<rwcnt;i=i+1) begin
        MatRowGet(TAccGroupr,i,TAccGrouprw);
        TTRMapr.Code = TAccGrouprw.Field;
        TTRMapr.FileName = "RetPUVc";
        TTRMapr.Type = 1;
        if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(TTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName(RetPUr,TTRMapr.Field,retpu);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
            storerowttrf = true;
          end;
        end else begin
          TTRMapr.FromFileName = "RetPUVc";
          TTRMapr.Type = 1;
          TTRMapr.Code = TAccGrouprw.Field;
          if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
            stp = TTRMapr.RowType;
            ClearRow(tempTTRr,TTRrw,stp);
            TTRrw.stp = stp;
            TTRrw.Value = GetFieldValueByName_RetPUVc(RetPUr,retpu,TTRMapr.FileName,TTRMapr.Field);
            if (nonblank(TTRrw.Value)) then begin
              MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
              storerowttrf = true;
            end;
          end;
        end;
      end;
      if (storerowttrf) then begin
        StoreTTR(TTRr);
        RecordCopy(TTRr,tempTTRr);
        storettrf = false;
      end;
    end;
    if (storettrf) then begin
      StoreTTR(TTRr);
    end;
  end;
  RETURN;
END;

global
updating procedure AddTTrans_RetPUVc(record TRVc TRr,record RetPUVc RetPUr)
BEGIN
  row TRVc TRrw;
  Integer i,rwcnt;
  record TAccVc TAccr;
  record TTRBlock TTRb;

  BlockLoad(TTRb);
  if (TTRb.FromRetPU!=0) then begin
    rwcnt = MatRowCnt(TRr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TRr,i,TRrw);
      if (TRrw.stp==1) and (TRrw.ovst==0) then begin
        if (nonblank(TRrw.TAccNumber)) then begin      
          TAccr.TAccNumber = TRrw.TAccNumber;
          if (ReadFirstMain(TAccr,1,true)) then begin
            AddExtraInforToTTR_RetPUVc(TRr,TRrw,i,TAccr.Group,RetPUr);
          end;
        end;
      end;
    end;
  end;
  RETURN;
END;

function string 255 GetFieldValueByName_CLInVc(record CLInVc CLInr,Integer clin,string FileName,string field)
BEGIN
  string 255 res;
  row CLInVc CLInrw;
  
  if (clin>=0) then begin
    MatRowGet(CLInr,clin,CLInrw);
  end;
  switch (FileName) begin
  end;
  GetFieldValueByName_CLInVc = res;
  RETURN;
END;

updating procedure AddExtraInforToTTR_CLInVc(record TRVc TRr,row TRVc TRrw,Integer rownr,string Group,record CLInVc CLInr)
BEGIN
  record TAccGroupVc TAccGroupr;
  record TTRVc TTRr,tempTTRr;
  record TTRMapVc TTRMapr;
  row TAccGroupVc TAccGrouprw;
  Integer i,rwcnt;
  row TTRVc TTRrw;
  Integer clin,vrwcnt;
  Integer stp;
  Boolean storerowttrf,storettrf;  

  TAccGroupr.Code = Group;
  if (ReadFirstMain(TAccGroupr,1,true)) then begin    
    CreateNewTTR(TRr,TRrw,rownr,TAccGroupr.Code,tempTTRr);
    storettrf = true;
    rwcnt = MatRowCnt(TAccGroupr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TAccGroupr,i,TAccGrouprw);
      TTRMapr.Code = TAccGrouprw.Field;
      TTRMapr.FileName = "CLInVc";
      TTRMapr.Type = 0;
      if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
        stp = TTRMapr.RowType;
        ClearRow(tempTTRr,TTRrw,stp);
        TTRrw.stp = stp;
        TTRrw.Value = GetFieldValueByName(CLInr,TTRMapr.Field,-1);
        if (nonblank(TTRrw.Value)) then begin
          MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
        end;
      end else begin
        TTRMapr.FromFileName = "CLInVc";
        TTRMapr.Type = 0;
        TTRMapr.Code = TAccGrouprw.Field;
        if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(tempTTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName_CLInVc(CLInr,-1,TTRMapr.FileName,TTRMapr.Field);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
          end;
        end;
      end;
    end;
    RecordCopy(TTRr,tempTTRr);
    
    vrwcnt = MatRowCnt(CLInr);
    for (clin=0;clin<vrwcnt;clin=clin+1) begin   
      storerowttrf = false;   
      for (i=0;i<rwcnt;i=i+1) begin
        MatRowGet(TAccGroupr,i,TAccGrouprw);
        TTRMapr.Code = TAccGrouprw.Field;
        TTRMapr.FileName = "CLInVc";
        TTRMapr.Type = 1;
        if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(TTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName(CLInr,TTRMapr.Field,clin);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
            storerowttrf = true;
          end;
        end else begin
          TTRMapr.FromFileName = "CLInVc";
          TTRMapr.Type = 1;
          TTRMapr.Code = TAccGrouprw.Field;
          if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
            stp = TTRMapr.RowType;
            ClearRow(tempTTRr,TTRrw,stp);
            TTRrw.stp = stp;
            TTRrw.Value = GetFieldValueByName_CLInVc(CLInr,clin,TTRMapr.FileName,TTRMapr.Field);
            if (nonblank(TTRrw.Value)) then begin
              MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
              storerowttrf = true;
            end;
          end;
        end;
      end;
      if (storerowttrf) then begin
        StoreTTR(TTRr);
        RecordCopy(TTRr,tempTTRr);
        storettrf = false;
      end;
    end;
    if (storettrf) then begin
      StoreTTR(TTRr);
    end;
  end;
  RETURN;
END;

global
updating procedure AddTTrans_CLInVc(record TRVc TRr,record CLInVc CLInr)
BEGIN
  row TRVc TRrw;
  Integer i,rwcnt;
  record TAccVc TAccr;
  record TTRBlock TTRb;

  BlockLoad(TTRb);
  if (TTRb.FromCLIn!=0) then begin
    rwcnt = MatRowCnt(TRr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TRr,i,TRrw);
      if (TRrw.stp==1) and (TRrw.ovst==0) then begin
        if (nonblank(TRrw.TAccNumber)) then begin      
          TAccr.TAccNumber = TRrw.TAccNumber;
          if (ReadFirstMain(TAccr,1,true)) then begin
            AddExtraInforToTTR_CLInVc(TRr,TRrw,i,TAccr.Group,CLInr);
          end;
        end;
      end;
    end;
  end;
  RETURN;
END;

function string 255 GetFieldValueByName_CLOutVc(record CLOutVc CLOutr,Integer clout,string FileName,string field)
BEGIN
  string 255 res;
  row CLOutVc CLOutrw;
  
  if (clout>=0) then begin
    MatRowGet(CLOutr,clout,CLOutrw);
  end;
  switch (FileName) begin
  end;
  GetFieldValueByName_CLOutVc = res;
  RETURN;
END;

updating procedure AddExtraInforToTTR_CLOutVc(record TRVc TRr,row TRVc TRrw,Integer rownr,string Group,record CLOutVc CLOutr)
BEGIN
  record TAccGroupVc TAccGroupr;
  record TTRVc TTRr,tempTTRr;
  record TTRMapVc TTRMapr;
  row TAccGroupVc TAccGrouprw;
  Integer i,rwcnt;
  row TTRVc TTRrw;
  Integer clout,vrwcnt;
  Integer stp;
  Boolean storerowttrf,storettrf;  

  TAccGroupr.Code = Group;
  if (ReadFirstMain(TAccGroupr,1,true)) then begin    
    CreateNewTTR(TRr,TRrw,rownr,TAccGroupr.Code,tempTTRr);
    storettrf = true;
    rwcnt = MatRowCnt(TAccGroupr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TAccGroupr,i,TAccGrouprw);
      TTRMapr.Code = TAccGrouprw.Field;
      TTRMapr.FileName = "CLOutVc";
      TTRMapr.Type = 0;
      if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
        stp = TTRMapr.RowType;
        ClearRow(tempTTRr,TTRrw,stp);
        TTRrw.stp = stp;
        TTRrw.Value = GetFieldValueByName(CLOutr,TTRMapr.Field,-1);
        if (nonblank(TTRrw.Value)) then begin
          MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
        end;
      end else begin
        TTRMapr.FromFileName = "CLOutVc";
        TTRMapr.Type = 0;
        TTRMapr.Code = TAccGrouprw.Field;
        if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(tempTTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName_CLOutVc(CLOutr,-1,TTRMapr.FileName,TTRMapr.Field);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
          end;
        end;
      end;
    end;
    RecordCopy(TTRr,tempTTRr);
    
    vrwcnt = MatRowCnt(CLOutr);
    for (clout=0;clout<vrwcnt;clout=clout+1) begin   
      storerowttrf = false;   
      for (i=0;i<rwcnt;i=i+1) begin
        MatRowGet(TAccGroupr,i,TAccGrouprw);
        TTRMapr.Code = TAccGrouprw.Field;
        TTRMapr.FileName = "CLOutVc";
        TTRMapr.Type = 1;
        if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(TTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName(CLOutr,TTRMapr.Field,clout);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
            storerowttrf = true;
          end;
        end else begin
          TTRMapr.FromFileName = "CLOutVc";
          TTRMapr.Type = 1;
          TTRMapr.Code = TAccGrouprw.Field;
          if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
            stp = TTRMapr.RowType;
            ClearRow(tempTTRr,TTRrw,stp);
            TTRrw.stp = stp;
            TTRrw.Value = GetFieldValueByName_CLOutVc(CLOutr,clout,TTRMapr.FileName,TTRMapr.Field);
            if (nonblank(TTRrw.Value)) then begin
              MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
              storerowttrf = true;
            end;
          end;
        end;
      end;
      if (storerowttrf) then begin
        StoreTTR(TTRr);
        RecordCopy(TTRr,tempTTRr);
        storettrf = false;
      end;
    end;
    if (storettrf) then begin
      StoreTTR(TTRr);
    end;
  end;
  RETURN;
END;

global
updating procedure AddTTrans_CLOutVc(record TRVc TRr,record CLOutVc CLOutr)
BEGIN
  row TRVc TRrw;
  Integer i,rwcnt;
  record TAccVc TAccr;
  record TTRBlock TTRb;

  BlockLoad(TTRb);
  if (TTRb.FromCLOut!=0) then begin
    rwcnt = MatRowCnt(TRr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TRr,i,TRrw);
      if (TRrw.stp==1) and (TRrw.ovst==0) then begin
        if (nonblank(TRrw.TAccNumber)) then begin      
          TAccr.TAccNumber = TRrw.TAccNumber;
          if (ReadFirstMain(TAccr,1,true)) then begin
            AddExtraInforToTTR_CLOutVc(TRr,TRrw,i,TAccr.Group,CLOutr);
          end;
        end;
      end;
    end;
  end;
  RETURN;
END;

function string 255 GetFieldValueByName_IntIVVc(record IntIVVc IntIVr,Integer intiv,string FileName,string field)
BEGIN
  string 255 res;
  row IntIVVc IntIVrw;
  
  if (intiv>=0) then begin
    MatRowGet(IntIVr,intiv,IntIVrw);
  end;
  switch (FileName) begin
  end;
  GetFieldValueByName_IntIVVc = res;
  RETURN;
END;

updating procedure AddExtraInforToTTR_IntIVVc(record TRVc TRr,row TRVc TRrw,Integer rownr,string Group,record IntIVVc IntIVr)
BEGIN
  record TAccGroupVc TAccGroupr;
  record TTRVc TTRr,tempTTRr;
  record TTRMapVc TTRMapr;
  row TAccGroupVc TAccGrouprw;
  Integer i,rwcnt;
  row TTRVc TTRrw;
  Integer intiv,vrwcnt;
  Integer stp;
  Boolean storerowttrf,storettrf;  

  TAccGroupr.Code = Group;
  if (ReadFirstMain(TAccGroupr,1,true)) then begin    
    CreateNewTTR(TRr,TRrw,rownr,TAccGroupr.Code,tempTTRr);
    storettrf = true;
    rwcnt = MatRowCnt(TAccGroupr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TAccGroupr,i,TAccGrouprw);
      TTRMapr.Code = TAccGrouprw.Field;
      TTRMapr.FileName = "IntIVVc";
      TTRMapr.Type = 0;
      if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
        stp = TTRMapr.RowType;
        ClearRow(tempTTRr,TTRrw,stp);
        TTRrw.stp = stp;
        TTRrw.Value = GetFieldValueByName(IntIVr,TTRMapr.Field,-1);
        if (nonblank(TTRrw.Value)) then begin
          MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
        end;
      end else begin
        TTRMapr.FromFileName = "IntIVVc";
        TTRMapr.Type = 0;
        TTRMapr.Code = TAccGrouprw.Field;
        if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(tempTTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName_IntIVVc(IntIVr,-1,TTRMapr.FileName,TTRMapr.Field);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(tempTTRr,MatRowCnt(tempTTRr),TTRrw);
          end;
        end;
      end;
    end;
    RecordCopy(TTRr,tempTTRr);
    
    vrwcnt = MatRowCnt(IntIVr);
    for (intiv=0;intiv<vrwcnt;intiv=intiv+1) begin   
      storerowttrf = false;   
      for (i=0;i<rwcnt;i=i+1) begin
        MatRowGet(TAccGroupr,i,TAccGrouprw);
        TTRMapr.Code = TAccGrouprw.Field;
        TTRMapr.FileName = "IntIVVc";
        TTRMapr.Type = 1;
        if (ReadFirstKey("CodeFNType",TTRMapr,3,true)) then begin
          stp = TTRMapr.RowType;
          ClearRow(TTRr,TTRrw,stp);
          TTRrw.stp = stp;
          TTRrw.Value = GetFieldValueByName(IntIVr,TTRMapr.Field,intiv);
          if (nonblank(TTRrw.Value)) then begin
            MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
            storerowttrf = true;
          end;
        end else begin
          TTRMapr.FromFileName = "IntIVVc";
          TTRMapr.Type = 1;
          TTRMapr.Code = TAccGrouprw.Field;
          if (ReadFirstKey("FFNType",TTRMapr,3,true)) then begin
            stp = TTRMapr.RowType;
            ClearRow(tempTTRr,TTRrw,stp);
            TTRrw.stp = stp;
            TTRrw.Value = GetFieldValueByName_IntIVVc(IntIVr,intiv,TTRMapr.FileName,TTRMapr.Field);
            if (nonblank(TTRrw.Value)) then begin
              MatRowPut(TTRr,MatRowCnt(TTRr),TTRrw);
              storerowttrf = true;
            end;
          end;
        end;
      end;
      if (storerowttrf) then begin
        StoreTTR(TTRr);
        RecordCopy(TTRr,tempTTRr);
        storettrf = false;
      end;
    end;
    if (storettrf) then begin
      StoreTTR(TTRr);
    end;
  end;
  RETURN;
END;

global
updating procedure AddTTrans_IntIVVc(record TRVc TRr,record IntIVVc IntIVr)
BEGIN
  row TRVc TRrw;
  Integer i,rwcnt;
  record TAccVc TAccr;
  record TTRBlock TTRb;

  BlockLoad(TTRb);
  if (TTRb.FromIntIV!=0) then begin
    rwcnt = MatRowCnt(TRr);
    for (i=0;i<rwcnt;i=i+1) begin
      MatRowGet(TRr,i,TRrw);
      if (TRrw.stp==1) and (TRrw.ovst==0) then begin
        if (nonblank(TRrw.TAccNumber)) then begin      
          TAccr.TAccNumber = TRrw.TAccNumber;
          if (ReadFirstMain(TAccr,1,true)) then begin
            AddExtraInforToTTR_IntIVVc(TRr,TRrw,i,TAccr.Group,IntIVr);
          end;
        end;
      end;
    end;
  end;
  RETURN;
END;