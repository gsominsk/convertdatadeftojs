/*
global
procedure TablesViewWClassDo(string curuser,Array string atable,Array string alabel,Array string achairs,Array string aguest,Array Integer astatus,var Integer acnt)
begin
  record NeighbourHoodVc NHr;
  record RestAccVc RestAccr;
  Boolean found;
  string 255 tstr;
  
  acnt = 0;
  ResetLoop(NHr);
  found = true;
  NHr.Table = "";
  while (LoopMain(NHr,1,found)) begin
    if (found) then begin
      atable[acnt] = NHr.Table;
      alabel[acnt] = NHr.Comment;
      achairs[acnt] = NHr.Seats;
      astatus[acnt] = 0;
      if (NHr.Waiter==curuser) then begin
        astatus[acnt] = 1;
      end;
      RestAccr.CustCode = NHr.Table;
      if (ReadFirstKey("OpenTabs",RestAccr,1,true)) then begin
        if (nonblank(RestAccr.GuestName)) then begin
          tstr = chr(10);
          tstr = tstr & Left(RestAccr.GuestName,15);
          aguest[acnt] = tstr;
        end;
      end;
      acnt = acnt + 1;
    end;
  end;
  return;
end;
*/

procedure AddToArray(string table,string curuser,Array string atable,Array string alabel,Array string achairs,Array string aguest,Array Integer astatus,var Integer acnt)
begin
  record RestAccVc RestAccr;
  record NeighbourHoodVc NHr;
  string 255 tstr;

  astatus[acnt] = -1;
  if (nonblank(table)) then begin
  NHr.Table = table;
  if (ReadFirstMain(NHr,1,true)) then begin
    atable[acnt] = NHr.Table;
    if (nonblank(NHr.TableLayoutName)) then begin
      atable[acnt] = NHr.TableLayoutName;
    end;
    alabel[acnt] = NHr.Comment;
    achairs[acnt] = NHr.Seats;
    astatus[acnt] = 0;
    if (NHr.Waiter==curuser) then begin
      astatus[acnt] = 1;
    end;
    if (blank(NHr.Waiter))  then begin
      astatus[acnt] = 2;
    end;
    RestAccr.CustCode = NHr.Table;
    if (ReadFirstKey("OpenTabs",RestAccr,1,true)) then begin
      if (nonblank(RestAccr.GuestName)) then begin
        tstr = chr(10);
        tstr = tstr & Left(RestAccr.GuestName,15);
        aguest[acnt] = tstr;
      end;
    end;
  end;
  end;
  acnt = acnt + 1;
  return;
end;

global
procedure TablesViewWClassDo(record LocalMachineBlock LMb,string curuser,Array string atable,Array string alabel,Array string achairs,Array string aguest,Array Integer astatus,var Integer acnt,var LongInt horizontal)
begin
  record TableLayoutVc TLr;
  row TableLayoutVc TLrw;
  Integer i,rwcnt;
  Boolean found;
  
  acnt = 0;
  Horizontal = -1;
  TLr.BranchID = LMb.BranchID;
  found = ReadFirstKey("BranchID",TLr,1,true);
  if (found==false) then begin
    TLr.Code = "";
    found = ReadFirstMain(TLr,1,true);
  end;
  if (found==false) then begin
    TLr.MachineName = LMb.LocalMachineCode;
    found = ReadFirstKey("MachineName",TLr,1,true);
  end;
  if (found==false) then begin
    TLr.MachineName = "";
    found = ReadFirstKey("MachineName",TLr,1,true);
  end;
  if (found) then begin
    horizontal = TLr.Horizontal;
    rwcnt = MatRowCnt(TLr);
    for (i=0;i<TLr.Vertical;i=i+1) begin
      MatRowGet(TLr,i,TLrw);
      if (TLr.Horizontal>0) then begin      
        AddToArray(TLrw.Table0,curuser,atable,alabel,achairs,aguest,astatus,acnt);
      end;
      if (TLr.Horizontal>1) then begin      
        AddToArray(TLrw.Table1,curuser,atable,alabel,achairs,aguest,astatus,acnt);
      end;
      if (TLr.Horizontal>2) then begin      
        AddToArray(TLrw.Table2,curuser,atable,alabel,achairs,aguest,astatus,acnt);
      end;
      if (TLr.Horizontal>3) then begin      
        AddToArray(TLrw.Table3,curuser,atable,alabel,achairs,aguest,astatus,acnt);
      end;
      if (TLr.Horizontal>4) then begin      
        AddToArray(TLrw.Table4,curuser,atable,alabel,achairs,aguest,astatus,acnt);
      end;
      if (TLr.Horizontal>5) then begin      
        AddToArray(TLrw.Table5,curuser,atable,alabel,achairs,aguest,astatus,acnt);
      end;
      if (TLr.Horizontal>6) then begin      
        AddToArray(TLrw.Table6,curuser,atable,alabel,achairs,aguest,astatus,acnt);
      end;
      if (TLr.Horizontal>7) then begin      
        AddToArray(TLrw.Table7,curuser,atable,alabel,achairs,aguest,astatus,acnt);
      end;
      if (TLr.Horizontal>8) then begin      
        AddToArray(TLrw.Table8,curuser,atable,alabel,achairs,aguest,astatus,acnt);
      end;
      if (TLr.Horizontal>9) then begin      
        AddToArray(TLrw.Table9,curuser,atable,alabel,achairs,aguest,astatus,acnt);
      end;
    end;
  end;
  return;
end;
